<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Journal Viewer</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            background: #000;
            font-family: 'Orbitron', sans-serif;
        }

        #canvas-container {
            width: 100%;
            height: 100%;
            cursor: default;
        }

        #canvas-container.fps-mode {
            cursor: crosshair;
        }

        /* Behavior Mode Buttons */
        .behavior-mode-btn {
            background: rgba(128, 128, 128, 0.3) !important;
            border: 1px solid rgba(128, 128, 128, 0.5) !important;
            transition: all 0.3s;
        }

        .behavior-mode-btn.active {
            background: rgba(128, 128, 128, 0.5) !important;
            border: 1px solid rgba(255, 255, 255, 0.7) !important;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.8), 
                        0 0 25px rgba(255, 255, 255, 0.5),
                        inset 0 0 10px rgba(255, 255, 255, 0.3) !important;
        }

        /* MySpace Grid Buttons */
        .myspace-grid-btn {
            background: rgba(128, 128, 128, 0.3) !important;
            border: 1px solid rgba(128, 128, 128, 0.5) !important;
            transition: all 0.3s;
        }

        .myspace-grid-btn.active {
            background: rgba(128, 128, 128, 0.5) !important;
            border: 1px solid rgba(255, 255, 255, 0.7) !important;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.8), 
                        0 0 25px rgba(255, 255, 255, 0.5),
                        inset 0 0 10px rgba(255, 255, 255, 0.3) !important;
        }

        /* Inspector Panel */
        #inspector-panel {
            position: fixed;
            left: 70px;
            top: 90px;
            width: 320px;
            max-height: calc(100vh - 400px);
            overflow-y: auto;
            background: rgba(25, 25, 30, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(128, 128, 128, 0.3);
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4), inset 0 1px 1px rgba(255, 255, 255, 0.1);
            color: #fff;
            z-index: 1000;
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        #inspector-panel.visible {
            left: 70px;
            top: 90px;
        }

        #inspector-panel.minimized {
            height: auto;
            width: auto;
            max-height: none;
        }

        /* MySpace Panel */
        #myspace-panel {
            position: fixed;
            left: 410px;
            top: 90px;
            width: 320px;
            max-height: calc(100vh - 400px);
            overflow-y: auto;
            background: rgba(25, 25, 30, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(128, 128, 128, 0.3);
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4), inset 0 1px 1px rgba(255, 255, 255, 0.1);
            color: #fff;
            z-index: 1000;
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        #myspace-panel.visible {
            left: 410px;
            top: 90px;
        }

        #myspace-panel.minimized {
            height: auto;
            width: auto;
            max-height: none;
        }

        .myspace-control-btn:hover {
            background: rgba(128, 128, 128, 0.5);
            border-color: rgba(128, 128, 128, 0.7);
        }

        .myspace-control-btn.active {
            background: rgba(128, 128, 128, 0.5);
            border-color: rgba(128, 128, 128, 0.8);
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.3);
        }

        /* Help Panel */
        #help-panel {
            position: fixed;
            left: 750px;
            top: 90px;
            width: 320px;
            max-height: calc(100vh - 200px);
            overflow-y: auto;
            background: rgba(25, 25, 30, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(128, 128, 128, 0.3);
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4), inset 0 1px 1px rgba(255, 255, 255, 0.1);
            color: #fff;
            z-index: 1000;
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        #help-panel.visible {
            left: 750px;
            top: 90px;
        }

        #help-panel.minimized {
            height: auto;
            width: auto;
            max-height: none;
        }

        #chat-button:hover {
            transform: scale(1.1);
            border-color: rgba(128, 128, 128, 0.8);
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
        }

        .panel-header {
            position: sticky;
            top: 0;
            padding: 12px 16px;
            background: rgba(25, 25, 30, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(128, 128, 128, 0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: move;
            user-select: none;
            z-index: 10;
            border-top-left-radius: 16px;
            border-top-right-radius: 16px;
        }

        .panel-title {
            font-size: 14px;
            font-weight: 600;
            letter-spacing: 0.5px;
            color: #fff;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.8), 0 0 20px rgba(255, 255, 255, 0.5);
        }

        .panel-controls {
            display: flex;
            gap: 8px;
        }

        .panel-btn {
            width: 24px;
            height: 24px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            color: #fff;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .panel-btn:hover {
            background: rgba(128, 128, 128, 0.3);
        }

        .close-btn:hover {
            background: rgba(226, 74, 74, 0.3);
        }

        .panel-content {
            padding: 20px;
        }

        .panel-content.hidden {
            display: none;
        }

        .info-label {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.5);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .info-value {
            font-size: 16px;
            color: #808080;
            font-weight: 600;
            margin-bottom: 20px;
        }

        .info-text {
            font-size: 14px;
            color: #fff;
            margin-bottom: 24px;
        }

        .slider-container {
            margin-bottom: 12px;
        }

        .slider {
            width: 100%;
            height: 4px;
            background: rgba(128, 128, 128, 0.2);
            border-radius: 2px;
            outline: none;
            cursor: pointer;
            -webkit-appearance: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            background: #808080;
            border-radius: 50%;
            cursor: pointer;
        }

        .slider::-moz-range-thumb {
            width: 16px;
            height: 16px;
            background: #808080;
            border-radius: 50%;
            cursor: pointer;
            border: none;
        }

        .info-box {
            margin-top: 20px;
            padding: 12px;
            background: rgba(128, 128, 128, 0.1);
            border-radius: 8px;
            font-size: 12px;
            line-height: 1.6;
            color: rgba(255, 255, 255, 0.7);
        }

        .summon-buttons {
            margin-top: 15px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .summon-btn {
            padding: 10px 12px;
            background: rgba(128, 128, 128, 0.3);
            border: 1px solid rgba(128, 128, 128, 0.5);
            border-radius: 8px;
            color: #fff;
            cursor: pointer;
            font-family: 'Orbitron', sans-serif;
            font-size: 11px;
            font-weight: 600;
            transition: all 0.2s;
        }

        .summon-btn:hover {
            background: rgba(128, 128, 128, 0.5);
            border-color: rgba(128, 128, 128, 0.8);
            transform: translateX(3px);
        }

        .summon-btn:active {
            transform: scale(0.98);
        }

        /* Mobile Movement Control */
        #movement-control {
            position: fixed;
            bottom: 20px;
            left: 20px;
            width: 150px;
            height: 150px;
            z-index: 1000;
        }

        /* Right Hand Movement Control */
        #rh-movement-control {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 150px;
            height: 150px;
            z-index: 1000;
        }

        /* Conscious Hand Movement Control */
        #ch-movement-control {
            position: fixed;
            top: 90px; /* Right under navbar */
            left: 50%;
            transform: translateX(-50%);
            width: 150px;
            height: 150px;
            z-index: 1000;
        }

        .joystick-base {
            width: 150px;
            height: 150px;
            background: rgba(25, 25, 30, 0.85);
            backdrop-filter: blur(20px);
            border: 2px solid rgba(128, 128, 128, 0.3);
            border-radius: 50%;
            position: relative;
            box-shadow: 0 8px 32px rgba(255, 255, 255, 0.4), 
                        0 4px 16px rgba(255, 255, 255, 0.3),
                        0 0 30px rgba(255, 255, 255, 0.2);
        }

        .joystick-stick {
            width: 60px;
            height: 60px;
            background: rgba(128, 128, 128, 0.6);
            border: 2px solid rgba(255, 255, 255, 0.9);
            border-radius: 50%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            cursor: pointer;
            transition: background 0.1s;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.9), 
                        0 0 35px rgba(255, 255, 255, 0.7),
                        0 0 50px rgba(255, 255, 255, 0.5),
                        inset 0 0 25px rgba(255, 255, 255, 0.3);
        }

        .joystick-stick:active {
            background: rgba(128, 128, 128, 0.9);
            box-shadow: 0 0 25px rgba(255, 255, 255, 1.0), 
                        0 0 45px rgba(255, 255, 255, 0.8),
                        0 0 60px rgba(255, 255, 255, 0.6),
                        inset 0 0 30px rgba(255, 255, 255, 0.4);
        }

        /* Control Buttons Grid */
        .control-buttons {
            position: fixed;
            bottom: 20px;
            left: 190px;
            display: grid;
            grid-template-columns: repeat(5, 35px);
            grid-template-rows: repeat(3, 35px);
            gap: 6px;
            z-index: 1000;
        }

        .control-btn {
            width: 35px;
            height: 35px;
            background: rgba(25, 25, 30, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(128, 128, 128, 0.3);
            border-radius: 6px;
            color: #fff;
            font-size: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            font-family: 'Orbitron', sans-serif;
            font-weight: 600;
        }

        .vertical-btn {
            font-size: 16px;
        }

        .control-btn:hover {
            background: rgba(128, 128, 128, 0.3);
            border-color: rgba(128, 128, 128, 0.6);
        }

        .control-btn.active {
            background: rgba(128, 128, 128, 0.6);
            border-color: rgba(128, 128, 128, 0.9);
        }

        /* Transform Panel */
        #transform-panel {
            position: fixed;
            bottom: 200px;
            left: 20px;
            width: 280px;
            background: rgba(25, 25, 30, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(128, 128, 128, 0.3);
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            z-index: 999;
            display: none;
        }

        /* FAQ Panel */
        #faq-panel {
            position: fixed;
            top: -100%;
            left: 50%;
            transform: translateX(-50%);
            width: 500px;
            max-width: 90vw;
            background: rgba(25, 25, 30, 0.9);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(128, 128, 128, 0.3);
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            z-index: 1001;
            transition: top 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        #faq-panel.visible {
            top: 50%;
            transform: translate(-50%, -50%);
        }

        .faq-content {
            padding: 20px;
            max-height: 70vh;
            overflow-y: auto;
        }

        .faq-content::-webkit-scrollbar {
            width: 8px;
        }

        .faq-content::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
        }

        .faq-content::-webkit-scrollbar-thumb {
            background: rgba(128, 128, 128, 0.5);
            border-radius: 4px;
        }

        .faq-content::-webkit-scrollbar-thumb:hover {
            background: rgba(128, 128, 128, 0.7);
        }

        .faq-item {
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(128, 128, 128, 0.2);
        }

        .faq-item:last-child {
            border-bottom: none;
        }

        .faq-question {
            font-size: 13px;
            color: #808080;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .faq-answer {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.7);
            line-height: 1.6;
        }

        /* Camera Rotation Circle */
        #camera-circle {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80px;
            height: 80px;
            border: 2px solid rgba(128, 128, 128, 0.2);
            border-radius: 50%;
            pointer-events: none;
            z-index: 10;
            transition: all 0.2s;
            opacity: 0;
            display: none;
        }

        .fps-mode #camera-circle {
            border-color: rgba(128, 128, 128, 0.6);
            border-width: 3px;
            opacity: 1;
            display: block;
        }

        #camera-circle::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 6px;
            height: 6px;
            background: rgba(128, 128, 128, 0.5);
            border-radius: 50%;
            transition: all 0.2s;
        }

        .fps-mode #camera-circle::before {
            width: 8px;
            height: 8px;
            background: rgba(128, 128, 128, 0.9);
        }

        /* Top Left Info Panel */
        #info-panel {
            position: fixed;
            top: 20px;
            left: 190px;
            padding: 16px 20px;
            background: rgba(25, 25, 30, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(128, 128, 128, 0.3);
            border-radius: 12px;
            z-index: 1000;
            min-width: 200px;
            transition: all 0.3s ease;
        }

        .info-space-title {
            font-size: 16px;
            font-weight: 700;
            color: #808080;
            margin-bottom: 8px;
            letter-spacing: 0.5px;
        }

        .info-username {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 8px;
        }

        .info-timer {
            font-size: 14px;
            font-weight: 700;
            color: #fff;
            font-family: 'Courier New', monospace;
        }

        /* Top Right Search Panel */
        #search-panel {
            position: fixed;
            top: 90px;
            right: 65px;
            background: rgba(25, 25, 30, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(128, 128, 128, 0.3);
            border-radius: 12px;
            z-index: 1000;
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            overflow: hidden;
        }

        #search-panel.collapsed {
            width: 35px;
            height: 35px;
            cursor: pointer;
        }

        #search-panel.expanded {
            width: 300px;
            height: auto;
            padding: 12px 16px;
        }

        .search-icon {
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            color: #808080;
            cursor: pointer;
        }

        .search-content {
            display: none;
        }

        #search-panel.expanded .search-icon {
            display: none;
        }

        #search-panel.expanded .search-content {
            display: block;
        }

        .search-input {
            width: 100%;
            padding: 10px 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(128, 128, 128, 0.3);
            border-radius: 8px;
            color: #fff;
            font-family: 'Orbitron', sans-serif;
            font-size: 13px;
            outline: none;
        }

        .search-input::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }

        .search-input:focus {
            border-color: rgba(128, 128, 128, 0.6);
            background: rgba(128, 128, 128, 0.1);
        }

        /* Hamburger Menus */
        .hamburger-btn {
            position: fixed;
            top: 90px;
            width: 35px;
            height: 35px;
            background: rgba(25, 25, 30, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(128, 128, 128, 0.3);
            border-radius: 6px;
            cursor: pointer;
            z-index: 1002;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 4px;
            transition: all 0.3s;
        }

        .hamburger-btn:hover {
            background: rgba(128, 128, 128, 0.3);
            border-color: rgba(128, 128, 128, 0.6);
        }

        .hamburger-btn span {
            width: 20px;
            height: 2px;
            background: #808080;
            border-radius: 2px;
            transition: all 0.3s;
        }

        #left-hamburger {
            left: 20px;
        }

        #left-hamburger.menu-open {
            left: 320px;
        }

        #right-hamburger {
            right: 20px;
        }

        #right-hamburger.menu-open {
            right: 320px;
        }

        /* Side Menus */
        .side-menu {
            position: fixed;
            top: 0;
            width: 300px;
            height: 100vh;
            background: rgba(25, 25, 30, 0.7);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(128, 128, 128, 0.3);
            z-index: 1001;
            transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            overflow-y: auto;
        }

        .side-menu::-webkit-scrollbar {
            width: 8px;
        }

        .side-menu::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }

        .side-menu::-webkit-scrollbar-thumb {
            background: rgba(128, 128, 128, 0.5);
            border-radius: 4px;
        }

        #left-menu {
            left: 0;
            transform: translateX(-100%);
            border-right: 1px solid rgba(128, 128, 128, 0.3);
            border-left: none;
        }

        #left-menu.open {
            transform: translateX(0);
        }

        #right-menu {
            right: 0;
            transform: translateX(100%);
            border-left: 1px solid rgba(128, 128, 128, 0.3);
            border-right: none;
        }

        #right-menu.open {
            transform: translateX(0);
        }

        .menu-header {
            padding: 20px;
            background: rgba(128, 128, 128, 0.15);
            border-bottom: 1px solid rgba(128, 128, 128, 0.3);
        }

        .menu-title {
            font-size: 16px;
            font-weight: 700;
            letter-spacing: 1px;
            color: #fff;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.8), 0 0 20px rgba(255, 255, 255, 0.5);
        }

        .menu-items {
            padding: 20px;
        }

        .menu-item {
            padding: 15px 20px;
            margin-bottom: 10px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(128, 128, 128, 0.2);
            border-radius: 8px;
            color: #fff;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 13px;
            font-weight: 500;
            letter-spacing: 0.5px;
        }

        .menu-item:hover {
            background: rgba(128, 128, 128, 0.2);
            border-color: rgba(128, 128, 128, 0.5);
            transform: translateX(5px);
        }

        .menu-item.active {
            background: rgba(128, 128, 128, 0.4);
            border-color: rgba(128, 128, 128, 0.7);
        }

        /* Breadcrumb Navigation */
        .breadcrumb {
            padding: 15px 20px;
            background: rgba(128, 128, 128, 0.1);
            border-bottom: 1px solid rgba(128, 128, 128, 0.2);
            font-size: 11px;
            color: rgba(255, 255, 255, 0.6);
            display: flex;
            align-items: center;
            gap: 8px;
            overflow-x: auto;
            white-space: nowrap;
        }

        .breadcrumb-item {
            cursor: pointer;
            transition: color 0.2s;
        }

        .breadcrumb-item:hover {
            color: #808080;
        }

        .breadcrumb-separator {
            color: rgba(255, 255, 255, 0.3);
        }

        .breadcrumb-current {
            color: #808080;
            font-weight: 600;
        }

        /* Submenu */
        .submenu {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
            margin-left: 20px;
        }

        .menu-item.expanded .submenu {
            max-height: 500px;
        }

        .submenu-item {
            padding: 10px 15px;
            margin: 5px 0;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(128, 128, 128, 0.15);
            border-radius: 6px;
            color: rgba(255, 255, 255, 0.8);
            cursor: pointer;
            transition: all 0.2s;
            font-size: 11px;
        }

        .submenu-item:hover {
            background: rgba(128, 128, 128, 0.15);
            border-color: rgba(128, 128, 128, 0.4);
            transform: translateX(3px);
        }

        .menu-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .expand-icon {
            font-size: 10px;
            transition: transform 0.3s;
        }

        .menu-item.expanded .expand-icon {
            transform: rotate(90deg);
        }

        .submenu-item.has-children {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* Prompt Modal */
        .prompt-modal {
            position: fixed;
            top: -100%;
            left: 50%;
            transform: translateX(-50%);
            width: 500px;
            max-width: 90vw;
            background: rgba(25, 25, 30, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(128, 128, 128, 0.3);
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            z-index: 2000;
            transition: top 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            padding: 24px;
        }

        .prompt-modal.visible {
            top: 50%;
            transform: translate(-50%, -50%);
        }

        .prompt-title {
            font-size: 18px;
            font-weight: 700;
            color: #808080;
            margin-bottom: 16px;
            text-align: center;
        }

        .prompt-message {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 20px;
            line-height: 1.6;
            text-align: center;
        }

        .prompt-buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
        }

        .prompt-btn {
            padding: 10px 20px;
            background: rgba(128, 128, 128, 0.3);
            border: 1px solid rgba(128, 128, 128, 0.5);
            border-radius: 8px;
            color: #fff;
            cursor: pointer;
            font-family: 'Orbitron', sans-serif;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.2s;
        }

        .prompt-btn:hover {
            background: rgba(128, 128, 128, 0.5);
            border-color: rgba(128, 128, 128, 0.8);
        }

        .prompt-close {
            position: absolute;
            top: 12px;
            right: 12px;
            width: 24px;
            height: 24px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            color: #fff;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .prompt-close:hover {
            background: rgba(226, 74, 74, 0.3);
        }

        /* Theme Selection */
        .theme-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-top: 16px;
        }

        .theme-option {
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid transparent;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
            font-size: 11px;
        }

        .theme-option:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(128, 128, 128, 0.5);
        }

        .theme-option.active {
            border-color: rgba(128, 128, 128, 0.9);
            background: rgba(128, 128, 128, 0.2);
        }

        .theme-color-preview {
            width: 100%;
            height: 40px;
            border-radius: 6px;
            margin-bottom: 8px;
        }

        /* Hand Menus */
        .hand-menu {
            position: fixed;
            width: 200px;
            height: 200px;
            pointer-events: none;
            z-index: 1500;
            transition: opacity 0.3s;
            opacity: 0;
        }

        .hand-menu.visible {
            opacity: 1;
            pointer-events: all;
        }

        #left-hand {
            left: 20%;
            top: 70%;
            transform: translate(-50%, -50%);
        }

        #right-hand {
            right: 20%;
            top: 70%;
            transform: translate(50%, -50%);
        }

        #conscious-hand {
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
        }

        .hand-circle {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80px;
            height: 80px;
            background: rgba(255, 255, 255, 0.5);
            border: 2px solid rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.8), 
                        0 0 40px rgba(255, 255, 255, 0.6),
                        inset 0 0 20px rgba(255, 255, 255, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Orbitron', sans-serif;
            font-size: 14px;
            font-weight: 700;
            color: #333;
            cursor: pointer;
        }

        .radial-menu {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 100%;
            height: 100%;
            transform: translate(-50%, -50%);
        }

        .radial-item {
            position: absolute;
            width: 60px;
            height: 60px;
            background: rgba(255, 255, 255, 0.85);
            border: 2px solid rgba(128, 128, 128, 0.6);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: 600;
            color: #333;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 0 10px rgba(128, 128, 128, 0.4);
        }

        .radial-item:hover {
            background: rgba(128, 128, 128, 0.9);
            color: #fff;
            transform: scale(1.15);
            box-shadow: 0 0 20px rgba(128, 128, 128, 0.8);
        }

        /* Pause Menu Overlay */
        .pause-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            z-index: 2500;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .pause-overlay.visible {
            display: flex;
        }

        .pause-menu {
            background: rgba(25, 25, 30, 0.95);
            backdrop-filter: blur(20px);
            border: 2px solid rgba(128, 128, 128, 0.6);
            border-radius: 20px;
            padding: 60px 80px;
            text-align: center;
            box-shadow: 0 0 40px rgba(128, 128, 128, 0.4);
        }

        .pause-title {
            font-size: 48px;
            font-weight: 700;
            color: #808080;
            margin-bottom: 30px;
            letter-spacing: 4px;
        }

        .pause-btn {
            padding: 15px 40px;
            background: rgba(128, 128, 128, 0.4);
            border: 2px solid rgba(128, 128, 128, 0.7);
            border-radius: 12px;
            color: #fff;
            font-family: 'Orbitron', sans-serif;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
        }

        .pause-btn:hover {
            background: rgba(128, 128, 128, 0.7);
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(128, 128, 128, 0.6);
        }

        /* Pocket Panel */
        .pocket-panel {
            position: fixed;
            right: -600px;
            top: 50%;
            transform: translateY(-50%);
            width: 550px;
            height: 600px;
            background: rgba(25, 25, 30, 0.65);
            backdrop-filter: blur(20px);
            border: 2px solid rgba(128, 128, 128, 0.4);
            border-right: none;
            border-radius: 20px 0 0 20px;
            z-index: 1800;
            transition: right 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            padding: 30px;
        }

        .pocket-panel.visible {
            right: 0;
        }

        .pocket-header {
            font-size: 24px;
            font-weight: 700;
            color: #808080;
            margin-bottom: 20px;
            text-align: center;
            letter-spacing: 2px;
        }

        .pocket-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(5, 1fr);
            gap: 12px;
            height: calc(100% - 60px);
        }

        .pocket-slot {
            background: rgba(255, 255, 255, 0.35);
            border: 2px solid rgba(128, 128, 128, 0.5);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .pocket-slot:hover {
            background: rgba(128, 128, 128, 0.5);
            border-color: rgba(128, 128, 128, 0.9);
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(128, 128, 128, 0.6);
        }

        .pocket-slot.in-scene {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(128, 128, 128, 0.3);
        }

        .pocket-slot.empty {
            background: rgba(255, 255, 255, 0.1);
            border: 2px dashed rgba(128, 128, 128, 0.3);
        }

        .pocket-slot-number {
            position: absolute;
            top: 5px;
            left: 8px;
            font-size: 10px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.6);
        }

        .pocket-slot-content {
            font-size: 12px;
            font-weight: 600;
            color: #fff;
            text-align: center;
            padding: 5px;
        }

        .pocket-slot-icon {
            font-size: 24px;
            margin-bottom: 5px;
        }

        /* Virtual Keyboard */
        #virtual-keyboard {
            position: fixed;
            bottom: -400px;
            right: 20px;
            width: 600px;
            max-width: 90vw;
            background: rgba(25, 25, 30, 0.95);
            backdrop-filter: blur(20px);
            border: 2px solid rgba(128, 128, 128, 0.4);
            border-radius: 16px 16px 0 0;
            padding: 20px;
            z-index: 2000;
            transition: bottom 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        #virtual-keyboard.visible {
            bottom: 0;
        }

        .keyboard-row {
            display: flex;
            gap: 6px;
            margin-bottom: 6px;
            justify-content: center;
        }

        .key-btn {
            min-width: 40px;
            height: 40px;
            padding: 0 10px;
            background: rgba(128, 128, 128, 0.3);
            border: 1px solid rgba(128, 128, 128, 0.5);
            border-radius: 6px;
            color: #fff;
            font-family: 'Orbitron', sans-serif;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .key-btn:hover {
            background: rgba(128, 128, 128, 0.6);
            transform: translateY(-2px);
        }

        .key-btn:active {
            transform: translateY(0);
            background: rgba(128, 128, 128, 0.8);
        }

        .key-btn.wide {
            min-width: 80px;
        }

        /* Text color classes for theme support */
        .theme-text {
            transition: color 0.3s;
        }

        /* Rainbow animations */
        @keyframes rainbowFlow {
            0% { filter: hue-rotate(0deg); }
            100% { filter: hue-rotate(360deg); }
        }

        @keyframes rainbowBorder {
            0% { border-color: #ff0000; }
            14% { border-color: #ff7f00; }
            28% { border-color: #ffff00; }
            42% { border-color: #00ff00; }
            57% { border-color: #0000ff; }
            71% { border-color: #4b0082; }
            85% { border-color: #9400d3; }
            100% { border-color: #ff0000; }
        }

        @keyframes rainbowGlow {
            0% { box-shadow: 0 0 20px #ff0000, 0 0 40px #ff0000; }
            14% { box-shadow: 0 0 20px #ff7f00, 0 0 40px #ff7f00; }
            28% { box-shadow: 0 0 20px #ffff00, 0 0 40px #ffff00; }
            42% { box-shadow: 0 0 20px #00ff00, 0 0 40px #00ff00; }
            57% { box-shadow: 0 0 20px #0000ff, 0 0 40px #0000ff; }
            71% { box-shadow: 0 0 20px #4b0082, 0 0 40px #4b0082; }
            85% { box-shadow: 0 0 20px #9400d3, 0 0 40px #9400d3; }
            100% { box-shadow: 0 0 20px #ff0000, 0 0 40px #ff0000; }
        }

        .rainbow-animated {
            animation: rainbowFlow 9.2s linear infinite;
        }

        .rainbow-border {
            animation: rainbowBorder 9.2s linear infinite;
        }

        .rainbow-glow {
            animation: rainbowGlow 9.2s linear infinite;
        }

        /* Docks */
        .dock {
            position: fixed;
            background: rgba(25, 25, 30, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(128, 128, 128, 0.3);
            z-index: 999;
            display: flex;
            gap: 10px;
            padding: 10px;
            transition: all 0.3s;
        }

        .dock.hidden {
            opacity: 0;
            pointer-events: none;
        }

        #dock-bottom {
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            flex-direction: row;
            border-radius: 16px 16px 0 0;
            border-bottom: none;
            margin-bottom: 0;
        }

        #dock-top {
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            flex-direction: row;
            border-radius: 0 0 16px 16px;
            border-top: none;
            margin-top: 0;
        }

        #dock-left {
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            flex-direction: column;
            border-radius: 0 16px 16px 0;
            border-left: none;
            margin-left: 0;
        }

        #dock-right {
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            flex-direction: column;
            border-radius: 16px 0 0 16px;
            border-right: none;
            margin-right: 0;
        }

        .dock-item {
            width: 60px;
            height: 60px;
            background: rgba(128, 128, 128, 0.3);
            border: 1px solid rgba(128, 128, 128, 0.5);
            border-radius: 8px;
            cursor: grab;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-size: 11px;
            font-weight: 600;
            transition: all 0.2s;
            user-select: none;
        }

        .dock-item:hover {
            background: rgba(128, 128, 128, 0.5);
            transform: scale(1.1);
        }

        .dock-item:active {
            cursor: grabbing;
        }

        .dock-item.dragging {
            opacity: 0.5;
            cursor: grabbing;
        }

        .dock.drag-over {
            background: rgba(128, 128, 128, 0.2);
            border-color: rgba(128, 128, 128, 0.7);
        }

        .transform-header {
            padding: 12px 16px;
            background: rgba(128, 128, 128, 0.15);
            border-bottom: 1px solid rgba(128, 128, 128, 0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .transform-content {
            padding: 16px;
        }

        .transform-row {
            margin-bottom: 16px;
        }

        .transform-label {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.5);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .transform-inputs {
            display: flex;
            gap: 8px;
        }

        .transform-input {
            flex: 1;
            padding: 8px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(128, 128, 128, 0.3);
            border-radius: 6px;
            color: #fff;
            font-family: 'Orbitron', sans-serif;
            font-size: 12px;
            text-align: center;
        }

        .transform-input:focus {
            outline: none;
            border-color: rgba(128, 128, 128, 0.6);
            background: rgba(128, 128, 128, 0.1);
        }

        .step-control {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 8px;
        }

        .step-label {
            font-size: 10px;
            color: rgba(255, 255, 255, 0.5);
            min-width: 40px;
        }

        .step-input {
            flex: 1;
            padding: 6px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(128, 128, 128, 0.3);
            border-radius: 4px;
            color: #fff;
            font-family: 'Orbitron', sans-serif;
            font-size: 11px;
        }

        .transform-submit-container {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(128, 128, 128, 0.2);
        }

        .transform-submit-btn {
            width: 100%;
            padding: 12px;
            background: rgba(128, 128, 128, 0.4);
            border: 1px solid rgba(128, 128, 128, 0.6);
            border-radius: 8px;
            color: #fff;
            cursor: pointer;
            font-family: 'Orbitron', sans-serif;
            font-size: 12px;
            font-weight: 700;
            letter-spacing: 0.5px;
            transition: all 0.2s;
        }

        .transform-submit-btn:hover {
            background: rgba(128, 128, 128, 0.6);
            border-color: rgba(128, 128, 128, 0.9);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(128, 128, 128, 0.4);
        }

        .transform-submit-btn:active {
            transform: translateY(0);
        }

        /* Action Button Grid */
        #action-grid {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: grid;
            grid-template-columns: repeat(6, 50px);
            gap: 8px;
            z-index: 1000;
        }

        #action-grid.hidden {
            display: none;
        }

        .action-btn {
            width: 50px;
            height: 50px;
            background: rgba(25, 25, 30, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(128, 128, 128, 0.3);
            border-radius: 8px;
            color: #fff;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            font-family: 'Orbitron', sans-serif;
            font-weight: 600;
        }

        .action-btn:hover {
            background: rgba(128, 128, 128, 0.3);
            border-color: rgba(128, 128, 128, 0.6);
        }

        .action-btn.active {
            background: rgba(128, 128, 128, 0.6);
            border-color: rgba(128, 128, 128, 0.9);
        }

        /* Responsive adjustments */
        @media (orientation: portrait) {
            #action-grid {
                grid-template-columns: repeat(5, 50px);
            }
        }

        @media (orientation: landscape) {
            #action-grid {
                grid-template-columns: repeat(6, 50px);
            }
        }

        @media (max-width: 768px) {
            #inspector-panel {
                width: 280px;
            }
            
            .panel-content {
                padding: 16px;
            }
        }

        /* Tool Menus - Positioned Directionally */
        /* RH Tool Menu - Right Side */
        #rh-tool-menu {
            position: fixed;
            top: 30%;
            right: 20px;
            width: 45%;
            max-width: 700px;
            z-index: 2000;
            cursor: move;
        }

        /* LH Tool Menu - Left Side */
        #lh-tool-menu {
            position: fixed;
            top: 30%;
            left: 20px;
            width: 45%;
            max-width: 700px;
            z-index: 2000;
            cursor: move;
        }

        /* CH Tool Menu - Top Center */
        #ch-tool-menu {
            position: fixed;
            top: 250px;
            left: 50%;
            transform: translateX(-50%);
            width: 45%;
            max-width: 700px;
            z-index: 2000;
            cursor: move;
        }

        #lh-tool-menu .tool-menu-container {
            /* More transparent overall */
            background: linear-gradient(90deg, 
                rgba(25, 25, 30, 0.2) 0%,
                rgba(25, 25, 30, 0.4) 20%,
                rgba(25, 25, 30, 0.25) 50%,
                rgba(25, 25, 30, 0.4) 80%,
                rgba(25, 25, 30, 0.5) 100%
            );
            backdrop-filter: blur(20px);
            border: 2px solid rgba(128, 128, 128, 0.4);
            border-radius: 16px;
            padding: 10px 16px;
            box-shadow: 0 10px 50px rgba(0, 0, 0, 0.8),
                        0 0 40px rgba(255, 255, 255, 0.3);
            /* Complete fade on left edge - fades border and everything */
            -webkit-mask-image: linear-gradient(90deg, 
                transparent 0%, 
                rgba(0, 0, 0, 0.3) 5%,
                rgba(0, 0, 0, 1) 15%, 
                rgba(0, 0, 0, 1) 100%
            );
            mask-image: linear-gradient(90deg, 
                transparent 0%, 
                rgba(0, 0, 0, 0.3) 5%,
                rgba(0, 0, 0, 1) 15%, 
                rgba(0, 0, 0, 1) 100%
            );
        }

        #rh-tool-menu .tool-menu-container {
            /* More transparent overall */
            background: linear-gradient(90deg, 
                rgba(25, 25, 30, 0.5) 0%,
                rgba(25, 25, 30, 0.4) 20%,
                rgba(25, 25, 30, 0.25) 50%,
                rgba(25, 25, 30, 0.4) 80%,
                rgba(25, 25, 30, 0.2) 100%
            );
            backdrop-filter: blur(20px);
            border: 2px solid rgba(128, 128, 128, 0.4);
            border-radius: 16px;
            padding: 10px 16px;
            box-shadow: 0 10px 50px rgba(0, 0, 0, 0.8),
                        0 0 40px rgba(255, 255, 255, 0.3);
            /* Complete fade on right edge - fades border and everything */
            -webkit-mask-image: linear-gradient(90deg, 
                rgba(0, 0, 0, 1) 0%, 
                rgba(0, 0, 0, 1) 85%, 
                rgba(0, 0, 0, 0.3) 95%,
                transparent 100%
            );
            mask-image: linear-gradient(90deg, 
                rgba(0, 0, 0, 1) 0%, 
                rgba(0, 0, 0, 1) 85%, 
                rgba(0, 0, 0, 0.3) 95%,
                transparent 100%
            );
        }

        #ch-tool-menu .tool-menu-container {
            /* More transparent overall */
            background: linear-gradient(90deg, 
                rgba(25, 25, 30, 0.2) 0%,
                rgba(25, 25, 30, 0.4) 20%,
                rgba(25, 25, 30, 0.25) 50%,
                rgba(25, 25, 30, 0.4) 80%,
                rgba(25, 25, 30, 0.2) 100%
            );
            backdrop-filter: blur(20px);
            border: 2px solid rgba(128, 128, 128, 0.4);
            border-radius: 16px;
            padding: 10px 16px;
            box-shadow: 0 10px 50px rgba(0, 0, 0, 0.8),
                        0 0 40px rgba(255, 255, 255, 0.3);
            /* Complete fade on BOTH left and right edges */
            -webkit-mask-image: linear-gradient(90deg, 
                transparent 0%, 
                rgba(0, 0, 0, 0.3) 5%,
                rgba(0, 0, 0, 1) 15%, 
                rgba(0, 0, 0, 1) 85%, 
                rgba(0, 0, 0, 0.3) 95%,
                transparent 100%
            );
            mask-image: linear-gradient(90deg, 
                transparent 0%, 
                rgba(0, 0, 0, 0.3) 5%,
                rgba(0, 0, 0, 1) 15%, 
                rgba(0, 0, 0, 1) 85%, 
                rgba(0, 0, 0, 0.3) 95%,
                transparent 100%
            );
        }

        .tool-menu-header {
            font-size: 14px;
            font-weight: 700;
            color: #fff;
            text-align: center;
            margin-bottom: 10px;
            letter-spacing: 2px;
            text-shadow: 0 0 15px rgba(255, 255, 255, 0.9),
                         0 0 30px rgba(255, 255, 255, 0.6);
        }

        .tool-menu-items {
            display: flex;
            gap: 12px;
            overflow-x: auto;
            padding: 8px 0;
            scrollbar-width: thin;
            scrollbar-color: rgba(128, 128, 128, 0.5) transparent;
        }

        .tool-menu-items::-webkit-scrollbar {
            height: 4px;
        }

        .tool-menu-items::-webkit-scrollbar-track {
            background: transparent;
        }

        .tool-menu-items::-webkit-scrollbar-thumb {
            background: rgba(128, 128, 128, 0.5);
            border-radius: 3px;
        }

        .tool-item {
            min-width: 80px;
            height: 80px;
            background: rgba(128, 128, 128, 0.2);
            border: 2px solid rgba(128, 128, 128, 0.4);
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 12px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.8);
        }

        .tool-item:hover,
        .tool-item.selected {
            background: rgba(128, 128, 128, 0.4);
            border-color: rgba(255, 255, 255, 0.8);
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.8),
                        0 0 35px rgba(255, 255, 255, 0.5),
                        inset 0 0 15px rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .tool-menu-footer {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid rgba(128, 128, 128, 0.3);
            text-align: center;
            font-size: 11px;
            color: rgba(255, 255, 255, 0.7);
            min-height: 30px;
        }

        /* Rotating Gradient Circles for Hand Menus */
        .hand-menu::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 180px;
            height: 180px;
            transform: translate(-50%, -50%);
            border-radius: 50%;
            background: conic-gradient(
                from 0deg,
                transparent 0%,
                rgba(255, 255, 255, 0.8) 25%,
                transparent 50%,
                rgba(255, 255, 255, 0.8) 75%,
                transparent 100%
            );
            border: 2px solid transparent;
            pointer-events: none;
            z-index: -1;
        }

        /* LH - Clockwise rotation */
        #left-hand::before {
            animation: rotateClockwise 4s linear infinite;
        }

        /* RH - Counter-clockwise rotation */
        #right-hand::before {
            animation: rotateCounterClockwise 4s linear infinite;
        }

        /* CH - X-axis rotation (double dutch style) */
        #conscious-hand::before {
            animation: rotateXAxis 4s linear infinite;
            transform-style: preserve-3d;
        }

        @keyframes rotateClockwise {
            from { transform: translate(-50%, -50%) rotate(0deg); }
            to { transform: translate(-50%, -50%) rotate(360deg); }
        }

        @keyframes rotateCounterClockwise {
            from { transform: translate(-50%, -50%) rotate(360deg); }
            to { transform: translate(-50%, -50%) rotate(0deg); }
        }

        @keyframes rotateXAxis {
            from { transform: translate(-50%, -50%) rotateX(0deg); }
            to { transform: translate(-50%, -50%) rotateX(360deg); }
        }
    </style>
</head>
<body>
    <div id="canvas-container"></div>

    <!-- Compact Header Bar -->
    <div id="header-bar" style="position: fixed; top: 10px; left: 20px; right: 20px; height: 60px; background: rgba(25, 25, 30, 0.85); backdrop-filter: blur(20px); border: 1px solid rgba(128, 128, 128, 0.3); border-radius: 12px; padding: 8px 16px; z-index: 1000; display: flex; align-items: center; gap: 8px;">
        
        <!-- Profile Picture -->
        <div id="profile-image-container" style="width: 44px; height: 44px; border-radius: 50%; border: 2px solid rgba(128, 128, 128, 0.5); overflow: hidden; cursor: pointer; background: rgba(128, 128, 128, 0.2); display: flex; align-items: center; justify-content: center; font-size: 24px; color: rgba(128, 128, 128, 0.8); flex-shrink: 0;">
            
        </div>
        <input type="file" id="profile-image-input" accept="image/*" style="display: none;">
        
        <!-- User Info Column -->
        <div style="display: flex; flex-direction: column; gap: 2px; min-width: 150px;">
            <div style="display: flex; align-items: center; gap: 6px;">
                <span style="font-size: 11px; color: rgba(255, 255, 255, 0.6); font-weight: 600;">USER:</span>
                <div id="header-username" contenteditable="true" style="font-size: 12px; font-weight: 700; color: #fff; border: 1px solid transparent; padding: 2px 4px; border-radius: 3px; outline: none; cursor: text;">undefined</div>
            </div>
            <div id="header-description" contenteditable="true" style="font-size: 10px; color: rgba(255, 255, 255, 0.5); border: 1px solid transparent; padding: 2px 4px; border-radius: 3px; outline: none; cursor: text; min-width: 100px;">Add description...</div>
        </div>
        
        <!-- Divider -->
        <div style="width: 1px; height: 40px; background: rgba(128, 128, 128, 0.2); flex-shrink: 0;"></div>
        
        <!-- Primary Space Info Column -->
        <div style="display: flex; flex-direction: column; gap: 4px; min-width: 140px;">
            <div style="font-size: 9px; font-weight: 700; color: #fff; letter-spacing: 0.5px; margin-bottom: 2px; text-shadow: 0 0 10px rgba(255, 255, 255, 0.8), 0 0 20px rgba(255, 255, 255, 0.5);">PRIMARY SPACE</div>
            <div style="display: flex; flex-direction: column; gap: 2px;">
                <div id="session-timer" style="font-size: 11px; font-weight: 700; color: #fff; font-family: 'Courier New', monospace;">00:00:00.000</div>
                <div id="timezone-display" style="font-size: 10px; font-weight: 700; color: #fff; cursor: pointer; position: relative; font-family: 'Courier New', monospace; text-shadow: 0 0 10px rgba(255, 255, 255, 0.8), 0 0 20px rgba(255, 255, 255, 0.5);">
                    <span id="current-time">--:--:-- --</span>
                    <span id="timezone-abbr" style="margin-left: 4px;">EST</span>
                </div>
                <!-- Timezone Selector Dropdown -->
                <div id="timezone-selector" style="display: none; position: absolute; top: 100%; left: 0; background: rgba(25, 25, 30, 0.95); border: 1px solid rgba(128, 128, 128, 0.3); border-radius: 8px; padding: 8px; min-width: 200px; max-height: 300px; overflow-y: auto; z-index: 10000; backdrop-filter: blur(20px); box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);">
                    <div style="font-size: 10px; font-weight: 700; color: #fff; margin-bottom: 8px; padding-bottom: 4px; border-bottom: 1px solid rgba(128, 128, 128, 0.2);">SELECT TIMEZONE</div>
                    <div class="timezone-option" data-tz="America/New_York" style="padding: 6px; cursor: pointer; font-size: 10px; color: rgba(255, 255, 255, 0.8); border-radius: 4px;">EST - Eastern</div>
                    <div class="timezone-option" data-tz="America/Chicago" style="padding: 6px; cursor: pointer; font-size: 10px; color: rgba(255, 255, 255, 0.8); border-radius: 4px;">CST - Central</div>
                    <div class="timezone-option" data-tz="America/Denver" style="padding: 6px; cursor: pointer; font-size: 10px; color: rgba(255, 255, 255, 0.8); border-radius: 4px;">MST - Mountain</div>
                    <div class="timezone-option" data-tz="America/Los_Angeles" style="padding: 6px; cursor: pointer; font-size: 10px; color: rgba(255, 255, 255, 0.8); border-radius: 4px;">PST - Pacific</div>
                    <div class="timezone-option" data-tz="Europe/London" style="padding: 6px; cursor: pointer; font-size: 10px; color: rgba(255, 255, 255, 0.8); border-radius: 4px;">GMT - London</div>
                    <div class="timezone-option" data-tz="Europe/Paris" style="padding: 6px; cursor: pointer; font-size: 10px; color: rgba(255, 255, 255, 0.8); border-radius: 4px;">CET - Paris</div>
                    <div class="timezone-option" data-tz="Asia/Tokyo" style="padding: 6px; cursor: pointer; font-size: 10px; color: rgba(255, 255, 255, 0.8); border-radius: 4px;">JST - Tokyo</div>
                    <div class="timezone-option" data-tz="Australia/Sydney" style="padding: 6px; cursor: pointer; font-size: 10px; color: rgba(255, 255, 255, 0.8); border-radius: 4px;">AEDT - Sydney</div>
                    <div style="margin-top: 8px; padding-top: 8px; border-top: 1px solid rgba(128, 128, 128, 0.2);">
                        <div id="auto-detect-tz" style="padding: 6px; cursor: pointer; font-size: 10px; color: rgba(74, 144, 226, 0.9); border-radius: 4px; text-align: center;"> Auto-Detect Location</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Divider -->
        <div style="width: 1px; height: 40px; background: rgba(128, 128, 128, 0.2); flex-shrink: 0;"></div>
        
        <!-- Coordinate Guide: Position -->
        <div style="display: flex; flex-direction: column; gap: 2px; min-width: 90px;">
            <div style="font-size: 8px; font-weight: 700; color: #fff; letter-spacing: 0.5px; text-shadow: 0 0 10px rgba(255, 255, 255, 0.8), 0 0 20px rgba(255, 255, 255, 0.5);">POS</div>
            <div style="font-family: 'Courier New', monospace; font-size: 9px; color: rgba(255, 255, 255, 0.8);">
                <div id="coord-pos-x">X: 0.00</div>
                <div id="coord-pos-y">Y: 0.00</div>
                <div id="coord-pos-z">Z: 0.00</div>
            </div>
        </div>
        
        <!-- Coordinate Guide: Rotation -->
        <div style="display: flex; flex-direction: column; gap: 2px; min-width: 90px;">
            <div style="font-size: 8px; font-weight: 700; color: #fff; letter-spacing: 0.5px; text-shadow: 0 0 10px rgba(255, 255, 255, 0.8), 0 0 20px rgba(255, 255, 255, 0.5);">ROT</div>
            <div style="font-family: 'Courier New', monospace; font-size: 9px; color: rgba(255, 255, 255, 0.8);">
                <div id="coord-rot-x">X: 0.00</div>
                <div id="coord-rot-y">Y: 0.00</div>
                <div id="coord-rot-z">Z: 0.00</div>
            </div>
        </div>
        
        <!-- Coordinate Guide: Scale -->
        <div style="display: flex; flex-direction: column; gap: 2px; min-width: 90px;">
            <div style="font-size: 8px; font-weight: 700; color: #fff; letter-spacing: 0.5px; text-shadow: 0 0 10px rgba(255, 255, 255, 0.8), 0 0 20px rgba(255, 255, 255, 0.5);">SCA</div>
            <div style="font-family: 'Courier New', monospace; font-size: 9px; color: rgba(255, 255, 255, 0.8);">
                <div id="coord-sca-x">X: 1.00</div>
                <div id="coord-sca-y">Y: 1.00</div>
                <div id="coord-sca-z">Z: 1.00</div>
            </div>
        </div>
        
        <!-- Divider -->
        <div style="width: 1px; height: 40px; background: rgba(128, 128, 128, 0.2); flex-shrink: 0;"></div>
        
        <!-- FPS Column -->
        <div style="display: flex; flex-direction: column; gap: 2px; min-width: 60px;">
            <div style="font-size: 8px; font-weight: 700; color: #fff; letter-spacing: 0.5px; text-shadow: 0 0 10px rgba(255, 255, 255, 0.8), 0 0 20px rgba(255, 255, 255, 0.5);">FPS</div>
            <div style="font-family: 'Courier New', monospace; font-size: 11px; color: rgba(255, 255, 255, 0.9);">
                <div id="fps-counter">60</div>
            </div>
        </div>
        
        <!-- Divider -->
        <div style="width: 1px; height: 40px; background: rgba(128, 128, 128, 0.2); flex-shrink: 0;"></div>
        
        <!-- System Column -->
        <div style="display: flex; flex-direction: column; gap: 2px; min-width: 110px;">
            <div style="font-size: 8px; font-weight: 700; color: #fff; letter-spacing: 0.5px; text-shadow: 0 0 10px rgba(255, 255, 255, 0.8), 0 0 20px rgba(255, 255, 255, 0.5);">SYSTEM</div>
            <div style="font-family: 'Courier New', monospace; font-size: 9px; color: rgba(255, 255, 255, 0.8);">
                <div style="display: flex; justify-content: space-between;">
                    <span>Root:</span>
                    <span id="root-system" style="color: #fff; text-shadow: 0 0 10px rgba(255, 255, 255, 0.8), 0 0 20px rgba(255, 255, 255, 0.5);">default</span>
                </div>
                <div style="display: flex; justify-content: space-between;">
                    <span>Parent:</span>
                    <span id="parent-system" style="color: #fff; text-shadow: 0 0 10px rgba(255, 255, 255, 0.8), 0 0 20px rgba(255, 255, 255, 0.5);">default</span>
                </div>
                <div style="display: flex; justify-content: space-between;">
                    <span>Child:</span>
                    <span id="child-system" style="color: #fff; text-shadow: 0 0 10px rgba(255, 255, 255, 0.8), 0 0 20px rgba(255, 255, 255, 0.5);">default</span>
                </div>
            </div>
        </div>
        
        <!-- Divider -->
        <div style="width: 1px; height: 40px; background: rgba(128, 128, 128, 0.2); flex-shrink: 0;"></div>
        
        <!-- Dimensional Column -->
        <div style="display: flex; flex-direction: column; gap: 2px; min-width: 110px;">
            <div style="font-size: 8px; font-weight: 700; color: #fff; letter-spacing: 0.5px; text-shadow: 0 0 10px rgba(255, 255, 255, 0.8), 0 0 20px rgba(255, 255, 255, 0.5);">DIMENSIONAL</div>
            <div style="font-family: 'Courier New', monospace; font-size: 9px; color: rgba(255, 255, 255, 0.8);">
                <div style="display: flex; justify-content: space-between;">
                    <span>Exp:</span>
                    <span id="dimensional-experience" style="color: #fff; text-shadow: 0 0 10px rgba(255, 255, 255, 0.8), 0 0 20px rgba(255, 255, 255, 0.5);">undefined</span>
                </div>
                <div style="display: flex; justify-content: space-between;">
                    <span>Per:</span>
                    <span id="dimensional-perspective" style="color: #fff; text-shadow: 0 0 10px rgba(255, 255, 255, 0.8), 0 0 20px rgba(255, 255, 255, 0.5);">undefined</span>
                </div>
                <div style="display: flex; justify-content: space-between;">
                    <span>Time:</span>
                    <span id="dimensional-time" style="color: #fff; text-shadow: 0 0 10px rgba(255, 255, 255, 0.8), 0 0 20px rgba(255, 255, 255, 0.5);">undefined</span>
                </div>
                <div style="display: flex; justify-content: space-between;">
                    <span>Space:</span>
                    <span id="dimensional-space" style="color: #fff; text-shadow: 0 0 10px rgba(255, 255, 255, 0.8), 0 0 20px rgba(255, 255, 255, 0.5);">undefined</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Top Right Search Panel -->
    <div id="search-panel" class="collapsed">
        <div class="search-icon"></div>
        <div class="search-content">
            <input type="text" class="search-input" placeholder="Search..." id="search-input">
        </div>
    </div>

    <!-- Camera Rotation Circle -->
    <div id="camera-circle"></div>

    <!-- Hamburger Menu Buttons -->
    <div class="hamburger-btn" id="left-hamburger">
        <span></span>
        <span></span>
        <span></span>
    </div>

    <div class="hamburger-btn" id="right-hamburger">
        <span></span>
        <span></span>
        <span></span>
    </div>

    <!-- Left Side Menu (Admin/System) -->
    <div class="side-menu" id="left-menu">
        <div class="menu-header">
            <div class="menu-title">- ADMIN & SYSTEM</div>
        </div>
        <div class="breadcrumb" id="left-breadcrumb">
            <span class="breadcrumb-item breadcrumb-current">Admin & System</span>
        </div>
        <div class="menu-items">
            <div class="menu-item" data-page="admin">
                <div class="menu-item-header">
                    <span> Admin</span>
                    <span class="expand-icon"></span>
                </div>
                <div class="submenu">
                    <div class="submenu-item" data-submenu="admin-00"> subMenuItem00</div>
                    <div class="submenu-item" data-submenu="admin-01"> subMenuItem01</div>
                    <div class="submenu-item" data-submenu="admin-02"> subMenuItem02</div>
                    <div class="submenu-item" data-submenu="admin-03"> subMenuItem03</div>
                    <div class="submenu-item" data-submenu="admin-04"> subMenuItem04</div>
                    <div class="submenu-item" data-submenu="admin-05"> subMenuItem05</div>
                    <div class="submenu-item" data-submenu="admin-06"> subMenuItem06</div>
                    <div class="submenu-item" data-submenu="admin-07"> UI Transparency</div>
                    <div class="submenu-item" data-submenu="admin-08"> Particle Behavior</div>
                    <div class="submenu-item has-children" data-submenu="admin-theme">
                         Theme
                        <span class="expand-icon"></span>
                    </div>
                    <div class="submenu-item has-children" data-submenu="admin-restart">
                         Restart App
                        <span class="expand-icon"></span>
                    </div>
                </div>
            </div>
            <div class="menu-item" data-page="system">
                <div class="menu-item-header">
                    <span> Systems</span>
                    <span class="expand-icon"></span>
                </div>
                <div class="submenu">
                    <div class="submenu-item" data-submenu="system-00" style="flex-direction: column; align-items: flex-start; padding: 12px;">
                        <div style="margin-bottom: 8px; font-weight: 600;"> UI Transparency</div>
                        <input type="range" id="ui-transparency-slider" min="0" max="100" value="100" 
                               style="width: 100%; cursor: pointer;">
                        <div style="display: flex; justify-content: space-between; width: 100%; font-size: 10px; margin-top: 4px;">
                            <span>Hidden</span>
                            <span id="transparency-value">100%</span>
                            <span>Opaque</span>
                        </div>
                    </div>
                    <div class="submenu-item" data-submenu="system-01"> MySpace</div>
                    <div class="submenu-item" data-submenu="system-02"> subMenuItem02</div>
                    <div class="submenu-item" data-submenu="system-03"> subMenuItem03</div>
                    <div class="submenu-item" data-submenu="system-04"> subMenuItem04</div>
                    <div class="submenu-item" data-submenu="system-05"> subMenuItem05</div>
                    <div class="submenu-item" data-submenu="system-06"> subMenuItem06</div>
                    <div class="submenu-item" data-submenu="system-07"> subMenuItem07</div>
                    <div class="submenu-item" data-submenu="system-08"> subMenuItem08</div>
                    <div class="submenu-item" data-submenu="system-09"> subMenuItem09</div>
                    <div class="submenu-item" data-submenu="system-10"> subMenuItem10</div>
                    <div class="submenu-item" data-submenu="system-11"> NAV</div>
                </div>
            </div>
            <div class="menu-item" data-page="continuous-experiences">
                <div class="menu-item-header">
                    <span>Continuous Experiences</span>
                    <span class="expand-icon"></span>
                </div>
                <div class="submenu">
                    <div class="submenu-item" data-submenu="continuous-00">subMenuItem00</div>
                    <div class="submenu-item" data-submenu="continuous-01">subMenuItem01</div>
                    <div class="submenu-item" data-submenu="continuous-02">subMenuItem02</div>
                    <div class="submenu-item" data-submenu="continuous-03">subMenuItem03</div>
                    <div class="submenu-item" data-submenu="continuous-04">subMenuItem04</div>
                    <div class="submenu-item" data-submenu="continuous-05">subMenuItem05</div>
                    <div class="submenu-item" data-submenu="continuous-06">subMenuItem06</div>
                    <div class="submenu-item" data-submenu="continuous-07">subMenuItem07</div>
                    <div class="submenu-item" data-submenu="continuous-08">subMenuItem08</div>
                    <div class="submenu-item" data-submenu="continuous-09">subMenuItem09</div>
                    <div class="submenu-item" data-submenu="continuous-10">subMenuItem10</div>
                </div>
            </div>
            <div class="menu-item" data-page="experiences">
                <div class="menu-item-header">
                    <span>Experiences</span>
                    <span class="expand-icon"></span>
                </div>
                <div class="submenu">
                    <div class="submenu-item" data-submenu="experiences-00">subMenuItem00</div>
                    <div class="submenu-item" data-submenu="experiences-01">subMenuItem01</div>
                    <div class="submenu-item" data-submenu="experiences-02">subMenuItem02</div>
                    <div class="submenu-item" data-submenu="experiences-03">subMenuItem03</div>
                    <div class="submenu-item" data-submenu="experiences-04">subMenuItem04</div>
                    <div class="submenu-item" data-submenu="experiences-05">subMenuItem05</div>
                    <div class="submenu-item" data-submenu="experiences-06">subMenuItem06</div>
                    <div class="submenu-item" data-submenu="experiences-07">subMenuItem07</div>
                    <div class="submenu-item" data-submenu="experiences-08">subMenuItem08</div>
                    <div class="submenu-item" data-submenu="experiences-09">subMenuItem09</div>
                    <div class="submenu-item" data-submenu="experiences-10">subMenuItem10</div>
                </div>
            </div>
            <div class="menu-item" data-page="expressions">
                <div class="menu-item-header">
                    <span>Expressions</span>
                    <span class="expand-icon"></span>
                </div>
                <div class="submenu">
                    <div class="submenu-item" data-submenu="expressions-00">subMenuItem00</div>
                    <div class="submenu-item" data-submenu="expressions-01">subMenuItem01</div>
                    <div class="submenu-item" data-submenu="expressions-02">subMenuItem02</div>
                    <div class="submenu-item" data-submenu="expressions-03">subMenuItem03</div>
                    <div class="submenu-item" data-submenu="expressions-04">subMenuItem04</div>
                    <div class="submenu-item" data-submenu="expressions-05">subMenuItem05</div>
                    <div class="submenu-item" data-submenu="expressions-06">subMenuItem06</div>
                    <div class="submenu-item" data-submenu="expressions-07">subMenuItem07</div>
                    <div class="submenu-item" data-submenu="expressions-08">subMenuItem08</div>
                    <div class="submenu-item" data-submenu="expressions-09">subMenuItem09</div>
                    <div class="submenu-item" data-submenu="expressions-10">subMenuItem10</div>
                </div>
            </div>
            <div class="menu-item" data-page="perspectives">
                <div class="menu-item-header">
                    <span>Perspectives</span>
                    <span class="expand-icon"></span>
                </div>
                <div class="submenu">
                    <div class="submenu-item" data-submenu="perspectives-00">subMenuItem00</div>
                    <div class="submenu-item" data-submenu="perspectives-01">subMenuItem01</div>
                    <div class="submenu-item" data-submenu="perspectives-02">subMenuItem02</div>
                    <div class="submenu-item" data-submenu="perspectives-03">subMenuItem03</div>
                    <div class="submenu-item" data-submenu="perspectives-04">subMenuItem04</div>
                    <div class="submenu-item" data-submenu="perspectives-05">subMenuItem05</div>
                    <div class="submenu-item" data-submenu="perspectives-06">subMenuItem06</div>
                    <div class="submenu-item" data-submenu="perspectives-07">subMenuItem07</div>
                    <div class="submenu-item" data-submenu="perspectives-08">subMenuItem08</div>
                    <div class="submenu-item" data-submenu="perspectives-09">subMenuItem09</div>
                    <div class="submenu-item" data-submenu="perspectives-10">subMenuItem10</div>
                </div>
            </div>
            <div class="menu-item" data-page="times">
                <div class="menu-item-header">
                    <span>Times</span>
                    <span class="expand-icon"></span>
                </div>
                <div class="submenu">
                    <div class="submenu-item" data-submenu="times-00">subMenuItem00</div>
                    <div class="submenu-item" data-submenu="times-01">subMenuItem01</div>
                    <div class="submenu-item" data-submenu="times-02">subMenuItem02</div>
                    <div class="submenu-item" data-submenu="times-03">subMenuItem03</div>
                    <div class="submenu-item" data-submenu="times-04">subMenuItem04</div>
                    <div class="submenu-item" data-submenu="times-05">subMenuItem05</div>
                    <div class="submenu-item" data-submenu="times-06">subMenuItem06</div>
                    <div class="submenu-item" data-submenu="times-07">subMenuItem07</div>
                    <div class="submenu-item" data-submenu="times-08">subMenuItem08</div>
                    <div class="submenu-item" data-submenu="times-09">subMenuItem09</div>
                    <div class="submenu-item" data-submenu="times-10">subMenuItem10</div>
                </div>
            </div>
            <div class="menu-item" data-page="space">
                <div class="menu-item-header">
                    <span>Spaces</span>
                    <span class="expand-icon"></span>
                </div>
                <div class="submenu">
                    <div class="submenu-item" data-submenu="myspace">MySpace</div>
                    <div class="submenu-item" data-submenu="space-01">subMenuItem01</div>
                    <div class="submenu-item" data-submenu="space-02">subMenuItem02</div>
                    <div class="submenu-item" data-submenu="space-03">subMenuItem03</div>
                    <div class="submenu-item" data-submenu="space-04">subMenuItem04</div>
                    <div class="submenu-item" data-submenu="space-05">subMenuItem05</div>
                    <div class="submenu-item" data-submenu="space-06">subMenuItem06</div>
                    <div class="submenu-item" data-submenu="space-07">subMenuItem07</div>
                    <div class="submenu-item" data-submenu="space-08">subMenuItem08</div>
                    <div class="submenu-item" data-submenu="space-09">subMenuItem09</div>
                    <div class="submenu-item" data-submenu="space-10">subMenuItem10</div>
                </div>
            </div>
            <div class="menu-item" data-page="objects">
                <div class="menu-item-header">
                    <span>Objects</span>
                    <span class="expand-icon"></span>
                </div>
                <div class="submenu">
                    <div class="submenu-item" data-submenu="objects-00">subMenuItem00</div>
                    <div class="submenu-item" data-submenu="objects-01">subMenuItem01</div>
                    <div class="submenu-item" data-submenu="objects-02">subMenuItem02</div>
                    <div class="submenu-item" data-submenu="objects-03">subMenuItem03</div>
                    <div class="submenu-item" data-submenu="objects-04">subMenuItem04</div>
                    <div class="submenu-item" data-submenu="objects-05">subMenuItem05</div>
                    <div class="submenu-item" data-submenu="objects-06">subMenuItem06</div>
                    <div class="submenu-item" data-submenu="objects-07">subMenuItem07</div>
                    <div class="submenu-item" data-submenu="objects-08">subMenuItem08</div>
                    <div class="submenu-item" data-submenu="objects-09">subMenuItem09</div>
                    <div class="submenu-item" data-submenu="objects-10">subMenuItem10</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Right Side Menu (Site Pages) -->
    <div class="side-menu" id="right-menu">
        <div class="menu-header">
            <div class="menu-title">- NAVIGATION</div>
        </div>
        <div class="breadcrumb" id="right-breadcrumb">
            <span class="breadcrumb-item breadcrumb-current">Navigation</span>
        </div>
        <div class="menu-items">
            <div class="menu-item active" data-page="home">
                <div class="menu-item-header">
                    <span> Home</span>
                    <span class="expand-icon"></span>
                </div>
                <div class="submenu">
                    <div class="submenu-item" data-submenu="home-00"> subMenuItem00</div>
                    <div class="submenu-item" data-submenu="home-01"> subMenuItem01</div>
                    <div class="submenu-item" data-submenu="home-02"> subMenuItem02</div>
                    <div class="submenu-item" data-submenu="home-03"> subMenuItem03</div>
                    <div class="submenu-item" data-submenu="home-04"> subMenuItem04</div>
                    <div class="submenu-item" data-submenu="home-05"> subMenuItem05</div>
                    <div class="submenu-item" data-submenu="home-06"> subMenuItem06</div>
                    <div class="submenu-item" data-submenu="home-07"> subMenuItem07</div>
                    <div class="submenu-item" data-submenu="home-08"> subMenuItem08</div>
                    <div class="submenu-item" data-submenu="home-09"> subMenuItem09</div>
                    <div class="submenu-item" data-submenu="home-10"> subMenuItem10</div>
                </div>
            </div>
            <div class="menu-item" data-page="about">
                <div class="menu-item-header">
                    <span> About Me</span>
                    <span class="expand-icon"></span>
                </div>
                <div class="submenu">
                    <div class="submenu-item" data-submenu="about-00"> subMenuItem00</div>
                    <div class="submenu-item" data-submenu="about-01"> subMenuItem01</div>
                    <div class="submenu-item" data-submenu="about-02"> subMenuItem02</div>
                    <div class="submenu-item" data-submenu="about-03"> subMenuItem03</div>
                    <div class="submenu-item" data-submenu="about-04"> subMenuItem04</div>
                    <div class="submenu-item" data-submenu="about-05"> subMenuItem05</div>
                    <div class="submenu-item" data-submenu="about-06"> subMenuItem06</div>
                    <div class="submenu-item" data-submenu="about-07"> subMenuItem07</div>
                    <div class="submenu-item" data-submenu="about-08"> subMenuItem08</div>
                    <div class="submenu-item" data-submenu="about-09"> subMenuItem09</div>
                    <div class="submenu-item" data-submenu="about-10"> subMenuItem10</div>
                </div>
            </div>
            <div class="menu-item" data-page="portfolio">
                <div class="menu-item-header">
                    <span> Portfolio</span>
                    <span class="expand-icon"></span>
                </div>
                <div class="submenu">
                    <div class="submenu-item" data-submenu="portfolio-00"> subMenuItem00</div>
                    <div class="submenu-item" data-submenu="portfolio-01"> subMenuItem01</div>
                    <div class="submenu-item" data-submenu="portfolio-02"> subMenuItem02</div>
                    <div class="submenu-item" data-submenu="portfolio-03"> subMenuItem03</div>
                    <div class="submenu-item" data-submenu="portfolio-04"> subMenuItem04</div>
                    <div class="submenu-item" data-submenu="portfolio-05"> subMenuItem05</div>
                    <div class="submenu-item" data-submenu="portfolio-06"> subMenuItem06</div>
                    <div class="submenu-item" data-submenu="portfolio-07"> subMenuItem07</div>
                    <div class="submenu-item" data-submenu="portfolio-08"> subMenuItem08</div>
                    <div class="submenu-item" data-submenu="portfolio-09"> subMenuItem09</div>
                    <div class="submenu-item" data-submenu="portfolio-10"> subMenuItem10</div>
                </div>
            </div>
            <div class="menu-item" data-page="products">
                <div class="menu-item-header">
                    <span> Products</span>
                    <span class="expand-icon"></span>
                </div>
                <div class="submenu">
                    <div class="submenu-item" data-submenu="products-00"> subMenuItem00</div>
                    <div class="submenu-item" data-submenu="products-01"> subMenuItem01</div>
                    <div class="submenu-item" data-submenu="products-02"> subMenuItem02</div>
                    <div class="submenu-item" data-submenu="products-03"> subMenuItem03</div>
                    <div class="submenu-item" data-submenu="products-04"> subMenuItem04</div>
                    <div class="submenu-item" data-submenu="products-05"> subMenuItem05</div>
                    <div class="submenu-item" data-submenu="products-06"> subMenuItem06</div>
                    <div class="submenu-item" data-submenu="products-07"> subMenuItem07</div>
                    <div class="submenu-item" data-submenu="products-08"> subMenuItem08</div>
                    <div class="submenu-item" data-submenu="products-09"> subMenuItem09</div>
                    <div class="submenu-item" data-submenu="products-10"> subMenuItem10</div>
                </div>
            </div>
            <div class="menu-item" data-page="services">
                <div class="menu-item-header">
                    <span> Services</span>
                    <span class="expand-icon"></span>
                </div>
                <div class="submenu">
                    <div class="submenu-item" data-submenu="services-00"> subMenuItem00</div>
                    <div class="submenu-item" data-submenu="services-01"> subMenuItem01</div>
                    <div class="submenu-item" data-submenu="services-02"> subMenuItem02</div>
                    <div class="submenu-item" data-submenu="services-03"> subMenuItem03</div>
                    <div class="submenu-item" data-submenu="services-04"> subMenuItem04</div>
                    <div class="submenu-item" data-submenu="services-05"> subMenuItem05</div>
                    <div class="submenu-item" data-submenu="services-06"> subMenuItem06</div>
                    <div class="submenu-item" data-submenu="services-07"> subMenuItem07</div>
                    <div class="submenu-item" data-submenu="services-08"> subMenuItem08</div>
                    <div class="submenu-item" data-submenu="services-09"> subMenuItem09</div>
                    <div class="submenu-item" data-submenu="services-10"> subMenuItem10</div>
                </div>
            </div>
            <div class="menu-item" data-page="resources">
                <div class="menu-item-header">
                    <span> Resources</span>
                    <span class="expand-icon"></span>
                </div>
                <div class="submenu">
                    <div class="submenu-item" data-submenu="resources-00"> subMenuItem00</div>
                    <div class="submenu-item" data-submenu="resources-01"> subMenuItem01</div>
                    <div class="submenu-item" data-submenu="resources-02"> subMenuItem02</div>
                    <div class="submenu-item" data-submenu="resources-03"> subMenuItem03</div>
                    <div class="submenu-item" data-submenu="resources-04"> subMenuItem04</div>
                    <div class="submenu-item" data-submenu="resources-05"> subMenuItem05</div>
                    <div class="submenu-item" data-submenu="resources-06"> subMenuItem06</div>
                    <div class="submenu-item" data-submenu="resources-07"> subMenuItem07</div>
                    <div class="submenu-item" data-submenu="resources-08"> subMenuItem08</div>
                    <div class="submenu-item" data-submenu="resources-09"> subMenuItem09</div>
                    <div class="submenu-item" data-submenu="resources-10"> subMenuItem10</div>
                </div>
            </div>
            <div class="menu-item" data-page="supporters">
                <div class="menu-item-header">
                    <span> Supporters</span>
                    <span class="expand-icon"></span>
                </div>
                <div class="submenu">
                    <div class="submenu-item" data-submenu="supporters-00"> subMenuItem00</div>
                    <div class="submenu-item" data-submenu="supporters-01"> subMenuItem01</div>
                    <div class="submenu-item" data-submenu="supporters-02"> subMenuItem02</div>
                    <div class="submenu-item" data-submenu="supporters-03"> subMenuItem03</div>
                    <div class="submenu-item" data-submenu="supporters-04"> subMenuItem04</div>
                    <div class="submenu-item" data-submenu="supporters-05"> subMenuItem05</div>
                    <div class="submenu-item" data-submenu="supporters-06"> subMenuItem06</div>
                    <div class="submenu-item" data-submenu="supporters-07"> subMenuItem07</div>
                    <div class="submenu-item" data-submenu="supporters-08"> subMenuItem08</div>
                    <div class="submenu-item" data-submenu="supporters-09"> subMenuItem09</div>
                    <div class="submenu-item" data-submenu="supporters-10"> subMenuItem10</div>
                </div>
            </div>
            <div class="menu-item" data-page="contact">
                <div class="menu-item-header">
                    <span> Contact</span>
                    <span class="expand-icon"></span>
                </div>
                <div class="submenu">
                    <div class="submenu-item" data-submenu="contact-00"> subMenuItem00</div>
                    <div class="submenu-item" data-submenu="contact-01"> subMenuItem01</div>
                    <div class="submenu-item" data-submenu="contact-02"> subMenuItem02</div>
                    <div class="submenu-item" data-submenu="contact-03"> subMenuItem03</div>
                    <div class="submenu-item" data-submenu="contact-04"> subMenuItem04</div>
                    <div class="submenu-item" data-submenu="contact-05"> subMenuItem05</div>
                    <div class="submenu-item" data-submenu="contact-06"> subMenuItem06</div>
                    <div class="submenu-item" data-submenu="contact-07"> subMenuItem07</div>
                    <div class="submenu-item" data-submenu="contact-08"> subMenuItem08</div>
                    <div class="submenu-item" data-submenu="contact-09"> subMenuItem09</div>
                    <div class="submenu-item" data-submenu="contact-10"> subMenuItem10</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Docks -->
    <div class="dock hidden" id="dock-bottom">
        <div class="dock-item" draggable="true" data-item="1">D1</div>
        <div class="dock-item" draggable="true" data-item="2">D2</div>
        <div class="dock-item" draggable="true" data-item="3">D3</div>
        <div class="dock-item" draggable="true" data-item="4">D4</div>
        <div class="dock-item" draggable="true" data-item="5">D5</div>
    </div>

    <div class="dock hidden" id="dock-top">
        <div class="dock-item" draggable="true" data-item="6">D6</div>
        <div class="dock-item" draggable="true" data-item="7">D7</div>
        <div class="dock-item" draggable="true" data-item="8">D8</div>
    </div>

    <div class="dock hidden" id="dock-left">
        <div class="dock-item" draggable="true" data-item="9">D9</div>
        <div class="dock-item" draggable="true" data-item="10">D10</div>
        <div class="dock-item" draggable="true" data-item="11">D11</div>
    </div>

    <div class="dock hidden" id="dock-right">
        <div class="dock-item" draggable="true" data-item="12">D12</div>
        <div class="dock-item" draggable="true" data-item="13">D13</div>
        <div class="dock-item" draggable="true" data-item="14">D14</div>
    </div>

    <!-- Restart Prompt Modal -->
    <div class="prompt-modal" id="restart-prompt">
        <button class="prompt-close" onclick="document.getElementById('restart-prompt').classList.remove('visible')"></button>
        <div class="prompt-title">Restart Application?</div>
        <div class="prompt-message">Are you sure you want to restart the application? All unsaved progress will be lost.</div>
        <div class="prompt-buttons">
            <button class="prompt-btn" onclick="location.reload()">Yes</button>
            <button class="prompt-btn" onclick="document.getElementById('restart-prompt').classList.remove('visible')">No</button>
            <button class="prompt-btn" onclick="showWisdomPrompt()">Not Sure</button>
        </div>
    </div>

    <!-- Wisdom Prompt Modal -->
    <div class="prompt-modal" id="wisdom-prompt">
        <button class="prompt-close" onclick="document.getElementById('wisdom-prompt').classList.remove('visible')"></button>
        <div class="prompt-title">Maybe This Will Help...</div>
        <div class="prompt-message" id="wisdom-text"></div>
        <div class="prompt-buttons">
            <button class="prompt-btn" onclick="document.getElementById('wisdom-prompt').classList.remove('visible')">Close</button>
        </div>
    </div>

    <!-- Theme Selector Modal -->
    <div class="prompt-modal" id="theme-prompt">
        <button class="prompt-close" onclick="document.getElementById('theme-prompt').classList.remove('visible')"></button>
        <div class="prompt-title">Select Theme</div>
        <div class="theme-grid" id="theme-grid"></div>
    </div>

    <!-- Left Hand Menu -->
    <div class="hand-menu" id="left-hand">
        <div class="hand-circle">LH</div>
        <div class="radial-menu" id="lh-radial"></div>
    </div>

    <!-- Right Hand Menu -->
    <div class="hand-menu" id="right-hand">
        <div class="hand-circle">RH</div>
        <div class="radial-menu" id="rh-radial"></div>
    </div>

    <!-- Conscious Hand Menu -->
    <div class="hand-menu" id="conscious-hand">
        <div class="hand-circle">CH</div>
        <div class="radial-menu" id="ch-radial"></div>
    </div>

    <!-- RH Horizontal Tool Selection Menu (BotW style) -->
    <div id="rh-tool-menu" style="display: none;">
        <div class="tool-menu-container">
            <div class="tool-menu-header">- RIGHT HAND TOOLS</div>
            <div class="tool-menu-items" id="rh-tool-menu-items">
                <!-- Tools will be populated here -->
            </div>
            <div class="tool-menu-footer">
                <span id="rh-tool-description">Select a tool to view details</span>
            </div>
        </div>
    </div>

    <!-- LH Horizontal Tool Selection Menu -->
    <div id="lh-tool-menu" style="display: none;">
        <div class="tool-menu-container">
            <div class="tool-menu-header">- LEFT HAND TOOLS</div>
            <div class="tool-menu-items" id="lh-tool-menu-items">
                <!-- Tools will be populated here -->
            </div>
            <div class="tool-menu-footer">
                <span id="lh-tool-description">Select a tool to view details</span>
            </div>
        </div>
    </div>

    <!-- CH Horizontal Tool Selection Menu -->
    <div id="ch-tool-menu" style="display: none;">
        <div class="tool-menu-container">
            <div class="tool-menu-header">- CONSCIOUS HAND TOOLS</div>
            <div class="tool-menu-items" id="ch-tool-menu-items">
                <!-- Tools will be populated here -->
            </div>
            <div class="tool-menu-footer">
                <span id="ch-tool-description">Select a tool to view details</span>
            </div>
        </div>
    </div>

    <!-- Pause Overlay -->
    <div class="pause-overlay" id="pause-overlay">
        <div class="pause-menu">
            <div class="pause-title">PAUSED</div>
            <button class="pause-btn" id="resume-btn">Resume</button>
        </div>
    </div>

    <!-- Pocket Panel -->
    <div class="pocket-panel" id="pocket-panel">
        <div class="pocket-header">USER POCKET</div>
        <div class="pocket-grid" id="pocket-grid"></div>
        <div class="pocket-pagination" style="display: flex; justify-content: center; align-items: center; gap: 10px; margin-top: 15px; padding: 10px;">
            <button id="pocket-prev-page" style="padding: 6px 12px; background: rgba(128, 128, 128, 0.3); border: 1px solid rgba(128, 128, 128, 0.5); border-radius: 6px; color: #fff; cursor: pointer; font-family: 'Orbitron', sans-serif; font-size: 11px;"> PREV</button>
            <span id="pocket-page-info" style="font-size: 12px; color: #fff; min-width: 80px; text-align: center;">Page 1 / 10</span>
            <button id="pocket-next-page" style="padding: 6px 12px; background: rgba(128, 128, 128, 0.3); border: 1px solid rgba(128, 128, 128, 0.5); border-radius: 6px; color: #fff; cursor: pointer; font-family: 'Orbitron', sans-serif; font-size: 11px;">NEXT </button>
        </div>
    </div>

    <!-- Particle Behavior Panel -->
    <div id="particle-behavior-panel" class="side-menu" style="display: none; right: 120px; top: 80px; width: 350px; max-height: 600px; overflow-y: auto;">
        <div class="panel-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <span class="panel-title" style="font-size: 18px; font-weight: 700;">- PARTICLE BEHAVIOR</span>
            <button class="panel-btn close-btn" id="particle-behavior-close" style="background: none; border: none; color: #fff; font-size: 24px; cursor: pointer;"></button>
        </div>
        
        <div class="behavior-section" style="margin-bottom: 25px;">
            <div style="font-weight: 600; margin-bottom: 10px; font-size: 14px;">Behavior Mode</div>
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 15px;">
                <button class="behavior-mode-btn active" data-mode="calm" style="padding: 10px; border-radius: 6px; color: #fff; cursor: pointer; font-family: 'Orbitron', sans-serif; font-size: 10px; font-weight: 600;">CALM</button>
                <button class="behavior-mode-btn" data-mode="forward" style="padding: 10px; border-radius: 6px; color: #fff; cursor: pointer; font-family: 'Orbitron', sans-serif; font-size: 10px; font-weight: 600;">FORWARD</button>
                <button class="behavior-mode-btn" data-mode="backward" style="padding: 10px; border-radius: 6px; color: #fff; cursor: pointer; font-family: 'Orbitron', sans-serif; font-size: 10px; font-weight: 600;">BACKWARD</button>
                <button class="behavior-mode-btn" data-mode="upward" style="padding: 10px; border-radius: 6px; color: #fff; cursor: pointer; font-family: 'Orbitron', sans-serif; font-size: 10px; font-weight: 600;">UPWARD</button>
                <button class="behavior-mode-btn" data-mode="downward" style="padding: 10px; border-radius: 6px; color: #fff; cursor: pointer; font-family: 'Orbitron', sans-serif; font-size: 10px; font-weight: 600;">DOWNWARD</button>
                <button class="behavior-mode-btn" data-mode="connected" style="padding: 10px; border-radius: 6px; color: #fff; cursor: pointer; font-family: 'Orbitron', sans-serif; font-size: 10px; font-weight: 600;">CONNECTED</button>
                <button class="behavior-mode-btn" data-mode="glitch" style="padding: 10px; border-radius: 6px; color: #fff; cursor: pointer; font-family: 'Orbitron', sans-serif; font-size: 10px; font-weight: 600;">GLITCH</button>
                <button class="behavior-mode-btn" data-mode="constellation" style="padding: 10px; border-radius: 6px; color: #fff; cursor: pointer; font-family: 'Orbitron', sans-serif; font-size: 9px; font-weight: 600;">CONSTELLATION</button>
            </div>
        </div>
        
        <div class="behavior-controls" id="forward-controls" style="display: none; margin-bottom: 20px;">
            <div style="font-weight: 600; margin-bottom: 10px; font-size: 14px;">Forward Flow Speed</div>
            <input type="range" id="forward-speed-slider" min="1" max="100" value="20" style="width: 100%; cursor: pointer; margin-bottom: 8px;">
            <div style="display: flex; justify-content: space-between; font-size: 11px;">
                <span>Slow</span>
                <span id="forward-speed-value">20</span>
                <span>Fast</span>
            </div>
        </div>
        
        <div class="behavior-controls" id="backward-controls" style="display: none; margin-bottom: 20px;">
            <div style="font-weight: 600; margin-bottom: 10px; font-size: 14px;">Backward Flow Speed</div>
            <input type="range" id="backward-speed-slider" min="1" max="100" value="20" style="width: 100%; cursor: pointer; margin-bottom: 8px;">
            <div style="display: flex; justify-content: space-between; font-size: 11px;">
                <span>Slow</span>
                <span id="backward-speed-value">20</span>
                <span>Fast</span>
            </div>
        </div>
        
        <div class="behavior-controls" id="upward-controls" style="display: none; margin-bottom: 20px;">
            <div style="font-weight: 600; margin-bottom: 10px; font-size: 14px;">Upward Flow Speed</div>
            <input type="range" id="upward-speed-slider" min="1" max="100" value="20" style="width: 100%; cursor: pointer; margin-bottom: 8px;">
            <div style="display: flex; justify-content: space-between; font-size: 11px;">
                <span>Slow</span>
                <span id="upward-speed-value">20</span>
                <span>Fast</span>
            </div>
        </div>
        
        <div class="behavior-controls" id="downward-controls" style="display: none; margin-bottom: 20px;">
            <div style="font-weight: 600; margin-bottom: 10px; font-size: 14px;">Downward Flow Speed</div>
            <input type="range" id="downward-speed-slider" min="1" max="100" value="20" style="width: 100%; cursor: pointer; margin-bottom: 8px;">
            <div style="display: flex; justify-content: space-between; font-size: 11px;">
                <span>Slow</span>
                <span id="downward-speed-value">20</span>
                <span>Fast</span>
            </div>
        </div>
        
        <div class="behavior-controls" id="connected-controls" style="display: none; margin-bottom: 20px;">
            <div style="font-weight: 600; margin-bottom: 10px; font-size: 14px;">Connection Frequency</div>
            <input type="range" id="connected-frequency-slider" min="1" max="100" value="50" style="width: 100%; cursor: pointer; margin-bottom: 8px;">
            <div style="display: flex; justify-content: space-between; font-size: 11px;">
                <span>Sparse</span>
                <span id="connected-frequency-value">50</span>
                <span>Dense</span>
            </div>
        </div>
        
        <div class="behavior-controls" id="glitch-controls" style="display: none; margin-bottom: 20px;">
            <div style="font-weight: 600; margin-bottom: 10px; font-size: 14px;">Glitch Intensity</div>
            <input type="range" id="glitch-intensity-slider" min="1" max="100" value="50" style="width: 100%; cursor: pointer; margin-bottom: 8px;">
            <div style="display: flex; justify-content: space-between; font-size: 11px;">
                <span>Subtle</span>
                <span id="glitch-intensity-value">50</span>
                <span>Extreme</span>
            </div>
        </div>
        
        <div class="behavior-controls" id="constellation-controls" style="display: none; margin-bottom: 20px;">
            <div style="font-weight: 600; margin-bottom: 10px; font-size: 14px;">Connection Distance</div>
            <input type="range" id="constellation-distance-slider" min="1" max="100" value="30" style="width: 100%; cursor: pointer; margin-bottom: 8px;">
            <div style="display: flex; justify-content: space-between; font-size: 11px;">
                <span>Close</span>
                <span id="constellation-distance-value">30</span>
                <span>Far</span>
            </div>
        </div>
        
        <!-- Divider -->
        <div style="height: 1px; background: rgba(128, 128, 128, 0.2); margin: 25px 0;"></div>
        
        <!-- Particle Count -->
        <div style="margin-bottom: 20px;">
            <div style="font-weight: 600; margin-bottom: 10px; font-size: 14px;">Particle Count</div>
            <input type="range" id="particle-count-slider" min="3000" max="6000" value="3000" step="100" style="width: 100%; cursor: pointer; margin-bottom: 8px;">
            <div style="display: flex; justify-content: space-between; font-size: 11px;">
                <span>3,000</span>
                <span id="particle-count-value">3,000</span>
                <span>6,000</span>
            </div>
        </div>
        
        <!-- Divider -->
        <div style="height: 1px; background: rgba(128, 128, 128, 0.2); margin: 25px 0;"></div>
        
        <!-- Particle System Rotation -->
        <div style="margin-bottom: 20px;">
            <div style="font-weight: 600; margin-bottom: 15px; font-size: 14px;">Particle System Rotation</div>
            
            <!-- X Rotation -->
            <div style="margin-bottom: 15px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 6px;">
                    <span style="font-size: 12px; color: rgba(255, 255, 255, 0.8);">X-Axis</span>
                    <span id="particle-rot-x-value" style="font-size: 12px; color: rgba(255, 255, 255, 0.8);">0</span>
                </div>
                <input type="range" id="particle-rot-x-slider" min="0" max="360" value="0" style="width: 100%; cursor: pointer;">
            </div>
            
            <!-- Y Rotation -->
            <div style="margin-bottom: 15px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 6px;">
                    <span style="font-size: 12px; color: rgba(255, 255, 255, 0.8);">Y-Axis</span>
                    <span id="particle-rot-y-value" style="font-size: 12px; color: rgba(255, 255, 255, 0.8);">0</span>
                </div>
                <input type="range" id="particle-rot-y-slider" min="0" max="360" value="0" style="width: 100%; cursor: pointer;">
            </div>
            
            <!-- Z Rotation -->
            <div style="margin-bottom: 15px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 6px;">
                    <span style="font-size: 12px; color: rgba(255, 255, 255, 0.8);">Z-Axis</span>
                    <span id="particle-rot-z-value" style="font-size: 12px; color: rgba(255, 255, 255, 0.8);">71</span>
                </div>
                <input type="range" id="particle-rot-z-slider" min="0" max="360" value="71" style="width: 100%; cursor: pointer;">
            </div>
            
            <button id="particle-rot-reset" style="width: 100%; padding: 8px; background: rgba(128, 128, 128, 0.3); border: 1px solid rgba(128, 128, 128, 0.5); border-radius: 6px; color: #fff; cursor: pointer; font-family: 'Orbitron', sans-serif; font-size: 11px; font-weight: 600;">
                RESET ROTATION
            </button>
        </div>
    </div>

    <!-- FAQ Panel -->
    <div id="faq-panel">
        <div class="panel-header">
            <span class="panel-title">- CONTROLS & FAQ</span>
            <button class="panel-btn close-btn" id="faq-close"></button>
        </div>
        <div class="faq-content">
            <div class="faq-item">
                <div class="faq-question"> Keyboard Controls</div>
                <div class="faq-answer" style="line-height: 2;">
                    <strong>W</strong> - Move forward<br>
                    <strong>A</strong> - Move left<br>
                    <strong>S</strong> - Move backward<br>
                    <strong>D</strong> - Move right<br>
                    <strong>R</strong> - Move up<br>
                    <strong>F</strong> - Move down<br>
                    <strong>C</strong> - Hold to enable mouse look (FPS mode)<br>
                    <strong>O</strong> - Reset camera to origin (0, 0, 10)<br>
                    <strong>0</strong> - Toggle MySpace (collapse/expand grid)<br>
                    <strong>9</strong> - Toggle User Pocket<br>
                    <strong>Q</strong> - Toggle Controls & FAQ panel<br>
                    <strong>X</strong> - Toggle Inspector panel<br>
                    <strong>Z</strong> - Toggle docks visibility<br>
                    <strong>Left Shift</strong> - Toggle Left Hand menu<br>
                    <strong>Right Shift</strong> - Toggle Right Hand menu<br>
                    <strong>Enter</strong> - Toggle Conscious Hand menu
                </div>
            </div>
            <div class="faq-item">
                <div class="faq-question"> Mouse Controls</div>
                <div class="faq-answer">
                    <strong>Hold C + Move mouse</strong> - Look around (FPS style)<br>
                    <strong>Click objects</strong> - Select journal pages or grid panels<br>
                    <strong>Click + Drag</strong> - Orbit camera around scene
                </div>
            </div>
            <div class="faq-item">
                <div class="faq-question"> Mobile Controls</div>
                <div class="faq-answer">
                    <strong>Joystick (bottom left)</strong> - Move camera position<br>
                    <strong>Single finger touch on screen</strong> - Look around (FPS camera rotation)<br>
                    <strong>POS/ROT/SCL buttons</strong> - Adjust position, rotation, scale<br>
                    <strong>Action buttons (A1-A30)</strong> - Custom quick actions
                </div>
            </div>
            <div class="faq-item">
                <div class="faq-question"> UI Panels</div>
                <div class="faq-answer">
                    <strong>Top Left</strong> - Session info (space title, username, timer)<br>
                    <strong>Top Right</strong> - Search panel (click icon to expand)<br>
                    <strong>Inspector (X key)</strong> - Object properties and transparency<br>
                    <strong>Side Menus</strong> - Click hamburger icons for navigation
                </div>
            </div>
            <div class="faq-item">
                <div class="faq-question"> Hand Menus</div>
                <div class="faq-answer">
                    <strong>Left Hand (LH)</strong> - Left Shift key or LH button - Radial menu with 10 options<br>
                    <strong>Right Hand (RH)</strong> - Right Shift key or RH button - Radial menu with 10 options<br>
                    <strong>Conscious Hand (CH)</strong> - Enter key or CH button - Main menu controls including Pause Menu<br>
                    Click on radial menu items to select options. Only one hand menu visible at a time.
                </div>
            </div>
            <div class="faq-item">
                <div class="faq-question"> MySpace (Grid Sphere)</div>
                <div class="faq-answer">
                    The spherical grid is your personal space. Press <strong>0 key</strong> or the <strong>MS button</strong> to collapse/expand it. When collapsed, panels animate one-by-one into a smaller sphere. Access also via Conscious Hand menu  MySpace option.
                </div>
            </div>
            <div class="faq-item">
                <div class="faq-question"> User Pocket</div>
                <div class="faq-answer">
                    Your pocket stores up to <strong>20 items</strong>. Press <strong>9 key</strong> or select from Conscious Hand menu. The pocket panel slides in from the right with a 4x5 grid.<br><br>
                    <strong>Cell States:</strong><br>
                     Empty slots: Dashed border, ready for items<br>
                     Items in pocket: 35% opacity (stored)<br>
                     Items deployed in scene: 20% opacity (active)<br><br>
                    Click slots to deploy/recall items. Items can have password protection for security.
                </div>
            </div>
            <div class="faq-item">
                <div class="faq-question">How do I navigate the site?</div>
                <div class="faq-answer">Click the hamburger menus () at the top left (Admin/System) and top right (Site Pages) to access different sections. Click outside the menu to close it.</div>
            </div>
            <div class="faq-item">
                <div class="faq-question">What are the docks?</div>
                <div class="faq-answer">Docks are located on all four edges (top, bottom, left, right). They contain draggable items (D1-D14) you can move between docks by clicking and dragging. Press <strong>Z</strong> to show/hide all docks.</div>
            </div>
            <div class="faq-item">
                <div class="faq-question">How do I select and manipulate objects?</div>
                <div class="faq-answer">Click on any journal page or grid panel to select it. Selected objects turn blue and the camera animates to focus on them. Press <strong>X</strong> to open the Inspector panel where you can adjust transparency (10-100%) and view object details.</div>
            </div>
            <div class="faq-item">
                <div class="faq-question">What do the transform buttons do?</div>
                <div class="faq-answer">The <strong>POS</strong>, <strong>ROT</strong>, and <strong>SCL</strong> buttons open transform panels to adjust position, rotation, and scale of selected objects with precise control. Use the step size control to determine how much each adjustment changes the values (range: -1000 to 1000).</div>
            </div>
        </div>
    </div>

    <!-- Inspector Panel -->
    <div id="inspector-panel" class="minimized">
        <div class="panel-header" id="panel-header">
            <span class="panel-title"> INSPECTOR</span>
            <div class="panel-controls">
                <button class="panel-btn" id="minimize-btn">_</button>
                <button class="panel-btn close-btn" id="close-btn"></button>
            </div>
        </div>
        <div class="panel-content hidden" id="panel-content" style="padding: 16px;">
            <!-- Selected Object Name -->
            <div style="margin-bottom: 20px;">
                <div class="info-label" style="font-size: 11px; color: rgba(255, 255, 255, 0.6); margin-bottom: 6px;">SELECTED OBJECT</div>
                <div class="info-value" id="selected-name" style="font-size: 14px; font-weight: 700; color: #808080;">None</div>
            </div>
            
            <!-- Object Transform Properties -->
            <div id="object-details" style="display: none;">
                <!-- Position -->
                <div style="margin-bottom: 15px;">
                    <div class="info-label" style="font-size: 11px; color: rgba(255, 255, 255, 0.6); margin-bottom: 6px;">POSITION</div>
                    <div id="object-position" style="font-family: 'Courier New', monospace; font-size: 12px; color: #fff; background: rgba(0, 0, 0, 0.3); padding: 8px; border-radius: 6px; border: 1px solid rgba(128, 128, 128, 0.3);">
                        X: 0.00 | Y: 0.00 | Z: 0.00
                    </div>
                </div>
                
                <!-- Rotation -->
                <div style="margin-bottom: 15px;">
                    <div class="info-label" style="font-size: 11px; color: rgba(255, 255, 255, 0.6); margin-bottom: 6px;">ROTATION</div>
                    <div id="object-rotation" style="font-family: 'Courier New', monospace; font-size: 12px; color: #fff; background: rgba(0, 0, 0, 0.3); padding: 8px; border-radius: 6px; border: 1px solid rgba(128, 128, 128, 0.3);">
                        X: 0.00 | Y: 0.00 | Z: 0.00
                    </div>
                </div>
                
                <!-- Scale -->
                <div style="margin-bottom: 20px;">
                    <div class="info-label" style="font-size: 11px; color: rgba(255, 255, 255, 0.6); margin-bottom: 6px;">SCALE</div>
                    <div id="object-scale" style="font-family: 'Courier New', monospace; font-size: 12px; color: #fff; background: rgba(0, 0, 0, 0.3); padding: 8px; border-radius: 6px; border: 1px solid rgba(128, 128, 128, 0.3);">
                        X: 1.00 | Y: 1.00 | Z: 1.00
                    </div>
                </div>
                
                <!-- Divider -->
                <div style="height: 1px; background: rgba(128, 128, 128, 0.2); margin: 20px 0;"></div>
                
                <!-- Object Data Section -->
                <div style="margin-bottom: 20px;">
                    <div class="info-label" style="font-size: 11px; color: rgba(255, 255, 255, 0.6); margin-bottom: 10px;">OBJECT DATA</div>
                    
                    <!-- Header Field -->
                    <div style="margin-bottom: 12px;">
                        <label style="display: block; font-size: 10px; color: rgba(255, 255, 255, 0.5); margin-bottom: 4px;">Header</label>
                        <input type="text" id="object-data-header" placeholder="Enter header..." style="width: 100%; padding: 8px; background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(128, 128, 128, 0.3); border-radius: 6px; color: #fff; font-family: 'Orbitron', sans-serif; font-size: 12px; outline: none;">
                    </div>
                    
                    <!-- Body Field -->
                    <div style="margin-bottom: 12px;">
                        <label style="display: block; font-size: 10px; color: rgba(255, 255, 255, 0.5); margin-bottom: 4px;">Body</label>
                        <textarea id="object-data-body" placeholder="Enter body content..." style="width: 100%; min-height: 120px; padding: 8px; background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(128, 128, 128, 0.3); border-radius: 6px; color: #fff; font-family: 'Orbitron', sans-serif; font-size: 11px; outline: none; resize: vertical;"></textarea>
                    </div>
                    
                    <!-- Footer Field -->
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; font-size: 10px; color: rgba(255, 255, 255, 0.5); margin-bottom: 4px;">Footer</label>
                        <input type="text" id="object-data-footer" placeholder="Enter footer..." style="width: 100%; padding: 8px; background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(128, 128, 128, 0.3); border-radius: 6px; color: #fff; font-family: 'Orbitron', sans-serif; font-size: 12px; outline: none;">
                    </div>
                    
                    <!-- Icon Selector Section -->
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; font-size: 10px; color: rgba(255, 255, 255, 0.5); margin-bottom: 8px;">Icon/Image</label>
                        
                        <!-- Icon Type Selector -->
                        <div style="display: flex; gap: 6px; margin-bottom: 10px;">
                            <button class="icon-type-btn active" data-type="emoji" style="flex: 1; padding: 6px; background: rgba(128, 128, 128, 0.3); border: 1px solid rgba(128, 128, 128, 0.5); border-radius: 4px; color: #fff; cursor: pointer; font-size: 10px; font-weight: 600;"> EMOJI</button>
                            <button class="icon-type-btn" data-type="image" style="flex: 1; padding: 6px; background: rgba(128, 128, 128, 0.3); border: 1px solid rgba(128, 128, 128, 0.5); border-radius: 4px; color: #fff; cursor: pointer; font-size: 10px; font-weight: 600;"> IMAGE</button>
                            <button class="icon-type-btn" data-type="fontawesome" style="flex: 1; padding: 6px; background: rgba(128, 128, 128, 0.3); border: 1px solid rgba(128, 128, 128, 0.5); border-radius: 4px; color: #fff; cursor: pointer; font-size: 10px; font-weight: 600;"> ICON</button>
                        </div>
                        
                        <!-- Emoji Picker -->
                        <div id="emoji-picker" class="icon-picker-content" style="display: grid; grid-template-columns: repeat(6, 1fr); gap: 4px; max-height: 150px; overflow-y: auto; padding: 8px; background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(128, 128, 128, 0.3); border-radius: 6px;">
                            <button class="emoji-option" data-emoji="" style="padding: 8px; background: rgba(128, 128, 128, 0.2); border: 1px solid rgba(128, 128, 128, 0.3); border-radius: 4px; cursor: pointer; font-size: 20px;"></button>
                            <button class="emoji-option" data-emoji="" style="padding: 8px; background: rgba(128, 128, 128, 0.2); border: 1px solid rgba(128, 128, 128, 0.3); border-radius: 4px; cursor: pointer; font-size: 20px;"></button>
                            <button class="emoji-option" data-emoji="" style="padding: 8px; background: rgba(128, 128, 128, 0.2); border: 1px solid rgba(128, 128, 128, 0.3); border-radius: 4px; cursor: pointer; font-size: 20px;"></button>
                            <button class="emoji-option" data-emoji="" style="padding: 8px; background: rgba(128, 128, 128, 0.2); border: 1px solid rgba(128, 128, 128, 0.3); border-radius: 4px; cursor: pointer; font-size: 20px;"></button>
                            <button class="emoji-option" data-emoji="" style="padding: 8px; background: rgba(128, 128, 128, 0.2); border: 1px solid rgba(128, 128, 128, 0.3); border-radius: 4px; cursor: pointer; font-size: 20px;"></button>
                            <button class="emoji-option" data-emoji="" style="padding: 8px; background: rgba(128, 128, 128, 0.2); border: 1px solid rgba(128, 128, 128, 0.3); border-radius: 4px; cursor: pointer; font-size: 20px;"></button>
                            <button class="emoji-option" data-emoji="" style="padding: 8px; background: rgba(128, 128, 128, 0.2); border: 1px solid rgba(128, 128, 128, 0.3); border-radius: 4px; cursor: pointer; font-size: 20px;"></button>
                            <button class="emoji-option" data-emoji="" style="padding: 8px; background: rgba(128, 128, 128, 0.2); border: 1px solid rgba(128, 128, 128, 0.3); border-radius: 4px; cursor: pointer; font-size: 20px;"></button>
                            <button class="emoji-option" data-emoji="" style="padding: 8px; background: rgba(128, 128, 128, 0.2); border: 1px solid rgba(128, 128, 128, 0.3); border-radius: 4px; cursor: pointer; font-size: 20px;"></button>
                            <button class="emoji-option" data-emoji="" style="padding: 8px; background: rgba(128, 128, 128, 0.2); border: 1px solid rgba(128, 128, 128, 0.3); border-radius: 4px; cursor: pointer; font-size: 20px;"></button>
                            <button class="emoji-option" data-emoji="" style="padding: 8px; background: rgba(128, 128, 128, 0.2); border: 1px solid rgba(128, 128, 128, 0.3); border-radius: 4px; cursor: pointer; font-size: 20px;"></button>
                            <button class="emoji-option" data-emoji="" style="padding: 8px; background: rgba(128, 128, 128, 0.2); border: 1px solid rgba(128, 128, 128, 0.3); border-radius: 4px; cursor: pointer; font-size: 20px;"></button>
                        </div>
                        
                        <!-- Image Upload -->
                        <div id="image-picker" class="icon-picker-content" style="display: none;">
                            <input type="file" id="icon-image-upload" accept="image/*" style="width: 100%; padding: 8px; background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(128, 128, 128, 0.3); border-radius: 6px; color: #fff; font-size: 10px; cursor: pointer;">
                            <div id="image-preview" style="margin-top: 8px; min-height: 60px; display: flex; align-items: center; justify-content: center; background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(128, 128, 128, 0.3); border-radius: 6px; color: rgba(255, 255, 255, 0.4); font-size: 10px;">No image selected</div>
                        </div>
                        
                        <!-- Font Awesome Icons -->
                        <div id="fontawesome-picker" class="icon-picker-content" style="display: none; grid-template-columns: repeat(6, 1fr); gap: 4px; max-height: 150px; overflow-y: auto; padding: 8px; background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(128, 128, 128, 0.3); border-radius: 6px;">
                            <button class="fa-option" data-icon="fa-home" style="padding: 8px; background: rgba(128, 128, 128, 0.2); border: 1px solid rgba(128, 128, 128, 0.3); border-radius: 4px; cursor: pointer; font-size: 16px;"></button>
                            <button class="fa-option" data-icon="fa-user" style="padding: 8px; background: rgba(128, 128, 128, 0.2); border: 1px solid rgba(128, 128, 128, 0.3); border-radius: 4px; cursor: pointer; font-size: 16px;"></button>
                            <button class="fa-option" data-icon="fa-heart" style="padding: 8px; background: rgba(128, 128, 128, 0.2); border: 1px solid rgba(128, 128, 128, 0.3); border-radius: 4px; cursor: pointer; font-size: 16px;"></button>
                            <button class="fa-option" data-icon="fa-star" style="padding: 8px; background: rgba(128, 128, 128, 0.2); border: 1px solid rgba(128, 128, 128, 0.3); border-radius: 4px; cursor: pointer; font-size: 16px;"></button>
                            <button class="fa-option" data-icon="fa-cog" style="padding: 8px; background: rgba(128, 128, 128, 0.2); border: 1px solid rgba(128, 128, 128, 0.3); border-radius: 4px; cursor: pointer; font-size: 16px;"></button>
                            <button class="fa-option" data-icon="fa-check" style="padding: 8px; background: rgba(128, 128, 128, 0.2); border: 1px solid rgba(128, 128, 128, 0.3); border-radius: 4px; cursor: pointer; font-size: 16px;"></button>
                        </div>
                        
                        <!-- Selected Icon Display -->
                        <div id="selected-icon-display" style="margin-top: 8px; padding: 8px; background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(128, 128, 128, 0.3); border-radius: 6px; color: rgba(255, 255, 255, 0.6); font-size: 10px; text-align: center;">
                            <span id="selected-icon-text">No icon selected</span>
                        </div>
                    </div>
                    
                    <!-- Submit Button -->
                    <button id="object-data-submit" style="width: 100%; padding: 10px; background: rgba(128, 128, 128, 0.3); border: 1px solid rgba(128, 128, 128, 0.5); border-radius: 6px; color: #fff; cursor: pointer; font-family: 'Orbitron', sans-serif; font-size: 12px; font-weight: 600; transition: all 0.3s; margin-bottom: 10px;">
                        SAVE DATA
                    </button>
                    
                    <!-- View Panel Button -->
                    <button id="open-view-panel-btn" style="width: 100%; padding: 10px; background: rgba(128, 128, 128, 0.3); border: 1px solid rgba(128, 128, 128, 0.5); border-radius: 6px; color: #fff; cursor: pointer; font-family: 'Orbitron', sans-serif; font-size: 12px; font-weight: 600; transition: all 0.3s;">
                         VIEW PANEL
                    </button>
                </div>
            </div>
            
            <!-- Info Section (Logic-style, expandable) -->
            <div id="info-section" style="margin-top: 20px;">
                <!-- Info Toggle Header -->
                <div id="info-toggle" style="display: flex; align-items: center; justify-content: space-between; padding: 10px 12px; background: rgba(128, 128, 128, 0.2); border: 1px solid rgba(128, 128, 128, 0.3); border-radius: 6px; cursor: pointer; margin-bottom: 0; transition: all 0.3s;">
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <span id="info-arrow" style="font-size: 12px; transition: transform 0.3s;"></span>
                        <span style="font-size: 11px; font-weight: 700; color: rgba(255, 255, 255, 0.8); letter-spacing: 0.5px;">INFO</span>
                    </div>
                    <span style="font-size: 9px; color: rgba(255, 255, 255, 0.5);">Click to expand</span>
                </div>
                
                <!-- Info Content (Collapsible) -->
                <div id="info-content" style="display: none; border: 1px solid rgba(128, 128, 128, 0.3); border-top: none; border-radius: 0 0 6px 6px; overflow: hidden; background: rgba(0, 0, 0, 0.2);">
                    <!-- Keyboard Shortcuts Section -->
                    <div style="padding: 12px; border-bottom: 1px solid rgba(128, 128, 128, 0.2);">
                        <div style="font-size: 10px; font-weight: 700; color: rgba(255, 255, 255, 0.6); margin-bottom: 8px; letter-spacing: 0.5px;">KEYBOARD SHORTCUTS</div>
                        <div style="font-family: 'Courier New', monospace; font-size: 10px; color: rgba(255, 255, 255, 0.8); line-height: 1.6;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                                <span style="color: rgba(255, 255, 255, 0.5);">POS Mode:</span>
                                <span style="background: rgba(128, 128, 128, 0.3); padding: 2px 6px; border-radius: 3px;">P</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                                <span style="color: rgba(255, 255, 255, 0.5);">ROT Mode:</span>
                                <span style="background: rgba(128, 128, 128, 0.3); padding: 2px 6px; border-radius: 3px;">R</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                                <span style="color: rgba(255, 255, 255, 0.5);">SCL Mode:</span>
                                <span style="background: rgba(128, 128, 128, 0.3); padding: 2px 6px; border-radius: 3px;">S</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                                <span style="color: rgba(255, 255, 255, 0.5);">Inspector:</span>
                                <span style="background: rgba(128, 128, 128, 0.3); padding: 2px 6px; border-radius: 3px;">X</span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span style="color: rgba(255, 255, 255, 0.5);">Reset Camera:</span>
                                <span style="background: rgba(128, 128, 128, 0.3); padding: 2px 6px; border-radius: 3px;">O</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Header Section -->
                    <div style="padding: 12px; border-bottom: 1px solid rgba(128, 128, 128, 0.2);">
                        <div style="font-size: 10px; font-weight: 700; color: rgba(255, 255, 255, 0.6); margin-bottom: 6px; letter-spacing: 0.5px;">HEADER</div>
                        <div id="info-header" style="font-size: 11px; color: rgba(255, 255, 255, 0.9); line-height: 1.5;">
                            mniExp 3D Journal Viewer
                        </div>
                    </div>
                    
                    <!-- Body Section -->
                    <div style="padding: 12px; border-bottom: 1px solid rgba(128, 128, 128, 0.2);">
                        <div style="font-size: 10px; font-weight: 700; color: rgba(255, 255, 255, 0.6); margin-bottom: 6px; letter-spacing: 0.5px;">BODY</div>
                        <div id="info-body" style="font-size: 10px; color: rgba(255, 255, 255, 0.7); line-height: 1.6; max-height: 200px; overflow-y: auto;">
                            Navigate your consciousness through MySpace. Use POS, ROT, and SCL controls to transform yourself or selected objects. When nothing is selected, controls affect your camera position. Select any grid panel to modify objects in the space.
                        </div>
                    </div>
                    
                    <!-- Footer Section -->
                    <div style="padding: 12px;">
                        <div style="font-size: 10px; font-weight: 700; color: rgba(255, 255, 255, 0.6); margin-bottom: 6px; letter-spacing: 0.5px;">FOOTER</div>
                        <div id="info-footer" style="font-size: 9px; color: rgba(255, 255, 255, 0.5); font-style: italic;">
                            Current Mode: <span id="info-current-mode" style="color: rgba(255, 255, 255, 0.8); font-weight: 600;">Navigation</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Resize Handle -->
        <div id="inspector-resize-handle" style="position: absolute; bottom: 0; right: 0; width: 20px; height: 20px; cursor: nwse-resize; background: linear-gradient(135deg, transparent 50%, rgba(128, 128, 128, 0.5) 50%); border-bottom-right-radius: 16px;"></div>
    </div>

    <!-- MySpace Control Panel -->
    <div id="myspace-panel" class="minimized">
        <div class="panel-header" id="myspace-panel-header">
            <span class="panel-title"> MYSPACE</span>
            <div class="panel-controls">
                <button class="panel-btn" id="myspace-minimize-btn">_</button>
                <button class="panel-btn close-btn" id="myspace-close-btn"></button>
            </div>
        </div>
        <div class="panel-content hidden" id="myspace-panel-content" style="padding: 16px;">
            
            <!-- Summon / DeSummon -->
            <div style="margin-bottom: 20px;">
                <button id="summon-toggle-btn" class="myspace-control-btn active" style="width: 100%; padding: 12px; background: rgba(128, 128, 128, 0.3); border: 1px solid rgba(128, 128, 128, 0.5); border-radius: 8px; color: #fff; cursor: pointer; font-family: 'Orbitron', sans-serif; font-size: 12px; font-weight: 600; transition: all 0.3s;">
                     SUMMONED
                </button>
            </div>
            
            <!-- MyZone Toggle -->
            <div style="margin-bottom: 20px;">
                <div style="font-weight: 600; margin-bottom: 10px; font-size: 14px; color: rgba(255, 255, 255, 0.9);">MyZone</div>
                <button id="myzone-toggle-btn" class="myspace-control-btn" style="width: 100%; padding: 12px; background: rgba(128, 128, 128, 0.3); border: 1px solid rgba(128, 128, 128, 0.5); border-radius: 8px; color: #fff; cursor: pointer; font-family: 'Orbitron', sans-serif; font-size: 12px; font-weight: 600; transition: all 0.3s;">
                    LOCK TO VIEW
                </button>
                <div style="font-size: 10px; color: rgba(255, 255, 255, 0.5); margin-top: 6px;">Sticks MySpace to camera view</div>
            </div>
            
            <!-- Rotation Controls -->
            <div style="margin-bottom: 20px;">
                <div style="font-weight: 600; margin-bottom: 10px; font-size: 14px; color: rgba(255, 255, 255, 0.9);">Rotate Grid View</div>
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px;">
                    <div></div>
                    <button id="rotate-up-btn" class="myspace-control-btn" style="padding: 12px; background: rgba(128, 128, 128, 0.3); border: 1px solid rgba(128, 128, 128, 0.5); border-radius: 8px; color: #fff; cursor: pointer; font-size: 16px; transition: all 0.3s;"></button>
                    <div></div>
                    
                    <button id="rotate-left-btn" class="myspace-control-btn" style="padding: 12px; background: rgba(128, 128, 128, 0.3); border: 1px solid rgba(128, 128, 128, 0.5); border-radius: 8px; color: #fff; cursor: pointer; font-size: 16px; transition: all 0.3s;"></button>
                    <button id="center-sphere-btn" class="myspace-control-btn" style="padding: 12px; background: rgba(128, 128, 128, 0.3); border: 1px solid rgba(128, 128, 128, 0.5); border-radius: 8px; color: #fff; cursor: pointer; font-size: 20px; transition: all 0.3s;"></button>
                    <button id="rotate-right-btn" class="myspace-control-btn" style="padding: 12px; background: rgba(128, 128, 128, 0.3); border: 1px solid rgba(128, 128, 128, 0.5); border-radius: 8px; color: #fff; cursor: pointer; font-size: 16px; transition: all 0.3s;"></button>
                    
                    <div></div>
                    <button id="rotate-down-btn" class="myspace-control-btn" style="padding: 12px; background: rgba(128, 128, 128, 0.3); border: 1px solid rgba(128, 128, 128, 0.5); border-radius: 8px; color: #fff; cursor: pointer; font-size: 16px; transition: all 0.3s;"></button>
                    <div></div>
                </div>
            </div>
            
            <!-- Reset MySpace -->
            <div style="margin-bottom: 20px;">
                <button id="reset-myspace-btn" class="myspace-control-btn" style="width: 100%; padding: 12px; background: rgba(128, 128, 128, 0.3); border: 1px solid rgba(128, 128, 128, 0.5); border-radius: 8px; color: #fff; cursor: pointer; font-family: 'Orbitron', sans-serif; font-size: 12px; font-weight: 600; transition: all 0.3s;">
                     RESET POSITION
                </button>
            </div>
            
            <!-- Wallpaper Control -->
            <div style="margin-bottom: 20px;">
                <div style="font-weight: 600; margin-bottom: 10px; font-size: 14px; color: rgba(255, 255, 255, 0.9);">Change Wallpaper</div>
                <div style="display: flex; gap: 8px; margin-bottom: 10px;">
                    <button id="wallpaper-image-btn" class="myspace-control-btn active" style="flex: 1; padding: 10px; background: rgba(128, 128, 128, 0.3); border: 1px solid rgba(128, 128, 128, 0.5); border-radius: 6px; color: #fff; cursor: pointer; font-size: 10px; font-weight: 600; transition: all 0.3s;">
                         IMAGE
                    </button>
                    <button id="wallpaper-video-btn" class="myspace-control-btn" style="flex: 1; padding: 10px; background: rgba(128, 128, 128, 0.3); border: 1px solid rgba(128, 128, 128, 0.5); border-radius: 6px; color: #fff; cursor: pointer; font-size: 10px; font-weight: 600; transition: all 0.3s;">
                         VIDEO
                    </button>
                    <button id="wallpaper-default-btn" class="myspace-control-btn" style="flex: 1; padding: 10px; background: rgba(128, 128, 128, 0.3); border: 1px solid rgba(128, 128, 128, 0.5); border-radius: 6px; color: #fff; cursor: pointer; font-size: 10px; font-weight: 600; transition: all 0.3s;">
                         DEFAULT
                    </button>
                </div>
                <input type="file" id="wallpaper-upload" accept="image/*,video/*" style="display: none;">
                <button id="wallpaper-upload-trigger" style="width: 100%; padding: 10px; background: rgba(128, 128, 128, 0.3); border: 1px solid rgba(128, 128, 128, 0.5); border-radius: 6px; color: #fff; cursor: pointer; font-family: 'Orbitron', sans-serif; font-size: 11px; font-weight: 600; transition: all 0.3s;">
                     UPLOAD FILE
                </button>
                <div id="wallpaper-preview" style="margin-top: 8px; font-size: 10px; color: rgba(255, 255, 255, 0.6);">
                    Current: Default Gradient
                </div>
            </div>
            
            <!-- Divider -->
            <div style="height: 1px; background: rgba(128, 128, 128, 0.2); margin: 20px 0;"></div>
            
            <!-- Sphere Rotation Controls -->
            <div style="margin-bottom: 20px;">
                <div style="font-weight: 600; margin-bottom: 10px; font-size: 14px; color: rgba(255, 255, 255, 0.9);">Sphere Auto-Rotation</div>
                <div style="display: flex; flex-direction: column; gap: 8px;">
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 8px; background: rgba(128, 128, 128, 0.2); border-radius: 6px; transition: all 0.3s;">
                        <input type="checkbox" id="sphere-rotate-x" style="cursor: pointer; width: 18px; height: 18px;">
                        <span style="font-size: 12px; color: rgba(255, 255, 255, 0.9);">Rotate on X-axis</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 8px; background: rgba(128, 128, 128, 0.2); border-radius: 6px; transition: all 0.3s;">
                        <input type="checkbox" id="sphere-rotate-y" style="cursor: pointer; width: 18px; height: 18px;">
                        <span style="font-size: 12px; color: rgba(255, 255, 255, 0.9);">Rotate on Y-axis</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 8px; background: rgba(128, 128, 128, 0.2); border-radius: 6px; transition: all 0.3s;">
                        <input type="checkbox" id="sphere-rotate-z" style="cursor: pointer; width: 18px; height: 18px;">
                        <span style="font-size: 12px; color: rgba(255, 255, 255, 0.9);">Rotate on Z-axis</span>
                    </label>
                </div>
                <div style="font-size: 10px; color: rgba(255, 255, 255, 0.5); margin-top: 6px;">Enable continuous rotation on selected axes</div>
            </div>
            
            <!-- Divider -->
            <div style="height: 1px; background: rgba(128, 128, 128, 0.2); margin: 20px 0;"></div>
            
            <!-- Grid Configuration -->
            <div style="margin-bottom: 20px;">
                <div style="font-weight: 600; margin-bottom: 10px; font-size: 14px; color: rgba(255, 255, 255, 0.9);">Grid Type</div>
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px;">
                    <button class="myspace-grid-btn active" data-grid-type="spherical" style="padding: 10px; background: rgba(128, 128, 128, 0.3); border: 1px solid rgba(128, 128, 128, 0.5); border-radius: 6px; color: #fff; cursor: pointer; font-family: 'Orbitron', sans-serif; font-size: 10px; font-weight: 600; transition: all 0.3s;">
                         SPHERICAL
                    </button>
                    <button class="myspace-grid-btn" data-grid-type="planar" style="padding: 10px; background: rgba(128, 128, 128, 0.3); border: 1px solid rgba(128, 128, 128, 0.5); border-radius: 6px; color: #fff; cursor: pointer; font-family: 'Orbitron', sans-serif; font-size: 10px; font-weight: 600; transition: all 0.3s;">
                         PLANAR
                    </button>
                    <button class="myspace-grid-btn" data-grid-type="helix" style="padding: 10px; background: rgba(128, 128, 128, 0.3); border: 1px solid rgba(128, 128, 128, 0.5); border-radius: 6px; color: #fff; cursor: pointer; font-family: 'Orbitron', sans-serif; font-size: 10px; font-weight: 600; transition: all 0.3s;">
                         HELIX
                    </button>
                    <button class="myspace-grid-btn" data-grid-type="cube" style="padding: 10px; background: rgba(128, 128, 128, 0.3); border: 1px solid rgba(128, 128, 128, 0.5); border-radius: 6px; color: #fff; cursor: pointer; font-family: 'Orbitron', sans-serif; font-size: 10px; font-weight: 600; transition: all 0.3s;">
                         CUBE
                    </button>
                </div>
            </div>
            
            <div style="margin-bottom: 15px;">
                <div style="font-weight: 600; margin-bottom: 8px; font-size: 14px; color: rgba(255, 255, 255, 0.9);">Grid Size</div>
                <input type="range" id="grid-size-slider" min="5" max="25" value="15" style="width: 100%; cursor: pointer; margin-bottom: 6px;">
                <div style="display: flex; justify-content: space-between; font-size: 10px; color: rgba(255, 255, 255, 0.7);">
                    <span>Small (5)</span>
                    <span id="grid-size-value">15</span>
                    <span>Large (25)</span>
                </div>
            </div>
            
            <div style="margin-bottom: 20px;">
                <div style="font-weight: 600; margin-bottom: 8px; font-size: 14px; color: rgba(255, 255, 255, 0.9);">Grid Spacing</div>
                <input type="range" id="grid-spacing-slider" min="1" max="5" value="2" step="0.5" style="width: 100%; cursor: pointer; margin-bottom: 6px;">
                <div style="display: flex; justify-content: space-between; font-size: 10px; color: rgba(255, 255, 255, 0.7);">
                    <span>Tight (1)</span>
                    <span id="grid-spacing-value">2</span>
                    <span>Wide (5)</span>
                </div>
            </div>
            
            <button id="apply-grid-btn" style="width: 100%; padding: 12px; background: rgba(128, 128, 128, 0.4); border: 1px solid rgba(128, 128, 128, 0.6); border-radius: 8px; color: #fff; cursor: pointer; font-family: 'Orbitron', sans-serif; font-size: 12px; font-weight: 600; transition: all 0.3s;">
                 APPLY CHANGES
            </button>
        </div>
        <!-- Resize Handle -->
        <div id="myspace-resize-handle" style="position: absolute; bottom: 0; right: 0; width: 20px; height: 20px; cursor: nwse-resize; background: linear-gradient(135deg, transparent 50%, rgba(128, 128, 128, 0.5) 50%); border-bottom-right-radius: 16px;"></div>
    </div>

    <!-- Help Panel -->
    <div id="help-panel" class="minimized">
        <div class="panel-header" id="help-panel-header">
            <span class="panel-title">(?) HELP</span>
            <div class="panel-controls">
                <button class="panel-btn" id="help-minimize-btn"></button>
                <button class="panel-btn close-btn" id="help-close-btn"></button>
            </div>
        </div>
        <div class="panel-content hidden" id="help-panel-content" style="padding: 16px;">
            
            <div style="font-size: 13px; font-weight: 600; color: rgba(255, 255, 255, 0.9); margin-bottom: 16px; text-align: center;">
                 KEYBOARD SHORTCUTS
            </div>
            
            <!-- Movement -->
            <div style="margin-bottom: 20px;">
                <div style="font-weight: 600; margin-bottom: 8px; font-size: 12px; color: rgba(255, 255, 255, 0.7);">Movement</div>
                <div style="font-family: 'Courier New', monospace; font-size: 11px; line-height: 1.8;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                        <span>Move Forward</span>
                        <span style="background: rgba(128, 128, 128, 0.3); padding: 2px 8px; border-radius: 4px;">W</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                        <span>Move Left</span>
                        <span style="background: rgba(128, 128, 128, 0.3); padding: 2px 8px; border-radius: 4px;">A</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                        <span>Move Backward</span>
                        <span style="background: rgba(128, 128, 128, 0.3); padding: 2px 8px; border-radius: 4px;">S</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                        <span>Move Right</span>
                        <span style="background: rgba(128, 128, 128, 0.3); padding: 2px 8px; border-radius: 4px;">D</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                        <span>Move Up</span>
                        <span style="background: rgba(128, 128, 128, 0.3); padding: 2px 8px; border-radius: 4px;">R</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span>Move Down</span>
                        <span style="background: rgba(128, 128, 128, 0.3); padding: 2px 8px; border-radius: 4px;">F</span>
                    </div>
                </div>
            </div>
            
            <!-- Camera -->
            <div style="margin-bottom: 20px;">
                <div style="font-weight: 600; margin-bottom: 8px; font-size: 12px; color: rgba(255, 255, 255, 0.7);">Camera</div>
                <div style="font-family: 'Courier New', monospace; font-size: 11px; line-height: 1.8;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                        <span>Mouse Look (Hold)</span>
                        <span style="background: rgba(128, 128, 128, 0.3); padding: 2px 8px; border-radius: 4px;">C</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span>Reset Camera</span>
                        <span style="background: rgba(128, 128, 128, 0.3); padding: 2px 8px; border-radius: 4px;">O</span>
                    </div>
                </div>
            </div>
            
            <!-- Panels -->
            <div style="margin-bottom: 20px;">
                <div style="font-weight: 600; margin-bottom: 8px; font-size: 12px; color: rgba(255, 255, 255, 0.7);">Panels</div>
                <div style="font-family: 'Courier New', monospace; font-size: 11px; line-height: 1.8;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                        <span>Toggle Inspector</span>
                        <span style="background: rgba(128, 128, 128, 0.3); padding: 2px 8px; border-radius: 4px;">X</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                        <span>Toggle FAQ</span>
                        <span style="background: rgba(128, 128, 128, 0.3); padding: 2px 8px; border-radius: 4px;">Q</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span>Toggle Docks</span>
                        <span style="background: rgba(128, 128, 128, 0.3); padding: 2px 8px; border-radius: 4px;">Z</span>
                    </div>
                </div>
            </div>
            
            <!-- Hand Menus -->
            <div style="margin-bottom: 20px;">
                <div style="font-weight: 600; margin-bottom: 8px; font-size: 12px; color: rgba(255, 255, 255, 0.7);">Hand Menus</div>
                <div style="font-family: 'Courier New', monospace; font-size: 11px; line-height: 1.8;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                        <span>Left Hand</span>
                        <span style="background: rgba(128, 128, 128, 0.3); padding: 2px 8px; border-radius: 4px;">Left Shift</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                        <span>Right Hand</span>
                        <span style="background: rgba(128, 128, 128, 0.3); padding: 2px 8px; border-radius: 4px;">Right Shift</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span>Conscious Hand</span>
                        <span style="background: rgba(128, 128, 128, 0.3); padding: 2px 8px; border-radius: 4px;">Enter</span>
                    </div>
                </div>
            </div>
            
            <!-- Spaces -->
            <div style="margin-bottom: 20px;">
                <div style="font-weight: 600; margin-bottom: 8px; font-size: 12px; color: rgba(255, 255, 255, 0.7);">Spaces</div>
                <div style="font-family: 'Courier New', monospace; font-size: 11px; line-height: 1.8;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                        <span>Toggle MySpace</span>
                        <span style="background: rgba(128, 128, 128, 0.3); padding: 2px 8px; border-radius: 4px;">0</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span>Toggle Pocket</span>
                        <span style="background: rgba(128, 128, 128, 0.3); padding: 2px 8px; border-radius: 4px;">9</span>
                    </div>
                </div>
            </div>
            
            <!-- General -->
            <div style="margin-bottom: 8px;">
                <div style="font-weight: 600; margin-bottom: 8px; font-size: 12px; color: rgba(255, 255, 255, 0.7);">General</div>
                <div style="font-family: 'Courier New', monospace; font-size: 11px; line-height: 1.8;">
                    <div style="display: flex; justify-content: space-between;">
                        <span>Close Panel</span>
                        <span style="background: rgba(128, 128, 128, 0.3); padding: 2px 8px; border-radius: 4px;">Esc</span>
                    </div>
                </div>
            </div>
            
        </div>
    </div>

    <!-- Object Data View Panel -->
    <div id="view-panel" style="display: none; position: fixed; left: 360px; top: 135px; width: 400px; max-height: calc(100vh - 400px); overflow-y: auto; background: rgba(25, 25, 30, 0.95); backdrop-filter: blur(20px); border: 1px solid rgba(128, 128, 128, 0.3); border-radius: 16px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4); color: #fff; z-index: 1000;">
        <div id="view-panel-header" style="display: flex; justify-content: space-between; align-items: center; padding: 12px 16px; background: rgba(128, 128, 128, 0.15); border-bottom: 1px solid rgba(128, 128, 128, 0.3); cursor: move; user-select: none; border-top-left-radius: 16px; border-top-right-radius: 16px;">
            <span style="font-size: 14px; font-weight: 600; letter-spacing: 0.5px;">OBJECT DATA VIEW</span>
            <button id="view-panel-close" style="width: 24px; height: 24px; border-radius: 50%; background: rgba(255, 0, 0, 0.2); border: 1px solid rgba(255, 0, 0, 0.5); color: #fff; cursor: pointer; font-size: 18px; line-height: 1;"></button>
        </div>
        
        <div style="padding: 16px;">
        <!-- Header -->
        <div style="margin-bottom: 20px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                <div style="font-size: 11px; color: rgba(255, 255, 255, 0.6); font-weight: 600;">HEADER</div>
                <button class="copy-btn" data-copy="header" style="padding: 4px 8px; background: rgba(128, 128, 128, 0.3); border: 1px solid rgba(128, 128, 128, 0.5); border-radius: 4px; color: #fff; cursor: pointer; font-family: 'Orbitron', sans-serif; font-size: 9px; font-weight: 600;"> COPY</button>
            </div>
            <div id="view-header" style="padding: 12px; background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(128, 128, 128, 0.3); border-radius: 8px; font-family: 'Orbitron', sans-serif; font-size: 13px; word-wrap: break-word; min-height: 40px;">
                
            </div>
        </div>
        
        <!-- Body -->
        <div style="margin-bottom: 20px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                <div style="font-size: 11px; color: rgba(255, 255, 255, 0.6); font-weight: 600;">BODY</div>
                <button class="copy-btn" data-copy="body" style="padding: 4px 8px; background: rgba(128, 128, 128, 0.3); border: 1px solid rgba(128, 128, 128, 0.5); border-radius: 4px; color: #fff; cursor: pointer; font-family: 'Orbitron', sans-serif; font-size: 9px; font-weight: 600;"> COPY</button>
            </div>
            <div id="view-body" style="padding: 12px; background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(128, 128, 128, 0.3); border-radius: 8px; font-family: 'Orbitron', sans-serif; font-size: 12px; white-space: pre-wrap; word-wrap: break-word; min-height: 120px; max-height: 300px; overflow-y: auto;">
                
            </div>
        </div>
        
        <!-- Footer -->
        <div style="margin-bottom: 0;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                <div style="font-size: 11px; color: rgba(255, 255, 255, 0.6); font-weight: 600;">FOOTER</div>
                <button class="copy-btn" data-copy="footer" style="padding: 4px 8px; background: rgba(128, 128, 128, 0.3); border: 1px solid rgba(128, 128, 128, 0.5); border-radius: 4px; color: #fff; cursor: pointer; font-family: 'Orbitron', sans-serif; font-size: 9px; font-weight: 600;"> COPY</button>
            </div>
            <div id="view-footer" style="padding: 12px; background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(128, 128, 128, 0.3); border-radius: 8px; font-family: 'Orbitron', sans-serif; font-size: 13px; word-wrap: break-word; min-height: 40px;">
                
            </div>
        </div>
        </div>
        
        <!-- Resize Handle -->
        <div id="view-panel-resize-handle" style="position: absolute; bottom: 0; right: 0; width: 20px; height: 20px; cursor: nwse-resize; background: linear-gradient(135deg, transparent 50%, rgba(128, 128, 128, 0.5) 50%); border-bottom-right-radius: 16px;"></div>
    </div>

    <!-- MySpace Grid Panel -->
    <div id="myspace-grid-panel" class="side-menu" style="display: none; right: 120px; top: 80px; width: 350px; max-height: 600px; overflow-y: auto;">
        <div class="panel-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <span class="panel-title" style="font-size: 18px; font-weight: 700;">- MYSPACE GRID</span>
            <button class="panel-btn close-btn" id="myspace-grid-close" style="background: none; border: none; color: #fff; font-size: 24px; cursor: pointer;"></button>
        </div>
        
        <div style="margin-bottom: 25px;">
            <div style="font-weight: 600; margin-bottom: 15px; font-size: 14px; color: rgba(255, 255, 255, 0.9);">Grid Type</div>
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
                <button class="myspace-grid-btn active" data-grid-type="spherical" style="padding: 12px; background: rgba(128, 128, 128, 0.3); border: 1px solid rgba(128, 128, 128, 0.5); border-radius: 8px; color: #fff; cursor: pointer; font-family: 'Orbitron', sans-serif; font-size: 11px; font-weight: 600; transition: all 0.3s;">
                     SPHERICAL
                </button>
                <button class="myspace-grid-btn" data-grid-type="planar" style="padding: 12px; background: rgba(128, 128, 128, 0.3); border: 1px solid rgba(128, 128, 128, 0.5); border-radius: 8px; color: #fff; cursor: pointer; font-family: 'Orbitron', sans-serif; font-size: 11px; font-weight: 600; transition: all 0.3s;">
                     PLANAR WALLS
                </button>
                <button class="myspace-grid-btn" data-grid-type="helix" style="padding: 12px; background: rgba(128, 128, 128, 0.3); border: 1px solid rgba(128, 128, 128, 0.5); border-radius: 8px; color: #fff; cursor: pointer; font-family: 'Orbitron', sans-serif; font-size: 11px; font-weight: 600; transition: all 0.3s;">
                     HELIX
                </button>
                <button class="myspace-grid-btn" data-grid-type="cube" style="padding: 12px; background: rgba(128, 128, 128, 0.3); border: 1px solid rgba(128, 128, 128, 0.5); border-radius: 8px; color: #fff; cursor: pointer; font-family: 'Orbitron', sans-serif; font-size: 11px; font-weight: 600; transition: all 0.3s;">
                     CUBE
                </button>
            </div>
        </div>
        
        <!-- Grid Settings -->
        <div style="margin-bottom: 20px;">
            <div style="font-weight: 600; margin-bottom: 10px; font-size: 14px; color: rgba(255, 255, 255, 0.9);">Grid Size</div>
            <input type="range" id="grid-size-slider" min="5" max="25" value="15" style="width: 100%; cursor: pointer; margin-bottom: 8px;">
            <div style="display: flex; justify-content: space-between; font-size: 11px; color: rgba(255, 255, 255, 0.7);">
                <span>Small (5)</span>
                <span id="grid-size-value">15</span>
                <span>Large (25)</span>
            </div>
        </div>
        
        <div style="margin-bottom: 20px;">
            <div style="font-weight: 600; margin-bottom: 10px; font-size: 14px; color: rgba(255, 255, 255, 0.9);">Grid Spacing</div>
            <input type="range" id="grid-spacing-slider" min="1" max="5" value="2" step="0.5" style="width: 100%; cursor: pointer; margin-bottom: 8px;">
            <div style="display: flex; justify-content: space-between; font-size: 11px; color: rgba(255, 255, 255, 0.7);">
                <span>Tight (1)</span>
                <span id="grid-spacing-value">2</span>
                <span>Wide (5)</span>
            </div>
        </div>
        
        <button id="apply-grid-btn" style="width: 100%; padding: 12px; background: rgba(128, 128, 128, 0.4); border: 1px solid rgba(128, 128, 128, 0.6); border-radius: 8px; color: #fff; cursor: pointer; font-family: 'Orbitron', sans-serif; font-size: 12px; font-weight: 600; transition: all 0.3s;">
             APPLY CHANGES
        </button>
    </div>

    <!-- Mobile Movement Control -->
    <div id="movement-control">
        <div class="joystick-base">
            <div class="joystick-stick" id="joystick-stick"></div>
        </div>
        <div class="control-buttons">
            <!-- Column 1: Vertical Movement -->
            <button class="control-btn vertical-btn" id="btn-up" title="Move Up (R)"></button>
            <button class="control-btn vertical-btn" id="btn-down" title="Move Down (F)"></button>
            <button class="control-btn vertical-btn" id="btn-center" title="Reset Camera (O)"></button>
            
            <!-- Column 2: Transform Controls -->
            <button class="control-btn" id="btn-pos" title="Position">POS</button>
            <button class="control-btn" id="btn-rot" title="Rotation">ROT</button>
            <button class="control-btn" id="btn-scale" title="Scale">SCL</button>
            
            <!-- Column 3: Hand Menus -->
            <button class="control-btn" id="btn-lh" title="Left Hand">LH</button>
            <button class="control-btn" id="btn-rh" title="Right Hand">RH</button>
            <button class="control-btn" id="btn-ch" title="Conscious Hand">CH</button>
            
            <!-- Column 4: UI Toggles -->
            <button class="control-btn" id="btn-docks" title="Docks">DO</button>
            <button class="control-btn" id="btn-keyboard" title="Keyboard">KB</button>
            <button class="control-btn" id="btn-action-grid" title="Action Grid">GKB</button>
            
            <!-- Column 5: Tray & Future Buttons -->
            <button class="control-btn" id="btn-tray" title="Toggle Tray">TRAY</button>
            <button class="control-btn" id="btn-chat" title="Toggle Chat">CHAT</button>
            <button class="control-btn" id="btn-15" title="Future Button">?</button>
            
            <!-- Column 6: Additional Controls -->
            <button class="control-btn" id="btn-nav" title="Toggle Navigation Bar">NAV</button>
            <button class="control-btn" id="btn-rulers" title="Toggle Rulers">RUL</button>
            <button class="control-btn" id="btn-max" title="Maximize">MAX</button>
            <button class="control-btn" id="btn-16" title="Future Button">?</button>
            <button class="control-btn" id="btn-17" title="Future Button">?</button>
        </div>
    </div>

    <!-- Right Hand Movement Control -->
    <div id="rh-movement-control" style="display: none;">
        <div class="joystick-base">
            <div class="joystick-stick" id="rh-joystick-stick"></div>
        </div>
    </div>

    <!-- Conscious Hand Movement Control -->
    <div id="ch-movement-control" style="display: none;">
        <div class="joystick-base">
            <div class="joystick-stick" id="ch-joystick-stick"></div>
        </div>
    </div>

    <!-- RH Tool Settings Panel (replaces movement pad) -->
    <div id="rh-tool-settings" style="display: none; position: fixed; bottom: 20px; right: 20px; width: 200px; background: rgba(25, 25, 30, 0.95); backdrop-filter: blur(30px); border: 2px solid rgba(128, 128, 128, 0.4); border-radius: 12px; padding: 15px; z-index: 1000;">
        <div style="font-size: 12px; font-weight: 700; color: #fff; text-align: center; margin-bottom: 10px; letter-spacing: 1px; text-shadow: 0 0 10px rgba(255, 255, 255, 0.8);">TOOL SETTINGS</div>
        <div id="rh-tool-settings-content" style="font-size: 11px; color: rgba(255, 255, 255, 0.8);">
            No tool selected
        </div>
    </div>

    <!-- Position Rulers -->
    <div id="x-axis-ruler" style="display: none; position: fixed; bottom: 20px; right: 20px; width: 300px; height: 30px; background: rgba(255, 255, 255, 0.15); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.4); border-radius: 8px; align-items: center; justify-content: space-between; padding: 0 10px; font-family: 'Courier New', monospace; font-size: 10px; color: #fff; z-index: 900;">
        <span style="color: rgba(255, 255, 255, 0.8);">-50</span>
        <div style="flex: 1; height: 2px; background: linear-gradient(90deg, rgba(255, 255, 255, 0.3), rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.3)); margin: 0 10px; position: relative; box-shadow: 0 0 5px rgba(255, 255, 255, 0.5);">
            <div id="x-marker" style="position: absolute; width: 3px; height: 10px; background: #fff; box-shadow: 0 0 15px rgba(255, 255, 255, 0.9), 0 0 25px rgba(255, 255, 255, 0.5); left: 50%; transform: translateX(-50%); top: -4px; border-radius: 2px;"></div>
        </div>
        <span style="color: rgba(255, 255, 255, 0.8);">+50</span>
        <span style="margin-left: 10px; color: #fff; font-weight: 700; text-shadow: 0 0 10px rgba(255, 255, 255, 0.8), 0 0 20px rgba(255, 255, 255, 0.5);">X</span>
    </div>
    
    <div id="z-axis-ruler" style="display: none; position: fixed; right: 20px; top: 160px; width: 30px; height: 300px; background: rgba(255, 255, 255, 0.15); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.4); border-radius: 8px; flex-direction: column; align-items: center; justify-content: space-between; padding: 10px 0; font-family: 'Courier New', monospace; font-size: 10px; color: #fff; z-index: 900;">
        <span style="color: rgba(255, 255, 255, 0.8);">+50</span>
        <div style="flex: 1; width: 2px; background: linear-gradient(180deg, rgba(255, 255, 255, 0.3), rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.3)); margin: 10px 0; position: relative; box-shadow: 0 0 5px rgba(255, 255, 255, 0.5);">
            <div id="z-marker" style="position: absolute; height: 3px; width: 10px; background: #fff; box-shadow: 0 0 15px rgba(255, 255, 255, 0.9), 0 0 25px rgba(255, 255, 255, 0.5); top: 50%; left: 50%; transform: translate(-50%, -50%); border-radius: 2px;"></div>
        </div>
        <span style="color: rgba(255, 255, 255, 0.8);">-50</span>
        <div style="margin-top: 10px; color: #fff; font-weight: 700; writing-mode: vertical-rl; transform: rotate(180deg); text-shadow: 0 0 10px rgba(255, 255, 255, 0.8), 0 0 20px rgba(255, 255, 255, 0.5);">Z</div>
    </div>
    
    <div id="y-axis-ruler" style="display: none; position: fixed; left: 20px; top: 160px; width: 30px; height: 300px; background: rgba(255, 255, 255, 0.15); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.4); border-radius: 8px; flex-direction: column; align-items: center; justify-content: space-between; padding: 10px 0; font-family: 'Courier New', monospace; font-size: 10px; color: #fff; z-index: 900;">
        <span style="color: rgba(255, 255, 255, 0.8);">+50</span>
        <div style="flex: 1; width: 2px; background: linear-gradient(180deg, rgba(255, 255, 255, 0.3), rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.3)); margin: 10px 0; position: relative; box-shadow: 0 0 5px rgba(255, 255, 255, 0.5);">
            <div id="y-marker" style="position: absolute; height: 3px; width: 10px; background: #fff; box-shadow: 0 0 15px rgba(255, 255, 255, 0.9), 0 0 25px rgba(255, 255, 255, 0.5); top: 50%; left: 50%; transform: translate(-50%, -50%); border-radius: 2px;"></div>
        </div>
        <span style="color: rgba(255, 255, 255, 0.8);">-50</span>
        <div style="margin-top: 10px; color: #fff; font-weight: 700; writing-mode: vertical-rl; transform: rotate(180deg); text-shadow: 0 0 10px rgba(255, 255, 255, 0.8), 0 0 20px rgba(255, 255, 255, 0.5);">Y</div>
    </div>

    <!-- JSON Viewer Panel -->
    <div id="json-viewer-panel" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 80vw; max-width: 800px; height: 70vh; background: rgba(25, 25, 30, 0.98); border: 2px solid rgba(255, 255, 255, 0.3); border-radius: 12px; z-index: 5000; backdrop-filter: blur(20px); box-shadow: 0 0 40px rgba(0, 0, 0, 0.8), 0 0 80px rgba(255, 255, 255, 0.2); resize: both; overflow: hidden; min-width: 400px; min-height: 300px;">
        <!-- Header -->
        <div id="json-viewer-header" style="padding: 16px; border-bottom: 1px solid rgba(128, 128, 128, 0.3); display: flex; justify-content: space-between; align-items: center; gap: 12px; cursor: move; user-select: none;">
            <div style="font-family: 'Orbitron', sans-serif; font-size: 14px; font-weight: 700; color: #fff; text-shadow: 0 0 10px rgba(255, 255, 255, 0.8);"> DATA VIEWER</div>
            
            <!-- Transparency Control -->
            <div style="display: flex; align-items: center; gap: 8px; flex: 1; max-width: 300px;">
                <span style="font-size: 10px; color: rgba(255, 255, 255, 0.6); white-space: nowrap;">Opacity:</span>
                <input type="range" id="json-viewer-opacity" min="0.3" max="1" step="0.1" value="0.98" style="flex: 1; height: 4px; background: rgba(128, 128, 128, 0.3); border-radius: 2px; outline: none;">
                <span id="json-viewer-opacity-value" style="font-size: 10px; color: rgba(255, 255, 255, 0.6); min-width: 30px;">98%</span>
            </div>
            
            <div style="display: flex; gap: 8px;">
                <button id="toggle-3d-viewer" style="padding: 6px 12px; background: rgba(128, 128, 128, 0.3); border: 1px solid rgba(128, 128, 128, 0.5); border-radius: 6px; color: #fff; cursor: pointer; font-size: 10px; font-weight: 600;">3D VIEW</button>
                <button id="minimize-json-viewer" style="width: 32px; height: 32px; background: rgba(128, 128, 128, 0.3); border: 1px solid rgba(128, 128, 128, 0.5); border-radius: 6px; color: #fff; cursor: pointer; font-size: 18px; display: flex; align-items: center; justify-content: center;"></button>
                <button id="close-json-viewer" style="width: 32px; height: 32px; background: rgba(128, 128, 128, 0.3); border: 1px solid rgba(128, 128, 128, 0.5); border-radius: 6px; color: #fff; cursor: pointer; font-size: 18px; display: flex; align-items: center; justify-content: center;"></button>
            </div>
        </div>
        
        <!-- Scroll Controls -->
        <div style="position: absolute; right: 16px; top: 50%; transform: translateY(-50%); display: flex; flex-direction: column; gap: 8px; z-index: 1;">
            <button id="json-scroll-up" style="width: 40px; height: 40px; background: rgba(128, 128, 128, 0.3); border: 1px solid rgba(128, 128, 128, 0.5); border-radius: 6px; color: #fff; cursor: pointer; font-size: 20px; display: flex; align-items: center; justify-content: center;"></button>
            <button id="json-scroll-down" style="width: 40px; height: 40px; background: rgba(128, 128, 128, 0.3); border: 1px solid rgba(128, 128, 128, 0.5); border-radius: 6px; color: #fff; cursor: pointer; font-size: 20px; display: flex; align-items: center; justify-content: center;"></button>
        </div>
        
        <!-- Content Area -->
        <div id="json-viewer-content" style="padding: 20px; height: calc(100% - 64px); overflow-y: auto; font-family: 'Courier New', monospace; font-size: 12px; color: #fff; line-height: 1.6;">
            <pre id="json-viewer-pre" style="margin: 0; white-space: pre-wrap; word-wrap: break-word;"></pre>
        </div>
    </div>
    
    <!-- Minimized JSON Viewer Tab -->
    <div id="json-viewer-minimized" style="display: none; position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); padding: 12px 24px; background: rgba(25, 25, 30, 0.95); border: 1px solid rgba(255, 255, 255, 0.3); border-radius: 8px; cursor: pointer; backdrop-filter: blur(20px); z-index: 5000;">
        <span style="font-family: 'Orbitron', sans-serif; font-size: 12px; font-weight: 600; color: #fff;"> DATA VIEWER (minimized)</span>
    </div>

    <!-- 3D Panel Control Panel -->
    <div id="panel-3d-controls" style="display: none; position: fixed; right: 20px; top: 50%; transform: translateY(-50%); width: 280px; background: rgba(25, 25, 30, 0.95); border: 2px solid rgba(255, 255, 255, 0.3); border-radius: 12px; backdrop-filter: blur(20px); z-index: 4500; box-shadow: 0 0 40px rgba(0, 0, 0, 0.8), 0 0 80px rgba(255, 255, 255, 0.2);">
        <!-- Header -->
        <div id="panel-3d-header" style="padding: 12px; border-bottom: 1px solid rgba(128, 128, 128, 0.3); display: flex; justify-content: space-between; align-items: center; cursor: move; user-select: none;">
            <span style="font-family: 'Orbitron', sans-serif; font-size: 12px; font-weight: 700; color: #fff; text-shadow: 0 0 10px rgba(255, 255, 255, 0.8);"> 3D PANEL CONTROLS</span>
            <button id="close-3d-controls" style="width: 28px; height: 28px; background: rgba(128, 128, 128, 0.3); border: 1px solid rgba(128, 128, 128, 0.5); border-radius: 6px; color: #fff; cursor: pointer; font-size: 16px; display: flex; align-items: center; justify-content: center;"></button>
        </div>
        
        <!-- Content -->
        <div style="padding: 16px; max-height: 70vh; overflow-y: auto;">
            <!-- Position Controls -->
            <div style="margin-bottom: 16px;">
                <div style="font-size: 10px; font-weight: 700; color: #fff; margin-bottom: 8px; text-shadow: 0 0 10px rgba(255, 255, 255, 0.8);">POSITION</div>
                <div style="display: grid; grid-template-columns: 20px 1fr; gap: 8px; align-items: center;">
                    <span style="font-size: 9px; color: rgba(255, 255, 255, 0.7);">X</span>
                    <input type="range" id="panel-3d-pos-x" min="-15" max="15" step="0.5" value="0" style="width: 100%;">
                    <span style="font-size: 9px; color: rgba(255, 255, 255, 0.7);">Y</span>
                    <input type="range" id="panel-3d-pos-y" min="-15" max="15" step="0.5" value="0" style="width: 100%;">
                    <span style="font-size: 9px; color: rgba(255, 255, 255, 0.7);">Z</span>
                    <input type="range" id="panel-3d-pos-z" min="-15" max="15" step="0.5" value="0" style="width: 100%;">
                </div>
            </div>
            
            <!-- Rotation Controls -->
            <div style="margin-bottom: 16px;">
                <div style="font-size: 10px; font-weight: 700; color: #fff; margin-bottom: 8px; text-shadow: 0 0 10px rgba(255, 255, 255, 0.8);">ROTATION</div>
                <div style="display: grid; grid-template-columns: 20px 1fr; gap: 8px; align-items: center;">
                    <span style="font-size: 9px; color: rgba(255, 255, 255, 0.7);">X</span>
                    <input type="range" id="panel-3d-rot-x" min="0" max="360" step="1" value="0" style="width: 100%;">
                    <span style="font-size: 9px; color: rgba(255, 255, 255, 0.7);">Y</span>
                    <input type="range" id="panel-3d-rot-y" min="0" max="360" step="1" value="0" style="width: 100%;">
                    <span style="font-size: 9px; color: rgba(255, 255, 255, 0.7);">Z</span>
                    <input type="range" id="panel-3d-rot-z" min="0" max="360" step="1" value="0" style="width: 100%;">
                </div>
            </div>
            
            <!-- Scale Controls -->
            <div style="margin-bottom: 16px;">
                <div style="font-size: 10px; font-weight: 700; color: #fff; margin-bottom: 8px; text-shadow: 0 0 10px rgba(255, 255, 255, 0.8);">SCALE</div>
                <div style="display: grid; grid-template-columns: 20px 1fr; gap: 8px; align-items: center;">
                    <span style="font-size: 9px; color: rgba(255, 255, 255, 0.7);">X</span>
                    <input type="range" id="panel-3d-sca-x" min="0.5" max="3" step="0.1" value="1" style="width: 100%;">
                    <span style="font-size: 9px; color: rgba(255, 255, 255, 0.7);">Y</span>
                    <input type="range" id="panel-3d-sca-y" min="0.5" max="3" step="0.1" value="2" style="width: 100%;">
                    <span style="font-size: 9px; color: rgba(255, 255, 255, 0.7);">Z</span>
                    <input type="range" id="panel-3d-sca-z" min="0.5" max="3" step="0.1" value="1" style="width: 100%;">
                </div>
            </div>
            
            <!-- Color Control -->
            <div style="margin-bottom: 16px;">
                <div style="font-size: 10px; font-weight: 700; color: #fff; margin-bottom: 8px; text-shadow: 0 0 10px rgba(255, 255, 255, 0.8);">PANEL COLOR</div>
                <input type="color" id="panel-3d-color" value="#191920" style="width: 100%; height: 40px; border: 1px solid rgba(128, 128, 128, 0.5); border-radius: 6px; background: rgba(0, 0, 0, 0.3); cursor: pointer;">
            </div>
            
            <!-- Opacity Control -->
            <div style="margin-bottom: 16px;">
                <div style="font-size: 10px; font-weight: 700; color: #fff; margin-bottom: 8px; text-shadow: 0 0 10px rgba(255, 255, 255, 0.8);">OPACITY</div>
                <input type="range" id="panel-3d-opacity" min="0.1" max="1" step="0.1" value="0.95" style="width: 100%;">
                <span id="panel-3d-opacity-value" style="font-size: 9px; color: rgba(255, 255, 255, 0.6);">95%</span>
            </div>
            
            <!-- Put in Pocket Button -->
            <button id="put-panel-in-pocket" style="width: 100%; padding: 10px; background: rgba(128, 128, 128, 0.3); border: 1px solid rgba(128, 128, 128, 0.5); border-radius: 6px; color: #fff; cursor: pointer; font-family: 'Orbitron', sans-serif; font-size: 11px; font-weight: 600;">
                 PUT IN POCKET
            </button>
        </div>
    </div>

    <!-- 3D Panel Control Panel -->
    <div id="panel-3d-controls" style="display: none; position: fixed; right: 20px; top: 50%; transform: translateY(-50%); width: 280px; background: rgba(25, 25, 30, 0.95); border: 2px solid rgba(255, 255, 255, 0.3); border-radius: 12px; z-index: 5000; backdrop-filter: blur(20px); box-shadow: 0 0 40px rgba(0, 0, 0, 0.8);">
        <!-- Header (draggable) -->
        <div id="panel-3d-header" style="padding: 12px 16px; border-bottom: 1px solid rgba(128, 128, 128, 0.3); display: flex; justify-content: space-between; align-items: center; cursor: move; user-select: none; background: rgba(128, 128, 128, 0.2);">
            <div style="font-family: 'Orbitron', sans-serif; font-size: 12px; font-weight: 700; color: #fff; text-shadow: 0 0 10px rgba(255, 255, 255, 0.8);"> 3D PANEL CONTROLS</div>
            <button id="close-3d-controls" style="width: 24px; height: 24px; background: rgba(128, 128, 128, 0.3); border: 1px solid rgba(128, 128, 128, 0.5); border-radius: 4px; color: #fff; cursor: pointer; font-size: 16px; display: flex; align-items: center; justify-content: center;"></button>
        </div>
        
        <!-- Content -->
        <div style="padding: 16px; max-height: 600px; overflow-y: auto;">
            <!-- Position Controls -->
            <div style="margin-bottom: 16px;">
                <div style="font-size: 10px; font-weight: 700; color: #fff; margin-bottom: 8px; text-shadow: 0 0 8px rgba(255, 255, 255, 0.6);">POSITION</div>
                <div style="display: grid; grid-template-columns: 30px 1fr; gap: 8px; align-items: center;">
                    <span style="font-size: 10px; color: rgba(255, 255, 255, 0.8);">X:</span>
                    <input type="range" id="panel-3d-pos-x" min="-20" max="20" step="0.5" value="0" style="width: 100%;">
                    
                    <span style="font-size: 10px; color: rgba(255, 255, 255, 0.8);">Y:</span>
                    <input type="range" id="panel-3d-pos-y" min="-20" max="20" step="0.5" value="0" style="width: 100%;">
                    
                    <span style="font-size: 10px; color: rgba(255, 255, 255, 0.8);">Z:</span>
                    <input type="range" id="panel-3d-pos-z" min="-20" max="20" step="0.5" value="0" style="width: 100%;">
                </div>
            </div>
            
            <!-- Rotation Controls -->
            <div style="margin-bottom: 16px;">
                <div style="font-size: 10px; font-weight: 700; color: #fff; margin-bottom: 8px; text-shadow: 0 0 8px rgba(255, 255, 255, 0.6);">ROTATION</div>
                <div style="display: grid; grid-template-columns: 30px 1fr; gap: 8px; align-items: center;">
                    <span style="font-size: 10px; color: rgba(255, 255, 255, 0.8);">X:</span>
                    <input type="range" id="panel-3d-rot-x" min="-3.14" max="3.14" step="0.1" value="0" style="width: 100%;">
                    
                    <span style="font-size: 10px; color: rgba(255, 255, 255, 0.8);">Y:</span>
                    <input type="range" id="panel-3d-rot-y" min="-3.14" max="3.14" step="0.1" value="0" style="width: 100%;">
                    
                    <span style="font-size: 10px; color: rgba(255, 255, 255, 0.8);">Z:</span>
                    <input type="range" id="panel-3d-rot-z" min="-3.14" max="3.14" step="0.1" value="0" style="width: 100%;">
                </div>
            </div>
            
            <!-- Scale Controls -->
            <div style="margin-bottom: 16px;">
                <div style="font-size: 10px; font-weight: 700; color: #fff; margin-bottom: 8px; text-shadow: 0 0 8px rgba(255, 255, 255, 0.6);">SCALE</div>
                <div style="display: grid; grid-template-columns: 30px 1fr; gap: 8px; align-items: center;">
                    <span style="font-size: 10px; color: rgba(255, 255, 255, 0.8);">X:</span>
                    <input type="range" id="panel-3d-sca-x" min="0.1" max="3" step="0.1" value="1" style="width: 100%;">
                    
                    <span style="font-size: 10px; color: rgba(255, 255, 255, 0.8);">Y:</span>
                    <input type="range" id="panel-3d-sca-y" min="0.1" max="3" step="0.1" value="1" style="width: 100%;">
                    
                    <span style="font-size: 10px; color: rgba(255, 255, 255, 0.8);">Z:</span>
                    <input type="range" id="panel-3d-sca-z" min="0.1" max="3" step="0.1" value="1" style="width: 100%;">
                </div>
            </div>
            
            <!-- Color Control -->
            <div style="margin-bottom: 16px;">
                <div style="font-size: 10px; font-weight: 700; color: #fff; margin-bottom: 8px; text-shadow: 0 0 8px rgba(255, 255, 255, 0.6);">PANEL COLOR</div>
                <div style="display: flex; gap: 8px; align-items: center;">
                    <input type="color" id="panel-3d-color" value="#191919" style="width: 60px; height: 32px; border: 1px solid rgba(128, 128, 128, 0.5); border-radius: 4px; cursor: pointer;">
                    <span id="panel-3d-color-value" style="font-size: 10px; color: rgba(255, 255, 255, 0.8); font-family: 'Courier New', monospace;">#191919</span>
                </div>
            </div>
            
            <!-- Opacity Control -->
            <div style="margin-bottom: 16px;">
                <div style="font-size: 10px; font-weight: 700; color: #fff; margin-bottom: 8px; text-shadow: 0 0 8px rgba(255, 255, 255, 0.6);">OPACITY</div>
                <div style="display: flex; gap: 8px; align-items: center;">
                    <input type="range" id="panel-3d-opacity" min="0.3" max="1" step="0.05" value="0.95" style="flex: 1;">
                    <span id="panel-3d-opacity-value" style="font-size: 10px; color: rgba(255, 255, 255, 0.8); min-width: 35px;">95%</span>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div style="display: flex; flex-direction: column; gap: 8px;">
                <button id="reset-3d-panel" style="width: 100%; padding: 10px; background: rgba(128, 128, 128, 0.3); border: 1px solid rgba(128, 128, 128, 0.5); border-radius: 6px; color: #fff; cursor: pointer; font-family: 'Orbitron', sans-serif; font-size: 11px; font-weight: 600;"> RESET POSITION</button>
                
                <button id="save-to-pocket-3d" style="width: 100%; padding: 10px; background: rgba(128, 128, 128, 0.3); border: 1px solid rgba(128, 128, 128, 0.5); border-radius: 6px; color: #fff; cursor: pointer; font-family: 'Orbitron', sans-serif; font-size: 11px; font-weight: 600;"> SAVE TO POCKET</button>
                
                <button id="remove-3d-panel" style="width: 100%; padding: 10px; background: rgba(180, 80, 80, 0.3); border: 1px solid rgba(180, 80, 80, 0.5); border-radius: 6px; color: #fff; cursor: pointer; font-family: 'Orbitron', sans-serif; font-size: 11px; font-weight: 600;"> REMOVE PANEL</button>
            </div>
        </div>
    </div>

    <!-- Virtual Keyboard -->
    <div id="virtual-keyboard"></div>

    <!-- Transform Panel -->
    <div id="transform-panel">
        <div class="transform-header">
            <span class="panel-title" id="transform-title">POSITION</span>
            <button class="panel-btn close-btn" id="transform-close"></button>
        </div>
        <div class="transform-content">
            <div class="transform-row">
                <div class="transform-label">X</div>
                <div class="transform-inputs">
                    <input type="number" class="transform-input" id="transform-x" value="0" step="0.1">
                </div>
            </div>
            <div class="transform-row">
                <div class="transform-label">Y</div>
                <div class="transform-inputs">
                    <input type="number" class="transform-input" id="transform-y" value="0" step="0.1">
                </div>
            </div>
            <div class="transform-row">
                <div class="transform-label">Z</div>
                <div class="transform-inputs">
                    <input type="number" class="transform-input" id="transform-z" value="0" step="0.1">
                </div>
            </div>
            <div class="transform-row">
                <div class="transform-label">Step Size</div>
                <div class="step-control">
                    <span class="step-label">Range:</span>
                    <input type="number" class="step-input" id="step-size" value="1" min="-1000" max="1000">
                </div>
            </div>
            <div class="transform-submit-container">
                <button class="transform-submit-btn" id="transform-submit">Apply Changes</button>
            </div>
        </div>
    </div>

    <!-- Action Button Grid (30 buttons) -->
    <div id="action-grid" class="hidden">
        <button class="action-btn" data-action="1">A1</button>
        <button class="action-btn" data-action="2">A2</button>
        <button class="action-btn" data-action="3">A3</button>
        <button class="action-btn" data-action="4">A4</button>
        <button class="action-btn" data-action="5">A5</button>
        <button class="action-btn" data-action="6">A6</button>
        <button class="action-btn" data-action="7">A7</button>
        <button class="action-btn" data-action="8">A8</button>
        <button class="action-btn" data-action="9">A9</button>
        <button class="action-btn" data-action="10">A10</button>
        <button class="action-btn" data-action="11">A11</button>
        <button class="action-btn" data-action="12">A12</button>
        <button class="action-btn" data-action="13">A13</button>
        <button class="action-btn" data-action="14">A14</button>
        <button class="action-btn" data-action="15">A15</button>
        <button class="action-btn" data-action="16">A16</button>
        <button class="action-btn" data-action="17">A17</button>
        <button class="action-btn" data-action="18">A18</button>
        <button class="action-btn" data-action="19">A19</button>
        <button class="action-btn" data-action="20">A20</button>
        <button class="action-btn" data-action="21">A21</button>
        <button class="action-btn" data-action="22">A22</button>
        <button class="action-btn" data-action="23">A23</button>
        <button class="action-btn" data-action="24">A24</button>
        <button class="action-btn" data-action="25">A25</button>
        <button class="action-btn" data-action="26">A26</button>
        <button class="action-btn" data-action="27">A27</button>
        <button class="action-btn" data-action="28">A28</button>
        <button class="action-btn" data-action="29">A29</button>
        <button class="action-btn" data-action="30">A30</button>
    </div>

    <!-- THREE.js and GSAP -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

    <script>
        // Global variables
        let scene, camera, renderer;
        let interactiveObjects = [];
        let journalPages = [];
        let gridObjects = [];
        let mySpaceGroup;  // Group to hold all MySpace grid panels
        let sphereRotateX = false;
        let sphereRotateY = false;
        let sphereRotateZ = false;
        let selectedObject = null;
        let hoveredObject = null;
        let isRotating = false;
        let previousMousePosition = { x: 0, y: 0 };
        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();
        const cameraTarget = new THREE.Vector3(0, 0, 0);

        // Keyboard controls
        const keys = {
            w: false,
            a: false,
            s: false,
            d: false,
            r: false,
            f: false,
            c: false
        };
        const moveSpeed = 0.2;

        // Mouse look controls - only active when holding C
        let lastMouseX = window.innerWidth / 2;
        let lastMouseY = window.innerHeight / 2;
        const lookSensitivity = 0.002;

        // Camera breathing effect (Metroid Prime style)
        let breathTime = 0;
        const breathSpeed = 0.8;
        const breathIntensity = 0.08; // Increased from 0.02 for more pronounced effect

        // Hand menus
        let leftHandVisible = false;
        let rightHandVisible = false;
        let consciousHandVisible = false;

        // MySpace (grid sphere) state
        let mySpaceExpanded = true;
        
        // Particle Energy State variables
        let particleSystem = null;
        let particleCount = 3000;
        let particleVelocities = null;
        
        // Particle Behavior State
        let particleBehaviorMode = 'calm'; // 'calm', 'forward', 'backward', 'connected', 'glitch', 'constellation'
        let forwardFlowSpeed = 0.2; // 0-1 range (default 20)
        let backwardFlowSpeed = 0.2; // 0-1 range (default 20)
        let upwardFlowSpeed = 0.2; // 0-1 range (default 20)
        let downwardFlowSpeed = 0.2; // 0-1 range (default 20)
        let connectionFrequency = 0.5; // 0-1 range for connected mode
        let glitchIntensity = 0.5; // 0-1 range for glitch mode
        let constellationDistance = 3.0; // Distance for constellation connections (scaled from slider)
        
        // FPS tracking
        let lastFrameTime = performance.now();
        let fps = 60;
        let fpsFrames = 0;
        let fpsTime = 0;
        let mySpaceAnimating = false;
        const expandedRadius = 25;
        const collapsedRadius = 5;

        // Pocket system with pagination
        let pocketVisible = false;
        let pocketItems = {}; // Object to store pocket items with metadata
        const slotsPerPage = 20;
        const totalPages = 10;
        const maxPocketSlots = slotsPerPage * totalPages; // 200 total slots
        let currentPocketPage = 1;
        
        // Initialize pocket slots
        for (let i = 0; i < maxPocketSlots; i++) {
            pocketItems[i] = {
                occupied: false,
                deployed: false, // true if item is out in the scene
                itemData: null,
                password: null
            };
        }

        // Docks visibility
        let docksVisible = false; // Start hidden by default

        // Session timer
        let sessionStartTime = Date.now();
        let timerInterval = null;

        // Theme system
        const themes = {
            'silver': {
                name: 'Silver',
                primary: 'rgba(60, 60, 70, 0.8)',
                accent: '#C0C0C0',
                text: '#E8E8E8',
                dockBg: '#ffffff',
                dockText: '#333333',
                dockGlow: 'rgba(255, 255, 255, 0.6)',
                preview: 'linear-gradient(135deg, #3c3c46, #808080)'
            },
            'darkblue': {
                name: 'Dark Blue',
                primary: 'rgba(25, 25, 30, 0.7)',
                accent: '#808080',
                text: '#fff',
                dockBg: '#ffffff',
                dockText: '#1a1a2e',
                dockGlow: 'rgba(128, 128, 128, 0.6)',
                preview: 'linear-gradient(135deg, #0f0f23, #808080)'
            },
            'orange': {
                name: 'Orange',
                primary: 'rgba(30, 20, 10, 0.7)',
                accent: '#FF8C00',
                text: '#fff',
                dockBg: '#ffffff',
                dockText: '#1e140a',
                dockGlow: 'rgba(255, 140, 0, 0.6)',
                preview: 'linear-gradient(135deg, #FF6B00, #FFA500)'
            },
            'yellow': {
                name: 'Yellow',
                primary: 'rgba(40, 40, 20, 0.7)',
                accent: '#FFD700',
                text: '#333',
                dockBg: '#ffffff',
                dockText: '#282814',
                dockGlow: 'rgba(255, 215, 0, 0.6)',
                preview: 'linear-gradient(135deg, #FFC107, #FFD700)'
            },
            'red': {
                name: 'Red',
                primary: 'rgba(30, 10, 10, 0.7)',
                accent: '#DC143C',
                text: '#fff',
                dockBg: '#ffffff',
                dockText: '#1e0a0a',
                dockGlow: 'rgba(220, 20, 60, 0.6)',
                preview: 'linear-gradient(135deg, #DC143C, #FF6B6B)'
            },
            'purple': {
                name: 'Purple',
                primary: 'rgba(20, 10, 30, 0.7)',
                accent: '#9370DB',
                text: '#fff',
                dockBg: '#ffffff',
                dockText: '#140a1e',
                dockGlow: 'rgba(147, 112, 219, 0.6)',
                preview: 'linear-gradient(135deg, #6A0DAD, #9370DB)'
            },
            'teal': {
                name: 'Teal',
                primary: 'rgba(10, 25, 25, 0.7)',
                accent: '#20B2AA',
                text: '#fff',
                dockBg: '#ffffff',
                dockText: '#0a1919',
                dockGlow: 'rgba(32, 178, 170, 0.6)',
                preview: 'linear-gradient(135deg, #008B8B, #20B2AA)'
            },
            'neonblue': {
                name: 'Neon Blue',
                primary: 'rgba(10, 10, 25, 0.7)',
                accent: '#00FFFF',
                text: '#fff',
                dockBg: '#ffffff',
                dockText: '#0a0a19',
                dockGlow: 'rgba(0, 255, 255, 0.6)',
                preview: 'linear-gradient(135deg, #00CED1, #00FFFF)'
            },
            'magenta': {
                name: 'Magenta',
                primary: 'rgba(30, 10, 30, 0.7)',
                accent: '#FF00FF',
                text: '#fff',
                dockBg: '#ffffff',
                dockText: '#1e0a1e',
                dockGlow: 'rgba(255, 0, 255, 0.6)',
                preview: 'linear-gradient(135deg, #C71585, #FF00FF)'
            },
            'rainbow': {
                name: 'Rainbow Static',
                primary: 'rgba(20, 20, 35, 0.75)',
                accent: '#FF00FF',
                text: '#fff',
                dockBg: '#ffffff',
                dockText: '#141423',
                dockGlow: 'rgba(255, 0, 255, 0.6)',
                preview: 'linear-gradient(90deg, #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #4b0082, #9400d3)',
                isRainbow: true,
                animated: false
            },
            'rainbowFlow': {
                name: 'Rainbow Flow',
                primary: 'rgba(20, 20, 35, 0.75)',
                accent: '#FF00FF',
                text: '#fff',
                dockBg: '#ffffff',
                dockText: '#141423',
                dockGlow: 'rgba(255, 0, 255, 0.6)',
                preview: 'linear-gradient(90deg, #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #4b0082, #9400d3)',
                isRainbow: true,
                animated: true
            },
            'whiteBright': {
                name: 'White Bright',
                primary: 'rgba(255, 255, 255, 0.85)',
                accent: '#ffffff',
                text: '#333',
                dockBg: '#ffffff',
                dockText: '#333',
                dockGlow: 'rgba(255, 255, 255, 0.9)',
                preview: 'linear-gradient(135deg, #ffffff, #f0f0f0)'
            }
        };

        let currentTheme = 'silver';

        // Wisdom, jokes, and FYIs
        const wiseSayings = [
            "The journey of a thousand miles begins with a single step.",
            "It does not matter how slowly you go as long as you do not stop.",
            "The only way to do great work is to love what you do.",
            "Innovation distinguishes between a leader and a follower.",
            "Your time is limited, don't waste it living someone else's life.",
            "The best time to plant a tree was 20 years ago. The second best time is now.",
            "What lies behind us and what lies before us are tiny matters compared to what lies within us.",
            "Believe you can and you're halfway there.",
            "Do not wait for leaders; do it alone, person to person.",
            "The future belongs to those who believe in the beauty of their dreams."
        ];

        const funnyJokes = [
            "Why don't scientists trust atoms? Because they make up everything!",
            "Why did the scarecrow win an award? He was outstanding in his field!",
            "What do you call a bear with no teeth? A gummy bear!",
            "Why don't eggs tell jokes? They'd crack each other up!",
            "What do you call a fake noodle? An impasta!",
            "Why did the bicycle fall over? It was two tired!",
            "What did one wall say to the other? I'll meet you at the corner!",
            "Why don't skeletons fight each other? They don't have the guts!",
            "What's the best thing about Switzerland? I don't know, but the flag is a big plus!",
            "How does a penguin build its house? Igloos it together!"
        ];

        const randomFYIs = [
            "FYI: Honey never spoils. Archaeologists have found 3000-year-old honey that's still edible!",
            "FYI: Octopuses have three hearts and blue blood!",
            "FYI: A group of flamingos is called a 'flamboyance'!",
            "FYI: The shortest war in history lasted 38 minutes!",
            "FYI: Bananas are berries, but strawberries aren't!",
            "FYI: There are more stars in the universe than grains of sand on Earth!",
            "FYI: A single bolt of lightning contains enough energy to toast 100,000 slices of bread!",
            "FYI: The human brain uses 20% of the body's energy despite being only 2% of body weight!",
            "FYI: Venus is the only planet that rotates clockwise!",
            "FYI: A jiffy is an actual unit of time - 1/100th of a second!"
        ];

        function showWisdomPrompt() {
            document.getElementById('restart-prompt').classList.remove('visible');
            
            const allContent = [...wiseSayings, ...funnyJokes, ...randomFYIs];
            const randomContent = allContent[Math.floor(Math.random() * allContent.length)];
            
            document.getElementById('wisdom-text').textContent = randomContent;
            document.getElementById('wisdom-prompt').classList.add('visible');
            playSound('passive');
        }

        function applyTheme(themeName) {
            const theme = themes[themeName];
            if (!theme) return;

            currentTheme = themeName;
            
            // Remove any existing rainbow animations
            document.querySelectorAll('.rainbow-animated, .rainbow-border, .rainbow-glow').forEach(el => {
                el.classList.remove('rainbow-animated', 'rainbow-border', 'rainbow-glow');
            });
            
            // Kill any existing rainbow GSAP animations
            if (window.rainbowTimeline) {
                window.rainbowTimeline.kill();
                window.rainbowTimeline = null;
            }
            
            // Kill all GSAP tweens on UI elements
            gsap.killTweensOf('.side-menu, #inspector-panel, #info-panel, #search-panel, .dock, .hamburger-btn, #faq-panel, .prompt-modal, .menu-item, .submenu-item, #transform-panel, .control-btn, .action-btn, #virtual-keyboard, .key-btn, .menu-title, .info-space-title, .breadcrumb-current, .controls-title, .prompt-title, .joystick-stick');
            
            // Reset CSS properties that GSAP may have modified
            document.querySelectorAll('.side-menu, #inspector-panel, #info-panel, #search-panel, .dock, .hamburger-btn, #faq-panel, .prompt-modal, .menu-item, .submenu-item, #transform-panel, .control-btn, .action-btn, #virtual-keyboard, .key-btn').forEach(el => {
                el.style.borderColor = '';
                el.style.backgroundPosition = '';
                el.style.backgroundSize = '';
            });
            
            document.querySelectorAll('.menu-title, .info-space-title, .breadcrumb-current, .controls-title, .prompt-title, .joystick-stick').forEach(el => {
                el.style.backgroundPosition = '';
                el.style.backgroundSize = '';
            });

            // Handle rainbow themes
            const isRainbow = theme.isRainbow;
            const isAnimated = theme.animated;
            
            // Update CSS variables or directly update elements
            const root = document.documentElement;
            root.style.setProperty('--theme-primary', theme.primary);
            root.style.setProperty('--theme-accent', theme.accent);
            root.style.setProperty('--theme-text', theme.text);

            // Update all panels (including header-bar and particle-behavior-panel)
            document.querySelectorAll('.side-menu, #inspector-panel, #header-bar, #search-panel, .dock, .hamburger-btn, #faq-panel, .prompt-modal, #transform-panel, #particle-behavior-panel').forEach(el => {
                el.style.background = theme.primary;
                el.style.backdropFilter = 'blur(20px)';
                el.style.color = theme.text;
                if (isRainbow && isAnimated) {
                    el.classList.add('rainbow-border');
                }
            });

            // Update accent colors with rainbow
            document.querySelectorAll('.menu-title, .info-space-title, .breadcrumb-current, .controls-title, .prompt-title').forEach(el => {
                if (isRainbow) {
                    el.style.background = 'linear-gradient(90deg, #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #4b0082, #9400d3)';
                    el.style.backgroundClip = 'text';
                    el.style.webkitBackgroundClip = 'text';
                    el.style.webkitTextFillColor = 'transparent';
                    if (isAnimated) {
                        el.classList.add('rainbow-animated');
                    }
                } else {
                    el.style.color = theme.accent;
                    el.style.background = 'none';
                    el.style.backgroundClip = 'unset';
                    el.style.webkitBackgroundClip = 'unset';
                    el.style.webkitTextFillColor = 'unset';
                }
            });

            // Update borders
            document.querySelectorAll('.side-menu, #inspector-panel, #header-bar, #search-panel, .dock, .hamburger-btn, #faq-panel, .prompt-modal, .menu-item, .submenu-item, #transform-panel, #particle-behavior-panel').forEach(el => {
                if (isRainbow && !isAnimated) {
                    el.style.borderImage = 'linear-gradient(90deg, #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #4b0082, #9400d3) 1';
                } else if (!isRainbow) {
                    el.style.borderImage = 'none';
                    el.style.borderColor = theme.accent + '80';
                }
            });

            // Update hamburger spans
            document.querySelectorAll('.hamburger-btn span').forEach(el => {
                el.style.background = theme.accent;
            });

            // Update text elements
            document.querySelectorAll('.menu-item, .submenu-item, .breadcrumb, .info-username, .faq-answer, .faq-question, .prompt-message').forEach(el => {
                el.style.color = theme.text;
            });
            
            // Update navbar text elements
            document.querySelectorAll('#header-username, #header-description, #session-timer, #fps-counter').forEach(el => {
                el.style.color = theme.text;
            });
            
            // Update navbar buttons
            document.querySelectorAll('.quick-action-btn').forEach(el => {
                el.style.background = theme.primary;
                el.style.borderColor = theme.accent + '80';
                el.style.color = theme.text;
            });
            
            // Update inspector input fields
            document.querySelectorAll('#object-data-header, #object-data-body, #object-data-footer').forEach(el => {
                el.style.background = 'rgba(0, 0, 0, 0.3)';
                el.style.borderColor = theme.accent + '50';
                el.style.color = theme.text;
            });
            
            // Update inspector submit button
            const submitBtn = document.getElementById('object-data-submit');
            if (submitBtn) {
                submitBtn.style.background = theme.primary;
                submitBtn.style.borderColor = theme.accent + '80';
                submitBtn.style.color = theme.text;
            }
            
            // Update inspector labels and values
            document.querySelectorAll('.info-label').forEach(el => {
                el.style.color = 'rgba(255, 255, 255, 0.6)';
            });
            
            document.querySelectorAll('#object-position, #object-rotation, #object-scale').forEach(el => {
                el.style.background = 'rgba(0, 0, 0, 0.3)';
                el.style.borderColor = theme.accent + '50';
                el.style.color = theme.text;
            });

            // Keep timer always visible (bold white or dark depending on theme)
            const timer = document.querySelector('.info-timer');
            if (timer) {
                timer.style.color = theme.text === '#333' ? '#000' : '#fff';
            }

            // Update breadcrumb separators
            document.querySelectorAll('.breadcrumb-separator').forEach(el => {
                el.style.color = theme.text === '#333' ? 'rgba(0, 0, 0, 0.3)' : 'rgba(255, 255, 255, 0.3)';
            });

            // Update dock items with white glow and theme-specific text
            document.querySelectorAll('.dock-item').forEach(el => {
                el.style.background = '#ffffff';
                el.style.color = theme.dockText;
                el.style.border = `1px solid ${theme.accent}`;
                el.style.boxShadow = `0 0 10px ${theme.dockGlow}, 0 0 20px ${theme.dockGlow}, inset 0 0 5px rgba(255, 255, 255, 0.3)`;
                el.style.textShadow = `0 0 8px ${theme.accent}, 0 0 12px ${theme.accent}`;
            });

            // Update docks background
            document.querySelectorAll('.dock').forEach(el => {
                el.style.background = theme.primary;
                el.style.borderColor = theme.accent + '50';
            });

            // Update mobile controls (joystick and buttons)
            const joystickBase = document.querySelector('.joystick-base');
            if (joystickBase) {
                joystickBase.style.background = theme.primary;
                joystickBase.style.borderColor = theme.accent + '50';
            }

            const joystickStick = document.querySelector('.joystick-stick');
            if (joystickStick) {
                if (isRainbow) {
                    joystickStick.style.background = 'linear-gradient(90deg, #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #4b0082, #9400d3)';
                    joystickStick.style.borderColor = '#ff00ff';
                    if (isAnimated) {
                        joystickStick.classList.add('rainbow-animated', 'rainbow-border');
                    }
                } else {
                    joystickStick.style.background = theme.accent + '99';
                    joystickStick.style.borderColor = theme.accent;
                }
            }

            // Update control buttons
            document.querySelectorAll('.control-btn').forEach(el => {
                el.style.background = theme.primary;
                el.style.color = theme.text;
                if (isRainbow && isAnimated) {
                    el.classList.add('rainbow-border');
                } else if (!isRainbow) {
                    el.style.borderColor = theme.accent + '50';
                } else {
                    el.style.borderImage = 'linear-gradient(90deg, #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #4b0082, #9400d3) 1';
                }
            });

            // Update action buttons
            document.querySelectorAll('.action-btn').forEach(el => {
                el.style.background = theme.primary;
                el.style.color = theme.text;
                if (isRainbow && isAnimated) {
                    el.classList.add('rainbow-border');
                } else if (!isRainbow) {
                    el.style.borderColor = theme.accent + '50';
                } else {
                    el.style.borderImage = 'linear-gradient(90deg, #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #4b0082, #9400d3) 1';
                }
            });

            // Update transform panel inputs
            document.querySelectorAll('.transform-input, .step-input').forEach(el => {
                el.style.background = 'rgba(255, 255, 255, 0.05)';
                el.style.borderColor = theme.accent + '50';
                el.style.color = theme.text;
            });

            // Update camera circle
            const cameraCircle = document.getElementById('camera-circle');
            if (cameraCircle) {
                cameraCircle.style.borderColor = theme.accent + '33';
            }

            // Update hand menu radial items
            document.querySelectorAll('.radial-item').forEach(el => {
                el.style.borderColor = theme.accent + '99';
                el.style.boxShadow = `0 0 10px ${theme.accent}66`;
            });

            // Update pause overlay
            const pauseTitle = document.querySelector('.pause-title');
            if (pauseTitle) {
                pauseTitle.style.color = theme.accent;
            }

            const pauseBtn = document.querySelector('.pause-btn');
            if (pauseBtn) {
                pauseBtn.style.background = theme.accent + '66';
                pauseBtn.style.borderColor = theme.accent + 'B3';
            }

            // Update pocket panel
            const pocketPanel = document.getElementById('pocket-panel');
            if (pocketPanel) {
                pocketPanel.style.background = theme.primary;
                pocketPanel.style.borderColor = theme.accent + '66';
            }

            const pocketHeader = document.querySelector('.pocket-header');
            if (pocketHeader) {
                pocketHeader.style.color = theme.accent;
            }

            document.querySelectorAll('.pocket-slot').forEach(el => {
                el.style.borderColor = theme.accent + '80';
            });

            // Update virtual keyboard
            const virtualKeyboard = document.getElementById('virtual-keyboard');
            if (virtualKeyboard) {
                virtualKeyboard.style.background = theme.primary;
                if (isRainbow && isAnimated) {
                    virtualKeyboard.classList.add('rainbow-border');
                } else if (isRainbow && !isAnimated) {
                    virtualKeyboard.style.borderImage = 'linear-gradient(90deg, #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #4b0082, #9400d3) 1';
                } else {
                    virtualKeyboard.style.borderImage = 'none';
                    virtualKeyboard.style.borderColor = theme.accent + '66';
                }
            }

            document.querySelectorAll('.key-btn').forEach(el => {
                el.style.color = theme.text;
                if (isRainbow) {
                    el.style.background = 'linear-gradient(90deg, #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #4b0082, #9400d3)';
                    if (isAnimated) {
                        el.classList.add('rainbow-animated', 'rainbow-border');
                    } else {
                        el.style.borderImage = 'linear-gradient(90deg, #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #4b0082, #9400d3) 1';
                    }
                } else {
                    el.style.background = theme.accent + '50';
                    el.style.borderColor = theme.accent + '80';
                    el.style.borderImage = 'none';
                }
            });

            // Update menu item hovers
            const styleSheet = document.createElement('style');
            styleSheet.textContent = `
                .menu-item:hover, .submenu-item:hover {
                    background: ${theme.accent}33 !important;
                    border-color: ${theme.accent}80 !important;
                }
                .prompt-btn {
                    background: ${theme.accent}50 !important;
                    border-color: ${theme.accent}80 !important;
                }
                .prompt-btn:hover {
                    background: ${theme.accent}80 !important;
                }
                .search-input {
                    color: ${theme.text} !important;
                    border-color: ${theme.accent}50 !important;
                }
                .search-input:focus {
                    border-color: ${theme.accent}99 !important;
                    background: ${theme.accent}1A !important;
                }
                .dock-item:hover {
                    background: #ffffff !important;
                    border-color: ${theme.accent} !important;
                    box-shadow: 0 0 15px ${theme.dockGlow}, 0 0 30px ${theme.dockGlow}, inset 0 0 8px rgba(255, 255, 255, 0.4) !important;
                    text-shadow: 0 0 10px ${theme.accent}, 0 0 15px ${theme.accent} !important;
                    transform: scale(1.1);
                }
                .dock-item.dragging {
                    opacity: 0.5;
                }
                .control-btn:hover, .action-btn:hover {
                    background: ${theme.accent}50 !important;
                    border-color: ${theme.accent}99 !important;
                }
                .control-btn.active, .action-btn.active {
                    background: ${theme.accent}99 !important;
                    border-color: ${theme.accent} !important;
                    color: ${theme.dockText} !important;
                }
                .joystick-stick:active {
                    background: ${theme.accent} !important;
                }
                .transform-input:focus, .step-input:focus {
                    border-color: ${theme.accent}99 !important;
                    background: ${theme.accent}1A !important;
                }
                .transform-input, .step-input {
                    color: ${theme.text} !important;
                    background: rgba(255, 255, 255, 0.05) !important;
                    border-color: ${theme.accent}50 !important;
                }
                .fps-mode #camera-circle {
                    border-color: ${theme.accent}99 !important;
                    border-width: 3px;
                }
                .fps-mode #camera-circle::before {
                    background: ${theme.accent}E6 !important;
                }
                .summon-btn, .transform-submit-btn {
                    background: ${theme.accent}50 !important;
                    border-color: ${theme.accent}80 !important;
                    color: ${theme.text} !important;
                }
                .summon-btn:hover, .transform-submit-btn:hover {
                    background: ${theme.accent}80 !important;
                    border-color: ${theme.accent} !important;
                }
                .radial-item:hover {
                    background: ${theme.accent}E6 !important;
                    border-color: ${theme.accent} !important;
                }
                .pause-title {
                    color: ${theme.accent} !important;
                }
                .pause-btn {
                    background: ${theme.accent}66 !important;
                    border-color: ${theme.accent}B3 !important;
                }
                .pause-btn:hover {
                    background: ${theme.accent}B3 !important;
                    box-shadow: 0 0 20px ${theme.accent}99 !important;
                }
                .pocket-panel {
                    background: ${theme.primary} !important;
                    border-color: ${theme.accent}66 !important;
                }
                .pocket-header {
                    color: ${theme.accent} !important;
                }
                .pocket-slot {
                    border-color: ${theme.accent}80 !important;
                }
                .pocket-slot:hover {
                    background: ${theme.accent}80 !important;
                    border-color: ${theme.accent}E6 !important;
                }
                #virtual-keyboard {
                    background: ${theme.primary} !important;
                    border-color: ${theme.accent}66 !important;
                }
                .key-btn {
                    background: ${theme.accent}50 !important;
                    border-color: ${theme.accent}80 !important;
                    color: ${theme.text} !important;
                }
                .key-btn:hover {
                    background: ${theme.accent}99 !important;
                    border-color: ${theme.accent} !important;
                }
                .key-btn:active {
                    background: ${theme.accent}CC !important;
                }
            `;
            
            // Remove old theme styles
            const oldStyle = document.getElementById('theme-dynamic-styles');
            if (oldStyle) oldStyle.remove();
            styleSheet.id = 'theme-dynamic-styles';
            document.head.appendChild(styleSheet);

            // Update active theme in grid
            document.querySelectorAll('.theme-option').forEach(el => {
                el.classList.remove('active');
            });
            const activeTheme = document.querySelector(`[data-theme="${themeName}"]`);
            if (activeTheme) {
                activeTheme.classList.add('active');
            }
            
            // Create GSAP rainbow flow animation if needed
            if (isRainbow && isAnimated) {
                const rainbowColors = ['#ff0000', '#ff7f00', '#ffff00', '#00ff00', '#0000ff', '#4b0082', '#9400d3', '#ff0000'];
                const duration = 9.2;
                const colorDuration = duration / rainbowColors.length;
                
                // Create master timeline that we can kill later
                window.rainbowTimeline = gsap.timeline({ repeat: -1, paused: false });
                
                // Animate borders through rainbow - add to master timeline
                document.querySelectorAll('.side-menu, #inspector-panel, #info-panel, #search-panel, .dock, .hamburger-btn, #faq-panel, .prompt-modal, .menu-item, .submenu-item, #transform-panel, .control-btn, .action-btn, #virtual-keyboard').forEach(el => {
                    rainbowColors.forEach((color, i) => {
                        gsap.to(el, {
                            borderColor: color,
                            duration: colorDuration,
                            ease: 'linear',
                            repeat: -1,
                            repeatDelay: duration - colorDuration,
                            delay: i * colorDuration
                        });
                    });
                });
                
                // Animate text gradients
                document.querySelectorAll('.menu-title, .info-space-title, .breadcrumb-current, .controls-title, .prompt-title').forEach(el => {
                    gsap.to(el, {
                        backgroundPosition: '200% center',
                        duration: duration,
                        ease: 'linear',
                        repeat: -1,
                        backgroundSize: '200% 100%'
                    });
                });
                
                // Animate joystick stick
                const joystickStick = document.querySelector('.joystick-stick');
                if (joystickStick) {
                    gsap.to(joystickStick, {
                        backgroundPosition: '200% center',
                        duration: duration,
                        ease: 'linear',
                        repeat: -1,
                        backgroundSize: '200% 100%'
                    });
                }
                
                // Animate key buttons
                document.querySelectorAll('.key-btn').forEach(el => {
                    rainbowColors.forEach((color, i) => {
                        gsap.to(el, {
                            borderColor: color,
                            duration: colorDuration,
                            ease: 'linear',
                            repeat: -1,
                            repeatDelay: duration - colorDuration,
                            delay: i * colorDuration
                        });
                    });
                });
            }

            playSound('active');
        }

        function initThemeSelector() {
            const grid = document.getElementById('theme-grid');
            grid.innerHTML = '';

            Object.keys(themes).forEach(themeKey => {
                const theme = themes[themeKey];
                const option = document.createElement('div');
                option.className = 'theme-option';
                option.setAttribute('data-theme', themeKey);
                if (themeKey === currentTheme) {
                    option.classList.add('active');
                }
                
                option.innerHTML = `
                    <div class="theme-color-preview" style="background: ${theme.preview}"></div>
                    <div>${theme.name}</div>
                `;
                
                option.addEventListener('click', () => {
                    applyTheme(themeKey);
                });
                
                grid.appendChild(option);
            });
        }

        function setupHandMenus() {
            const leftHand = document.getElementById('left-hand');
            const rightHand = document.getElementById('right-hand');
            const consciousHand = document.getElementById('conscious-hand');
            const pauseOverlay = document.getElementById('pause-overlay');
            const resumeBtn = document.getElementById('resume-btn');

            // Create radial menu items for Left Hand
            const lhRadial = document.getElementById('lh-radial');
            const lhOptions = ['Move', 'Shift', 'Focus', 'Look', 'Feel', 
                              'Change', 'Zoom', 'Choose', 'Pace', 'Stretch'];
            createRadialMenu(lhRadial, lhOptions, 'lh');

            // Create radial menu items for Right Hand
            const rhRadial = document.getElementById('rh-radial');
            const rhOptions = ['Body', 'Mind', 'Voice', 'Power', 'Build', 
                              'Heal', 'Info', 'Assist', 'Protect', 'Story'];
            createRadialMenu(rhRadial, rhOptions, 'rh');

            // Create radial menu items for Conscious Hand
            const chRadial = document.getElementById('ch-radial');
            const chOptions = ['Form', 'Flow', 'Charge', 'Tone', 'Self', 
                              'Bond', 'Mood', 'Code', 'Web', 'Beyond'];
            createRadialMenu(chRadial, chOptions, 'ch');

            // Resume button
            resumeBtn.addEventListener('click', () => {
                pauseOverlay.classList.remove('visible');
                playSound('active');
            });

            // Mobile buttons
            const btnLH = document.getElementById('btn-lh');
            const btnRH = document.getElementById('btn-rh');
            const btnCH = document.getElementById('btn-ch');

            if (btnLH) {
                btnLH.addEventListener('click', () => {
                    toggleLeftHand();
                });
            }

            if (btnRH) {
                btnRH.addEventListener('click', () => {
                    toggleRightHand();
                });
            }

            if (btnCH) {
                btnCH.addEventListener('click', () => {
                    toggleConsciousHand();
                });
            }

            const btnDocks = document.getElementById('btn-docks');
            if (btnDocks) {
                btnDocks.addEventListener('click', () => {
                    docksVisible = !docksVisible;
                    const docks = document.querySelectorAll('.dock');
                    docks.forEach(dock => {
                        if (docksVisible) {
                            dock.classList.remove('hidden');
                        } else {
                            dock.classList.add('hidden');
                        }
                    });
                    playSound('passive');
                });
            }

            const btnKeyboard = document.getElementById('btn-keyboard');
            if (btnKeyboard) {
                btnKeyboard.addEventListener('click', () => {
                    toggleVirtualKeyboard();
                });
            }

            const btnActionGrid = document.getElementById('btn-action-grid');
            if (btnActionGrid) {
                btnActionGrid.addEventListener('click', () => {
                    toggleActionGrid();
                });
            }

            const btnTray = document.getElementById('btn-tray');
            if (btnTray) {
                btnTray.addEventListener('click', () => {
                    const sideTray = document.getElementById('side-tray');
                    const topTray = document.getElementById('top-tray');
                    
                    const isHidden = sideTray.style.display === 'none';
                    
                    if (sideTray) {
                        sideTray.style.display = isHidden ? 'block' : 'none';
                    }
                    if (topTray) {
                        topTray.style.display = isHidden ? 'flex' : 'none';
                    }
                    
                    btnTray.classList.toggle('active');
                    playSound('passive');
                });
            }

            const btnChat = document.getElementById('btn-chat');
            if (btnChat) {
                btnChat.addEventListener('click', () => {
                    const chatPanel = document.getElementById('chat-panel');
                    const chatButton = document.getElementById('chat-button');
                    
                    if (chatPanel) {
                        const isHidden = chatPanel.style.display === 'none';
                        chatPanel.style.display = isHidden ? 'block' : 'none';
                        
                        if (chatButton) {
                            chatButton.style.background = isHidden ? 'rgba(128, 128, 128, 0.5)' : 'rgba(25, 25, 30, 0.85)';
                        }
                        
                        btnChat.classList.toggle('active');
                        playSound('passive');
                    }
                });
            }

            const btnNav = document.getElementById('btn-nav');
            if (btnNav) {
                btnNav.addEventListener('click', () => {
                    const headerBar = document.getElementById('header-bar');
                    if (headerBar.style.display === 'none') {
                        headerBar.style.display = 'flex';
                    } else {
                        headerBar.style.display = 'none';
                    }
                    playSound('active');
                });
            }

            const btnRulers = document.getElementById('btn-rulers');
            if (btnRulers) {
                btnRulers.addEventListener('click', () => {
                    const xRuler = document.getElementById('x-axis-ruler');
                    const yRuler = document.getElementById('y-axis-ruler');
                    const zRuler = document.getElementById('z-axis-ruler');
                    
                    if (xRuler && yRuler && zRuler) {
                        const isVisible = xRuler.style.display === 'flex';
                        xRuler.style.display = isVisible ? 'none' : 'flex';
                        yRuler.style.display = isVisible ? 'none' : 'flex';
                        zRuler.style.display = isVisible ? 'none' : 'flex';
                        playSound('active');
                    }
                });
            }

            const btnMax = document.getElementById('btn-max');
            if (btnMax) {
                btnMax.addEventListener('click', () => {
                    if (!document.fullscreenElement) {
                        document.documentElement.requestFullscreen().catch(err => {
                            console.log('Fullscreen error:', err);
                        });
                    } else {
                        document.exitFullscreen();
                    }
                    playSound('active');
                });
            }

            // Up and Down movement buttons (R and F keys)
            const btnUp = document.getElementById('btn-up');
            if (btnUp) {
                btnUp.addEventListener('mousedown', () => {
                    keys['r'] = true;
                });
                btnUp.addEventListener('mouseup', () => {
                    keys['r'] = false;
                });
                btnUp.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    keys['r'] = true;
                });
                btnUp.addEventListener('touchend', (e) => {
                    e.preventDefault();
                    keys['r'] = false;
                });
            }

            const btnDown = document.getElementById('btn-down');
            if (btnDown) {
                btnDown.addEventListener('mousedown', () => {
                    keys['f'] = true;
                });
                btnDown.addEventListener('mouseup', () => {
                    keys['f'] = false;
                });
                btnDown.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    keys['f'] = true;
                });
                btnDown.addEventListener('touchend', (e) => {
                    e.preventDefault();
                    keys['f'] = false;
                });
            }

            // Center button (O key - reset camera)
            const btnCenter = document.getElementById('btn-center');
            if (btnCenter) {
                btnCenter.addEventListener('click', () => {
                    gsap.to(camera.position, {
                        duration: 1.5,
                        x: 0,
                        y: 0,
                        z: 10,
                        ease: 'power2.inOut'
                    });
                    camera.quaternion.set(0, 0, 0, 1); // Reset rotation
                    playSound('active');
                });
            }
        }

        function createRadialMenu(container, options, handType) {
            const radius = 100; // Distance from center
            const angleStep = (Math.PI * 2) / options.length;

            options.forEach((option, index) => {
                const angle = angleStep * index - Math.PI / 2; // Start from top
                const x = Math.cos(angle) * radius;
                const y = Math.sin(angle) * radius;

                const item = document.createElement('div');
                item.className = 'radial-item';
                item.textContent = option;
                item.style.left = `calc(50% + ${x}px)`;
                item.style.top = `calc(50% + ${y}px)`;
                item.style.transform = 'translate(-50%, -50%)';

                item.addEventListener('click', () => {
                    handleRadialItemClick(handType, option, index);
                });

                container.appendChild(item);
            });
        }

        function handleRadialItemClick(handType, option, index) {
            console.log(`${handType} - ${option} clicked (index: ${index})`);
            playSound('active');

            // Handle RH options - all open the tool menu
            if (handType === 'rh') {
                if (!rhToolMenuVisible) {
                    toggleRHToolMenu();
                }
                return;
            }

            // Handle LH options - all open the tool menu
            if (handType === 'lh') {
                if (!lhToolMenuVisible) {
                    toggleLHToolMenu();
                }
                return;
            }

            // Handle special CH options
            if (handType === 'ch') {
                if (option === 'Pause Menu') {
                    document.getElementById('pause-overlay').classList.add('visible');
                    return;
                }
                
                if (option === 'MySpace') {
                    toggleMySpace();
                    return;
                }
                
                if (option === 'User Pocket') {
                    togglePocket();
                    return;
                }
                
                // All other CH options open the tool menu
                if (!chToolMenuVisible) {
                    toggleCHToolMenu();
                }
            }

            // Add more functionality here for each option
        }

        function toggleLeftHand() {
            leftHandVisible = !leftHandVisible;
            const leftHand = document.getElementById('left-hand');
            
            if (leftHandVisible) {
                leftHand.classList.add('visible');
            } else {
                leftHand.classList.remove('visible');
                // Hide LH tool menu when hand is hidden
                if (lhToolMenuVisible) {
                    toggleLHToolMenu();
                }
            }
            playSound('passive');
        }

        function toggleRightHand() {
            rightHandVisible = !rightHandVisible;
            const rightHand = document.getElementById('right-hand');
            const rhMovementControl = document.getElementById('rh-movement-control');
            
            if (rightHandVisible) {
                rightHand.classList.add('visible');
                rhMovementControl.style.display = 'block';
            } else {
                rightHand.classList.remove('visible');
                rhMovementControl.style.display = 'none';
                // Hide tool menu when RH is hidden
                if (rhToolMenuVisible) {
                    toggleRHToolMenu();
                }
            }
            playSound('passive');
        }

        function toggleConsciousHand() {
            consciousHandVisible = !consciousHandVisible;
            const consciousHand = document.getElementById('conscious-hand');
            const chMovementControl = document.getElementById('ch-movement-control');
            
            if (consciousHandVisible) {
                consciousHand.classList.add('visible');
                chMovementControl.style.display = 'block';
            } else {
                consciousHand.classList.remove('visible');
                chMovementControl.style.display = 'none';
                // Hide CH tool menu when hand is hidden
                if (chToolMenuVisible) {
                    toggleCHToolMenu();
                }
            }
            playSound('passive');
        }

        // Tool Menu System for all hands
        let rhToolMenuVisible = false;
        let lhToolMenuVisible = false;
        let chToolMenuVisible = false;

        const rhToolData = [];
        const lhToolData = [];
        const chToolData = [];

        // Create 11 tools for each hand
        for (let i = 0; i < 11; i++) {
            rhToolData.push({
                name: `TOOL${String(i).padStart(2, '0')}`,
                description: `RH Tool ${i}. Different settings and interface will appear in the RH movement pad when selected.`,
                id: `rh-tool${i}`
            });
            lhToolData.push({
                name: `TOOL${String(i).padStart(2, '0')}`,
                description: `LH Tool ${i}. Additional details and functionality will be added later.`,
                id: `lh-tool${i}`
            });
            chToolData.push({
                name: `TOOL${String(i).padStart(2, '0')}`,
                description: `CH Tool ${i}. Additional details and functionality will be added later.`,
                id: `ch-tool${i}`
            });
        }

        function initializeToolMenu() {
            // Initialize RH tool menu
            populateToolMenu('rh', rhToolData);
            // Initialize LH tool menu
            populateToolMenu('lh', lhToolData);
            // Initialize CH tool menu
            populateToolMenu('ch', chToolData);
            
            // Make all tool menus draggable
            makeDraggable('rh-tool-menu');
            makeDraggable('lh-tool-menu');
            makeDraggable('ch-tool-menu');
        }

        function populateToolMenu(handType, toolData) {
            const toolMenuItems = document.getElementById(`${handType}-tool-menu-items`);
            const toolDescription = document.getElementById(`${handType}-tool-description`);
            
            toolData.forEach((tool, index) => {
                const toolItem = document.createElement('div');
                toolItem.className = 'tool-item';
                toolItem.textContent = tool.name;
                toolItem.dataset.toolId = tool.id;
                toolItem.dataset.handType = handType;
                
                toolItem.addEventListener('click', () => {
                    // Remove previous selection from this hand's menu
                    toolMenuItems.querySelectorAll('.tool-item').forEach(item => {
                        item.classList.remove('selected');
                    });
                    // Select current
                    toolItem.classList.add('selected');
                    // Update description
                    toolDescription.textContent = tool.description;
                    
                    // If RH tool selected, update the RH movement pad to show tool interface
                    if (handType === 'rh') {
                        updateRHToolInterface(tool.id);
                    }
                    
                    playSound('passive');
                });
                
                toolMenuItems.appendChild(toolItem);
            });
        }

        function makeDraggable(elementId) {
            const element = document.getElementById(elementId);
            let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
            
            const header = element.querySelector('.tool-menu-header');
            if (header) {
                header.style.cursor = 'move';
                header.onmousedown = dragMouseDown;
            }
            
            function dragMouseDown(e) {
                e.preventDefault();
                pos3 = e.clientX;
                pos4 = e.clientY;
                document.onmouseup = closeDragElement;
                document.onmousemove = elementDrag;
            }
            
            function elementDrag(e) {
                e.preventDefault();
                pos1 = pos3 - e.clientX;
                pos2 = pos4 - e.clientY;
                pos3 = e.clientX;
                pos4 = e.clientY;
                element.style.top = (element.offsetTop - pos2) + 'px';
                element.style.left = (element.offsetLeft - pos1) + 'px';
                element.style.right = 'auto';
                element.style.transform = 'none';
            }
            
            function closeDragElement() {
                document.onmouseup = null;
                document.onmousemove = null;
            }
        }

        function updateRHToolInterface(toolId) {
            // This function will update the RH movement pad to show
            // the appropriate interface for the selected tool
            // For now, just console log - we'll implement specific tool UIs later
            console.log('RH Tool selected:', toolId);
            // TODO: Show different interface in RH movement pad based on toolId
        }

        function toggleRHToolMenu() {
            rhToolMenuVisible = !rhToolMenuVisible;
            const toolMenu = document.getElementById('rh-tool-menu');
            
            if (rhToolMenuVisible) {
                toolMenu.style.display = 'block';
                playSound('active');
            } else {
                toolMenu.style.display = 'none';
                // Clear selection
                document.querySelectorAll('#rh-tool-menu-items .tool-item').forEach(item => {
                    item.classList.remove('selected');
                });
                document.getElementById('rh-tool-description').textContent = 'Select a tool to view details';
                playSound('passive');
            }
        }

        function toggleLHToolMenu() {
            lhToolMenuVisible = !lhToolMenuVisible;
            const toolMenu = document.getElementById('lh-tool-menu');
            
            if (lhToolMenuVisible) {
                toolMenu.style.display = 'block';
                playSound('active');
            } else {
                toolMenu.style.display = 'none';
                // Clear selection
                document.querySelectorAll('#lh-tool-menu-items .tool-item').forEach(item => {
                    item.classList.remove('selected');
                });
                document.getElementById('lh-tool-description').textContent = 'Select a tool to view details';
                playSound('passive');
            }
        }

        function toggleCHToolMenu() {
            chToolMenuVisible = !chToolMenuVisible;
            const toolMenu = document.getElementById('ch-tool-menu');
            
            if (chToolMenuVisible) {
                toolMenu.style.display = 'block';
                playSound('active');
            } else {
                toolMenu.style.display = 'none';
                // Clear selection
                document.querySelectorAll('#ch-tool-menu-items .tool-item').forEach(item => {
                    item.classList.remove('selected');
                });
                document.getElementById('ch-tool-description').textContent = 'Select a tool to view details';
                playSound('passive');
            }
        }

        function toggleMySpace() {
            if (mySpaceAnimating) return; // Prevent multiple animations
            
            mySpaceAnimating = true;
            mySpaceExpanded = !mySpaceExpanded;
            
            const targetRadius = mySpaceExpanded ? expandedRadius : collapsedRadius;
            
            // Animate each grid panel one by one
            gridObjects.forEach((panel, index) => {
                // Stagger the animation for each panel
                setTimeout(() => {
                    // Calculate new position on sphere
                    const currentPos = panel.position.clone().normalize();
                    const targetPos = currentPos.multiplyScalar(targetRadius);
                    
                    gsap.to(panel.position, {
                        duration: 0.6,
                        x: targetPos.x,
                        y: targetPos.y,
                        z: targetPos.z,
                        ease: 'power2.inOut',
                        onComplete: () => {
                            // Make panel look at center
                            panel.lookAt(0, 0, 0);
                            
                            // Mark animation complete on last panel
                            if (index === gridObjects.length - 1) {
                                mySpaceAnimating = false;
                            }
                        }
                    });
                    
                    // Also animate opacity for collapse effect
                    gsap.to(panel.material, {
                        duration: 0.6,
                        opacity: mySpaceExpanded ? 0.2 : 0.1,
                        ease: 'power2.inOut'
                    });
                    
                }, index * 20); // 20ms delay between each panel
            });
            
            playSound('active');
        }

        function togglePocket() {
            pocketVisible = !pocketVisible;
            const pocketPanel = document.getElementById('pocket-panel');
            
            if (pocketVisible) {
                pocketPanel.classList.add('visible');
            } else {
                pocketPanel.classList.remove('visible');
            }
            
            playSound('passive');
        }

        let keyboardVisible = false;

        function toggleVirtualKeyboard() {
            keyboardVisible = !keyboardVisible;
            const keyboard = document.getElementById('virtual-keyboard');
            
            if (keyboardVisible) {
                keyboard.classList.add('visible');
            } else {
                keyboard.classList.remove('visible');
            }
            
            playSound('passive');
        }

        let actionGridVisible = false;

        function toggleActionGrid() {
            actionGridVisible = !actionGridVisible;
            const actionGrid = document.getElementById('action-grid');
            
            if (actionGridVisible) {
                actionGrid.classList.remove('hidden');
            } else {
                actionGrid.classList.add('hidden');
            }
            
            playSound('passive');
        }

        function initVirtualKeyboard() {
            const keyboard = document.getElementById('virtual-keyboard');
            
            const keys = [
                ['Q', 'W', 'E', 'R', 'F', 'A', 'S', 'D'],
                ['0', '9', 'X', 'Z', 'O', 'C', 'ENTER']
            ];
            
            keys.forEach(row => {
                const rowDiv = document.createElement('div');
                rowDiv.className = 'keyboard-row';
                
                row.forEach(key => {
                    const keyBtn = document.createElement('button');
                    keyBtn.className = 'key-btn';
                    if (key === 'ENTER') {
                        keyBtn.classList.add('wide');
                    }
                    keyBtn.textContent = key;
                    
                    keyBtn.addEventListener('click', () => {
                        simulateKeyPress(key);
                        playSound('passive');
                    });
                    
                    rowDiv.appendChild(keyBtn);
                });
                
                keyboard.appendChild(rowDiv);
            });
        }

        function simulateKeyPress(key) {
            const keyMap = {
                'ENTER': 'Enter',
                '0': '0',
                '9': '9'
            };
            
            const eventKey = keyMap[key] || key.toLowerCase();
            
            // Simulate keydown
            const keydownEvent = new KeyboardEvent('keydown', {
                key: eventKey,
                code: 'Key' + key,
                keyCode: key.charCodeAt(0),
                which: key.charCodeAt(0),
                bubbles: true
            });
            window.dispatchEvent(keydownEvent);
            
            // Simulate keyup after short delay
            setTimeout(() => {
                const keyupEvent = new KeyboardEvent('keyup', {
                    key: eventKey,
                    code: 'Key' + key,
                    keyCode: key.charCodeAt(0),
                    which: key.charCodeAt(0),
                    bubbles: true
                });
                window.dispatchEvent(keyupEvent);
            }, 100);
        }

        function setupUITransparency() {
            const slider = document.getElementById('ui-transparency-slider');
            const valueDisplay = document.getElementById('transparency-value');
            
            if (!slider) return;
            
            slider.addEventListener('input', (e) => {
                const value = parseInt(e.target.value);
                valueDisplay.textContent = value + '%';
                
                // Calculate opacity (0 = 5% visible, 100 = 100% visible)
                const minOpacity = 0.05;
                const maxOpacity = 1.0;
                const opacity = minOpacity + (value / 100) * (maxOpacity - minOpacity);
                
                // Apply to all UI elements
                const uiElements = document.querySelectorAll(
                    '.side-menu, #inspector-panel, #info-panel, #search-panel, ' +
                    '.dock, .hamburger-btn, #faq-panel, .prompt-modal, #transform-panel, ' +
                    '.joystick-base, .control-buttons, #action-grid, #virtual-keyboard, ' +
                    '#pocket-panel, .radial-menu'
                );
                
                uiElements.forEach(el => {
                    el.style.opacity = opacity;
                });
                
                playSound('passive');
            });
        }

        function setupParticleBehavior() {
            const panel = document.getElementById('particle-behavior-panel');
            const closeBtn = document.getElementById('particle-behavior-close');
            const modeButtons = document.querySelectorAll('.behavior-mode-btn');
            const forwardControls = document.getElementById('forward-controls');
            const backwardControls = document.getElementById('backward-controls');
            const upwardControls = document.getElementById('upward-controls');
            const downwardControls = document.getElementById('downward-controls');
            const connectedControls = document.getElementById('connected-controls');
            const glitchControls = document.getElementById('glitch-controls');
            const constellationControls = document.getElementById('constellation-controls');
            const forwardSpeedSlider = document.getElementById('forward-speed-slider');
            const backwardSpeedSlider = document.getElementById('backward-speed-slider');
            const upwardSpeedSlider = document.getElementById('upward-speed-slider');
            const downwardSpeedSlider = document.getElementById('downward-speed-slider');
            const connectedFrequencySlider = document.getElementById('connected-frequency-slider');
            const glitchIntensitySlider = document.getElementById('glitch-intensity-slider');
            const constellationDistanceSlider = document.getElementById('constellation-distance-slider');
            const particleCountSlider = document.getElementById('particle-count-slider');
            const forwardSpeedValue = document.getElementById('forward-speed-value');
            const backwardSpeedValue = document.getElementById('backward-speed-value');
            const upwardSpeedValue = document.getElementById('upward-speed-value');
            const downwardSpeedValue = document.getElementById('downward-speed-value');
            const connectedFrequencyValue = document.getElementById('connected-frequency-value');
            const glitchIntensityValue = document.getElementById('glitch-intensity-value');
            const constellationDistanceValue = document.getElementById('constellation-distance-value');
            const particleCountValue = document.getElementById('particle-count-value');
            
            // Close button
            if (closeBtn) {
                closeBtn.addEventListener('click', () => {
                    panel.style.display = 'none';
                    playSound('passive');
                });
            }
            
            // Mode buttons
            modeButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    const mode = btn.getAttribute('data-mode');
                    
                    // Update active state
                    modeButtons.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    
                    // Update behavior mode
                    particleBehaviorMode = mode;
                    
                    // Show/hide appropriate controls
                    forwardControls.style.display = mode === 'forward' ? 'block' : 'none';
                    backwardControls.style.display = mode === 'backward' ? 'block' : 'none';
                    upwardControls.style.display = mode === 'upward' ? 'block' : 'none';
                    downwardControls.style.display = mode === 'downward' ? 'block' : 'none';
                    connectedControls.style.display = mode === 'connected' ? 'block' : 'none';
                    glitchControls.style.display = mode === 'glitch' ? 'block' : 'none';
                    constellationControls.style.display = mode === 'constellation' ? 'block' : 'none';
                    
                    playSound('active');
                });
            });
            
            // Forward speed slider
            if (forwardSpeedSlider) {
                forwardSpeedSlider.addEventListener('input', (e) => {
                    const value = parseInt(e.target.value);
                    forwardSpeedValue.textContent = value;
                    forwardFlowSpeed = value / 100;
                    playSound('passive');
                });
            }
            
            // Backward speed slider
            if (backwardSpeedSlider) {
                backwardSpeedSlider.addEventListener('input', (e) => {
                    const value = parseInt(e.target.value);
                    backwardSpeedValue.textContent = value;
                    backwardFlowSpeed = value / 100;
                    playSound('passive');
                });
            }
            
            // Upward speed slider
            if (upwardSpeedSlider) {
                upwardSpeedSlider.addEventListener('input', (e) => {
                    const value = parseInt(e.target.value);
                    upwardSpeedValue.textContent = value;
                    upwardFlowSpeed = value / 100;
                    playSound('passive');
                });
            }
            
            // Downward speed slider
            if (downwardSpeedSlider) {
                downwardSpeedSlider.addEventListener('input', (e) => {
                    const value = parseInt(e.target.value);
                    downwardSpeedValue.textContent = value;
                    downwardFlowSpeed = value / 100;
                    playSound('passive');
                });
            }
            
            // Connected frequency slider
            if (connectedFrequencySlider) {
                connectedFrequencySlider.addEventListener('input', (e) => {
                    const value = parseInt(e.target.value);
                    connectedFrequencyValue.textContent = value;
                    connectionFrequency = value / 100;
                    playSound('passive');
                });
            }
            
            // Glitch intensity slider
            if (glitchIntensitySlider) {
                glitchIntensitySlider.addEventListener('input', (e) => {
                    const value = parseInt(e.target.value);
                    glitchIntensityValue.textContent = value;
                    glitchIntensity = value / 100;
                    playSound('passive');
                });
            }
            
            // Constellation distance slider
            if (constellationDistanceSlider) {
                constellationDistanceSlider.addEventListener('input', (e) => {
                    const value = parseInt(e.target.value);
                    constellationDistanceValue.textContent = value;
                    constellationDistance = value / 10; // Scale 1-100 to 0.1-10
                    playSound('passive');
                });
            }
            
            // Particle count slider
            if (particleCountSlider) {
                particleCountSlider.addEventListener('input', (e) => {
                    const value = parseInt(e.target.value);
                    particleCountValue.textContent = value.toLocaleString();
                    // Update particle count (will require reinitializing the particle system)
                    updateParticleCount(value);
                    playSound('passive');
                });
            }
            
            // Particle rotation sliders
            const particleRotXSlider = document.getElementById('particle-rot-x-slider');
            const particleRotYSlider = document.getElementById('particle-rot-y-slider');
            const particleRotZSlider = document.getElementById('particle-rot-z-slider');
            const particleRotXValue = document.getElementById('particle-rot-x-value');
            const particleRotYValue = document.getElementById('particle-rot-y-value');
            const particleRotZValue = document.getElementById('particle-rot-z-value');
            const particleRotReset = document.getElementById('particle-rot-reset');
            
            if (particleRotXSlider) {
                particleRotXSlider.addEventListener('input', (e) => {
                    const degrees = parseInt(e.target.value);
                    particleRotXValue.textContent = degrees + '';
                    if (particleSystem) {
                        particleSystem.rotation.x = degrees * Math.PI / 180;
                    }
                    playSound('passive');
                });
            }
            
            if (particleRotYSlider) {
                particleRotYSlider.addEventListener('input', (e) => {
                    const degrees = parseInt(e.target.value);
                    particleRotYValue.textContent = degrees + '';
                    if (particleSystem) {
                        particleSystem.rotation.y = degrees * Math.PI / 180;
                    }
                    playSound('passive');
                });
            }
            
            if (particleRotZSlider) {
                particleRotZSlider.addEventListener('input', (e) => {
                    const degrees = parseInt(e.target.value);
                    particleRotZValue.textContent = degrees + '';
                    if (particleSystem) {
                        particleSystem.rotation.z = degrees * Math.PI / 180;
                    }
                    playSound('passive');
                });
            }
            
            if (particleRotReset) {
                particleRotReset.addEventListener('click', () => {
                    // Reset to default (0, 0, 71)
                    particleRotXSlider.value = 0;
                    particleRotYSlider.value = 0;
                    particleRotZSlider.value = 71;
                    particleRotXValue.textContent = '0';
                    particleRotYValue.textContent = '0';
                    particleRotZValue.textContent = '71';
                    if (particleSystem) {
                        particleSystem.rotation.set(0, 0, 71 * Math.PI / 180);
                    }
                    playSound('active');
                });
            }
        }

        function updateParticleCount(newCount) {
            if (!particleSystem) return;
            
            // Store old count
            const oldCount = particleCount;
            particleCount = newCount;
            
            // Create new geometry with new particle count
            const newGeometry = new THREE.BufferGeometry();
            const newPositions = new Float32Array(particleCount * 3);
            const newVelocities = new Float32Array(particleCount * 3);
            
            // Initialize new particles
            for (let i = 0; i < particleCount; i++) {
                const angle = Math.random() * Math.PI * 2;
                const radius = Math.sqrt(Math.random()) * 10;
                const z = (Math.random() - 0.5) * 4;
                
                newPositions[i * 3] = Math.cos(angle) * radius;
                newPositions[i * 3 + 1] = Math.sin(angle) * radius;
                newPositions[i * 3 + 2] = z;
                
                newVelocities[i * 3] = (Math.random() - 0.5) * 0.02;
                newVelocities[i * 3 + 1] = (Math.random() - 0.5) * 0.02;
                newVelocities[i * 3 + 2] = (Math.random() - 0.5) * 0.02;
            }
            
            // Update geometry
            newGeometry.setAttribute('position', new THREE.BufferAttribute(newPositions, 3));
            
            // Dispose old geometry
            particleSystem.geometry.dispose();
            
            // Apply new geometry
            particleSystem.geometry = newGeometry;
            
            // Update velocity array
            particleVelocities = newVelocities;
        }

        function setupMySpaceGrid() {
            const panel = document.getElementById('myspace-grid-panel');
            const closeBtn = document.getElementById('myspace-grid-close');
            const gridButtons = document.querySelectorAll('.myspace-grid-btn');
            const gridSizeSlider = document.getElementById('grid-size-slider');
            const gridSpacingSlider = document.getElementById('grid-spacing-slider');
            const gridSizeValue = document.getElementById('grid-size-value');
            const gridSpacingValue = document.getElementById('grid-spacing-value');
            const applyBtn = document.getElementById('apply-grid-btn');
            
            let currentGridType = 'spherical';
            let currentGridSize = 15;
            let currentGridSpacing = 2;
            
            // Close button
            if (closeBtn) {
                closeBtn.addEventListener('click', () => {
                    panel.style.display = 'none';
                    playSound('passive');
                });
            }
            
            // Grid type buttons
            gridButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    currentGridType = btn.getAttribute('data-grid-type');
                    
                    // Update active state
                    gridButtons.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    
                    playSound('active');
                });
            });
            
            // Grid size slider
            if (gridSizeSlider) {
                gridSizeSlider.addEventListener('input', (e) => {
                    currentGridSize = parseInt(e.target.value);
                    gridSizeValue.textContent = currentGridSize;
                    playSound('passive');
                });
            }
            
            // Grid spacing slider
            if (gridSpacingSlider) {
                gridSpacingSlider.addEventListener('input', (e) => {
                    currentGridSpacing = parseFloat(e.target.value);
                    gridSpacingValue.textContent = currentGridSpacing;
                    playSound('passive');
                });
            }
            
            // Apply button
            if (applyBtn) {
                applyBtn.addEventListener('click', () => {
                    // Recreate grid panels with new configuration
                    if (window.createMySpaceGrid) {
                        const radius = currentGridSpacing * 10; // Scale spacing to radius
                        window.createMySpaceGrid(currentGridType, currentGridSize, radius);
                        playSound('active');
                    }
                });
            }
        }

        function setupProfile() {
            const profileImageContainer = document.getElementById('profile-image-container');
            const profileImageInput = document.getElementById('profile-image-input');
            const headerUsername = document.getElementById('header-username');
            const headerDescription = document.getElementById('header-description');
            
            // Load saved profile data
            const savedImage = localStorage.getItem('userProfileImage');
            const savedUsername = localStorage.getItem('userProfileUsername');
            const savedDescription = localStorage.getItem('userProfileDescription');
            
            if (savedImage) {
                profileImageContainer.style.backgroundImage = `url(${savedImage})`;
                profileImageContainer.style.backgroundSize = 'cover';
                profileImageContainer.style.backgroundPosition = 'center';
                profileImageContainer.textContent = '';
            }
            
            if (savedUsername) headerUsername.textContent = savedUsername;
            if (savedDescription) headerDescription.textContent = savedDescription;
            
            // Click to upload image
            profileImageContainer.addEventListener('click', () => {
                profileImageInput.click();
            });
            
            profileImageInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        const imageData = event.target.result;
                        profileImageContainer.style.backgroundImage = `url(${imageData})`;
                        profileImageContainer.style.backgroundSize = 'cover';
                        profileImageContainer.style.backgroundPosition = 'center';
                        profileImageContainer.textContent = '';
                        localStorage.setItem('userProfileImage', imageData);
                    };
                    reader.readAsDataURL(file);
                }
            });
            
            // Save username on blur
            headerUsername.addEventListener('blur', () => {
                localStorage.setItem('userProfileUsername', headerUsername.textContent);
            });
            
            // Save description on blur
            headerDescription.addEventListener('blur', () => {
                localStorage.setItem('userProfileDescription', headerDescription.textContent);
            });
            
            // Styling on focus
            headerUsername.addEventListener('focus', function() {
                this.style.borderColor = 'rgba(128, 128, 128, 0.5)';
            });
            
            headerUsername.addEventListener('blur', function() {
                this.style.borderColor = 'transparent';
            });
            
            headerDescription.addEventListener('focus', function() {
                this.style.borderColor = 'rgba(128, 128, 128, 0.5)';
            });
            
            headerDescription.addEventListener('blur', function() {
                this.style.borderColor = 'transparent';
            });
        }


        function initPocket() {
            renderPocketPage();
            setupPocketPagination();
        }

        function renderPocketPage() {
            const pocketGrid = document.getElementById('pocket-grid');
            pocketGrid.innerHTML = ''; // Clear existing slots
            
            const startSlot = (currentPocketPage - 1) * slotsPerPage;
            const endSlot = startSlot + slotsPerPage;
            
            // Create 20 pocket slots for current page
            for (let i = startSlot; i < endSlot; i++) {
                const slot = document.createElement('div');
                slot.className = 'pocket-slot empty';
                slot.setAttribute('data-slot', i);
                
                // Slot number
                const slotNumber = document.createElement('div');
                slotNumber.className = 'pocket-slot-number';
                slotNumber.textContent = i + 1;
                slot.appendChild(slotNumber);
                
                // Slot content (icon + text)
                const slotContent = document.createElement('div');
                slotContent.className = 'pocket-slot-content';
                
                const slotIcon = document.createElement('div');
                slotIcon.className = 'pocket-slot-icon';
                slotIcon.textContent = '';
                slotContent.appendChild(slotIcon);
                
                const slotText = document.createElement('div');
                slotText.textContent = 'Empty';
                slotContent.appendChild(slotText);
                
                slot.appendChild(slotContent);
                
                // Click handler
                slot.addEventListener('click', () => {
                    handlePocketSlotClick(i);
                });
                
                pocketGrid.appendChild(slot);
                
                // Update visual state based on existing data
                updatePocketSlot(i);
            }
            
            // Update page info
            document.getElementById('pocket-page-info').textContent = `Page ${currentPocketPage} / ${totalPages}`;
        }

        function setupPocketPagination() {
            const prevBtn = document.getElementById('pocket-prev-page');
            const nextBtn = document.getElementById('pocket-next-page');
            
            prevBtn.addEventListener('click', () => {
                if (currentPocketPage > 1) {
                    currentPocketPage--;
                    renderPocketPage();
                    playSound('passive');
                }
            });
            
            nextBtn.addEventListener('click', () => {
                if (currentPocketPage < totalPages) {
                    currentPocketPage++;
                    renderPocketPage();
                    playSound('passive');
                }
            });
        }

        function handlePocketSlotClick(slotIndex) {
            const slot = pocketItems[slotIndex];
            
            console.log(`Pocket slot ${slotIndex} clicked`);
            playSound('active');
            
            if (!slot.occupied) {
                // Empty slot - could add item here
                console.log('Empty slot - ready to add item');
            } else if (slot.deployed) {
                // Item is deployed in scene - recall it
                console.log('Recalling item from scene');
                slot.deployed = false;
                updatePocketSlot(slotIndex);
            } else {
                // Item is in pocket - deploy it
                console.log('Deploying item to scene');
                slot.deployed = true;
                updatePocketSlot(slotIndex);
            }
        }

        function updatePocketSlot(slotIndex) {
            const slot = pocketItems[slotIndex];
            const slotElement = document.querySelector(`[data-slot="${slotIndex}"]`);
            
            if (!slotElement) return;
            
            // Update visual state
            slotElement.classList.remove('empty', 'in-scene');
            
            if (!slot.occupied) {
                slotElement.classList.add('empty');
            } else if (slot.deployed) {
                slotElement.classList.add('in-scene');
            }
            
            // Update transparency based on state
            if (slot.deployed) {
                slotElement.style.opacity = '0.2'; // Item out in scene (20%)
            } else {
                slotElement.style.opacity = '0.35'; // Item in pocket (35%)
            }
        }

        // Mobile controls
        let joystickActive = false;
        let joystickStartPos = { x: 0, y: 0 };
        let currentTransformMode = null; // 'position', 'rotation', 'scale'

        // Panel drag functionality
        let isDragging = false;
        let dragStartX = 0;
        let dragStartY = 0;
        let panelStartX = 20;
        let panelStartY = 20;

        // Sound effects
        function playSound(type) {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            if (type === 'hover') {
                oscillator.frequency.value = 600;
                gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.1);
            } else if (type === 'active') {
                oscillator.frequency.value = 800;
                gainNode.gain.setValueAtTime(0.15, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.2);
            } else if (type === 'passive') {
                oscillator.frequency.value = 400;
                gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.15);
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.15);
            }
        }

        // Initialize scene
        // Entrance sequence variables
        let entranceTunnel = null;
        let entranceWireframe = null;
        let entranceRings = [];
        let descentCylinder = null; // Bright cylinder that descends 1.5x faster
        let isEntranceActive = false;
        let entranceProgress = 0;
        let landingCylinder = null;

        function init() {
            // Scene
            scene = new THREE.Scene();

            // Camera
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 0, 15);
            scene.add(camera); // Add camera to scene so children render

            // Renderer
            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.domElement.style.opacity = '0'; // Hide initially until entrance starts
            document.getElementById('canvas-container').appendChild(renderer.domElement);

            // Outer sphere with gradient - Part of MySpace
            const sphereGeometry = new THREE.SphereGeometry(30, 64, 64);
            const sphereMaterial = new THREE.ShaderMaterial({
                side: THREE.BackSide,
                uniforms: {
                    color1: { value: new THREE.Color(0x333333) },
                    color2: { value: new THREE.Color(0xffffff) }
                },
                vertexShader: `
                    varying vec3 vPosition;
                    void main() {
                        vPosition = position;
                        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
                    }
                `,
                fragmentShader: `
                    uniform vec3 color1;
                    uniform vec3 color2;
                    varying vec3 vPosition;
                    void main() {
                        float mixValue = (vPosition.y + 30.0) / 60.0;
                        gl_FragColor = vec4(mix(color1, color2, mixValue), 1.0);
                    }
                `
            });
            const sphere = new THREE.Mesh(sphereGeometry, sphereMaterial);
            sphere.userData.type = 'myspace-sphere'; // Tag for identification
            window.mySpaceSphere = sphere; // Store global reference
            scene.add(sphere); // Add to scene for now, will add to group later

            // User Energy State - Particle System
            const particleGeometry = new THREE.BufferGeometry();
            const particlePositions = new Float32Array(particleCount * 3);
            particleVelocities = new Float32Array(particleCount * 3);
            
            // Create particles in sphere shape - smaller radius for better centering
            for (let i = 0; i < particleCount; i++) {
                const i3 = i * 3;
                
                // Random spherical coordinates
                const theta = Math.random() * Math.PI * 2;
                const phi = Math.acos(2 * Math.random() - 1);
                const radius = 8 + Math.random() * 4; // 8-12 range (closer to user)
                
                // Convert to Cartesian
                particlePositions[i3] = radius * Math.sin(phi) * Math.cos(theta);
                particlePositions[i3 + 1] = radius * Math.sin(phi) * Math.sin(theta);
                particlePositions[i3 + 2] = radius * Math.cos(phi);
                
                // Gentle random velocities for calm animation
                particleVelocities[i3] = (Math.random() - 0.5) * 0.02;
                particleVelocities[i3 + 1] = (Math.random() - 0.5) * 0.02;
                particleVelocities[i3 + 2] = (Math.random() - 0.5) * 0.02;
            }
            
            particleGeometry.setAttribute('position', new THREE.BufferAttribute(particlePositions, 3));
            
            // Create circular texture for round particles
            const canvas = document.createElement('canvas');
            canvas.width = 32;
            canvas.height = 32;
            const ctx = canvas.getContext('2d');
            const gradient = ctx.createRadialGradient(16, 16, 0, 16, 16, 16);
            gradient.addColorStop(0, 'rgba(255, 255, 255, 1)');
            gradient.addColorStop(0.5, 'rgba(255, 255, 255, 0.5)');
            gradient.addColorStop(1, 'rgba(255, 255, 255, 0)');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, 32, 32);
            const particleTexture = new THREE.CanvasTexture(canvas);
            
            const particleMaterial = new THREE.PointsMaterial({
                color: 0xffffff,
                size: 0.05,
                transparent: true,
                opacity: 0.6,
                blending: THREE.AdditiveBlending,
                sizeAttenuation: true,
                map: particleTexture
            });
            
            particleSystem = new THREE.Points(particleGeometry, particleMaterial);
            // Attach particle system to camera so it follows both position and rotation
            camera.add(particleSystem);
            // Reset to origin - no offset
            particleSystem.position.set(0, 0, 0);
            // Rotate to (0, 0, 71 degrees) for optimal forward flow
            particleSystem.rotation.set(0, 0, 71 * Math.PI / 180);

            // Grid plane at 0, -5, 0
            const gridSize = 50;
            const gridDivisions = 50;
            const gridHelper = new THREE.GridHelper(gridSize, gridDivisions, 0xffffff, 0xffffff);
            gridHelper.position.set(0, -5, 0);
            gridHelper.material.opacity = 0.3;
            gridHelper.material.transparent = true;
            scene.add(gridHelper);

            // Initialize MySpace grid with default spherical configuration
            window.gridPanelObjects = [];
            createMySpaceGrid('spherical', 8, 25);
            
            function createMySpaceGrid(gridType, segments, radius) {
                // Initialize mySpaceGroup if it doesn't exist
                if (!mySpaceGroup) {
                    mySpaceGroup = new THREE.Group();
                    scene.add(mySpaceGroup);
                    
                    // Add the gradient sphere to MySpace group if it exists
                    if (window.mySpaceSphere && window.mySpaceSphere.parent === scene) {
                        scene.remove(window.mySpaceSphere);
                        mySpaceGroup.add(window.mySpaceSphere);
                    }
                }
                
                // Clear existing grid panels
                if (window.gridPanelObjects && window.gridPanelObjects.length > 0) {
                    window.gridPanelObjects.forEach(panel => {
                        mySpaceGroup.remove(panel);
                        if (panel.geometry) panel.geometry.dispose();
                        if (panel.material) panel.material.dispose();
                        const index = gridObjects.indexOf(panel);
                        if (index > -1) gridObjects.splice(index, 1);
                        const interactiveIndex = interactiveObjects.indexOf(panel);
                        if (interactiveIndex > -1) interactiveObjects.splice(interactiveIndex, 1);
                    });
                    window.gridPanelObjects = [];
                }
                
                const gridGeometry = new THREE.PlaneGeometry(3, 3);
                const totalPanels = segments * segments * 2; // Approximate total
                
                if (gridType === 'spherical') {
                    // Original spherical grid
                    for (let lat = 0; lat < segments; lat++) {
                        for (let lon = 0; lon < segments * 2; lon++) {
                            const phi = (lat / segments) * Math.PI;
                            const theta = (lon / (segments * 2)) * Math.PI * 2;
                            
                            const x = radius * Math.sin(phi) * Math.cos(theta);
                            const y = radius * Math.cos(phi);
                            const z = radius * Math.sin(phi) * Math.sin(theta);
                            
                            createGridPanel(gridGeometry, x, y, z, lat, lon);
                        }
                    }
                } else if (gridType === 'planar') {
                    // Planar walls - 5x5 grid, multiple layers
                    const spacing = radius / 8;
                    for (let layer = 0; layer < 5; layer++) {
                        const zPos = layer * spacing * 2 - spacing * 4;
                        for (let x = 0; x < 5; x++) {
                            for (let y = 0; y < 5; y++) {
                                const xPos = (x - 2) * spacing;
                                const yPos = (y - 2) * spacing;
                                createGridPanel(gridGeometry, xPos, yPos, zPos, x, y + (layer * 5));
                            }
                        }
                    }
                } else if (gridType === 'helix') {
                    // Helix/spiral arrangement
                    const height = radius * 2;
                    const helixRadius = radius * 0.6;
                    const turns = 5;
                    const panelsPerTurn = Math.floor(segments / 2);
                    
                    for (let i = 0; i < turns * panelsPerTurn; i++) {
                        const t = i / panelsPerTurn;
                        const angle = t * Math.PI * 2;
                        const y = (t / turns) * height - height / 2;
                        const x = helixRadius * Math.cos(angle);
                        const z = helixRadius * Math.sin(angle);
                        createGridPanel(gridGeometry, x, y, z, i, 0);
                    }
                } else if (gridType === 'cube') {
                    // Cubic grid arrangement
                    const divisions = Math.floor(segments / 2);
                    const spacing = radius / divisions;
                    const halfSize = radius / 2;
                    
                    // Create panels on all 6 faces of the cube
                    for (let face = 0; face < 6; face++) {
                        for (let i = 0; i < divisions; i++) {
                            for (let j = 0; j < divisions; j++) {
                                const u = (i / divisions) * radius - halfSize;
                                const v = (j / divisions) * radius - halfSize;
                                
                                let x, y, z;
                                if (face === 0) { x = u; y = v; z = halfSize; }  // Front
                                else if (face === 1) { x = u; y = v; z = -halfSize; }  // Back
                                else if (face === 2) { x = halfSize; y = v; z = u; }  // Right
                                else if (face === 3) { x = -halfSize; y = v; z = u; }  // Left
                                else if (face === 4) { x = u; y = halfSize; z = v; }  // Top
                                else if (face === 5) { x = u; y = -halfSize; z = v; }  // Bottom
                                
                                createGridPanel(gridGeometry, x, y, z, i, j + (face * divisions));
                            }
                        }
                    }
                }
                
                function createGridPanel(geometry, x, y, z, lat, lon) {
                    const gridMaterial = new THREE.MeshBasicMaterial({
                        color: 0xeeeeee,
                        transparent: true,
                        opacity: 0.2,
                        side: THREE.DoubleSide
                    });
                    
                    const gridPanel = new THREE.Mesh(geometry, gridMaterial);
                    gridPanel.position.set(x, y, z);
                    gridPanel.lookAt(0, 0, 0);
                    gridPanel.userData = { 
                        type: 'grid',
                        label: `Grid ${lat}-${lon}`,
                        originalColor: 0xeeeeee,
                        originalPosition: { x, y, z }
                    };
                    
                    mySpaceGroup.add(gridPanel);  // Add to group instead of scene
                    gridObjects.push(gridPanel);
                    interactiveObjects.push(gridPanel);
                    window.gridPanelObjects.push(gridPanel);
                    
                    // Add grid lines
                    const edgesGeometry = new THREE.EdgesGeometry(geometry);
                    const edgesMaterial = new THREE.LineBasicMaterial({ 
                        color: 0xeeeeee, 
                        opacity: 0.3, 
                        transparent: true 
                    });
                    const edges = new THREE.LineSegments(edgesGeometry, edgesMaterial);
                    gridPanel.add(edges);
                }
            }
            
            // Make function globally accessible
            window.createMySpaceGrid = createMySpaceGrid;

            // Grid radius for positioning journal pages
            const gridRadius = 25;

            // Journal pages - now square and positioned on grid
            const pageData = [
                { title: 'Morning\nRoutine', color: 0x808080, lat: 2, lon: 0 },
                { title: 'Job\nRoutine', color: 0xF5A623, lat: 4, lon: 4 },
                { title: 'Before Bed\nRoutine', color: 0x9013FE, lat: 6, lon: 8 }
            ];

            pageData.forEach((data, index) => {
                // Calculate position on grid sphere
                const phi = (data.lat / 8) * Math.PI;
                const theta = (data.lon / 16) * 2 * Math.PI;
                
                const x = gridRadius * Math.sin(phi) * Math.cos(theta);
                const y = gridRadius * Math.cos(phi);
                const z = gridRadius * Math.sin(phi) * Math.sin(theta);
                
                // Square geometry (2.5 x 2.5)
                const pageGeometry = new THREE.BoxGeometry(2.5, 2.5, 0.1);
                const pageMaterial = new THREE.MeshPhongMaterial({
                    color: data.color,
                    transparent: true,
                    opacity: 0.8,
                    shininess: 100
                });
                
                const page = new THREE.Mesh(pageGeometry, pageMaterial);
                page.position.set(x, y, z);
                page.lookAt(0, 0, 0); // Face center
                page.userData = {
                    type: 'page',
                    title: data.title.replace('\n', ' '),
                    index: index,
                    originalColor: data.color,
                    originalPosition: { x, y, z }
                };
                
                scene.add(page);
                journalPages.push(page);
                interactiveObjects.push(page);

                // Add text using canvas
                const canvas = document.createElement('canvas');
                canvas.width = 512;
                canvas.height = 512;
                const ctx = canvas.getContext('2d');
                ctx.fillStyle = '#ffffff';
                ctx.font = 'bold 40px Orbitron, sans-serif';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                
                const lines = data.title.split('\n');
                lines.forEach((line, i) => {
                    ctx.fillText(line, 256, 256 + (i - 0.5) * 50);
                });
                
                const texture = new THREE.CanvasTexture(canvas);
                const textMaterial = new THREE.MeshBasicMaterial({ 
                    map: texture, 
                    transparent: true,
                    side: THREE.DoubleSide
                });
                const textPlane = new THREE.PlaneGeometry(2.3, 2.3);
                const textMesh = new THREE.Mesh(textPlane, textMaterial);
                textMesh.position.z = 0.06;
                page.add(textMesh);
            });

            // Lighting
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);

            const pointLight1 = new THREE.PointLight(0x808080, 1, 100);
            pointLight1.position.set(10, 10, 10);
            scene.add(pointLight1);

            const pointLight2 = new THREE.PointLight(0xF5A623, 1, 100);
            pointLight2.position.set(-10, -10, 10);
            scene.add(pointLight2);

            // Event listeners
            renderer.domElement.addEventListener('mousemove', onMouseMove);
            renderer.domElement.addEventListener('mousedown', onMouseDown);
            renderer.domElement.addEventListener('mouseup', onMouseUp);
            
            // Mouse wheel zoom for 3D panel viewing
            renderer.domElement.addEventListener('wheel', (e) => {
                if (scene3DDataPanel) {
                    e.preventDefault();
                    const zoomSpeed = 0.5;
                    const minZ = 8;  // Closest zoom
                    const maxZ = 30; // Farthest zoom
                    
                    if (e.deltaY < 0) {
                        // Zoom in
                        camera.position.z = Math.max(minZ, camera.position.z - zoomSpeed);
                    } else {
                        // Zoom out
                        camera.position.z = Math.min(maxZ, camera.position.z + zoomSpeed);
                    }
                }
            }, { passive: false });
            window.addEventListener('resize', onResize);

            // Panel controls
            setupPanelControls();
            setupInspectorDataSave();
            setupJSONViewer();

            // Keyboard controls
            window.addEventListener('keydown', (e) => {
                // Disable keyboard controls when typing in text fields
                const activeElement = document.activeElement;
                const isTextField = activeElement.tagName === 'INPUT' || 
                                   activeElement.tagName === 'TEXTAREA' || 
                                   activeElement.isContentEditable;
                
                if (isTextField) {
                    return; // Don't process keyboard shortcuts
                }
                
                const key = e.key.toLowerCase();
                if (key in keys) {
                    keys[key] = true;
                    // Add visual feedback for C key (FPS mode)
                    if (key === 'c') {
                        document.body.classList.add('fps-mode');
                    }
                }
                // FAQ panel toggle
                if (key === 'q') {
                    const faqPanel = document.getElementById('faq-panel');
                    faqPanel.classList.toggle('visible');
                    playSound('passive');
                }
                // Inspector panel toggle
                if (key === 'x') {
                    const inspectorPanel = document.getElementById('inspector-panel');
                    inspectorPanel.classList.toggle('visible');
                    playSound('passive');
                }
                // Docks toggle
                if (key === 'z') {
                    docksVisible = !docksVisible;
                    const docks = document.querySelectorAll('.dock');
                    docks.forEach(dock => {
                        if (docksVisible) {
                            dock.classList.remove('hidden');
                        } else {
                            dock.classList.add('hidden');
                        }
                    });
                    playSound('passive');
                }
                // Reset camera position
                if (key === 'o') {
                    gsap.to(camera.position, {
                        duration: 1.5,
                        x: 0,
                        y: 0,
                        z: 10,
                        ease: 'power2.inOut'
                    });
                    camera.quaternion.set(0, 0, 0, 1); // Reset rotation
                    playSound('active');
                }
                // Left Hand toggle (Left Shift)
                if (e.key === 'Shift' && e.location === 1) { // Left Shift
                    e.preventDefault();
                    toggleLeftHand();
                }
                // Right Hand toggle (Right Shift)
                if (e.key === 'Shift' && e.location === 2) { // Right Shift
                    e.preventDefault();
                    toggleRightHand();
                }
                // Conscious Hand toggle (Enter)
                if (e.key === 'Enter') {
                    e.preventDefault();
                    toggleConsciousHand();
                }
                // MySpace toggle (0 key)
                if (e.key === '0') {
                    e.preventDefault();
                    toggleMySpace();
                }
                // Pocket toggle (9 key)
                if (e.key === '9') {
                    e.preventDefault();
                    togglePocket();
                }
                // Side Tray toggle (T key)
                if (e.key === 't' || e.key === 'T') {
                    e.preventDefault();
                    const sideTray = document.getElementById('side-tray');
                    const topTray = document.getElementById('top-tray');
                    
                    const isHidden = sideTray.style.display === 'none';
                    
                    if (sideTray) {
                        sideTray.style.display = isHidden ? 'block' : 'none';
                    }
                    if (topTray) {
                        topTray.style.display = isHidden ? 'flex' : 'none';
                    }
                    
                    playSound('passive');
                }
            });

            window.addEventListener('keyup', (e) => {
                // Disable keyboard controls when typing in text fields
                const activeElement = document.activeElement;
                const isTextField = activeElement.tagName === 'INPUT' || 
                                   activeElement.tagName === 'TEXTAREA' || 
                                   activeElement.isContentEditable;
                
                if (isTextField) {
                    return; // Don't process keyboard shortcuts
                }
                
                const key = e.key.toLowerCase();
                if (key in keys) {
                    keys[key] = false;
                    // Remove visual feedback for C key
                    if (key === 'c') {
                        document.body.classList.remove('fps-mode');
                    }
                }
            });

            // Mobile controls
            setupMobileControls();
            setupTransformPanel();
            initializeToolMenu();
            setupActionGrid();
            setupHamburgerMenus();
            setupDockDragDrop();
            setupTimer();
            setupTimezone();
            setupSearchPanel();
            setupHandMenus();
            initPocket();
            initVirtualKeyboard();
            setupUITransparency();
            setupParticleBehavior();
            setupMySpaceGrid();
            setupProfile();

            // Apply default theme
            applyTheme('silver');

            // Start animation
            animate();
            
            // Show welcome screen
            showWelcomeScreen();
            
            // Setup MAX button for fullscreen
            setupMaxButton();
        }
        
        function setupMaxButton() {
            const maxBtn = document.getElementById('btn-13');
            if (maxBtn) {
                maxBtn.addEventListener('click', () => {
                    if (!document.fullscreenElement) {
                        // Enter fullscreen
                        document.documentElement.requestFullscreen().catch(err => {
                            console.log('Fullscreen error:', err);
                        });
                        maxBtn.textContent = 'EXIT';
                        playSound('active');
                    } else {
                        // Exit fullscreen
                        document.exitFullscreen();
                        maxBtn.textContent = 'MAX';
                        playSound('active');
                    }
                });
                
                // Listen for fullscreen changes
                document.addEventListener('fullscreenchange', () => {
                    if (!document.fullscreenElement) {
                        maxBtn.textContent = 'MAX';
                    } else {
                        maxBtn.textContent = 'EXIT';
                    }
                });
            }
        }
        
        function showWelcomeScreen() {
            // Create welcome panel overlay
            const welcomePanel = document.createElement('div');
            welcomePanel.id = 'welcome-panel';
            welcomePanel.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100vw;
                height: 100vh;
                background: linear-gradient(135deg, 
                    rgba(200, 200, 210, 0.95), 
                    rgba(240, 240, 245, 0.95), 
                    rgba(220, 220, 230, 0.95),
                    rgba(250, 250, 255, 0.95));
                background-size: 400% 400%;
                animation: cloudFlow 15s ease infinite;
                z-index: 10000;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                backdrop-filter: blur(20px);
            `;
            
            welcomePanel.innerHTML = `
                <!-- Central  Symbol -->
                <div id="central-symbol" style="
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    font-family: 'Orbitron', sans-serif;
                    font-size: 120px;
                    color: rgba(80, 80, 90, 1);
                    cursor: pointer;
                    text-shadow: 0 0 40px rgba(255, 255, 255, 0.9), 0 0 80px rgba(200, 200, 210, 0.6);
                    transition: all 0.3s;
                    z-index: 100;
                "></div>
                
                <!-- Branches Container - lines stemming from  -->
                <svg id="branches-container" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 90;">
                    <!-- Radiating lines from center -->
                    <line id="branch-1" x1="50%" y1="50%" x2="20%" y2="20%" stroke="rgba(255, 255, 255, 0.6)" stroke-width="2" stroke-dasharray="5,5" style="opacity: 0;"/>
                    <line id="branch-2" x1="50%" y1="50%" x2="80%" y2="20%" stroke="rgba(255, 255, 255, 0.6)" stroke-width="2" stroke-dasharray="5,5" style="opacity: 0;"/>
                    <line id="branch-3" x1="50%" y1="50%" x2="80%" y2="80%" stroke="rgba(255, 255, 255, 0.6)" stroke-width="2" stroke-dasharray="5,5" style="opacity: 0;"/>
                    <line id="branch-4" x1="50%" y1="50%" x2="20%" y2="80%" stroke="rgba(255, 255, 255, 0.6)" stroke-width="2" stroke-dasharray="5,5" style="opacity: 0;"/>
                    <line id="branch-5" x1="50%" y1="50%" x2="10%" y2="50%" stroke="rgba(255, 255, 255, 0.6)" stroke-width="2" stroke-dasharray="5,5" style="opacity: 0;"/>
                    <line id="branch-6" x1="50%" y1="50%" x2="90%" y2="50%" stroke="rgba(255, 255, 255, 0.6)" stroke-width="2" stroke-dasharray="5,5" style="opacity: 0;"/>
                    <line id="branch-7" x1="50%" y1="50%" x2="50%" y2="10%" stroke="rgba(255, 255, 255, 0.6)" stroke-width="2" stroke-dasharray="5,5" style="opacity: 0;"/>
                    <line id="branch-8" x1="50%" y1="50%" x2="50%" y2="90%" stroke="rgba(255, 255, 255, 0.6)" stroke-width="2" stroke-dasharray="5,5" style="opacity: 0;"/>
                </svg>
                
                <!-- Questions Container -->
                <div id="questions-container" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 50;"></div>
                
                <!-- Floating Symbols Container -->
                <div id="symbols-container" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 40;"></div>
                
                <!-- Letter Reveal Container -->
                <div id="letter-reveal" style="
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    font-family: 'Orbitron', sans-serif;
                    font-size: 48px;
                    font-weight: 900;
                    color: rgba(80, 80, 90, 1);
                    text-shadow: 0 0 30px rgba(255, 255, 255, 0.9);
                    display: none;
                    z-index: 150;
                "></div>
                
                <style>
                    @keyframes cloudFlow {
                        0% { background-position: 0% 50%; }
                        25% { background-position: 50% 60%; }
                        50% { background-position: 100% 50%; }
                        75% { background-position: 50% 40%; }
                        100% { background-position: 0% 50%; }
                    }
                    
                    @keyframes fadeToBack {
                        0% { 
                            opacity: 1; 
                            transform: translate(-50%, -50%) scale(1); 
                            filter: blur(0px);
                        }
                        100% { 
                            opacity: 0; 
                            transform: translate(-50%, -50%) scale(1.5); 
                            filter: blur(5px);
                        }
                    }
                    
                    @keyframes floatAway {
                        0% { 
                            opacity: 1; 
                            transform: scale(1); 
                            filter: blur(0px);
                        }
                        100% { 
                            opacity: 0; 
                            transform: scale(2); 
                            filter: blur(3px);
                        }
                    }
                    
                    @keyframes diamondShake {
                        0% { 
                            transform: translate(-50%, -50%) rotate(0deg) scale(1.1);
                        }
                        10% { 
                            transform: translate(calc(-50% + 1px), calc(-50% + 0.5px)) rotate(0.5deg) scale(1.1);
                        }
                        20% { 
                            transform: translate(calc(-50% - 1px), calc(-50% + 1px)) rotate(-0.5deg) scale(1.1);
                        }
                        30% { 
                            transform: translate(calc(-50% + 1.5px), calc(-50% - 0.5px)) rotate(0.8deg) scale(1.1);
                        }
                        40% { 
                            transform: translate(calc(-50% - 1.5px), calc(-50% + 1.5px)) rotate(-0.8deg) scale(1.1);
                        }
                        50% { 
                            transform: translate(calc(-50% + 2px), calc(-50% - 1px)) rotate(1deg) scale(1.1);
                        }
                        60% { 
                            transform: translate(calc(-50% - 1.5px), calc(-50% + 0.5px)) rotate(-0.8deg) scale(1.1);
                        }
                        70% { 
                            transform: translate(calc(-50% + 1px), calc(-50% - 1.5px)) rotate(0.5deg) scale(1.1);
                        }
                        80% { 
                            transform: translate(calc(-50% - 0.5px), calc(-50% + 1px)) rotate(-0.3deg) scale(1.1);
                        }
                        90% { 
                            transform: translate(calc(-50% + 0.5px), calc(-50% - 0.5px)) rotate(0.2deg) scale(1.1);
                        }
                        100% { 
                            transform: translate(-50%, -50%) rotate(0deg) scale(1.1);
                        }
                    }
                    
                    #central-symbol:hover {
                        transform: translate(-50%, -50%) scale(1.1);
                        text-shadow: 0 0 60px rgba(255, 255, 255, 1), 0 0 100px rgba(200, 200, 210, 0.8);
                    }
                </style>
            `;
            
            document.body.appendChild(welcomePanel);
            
            // Get branch references for hover animation
            const branches = [];
            for (let i = 1; i <= 8; i++) {
                branches.push(document.getElementById(`branch-${i}`));
            }
            
            const centralSymbol = document.getElementById('central-symbol');
            const questionsContainer = document.getElementById('questions-container');
            const symbolsContainer = document.getElementById('symbols-container');
            const letterReveal = document.getElementById('letter-reveal');
            
            const questions = [
                "What is this?",
                "What is this for?",
                "Is this safe?",
                "Why a diamond?",
                "Does this go anywhere?",
                "Why does this exist?",
                "Why am I questioning this?"
            ];
            
            let hovering = false;
            let questionInterval;
            let symbolInterval;
            
            // Hover to spawn questions and symbols
            centralSymbol.addEventListener('mouseenter', () => {
                hovering = true;
                
                // Animate branches on hover with staggered timing
                branches.forEach((branch, index) => {
                    if (branch) {
                        setTimeout(() => {
                            branch.style.transition = 'opacity 0.8s ease-in-out';
                            branch.style.opacity = '1';
                            
                            // Pulse animation
                            const pulseInterval = setInterval(() => {
                                if (!hovering) {
                                    clearInterval(pulseInterval);
                                    branch.style.opacity = '0';
                                } else {
                                    branch.style.opacity = Math.random() * 0.5 + 0.5; // Random between 0.5 and 1
                                }
                            }, 2000 + index * 200);
                        }, index * 100);
                    }
                });
                
                // Add shake animation to symbol
                centralSymbol.style.animation = 'diamondShake 2s ease-in-out infinite';
                
                // Spawn questions every 800ms
                questionInterval = setInterval(() => {
                    if (!hovering) return;
                    
                    const question = questions[Math.floor(Math.random() * questions.length)];
                    const questionDiv = document.createElement('div');
                    
                    const angle = Math.random() * Math.PI * 2;
                    const distance = 150 + Math.random() * 200;
                    const x = 50 + Math.cos(angle) * distance / window.innerWidth * 100;
                    const y = 50 + Math.sin(angle) * distance / window.innerHeight * 100;
                    
                    questionDiv.style.cssText = `
                        position: absolute;
                        top: ${y}%;
                        left: ${x}%;
                        transform: translate(-50%, -50%);
                        padding: 12px 20px;
                        background: rgba(255, 255, 255, 0.1);
                        border: 2px solid rgba(255, 255, 255, 0.9);
                        border-radius: 8px;
                        color: rgba(80, 80, 90, 1);
                        font-family: 'Orbitron', sans-serif;
                        font-size: 14px;
                        font-weight: 600;
                        white-space: nowrap;
                        box-shadow: 0 0 30px rgba(255, 255, 255, 0.9), 0 0 50px rgba(255, 255, 255, 0.6);
                        animation: fadeToBack 3s ease-out forwards;
                    `;
                    questionDiv.textContent = question;
                    questionsContainer.appendChild(questionDiv);
                    
                    setTimeout(() => questionDiv.remove(), 3000);
                }, 800);
                
                // Spawn symbols every 600ms
                symbolInterval = setInterval(() => {
                    if (!hovering) return;
                    
                    const symbolDiv = document.createElement('div');
                    
                    const angle = Math.random() * Math.PI * 2;
                    const distance = 100 + Math.random() * 150;
                    const x = 50 + Math.cos(angle) * distance / window.innerWidth * 100;
                    const y = 50 + Math.sin(angle) * distance / window.innerHeight * 100;
                    
                    symbolDiv.style.cssText = `
                        position: absolute;
                        top: ${y}%;
                        left: ${x}%;
                        font-family: 'Orbitron', sans-serif;
                        font-size: 40px;
                        color: rgba(80, 80, 90, 1);
                        border: 2px solid rgba(255, 255, 255, 0.8);
                        border-radius: 50%;
                        padding: 10px;
                        box-shadow: 0 0 25px rgba(255, 255, 255, 0.9), 0 0 40px rgba(255, 255, 255, 0.6);
                        animation: floatAway 2.5s ease-out forwards;
                    `;
                    symbolDiv.textContent = '';
                    symbolsContainer.appendChild(symbolDiv);
                    
                    setTimeout(() => symbolDiv.remove(), 2500);
                }, 600);
            });
            
            centralSymbol.addEventListener('mouseleave', () => {
                hovering = false;
                clearInterval(questionInterval);
                clearInterval(symbolInterval);
                
                // Stop shake animation
                centralSymbol.style.animation = '';
                
                // Fade out branches
                branches.forEach(branch => {
                    if (branch) {
                        branch.style.transition = 'opacity 0.5s ease-out';
                        branch.style.opacity = '0';
                    }
                });
            });
            
            // Click to reveal text letter by letter
            let clicked = false;
            centralSymbol.addEventListener('click', () => {
                if (clicked) return;
                clicked = true;
                
                playSound('active');
                hovering = false;
                clearInterval(questionInterval);
                clearInterval(symbolInterval);
                
                // Hide central symbol
                centralSymbol.style.opacity = '0';
                
                // Hide branches
                branches.forEach(branch => {
                    if (branch) {
                        branch.style.opacity = '0';
                    }
                });
                
                // Show letter reveal
                letterReveal.style.display = 'block';
                
                const fullText = "Welcome to mniExp";
                let currentText = "";
                let index = 0;
                
                const letterInterval = setInterval(() => {
                    if (index < fullText.length) {
                        currentText += fullText[index];
                        letterReveal.textContent = currentText;
                        playSound('passive');
                        index++;
                    } else {
                        clearInterval(letterInterval);
                        
                        // Wait 1 second then start tunnel
                        setTimeout(() => {
                            welcomePanel.style.transition = 'opacity 0.5s';
                            welcomePanel.style.opacity = '0';
                            setTimeout(() => {
                                welcomePanel.remove();
                                startEntranceSequence();
                            }, 500);
                        }, 1000);
                    }
                }, 80);
            });
        }
        
        function startEntranceSequence() {
            isEntranceActive = true;
            entranceProgress = 0;
            
            // Fade in the canvas smoothly
            renderer.domElement.style.transition = 'opacity 0.5s';
            renderer.domElement.style.opacity = '1';
            
            // Move camera way above
            camera.position.set(0, 100000, 0);
            camera.lookAt(0, 0, 0);
            
            // Create primary tunnel cylinder (50% transparent white)
            const tunnelGeometry = new THREE.CylinderGeometry(15, 15, 200000, 32, 1, true);
            const tunnelMaterial = new THREE.MeshBasicMaterial({
                color: 0xffffff,
                transparent: true,
                opacity: 0.5,
                side: THREE.DoubleSide
            });
            entranceTunnel = new THREE.Mesh(tunnelGeometry, tunnelMaterial);
            entranceTunnel.position.y = 50000;
            scene.add(entranceTunnel);
            
            // Create wireframe cylinder inside
            const wireframeGeometry = new THREE.CylinderGeometry(14, 14, 200000, 16, 1, true);
            const wireframeMaterial = new THREE.MeshBasicMaterial({
                color: 0xffffff,
                wireframe: true,
                transparent: true,
                opacity: 0.8
            });
            entranceWireframe = new THREE.Mesh(wireframeGeometry, wireframeMaterial);
            entranceWireframe.position.y = 50000;
            scene.add(entranceWireframe);
            
            // Create ring geometries that come towards user
            for (let i = 0; i < 20; i++) {
                const ringGeometry = new THREE.TorusGeometry(12, 0.5, 16, 32);
                const ringMaterial = new THREE.MeshBasicMaterial({
                    color: 0xffffff,
                    transparent: true,
                    opacity: 0.8
                });
                const ring = new THREE.Mesh(ringGeometry, ringMaterial);
                ring.rotation.x = Math.PI / 2;
                ring.position.y = i * 10000;
                ring.userData.initialY = ring.position.y;
                entranceRings.push(ring);
                scene.add(ring);
            }
            
            // Create bright descent cylinder (1.5x faster than camera)
            const descentGeometry = new THREE.CylinderGeometry(2, 2, 80, 32);
            const descentMaterial = new THREE.MeshBasicMaterial({
                color: 0xffffff,
                transparent: true,
                opacity: 1.0
            });
            descentCylinder = new THREE.Mesh(descentGeometry, descentMaterial);
            descentCylinder.position.set(0, 100000 + 50, -30); // Start ahead of camera
            scene.add(descentCylinder);
            
            // Disable controls during entrance
            controlsEnabled = false;
        }
        
        function updateEntranceSequence(delta) {
            if (!isEntranceActive) return;
            
            // 8 second descent with easing
            entranceProgress += delta / 8;
            
            if (entranceProgress < 1) {
                // Smooth easing function (ease-in-out cubic)
                const easeInOutCubic = (t) => {
                    return t < 0.5
                        ? 4 * t * t * t
                        : 1 - Math.pow(-2 * t + 2, 3) / 2;
                };
                
                const easedProgress = easeInOutCubic(entranceProgress);
                
                // Descend with easing
                const startY = 100000;
                const endY = 15;
                camera.position.y = startY - (startY - endY) * easedProgress;
                
                // Move bright descent cylinder 1.5x faster than camera
                if (descentCylinder) {
                    descentCylinder.position.y = (startY + 50) - (startY - endY) * easedProgress * 1.5;
                    descentCylinder.position.z = camera.position.z - 30; // Stay in front of camera
                }
                
                // Add gentle camera rotation during descent for dynamic feel
                camera.rotation.z = Math.sin(entranceProgress * Math.PI * 2) * 0.05;
                
                // Rotate tunnel - speed varies with progress
                const rotationSpeed = 1 + Math.sin(entranceProgress * Math.PI) * 0.5;
                if (entranceTunnel) entranceTunnel.rotation.y += delta * 2 * rotationSpeed;
                if (entranceWireframe) entranceWireframe.rotation.y -= delta * 3 * rotationSpeed;
                
                // Move rings towards user - speed up near end
                const ringSpeed = 20000 * (1 + easedProgress);
                entranceRings.forEach((ring, i) => {
                    ring.position.y -= delta * ringSpeed;
                    if (ring.position.y < camera.position.y - 1000) {
                        ring.position.y = camera.position.y + 20000;
                    }
                    ring.rotation.z += delta * (2 + easedProgress);
                    
                    // Fade rings in and out
                    const fadeIn = Math.min(1, entranceProgress * 3);
                    const fadeOut = entranceProgress > 0.7 ? (1 - (entranceProgress - 0.7) / 0.3) : 1;
                    ring.material.opacity = 0.3 * fadeIn * fadeOut;
                });
                
                // Pulse the tunnel opacity
                if (entranceTunnel) {
                    entranceTunnel.material.opacity = 0.15 + Math.sin(entranceProgress * Math.PI * 4) * 0.05;
                }
            } else {
                // Landing sequence
                endEntranceSequence();
            }
        }
        
        function endEntranceSequence() {
            isEntranceActive = false;
            
            // Reset camera rotation
            gsap.to(camera.rotation, {
                duration: 0.5,
                z: 0,
                ease: 'power2.out'
            });
            
            // Remove tunnel and rings
            if (entranceTunnel) {
                scene.remove(entranceTunnel);
                entranceTunnel = null;
            }
            if (entranceWireframe) {
                scene.remove(entranceWireframe);
                entranceWireframe = null;
            }
            entranceRings.forEach(ring => scene.remove(ring));
            entranceRings = [];
            
            // Remove the descent cylinder - it will be replaced by landing cylinder
            if (descentCylinder) {
                scene.remove(descentCylinder);
                descentCylinder = null;
            }
            
            // Create landing cylinder effect (Megaman style)
            const landingGeometry = new THREE.CylinderGeometry(6, 6, 40, 32, 1, true);
            const landingMaterial = new THREE.MeshBasicMaterial({
                color: 0xffffff,
                transparent: true,
                opacity: 1.0,
                side: THREE.DoubleSide
            });
            landingCylinder = new THREE.Mesh(landingGeometry, landingMaterial);
            landingCylinder.position.set(camera.position.x, camera.position.y, camera.position.z - 30);
            scene.add(landingCylinder);
            
            // Megaman-style landing animation: shrink then shoot up
            let landingProgress = 0;
            const landingAnimation = setInterval(() => {
                landingProgress += 0.03; // Speed of animation
                
                if (landingProgress < 0.5) {
                    // Phase 1: Cylinder shrinks and gets thinner (0 to 0.5)
                    const shrinkProgress = landingProgress / 0.5;
                    const scale = 1 - shrinkProgress * 0.7; // Shrink to 30% size
                    landingCylinder.scale.set(scale, 1, scale);
                    landingCylinder.material.opacity = 1.0;
                } else if (landingProgress < 1) {
                    // Phase 2: Cylinder shoots straight up rapidly (0.5 to 1)
                    const shootProgress = (landingProgress - 0.5) / 0.5;
                    const shootSpeed = shootProgress * shootProgress * 150; // Accelerating upward
                    landingCylinder.position.y += shootSpeed;
                    landingCylinder.material.opacity = 1 - shootProgress;
                    // Keep it thin
                    landingCylinder.scale.set(0.3, 1, 0.3);
                } else {
                    // Animation complete
                    scene.remove(landingCylinder);
                    landingCylinder = null;
                    clearInterval(landingAnimation);
                    controlsEnabled = true;
                }
            }, 16);
            
            // Smooth camera transition to final position with better easing
            gsap.to(camera.position, {
                duration: 1.5,
                x: 0,
                y: 0,
                z: 15,
                ease: 'power3.out',
                onUpdate: () => {
                    // During transition, gradually face forward
                    camera.lookAt(0, 0, 0);
                },
                onComplete: () => {
                    // Once at final position, face forward towards horizon
                    camera.lookAt(0, 0, -100);
                }
            });
            
            playSound('active');
        }

        function onMouseMove(event) {
            const rect = renderer.domElement.getBoundingClientRect();
            mouse.x = ((event.clientX - rect.left) / rect.width) * 2 - 1;
            mouse.y = -((event.clientY - rect.top) / rect.height) * 2 + 1;

            // Mouse look - only when holding C key (Metroid Prime style)
            if (keys.c && !isRotating) {
                const deltaX = event.clientX - lastMouseX;
                const deltaY = event.clientY - lastMouseY;
                
                lastMouseX = event.clientX;
                lastMouseY = event.clientY;

                // Apply FPS-style rotation
                if (Math.abs(deltaX) > 0.1 || Math.abs(deltaY) > 0.1) {
                    // Horizontal rotation (yaw) - rotate around world Y axis
                    camera.rotateOnWorldAxis(new THREE.Vector3(0, 1, 0), -deltaX * lookSensitivity);
                    
                    // Vertical rotation (pitch) - rotate around camera's local X axis
                    const pitchAxis = new THREE.Vector3(1, 0, 0);
                    const pitchQuaternion = new THREE.Quaternion().setFromAxisAngle(pitchAxis, -deltaY * lookSensitivity);
                    camera.quaternion.multiply(pitchQuaternion);
                    
                    // Clamp pitch to prevent looking too far up or down
                    const forward = new THREE.Vector3(0, 0, -1);
                    forward.applyQuaternion(camera.quaternion);
                    
                    // If looking too far down, clamp it
                    if (forward.y < -0.99) {
                        const correctionAxis = new THREE.Vector3(1, 0, 0);
                        const correctionAngle = -0.01;
                        const correctionQuaternion = new THREE.Quaternion().setFromAxisAngle(correctionAxis, correctionAngle);
                        camera.quaternion.multiply(correctionQuaternion);
                    }
                    // If looking too far up, clamp it
                    else if (forward.y > 0.99) {
                        const correctionAxis = new THREE.Vector3(1, 0, 0);
                        const correctionAngle = 0.01;
                        const correctionQuaternion = new THREE.Quaternion().setFromAxisAngle(correctionAxis, correctionAngle);
                        camera.quaternion.multiply(correctionQuaternion);
                    }
                }
            } else {
                // Update last mouse position even when not looking
                lastMouseX = event.clientX;
                lastMouseY = event.clientY;
            }

            // Orbit rotation (when dragging without C key)
            if (isRotating && !keys.c) {
                const deltaX = event.clientX - previousMousePosition.x;
                const deltaY = event.clientY - previousMousePosition.y;
                
                const rotationSpeed = 0.005;
                const euler = new THREE.Euler(
                    deltaY * rotationSpeed,
                    deltaX * rotationSpeed,
                    0,
                    'XYZ'
                );
                
                const quaternion = new THREE.Quaternion().setFromEuler(euler);
                camera.position.applyQuaternion(quaternion);
                camera.lookAt(cameraTarget);
                
                previousMousePosition = { x: event.clientX, y: event.clientY };
            }

            // Raycasting for hover
            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(interactiveObjects);

            if (intersects.length > 0) {
                const hoveredObj = intersects[0].object;
                if (hoveredObj !== hoveredObject) {
                    if (hoveredObject && hoveredObject !== selectedObject) {
                        hoveredObject.material.color.setHex(hoveredObject.userData.originalColor);
                        hoveredObject.material.opacity = hoveredObject.userData.type === 'grid' ? 0.2 : 0.8;
                    }
                    hoveredObject = hoveredObj;
                    if (hoveredObj !== selectedObject) {
                        hoveredObj.material.color.setHex(0x888888);
                        hoveredObj.material.opacity = 0.6;
                    }
                    playSound('hover');
                }
            } else {
                if (hoveredObject && hoveredObject !== selectedObject) {
                    hoveredObject.material.color.setHex(hoveredObject.userData.originalColor);
                    hoveredObject.material.opacity = hoveredObject.userData.type === 'grid' ? 0.2 : 0.8;
                }
                hoveredObject = null;
            }
        }

        function onMouseDown(event) {
            if (event.button === 0) {
                const rect = renderer.domElement.getBoundingClientRect();
                const x = ((event.clientX - rect.left) / rect.width) * 2 - 1;
                const y = -((event.clientY - rect.top) / rect.height) * 2 + 1;
                
                raycaster.setFromCamera({ x, y }, camera);
                const intersects = raycaster.intersectObjects(interactiveObjects);

                if (intersects.length > 0) {
                    const clickedObj = intersects[0].object;
                    
                    // Check if clicked on scroll icon
                    if (clickedObj.userData.isScrollIcon) {
                        const parentObj = clickedObj.userData.parentObject;
                        if (parentObj) {
                            // Load JSON data and show viewer
                            const objectId = parentObj.uuid;
                            const savedData = localStorage.getItem(`object_data_${objectId}`);
                            if (savedData) {
                                const data = JSON.parse(savedData);
                                if (data.isJSON) {
                                    showJSONViewer(data.body);
                                    
                                    // Move camera to center for viewing
                                    gsap.to(camera.position, {
                                        duration: 1.5,
                                        x: 0,
                                        y: 0,
                                        z: 15,
                                        ease: 'power2.inOut'
                                    });
                                    gsap.to(cameraTarget, {
                                        duration: 1.5,
                                        x: 0,
                                        y: 0,
                                        z: 0,
                                        ease: 'power2.inOut'
                                    });
                                }
                            }
                        }
                        playSound('active');
                        return; // Don't continue with normal selection
                    }
                    
                    // Reset previous selection
                    if (selectedObject) {
                        selectedObject.material.color.setHex(selectedObject.userData.originalColor);
                        selectedObject.material.opacity = selectedObject.userData.type === 'grid' ? 0.2 : 0.8;
                        // Only set emissive if material supports it
                        if (selectedObject.material.emissive) {
                            selectedObject.material.emissive.setHex(0x000000);
                            selectedObject.material.emissiveIntensity = 0;
                        }
                    }
                    
                    selectedObject = clickedObj;
                    clickedObj.material.color.setHex(0xffffff);
                    clickedObj.material.opacity = 1.0;
                    // Only set emissive if material supports it
                    if (clickedObj.material.emissive !== undefined) {
                        clickedObj.material.emissive.setHex(0xffffff);
                        clickedObj.material.emissiveIntensity = 0.5;
                    }
                    playSound('active');
                    
                    // Update UI
                    updateInspectorPanel();
                    
                    // Animate camera
                    gsap.to(camera.position, {
                        duration: 1.5,
                        x: clickedObj.position.x * 1.5,
                        y: clickedObj.position.y * 1.5,
                        z: clickedObj.position.z + 10,
                        ease: 'power2.inOut',
                        onUpdate: () => {
                            camera.lookAt(clickedObj.position);
                        }
                    });
                    
                    gsap.to(cameraTarget, {
                        duration: 1.5,
                        x: clickedObj.position.x,
                        y: clickedObj.position.y,
                        z: clickedObj.position.z,
                        ease: 'power2.inOut'
                    });
                } else {
                    isRotating = true;
                    previousMousePosition = { x: event.clientX, y: event.clientY };
                }
            }
        }

        function onMouseUp() {
            isRotating = false;
        }

        function onResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function updateInspectorPanel() {
            if (selectedObject) {
                const objName = selectedObject.userData.title || selectedObject.userData.label || 'Unknown';
                document.getElementById('selected-name').textContent = objName;
                
                // Update position
                document.getElementById('object-position').textContent = 
                    `X: ${selectedObject.position.x.toFixed(2)} | Y: ${selectedObject.position.y.toFixed(2)} | Z: ${selectedObject.position.z.toFixed(2)}`;
                
                // Update rotation (convert from radians to degrees)
                document.getElementById('object-rotation').textContent = 
                    `X: ${(selectedObject.rotation.x * 180 / Math.PI).toFixed(2)} | Y: ${(selectedObject.rotation.y * 180 / Math.PI).toFixed(2)} | Z: ${(selectedObject.rotation.z * 180 / Math.PI).toFixed(2)}`;
                
                // Update scale
                document.getElementById('object-scale').textContent = 
                    `X: ${selectedObject.scale.x.toFixed(2)} | Y: ${selectedObject.scale.y.toFixed(2)} | Z: ${selectedObject.scale.z.toFixed(2)}`;
                
                // Load saved object data from localStorage
                const objectId = selectedObject.uuid; // Use THREE.js UUID
                const savedData = localStorage.getItem(`object_data_${objectId}`);
                
                if (savedData) {
                    const data = JSON.parse(savedData);
                    document.getElementById('object-data-header').value = data.header || '';
                    document.getElementById('object-data-body').value = data.body || '';
                    document.getElementById('object-data-footer').value = data.footer || '';
                    
                    // Update labels with header, footer, and icon
                    updateObjectLabel(selectedObject, data.header, data.footer, data.icon);
                    
                    // Add scroll icon if JSON detected
                    if (data.isJSON) {
                        addScrollIconToObject(selectedObject);
                    }
                    
                    // Show selected icon in UI
                    if (data.icon) {
                        if (data.icon.type === 'image' && data.icon.imageData) {
                            document.getElementById('selected-icon-text').textContent = `Image selected`;
                        } else if (data.icon.value) {
                            document.getElementById('selected-icon-text').textContent = `Selected: ${data.icon.value}`;
                        }
                    }
                } else {
                    // Clear fields if no saved data
                    document.getElementById('object-data-header').value = '';
                    document.getElementById('object-data-body').value = '';
                    document.getElementById('object-data-footer').value = '';
                    document.getElementById('selected-icon-text').textContent = 'No icon selected';
                }
                
                document.getElementById('object-details').style.display = 'block';
            } else {
                document.getElementById('selected-name').textContent = 'None';
                document.getElementById('object-details').style.display = 'none';
            }
        }
        
        function setupInspectorDataSave() {
            const submitBtn = document.getElementById('object-data-submit');
            
            // Icon selector state
            let selectedIconType = 'emoji';
            let selectedIconValue = null;
            let selectedImageData = null;
            
            if (!submitBtn) {
                console.warn('Inspector submit button not found');
                return;
            }
            
            // Icon type button handlers
            document.querySelectorAll('.icon-type-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    // Remove active from all
                    document.querySelectorAll('.icon-type-btn').forEach(b => {
                        b.classList.remove('active');
                        b.style.background = 'rgba(128, 128, 128, 0.3)';
                    });
                    
                    // Add active to clicked
                    btn.classList.add('active');
                    btn.style.background = 'rgba(128, 128, 128, 0.5)';
                    
                    selectedIconType = btn.getAttribute('data-type');
                    
                    // Show appropriate picker
                    document.getElementById('emoji-picker').style.display = selectedIconType === 'emoji' ? 'grid' : 'none';
                    document.getElementById('image-picker').style.display = selectedIconType === 'image' ? 'block' : 'none';
                    document.getElementById('fontawesome-picker').style.display = selectedIconType === 'fontawesome' ? 'grid' : 'none';
                    
                    playSound('passive');
                });
            });
            
            // Emoji selection
            document.querySelectorAll('.emoji-option').forEach(btn => {
                btn.addEventListener('click', () => {
                    selectedIconValue = btn.getAttribute('data-emoji');
                    document.getElementById('selected-icon-text').textContent = `Selected: ${selectedIconValue}`;
                    playSound('passive');
                });
            });
            
            // FontAwesome selection
            document.querySelectorAll('.fa-option').forEach(btn => {
                btn.addEventListener('click', () => {
                    selectedIconValue = btn.textContent; // Using emoji representation
                    document.getElementById('selected-icon-text').textContent = `Selected: ${selectedIconValue}`;
                    playSound('passive');
                });
            });
            
            // Image upload
            const imageUpload = document.getElementById('icon-image-upload');
            if (imageUpload) {
                imageUpload.addEventListener('change', (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = (event) => {
                            selectedImageData = event.target.result;
                            const preview = document.getElementById('image-preview');
                            preview.innerHTML = `<img src="${selectedImageData}" style="max-width: 100%; max-height: 100%; object-fit: contain;">`;
                            document.getElementById('selected-icon-text').textContent = `Image: ${file.name}`;
                            playSound('passive');
                        };
                        reader.readAsDataURL(file);
                    }
                });
            }
            
            // Save button handler
            submitBtn.addEventListener('click', () => {
                if (selectedObject) {
                    const objectId = selectedObject.uuid;
                    const header = document.getElementById('object-data-header').value;
                    const body = document.getElementById('object-data-body').value;
                    const footer = document.getElementById('object-data-footer').value;
                    
                    // Prepare icon data
                    let iconData = null;
                    if (selectedIconValue || selectedImageData) {
                        iconData = {
                            type: selectedIconType,
                            value: selectedIconValue,
                            imageData: selectedImageData
                        };
                    }
                    
                    // Check if body contains JSON
                    let isJSON = false;
                    try {
                        if (body && body.trim().startsWith('{') || body.trim().startsWith('[')) {
                            JSON.parse(body);
                            isJSON = true;
                        }
                    } catch (e) {
                        isJSON = false;
                    }
                    
                    const data = {
                        header: header,
                        body: body,
                        footer: footer,
                        icon: iconData,
                        isJSON: isJSON,
                        savedAt: new Date().toISOString()
                    };
                    
                    localStorage.setItem(`object_data_${objectId}`, JSON.stringify(data));
                    
                    // Update labels and icons
                    updateObjectLabel(selectedObject, header, footer, iconData);
                    
                    // Add scroll icon if JSON detected
                    if (isJSON) {
                        addScrollIconToObject(selectedObject);
                    } else if (selectedObject.userData.scrollIcon) {
                        // Remove scroll icon if body is no longer JSON
                        selectedObject.remove(selectedObject.userData.scrollIcon);
                        selectedObject.userData.scrollIcon = null;
                    }
                    
                    // Visual feedback
                    submitBtn.textContent = 'SAVED!';
                    submitBtn.style.background = 'rgba(74, 226, 144, 0.3)';
                    submitBtn.style.borderColor = 'rgba(74, 226, 144, 0.5)';
                    
                    setTimeout(() => {
                        submitBtn.textContent = 'SAVE DATA';
                        submitBtn.style.background = 'rgba(128, 128, 128, 0.3)';
                        submitBtn.style.borderColor = 'rgba(128, 128, 128, 0.5)';
                    }, 2000);
                    
                    playSound('active');
                }
            });
        }
        
        function updateObjectLabel(object, headerText, footerText, iconData) {
            // Remove existing labels
            if (object.userData.headerLabel) {
                object.remove(object.userData.headerLabel);
                if (object.userData.headerLabel.geometry) object.userData.headerLabel.geometry.dispose();
                if (object.userData.headerLabel.material) object.userData.headerLabel.material.dispose();
                object.userData.headerLabel = null;
            }
            if (object.userData.footerLabel) {
                object.remove(object.userData.footerLabel);
                if (object.userData.footerLabel.geometry) object.userData.footerLabel.geometry.dispose();
                if (object.userData.footerLabel.material) object.userData.footerLabel.material.dispose();
                object.userData.footerLabel = null;
            }
            if (object.userData.iconSprite) {
                object.remove(object.userData.iconSprite);
                if (object.userData.iconSprite.geometry) object.userData.iconSprite.geometry.dispose();
                if (object.userData.iconSprite.material) object.userData.iconSprite.material.dispose();
                object.userData.iconSprite = null;
            }
            if (object.userData.scrollIcon) {
                object.remove(object.userData.scrollIcon);
                if (object.userData.scrollIcon.geometry) object.userData.scrollIcon.geometry.dispose();
                if (object.userData.scrollIcon.material) object.userData.scrollIcon.material.dispose();
                object.userData.scrollIcon = null;
            }
            
            // Create header label if text provided
            if (headerText && headerText.trim()) {
                const canvas = document.createElement('canvas');
                const context = canvas.getContext('2d');
                canvas.width = 512;
                canvas.height = 128;
                
                // Draw background
                context.fillStyle = 'rgba(80, 80, 90, 0.9)';
                context.fillRect(0, 0, canvas.width, canvas.height);
                
                // Border
                context.strokeStyle = 'rgba(128, 128, 128, 0.5)';
                context.lineWidth = 2;
                context.strokeRect(1, 1, canvas.width - 2, canvas.height - 2);
                
                // Text with glow
                context.font = 'bold 48px Orbitron, sans-serif';
                context.textAlign = 'center';
                context.textBaseline = 'middle';
                context.shadowColor = 'rgba(255, 255, 255, 0.8)';
                context.shadowBlur = 15;
                context.fillStyle = '#ffffff';
                context.fillText(headerText, canvas.width / 2, canvas.height / 2);
                context.fillText(headerText, canvas.width / 2, canvas.height / 2);
                
                const texture = new THREE.CanvasTexture(canvas);
                const spriteMaterial = new THREE.SpriteMaterial({ 
                    map: texture,
                    transparent: true,
                    depthTest: false,
                    depthWrite: false
                });
                const sprite = new THREE.Sprite(spriteMaterial);
                sprite.scale.set(4, 1, 1);
                sprite.position.set(0, 3.5, 0); // Higher to not cover object
                object.add(sprite);
                object.userData.headerLabel = sprite;
            }
            
            // Create footer label if text provided
            if (footerText && footerText.trim()) {
                const canvas = document.createElement('canvas');
                const context = canvas.getContext('2d');
                canvas.width = 512;
                canvas.height = 128;
                
                // Draw background
                context.fillStyle = 'rgba(80, 80, 90, 0.9)';
                context.fillRect(0, 0, canvas.width, canvas.height);
                
                // Border
                context.strokeStyle = 'rgba(128, 128, 128, 0.5)';
                context.lineWidth = 2;
                context.strokeRect(1, 1, canvas.width - 2, canvas.height - 2);
                
                // Text with glow
                context.font = 'bold 38px Orbitron, sans-serif';
                context.textAlign = 'center';
                context.textBaseline = 'middle';
                context.shadowColor = 'rgba(255, 255, 255, 0.8)';
                context.shadowBlur = 15;
                context.fillStyle = '#ffffff';
                context.fillText(footerText, canvas.width / 2, canvas.height / 2);
                context.fillText(footerText, canvas.width / 2, canvas.height / 2);
                
                const texture = new THREE.CanvasTexture(canvas);
                const spriteMaterial = new THREE.SpriteMaterial({ 
                    map: texture,
                    transparent: true,
                    depthTest: false,
                    depthWrite: false
                });
                const sprite = new THREE.Sprite(spriteMaterial);
                sprite.scale.set(4, 1, 1);
                sprite.position.set(0, -2.5, 0); // Bottom of object
                object.add(sprite);
                object.userData.footerLabel = sprite;
            }
            
            // Create icon sprite if icon data provided
            if (iconData && iconData.type && iconData.value) {
                const canvas = document.createElement('canvas');
                const context = canvas.getContext('2d');
                canvas.width = 256;
                canvas.height = 256;
                
                // Semi-transparent background
                context.fillStyle = 'rgba(255, 255, 255, 0.2)';
                context.fillRect(0, 0, canvas.width, canvas.height);
                
                // Border
                context.strokeStyle = 'rgba(255, 255, 255, 0.5)';
                context.lineWidth = 4;
                context.strokeRect(2, 2, canvas.width - 4, canvas.height - 4);
                
                if (iconData.type === 'emoji' || iconData.type === 'fontawesome') {
                    // Draw emoji/icon
                    context.font = '120px Arial';
                    context.textAlign = 'center';
                    context.textBaseline = 'middle';
                    context.fillStyle = '#ffffff';
                    context.fillText(iconData.value, canvas.width / 2, canvas.height / 2);
                } else if (iconData.type === 'image' && iconData.imageData) {
                    // Draw image
                    const img = new Image();
                    img.src = iconData.imageData;
                    img.onload = () => {
                        context.drawImage(img, 20, 20, canvas.width - 40, canvas.height - 40);
                        const texture = new THREE.CanvasTexture(canvas);
                        if (object.userData.iconSprite && object.userData.iconSprite.material) {
                            object.userData.iconSprite.material.map = texture;
                            object.userData.iconSprite.material.needsUpdate = true;
                        }
                    };
                }
                
                const texture = new THREE.CanvasTexture(canvas);
                const spriteMaterial = new THREE.SpriteMaterial({ 
                    map: texture,
                    transparent: true,
                    depthTest: false,
                    depthWrite: false
                });
                const sprite = new THREE.Sprite(spriteMaterial);
                sprite.scale.set(1.5, 1.5, 1);
                sprite.position.set(0, 0, 0.1); // Slightly in front of object
                object.add(sprite);
                object.userData.iconSprite = sprite;
            }
        }
        
        function addScrollIconToObject(object) {
            // Remove existing scroll icon
            if (object.userData.scrollIcon) {
                object.remove(object.userData.scrollIcon);
                if (object.userData.scrollIcon.geometry) object.userData.scrollIcon.geometry.dispose();
                if (object.userData.scrollIcon.material) object.userData.scrollIcon.material.dispose();
            }
            
            // Create scroll icon
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            canvas.width = 128;
            canvas.height = 128;
            
            // Background
            context.fillStyle = 'rgba(100, 100, 255, 0.8)';
            context.beginPath();
            context.arc(64, 64, 60, 0, Math.PI * 2);
            context.fill();
            
            // Border
            context.strokeStyle = 'rgba(255, 255, 255, 0.8)';
            context.lineWidth = 4;
            context.stroke();
            
            // Scroll emoji
            context.font = 'bold 60px Arial';
            context.textAlign = 'center';
            context.textBaseline = 'middle';
            context.fillStyle = '#ffffff';
            context.fillText('', 64, 64);
            
            const texture = new THREE.CanvasTexture(canvas);
            const spriteMaterial = new THREE.SpriteMaterial({ 
                map: texture,
                transparent: true,
                depthTest: false,
                depthWrite: false
            });
            const sprite = new THREE.Sprite(spriteMaterial);
            sprite.scale.set(1, 1, 1);
            sprite.position.set(1.5, 1.5, 0); // Top right corner
            sprite.userData.isScrollIcon = true;
            sprite.userData.parentObject = object;
            
            object.add(sprite);
            object.userData.scrollIcon = sprite;
            
            // Add to interactive objects for clicking
            interactiveObjects.push(sprite);
        }
        
        function showJSONViewer(jsonString) {
            const panel = document.getElementById('json-viewer-panel');
            const content = document.getElementById('json-viewer-pre');
            
            if (!panel || !content) return;
            
            // Format JSON
            try {
                const parsed = JSON.parse(jsonString);
                content.textContent = JSON.stringify(parsed, null, 2);
            } catch (e) {
                content.textContent = jsonString;
            }
            
            // Show panel
            panel.style.display = 'block';
            playSound('passive');
        }
        
        function setupJSONViewer() {
            const panel = document.getElementById('json-viewer-panel');
            const minimizedTab = document.getElementById('json-viewer-minimized');
            const closeBtn = document.getElementById('close-json-viewer');
            const minimizeBtn = document.getElementById('minimize-json-viewer');
            const toggle3DBtn = document.getElementById('toggle-3d-viewer');
            const scrollUpBtn = document.getElementById('json-scroll-up');
            const scrollDownBtn = document.getElementById('json-scroll-down');
            const contentArea = document.getElementById('json-viewer-content');
            const opacitySlider = document.getElementById('json-viewer-opacity');
            const opacityValue = document.getElementById('json-viewer-opacity-value');
            
            // Opacity slider
            if (opacitySlider && opacityValue && panel) {
                opacitySlider.addEventListener('input', (e) => {
                    const value = parseFloat(e.target.value);
                    opacityValue.textContent = `${Math.round(value * 100)}%`;
                    panel.style.background = `rgba(25, 25, 30, ${value})`;
                    playSound('passive');
                });
            }
            
            // Make panel draggable
            const header = document.getElementById('json-viewer-header');
            if (header && panel) {
                let isDragging = false;
                let currentX;
                let currentY;
                let initialX;
                let initialY;
                
                header.addEventListener('mousedown', (e) => {
                    if (e.target === header || header.contains(e.target)) {
                        isDragging = true;
                        const rect = panel.getBoundingClientRect();
                        initialX = e.clientX - rect.left;
                        initialY = e.clientY - rect.top;
                        panel.style.transform = 'none';
                    }
                });
                
                document.addEventListener('mousemove', (e) => {
                    if (isDragging) {
                        e.preventDefault();
                        currentX = e.clientX - initialX;
                        currentY = e.clientY - initialY;
                        panel.style.left = currentX + 'px';
                        panel.style.top = currentY + 'px';
                    }
                });
                
                document.addEventListener('mouseup', () => {
                    isDragging = false;
                });
            }
            
            // Close button
            if (closeBtn) {
                closeBtn.addEventListener('click', () => {
                    panel.style.display = 'none';
                    playSound('passive');
                });
            }
            
            // Minimize button
            if (minimizeBtn && panel && minimizedTab) {
                minimizeBtn.addEventListener('click', () => {
                    panel.style.display = 'none';
                    minimizedTab.style.display = 'block';
                    playSound('passive');
                });
            }
            
            // Restore from minimized
            if (minimizedTab && panel) {
                minimizedTab.addEventListener('click', () => {
                    minimizedTab.style.display = 'none';
                    panel.style.display = 'block';
                    playSound('passive');
                });
            }
            
            // Toggle 3D View
            if (toggle3DBtn) {
                toggle3DBtn.addEventListener('click', () => {
                    // Close 2D panel
                    panel.style.display = 'none';
                    
                    // Create or show 3D panel
                    show3DDataPanel();
                    playSound('active');
                });
            }
            
            // Scroll buttons
            if (scrollUpBtn && contentArea) {
                scrollUpBtn.addEventListener('click', () => {
                    contentArea.scrollBy({ top: -100, behavior: 'smooth' });
                    playSound('passive');
                });
            }
            
            if (scrollDownBtn && contentArea) {
                scrollDownBtn.addEventListener('click', () => {
                    contentArea.scrollBy({ top: 100, behavior: 'smooth' });
                    playSound('passive');
                });
            }
            
            // Close on Escape key
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    if (panel && panel.style.display === 'block') {
                        panel.style.display = 'none';
                        playSound('passive');
                    }
                }
            });
        }
        
        let scene3DDataPanel = null;
        let scene3DDataTexture = null;
        
        function show3DDataPanel() {
            const jsonContent = document.getElementById('json-viewer-pre').textContent;
            
            // Remove existing 3D panel if exists
            if (scene3DDataPanel) {
                scene.remove(scene3DDataPanel);
                if (scene3DDataTexture) scene3DDataTexture.dispose();
            }
            
            // Create canvas for text
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            canvas.width = 1024;
            canvas.height = 2048;
            
            // Background
            context.fillStyle = 'rgba(25, 25, 30, 0.95)';
            context.fillRect(0, 0, canvas.width, canvas.height);
            
            // Border
            context.strokeStyle = 'rgba(255, 255, 255, 0.5)';
            context.lineWidth = 4;
            context.strokeRect(2, 2, canvas.width - 4, canvas.height - 4);
            
            // Header
            context.fillStyle = 'rgba(128, 128, 128, 0.3)';
            context.fillRect(0, 0, canvas.width, 80);
            context.font = 'bold 36px Orbitron';
            context.fillStyle = '#ffffff';
            context.textAlign = 'center';
            context.fillText(' DATA VIEWER', canvas.width / 2, 50);
            
            // JSON Content
            context.font = '20px Courier New';
            context.fillStyle = '#ffffff';
            context.textAlign = 'left';
            
            const lines = jsonContent.split('\n');
            let y = 120;
            const lineHeight = 28;
            const maxWidth = canvas.width - 40;
            
            lines.forEach(line => {
                if (y < canvas.height - 40) {
                    // Wrap long lines
                    const words = line.split(' ');
                    let currentLine = '';
                    
                    words.forEach(word => {
                        const testLine = currentLine + word + ' ';
                        const metrics = context.measureText(testLine);
                        
                        if (metrics.width > maxWidth && currentLine !== '') {
                            context.fillText(currentLine, 20, y);
                            y += lineHeight;
                            currentLine = word + ' ';
                        } else {
                            currentLine = testLine;
                        }
                    });
                    
                    context.fillText(currentLine, 20, y);
                    y += lineHeight;
                }
            });
            
            // Scroll controls hint
            context.font = 'bold 24px Orbitron';
            context.fillStyle = 'rgba(255, 255, 255, 0.7)';
            context.textAlign = 'center';
            context.fillText(' W Key - Scroll Up ', canvas.width / 2, canvas.height - 50);
            context.fillText(' S Key - Scroll Down ', canvas.width / 2, canvas.height - 20);
            
            // Create texture and material
            scene3DDataTexture = new THREE.CanvasTexture(canvas);
            const material = new THREE.MeshBasicMaterial({
                map: scene3DDataTexture,
                transparent: true,
                opacity: 0.95,
                side: THREE.DoubleSide
            });
            
            // Create plane geometry
            const geometry = new THREE.PlaneGeometry(10, 20);
            scene3DDataPanel = new THREE.Mesh(geometry, material);
            
            // Position at center
            scene3DDataPanel.position.set(0, 0, 0);
            scene3DDataPanel.userData.is3DPanel = true;
            scene3DDataPanel.userData.scrollOffset = 0;
            scene3DDataPanel.userData.jsonContent = jsonContent;
            scene3DDataPanel.userData.canvasHeight = canvas.height;
            
            scene.add(scene3DDataPanel);
            
            // Move camera to viewing position
            gsap.to(camera.position, {
                duration: 1.5,
                x: 0,
                y: 0,
                z: 15,
                ease: 'power2.inOut'
            });
            
            gsap.to(cameraTarget, {
                duration: 1.5,
                x: 0,
                y: 0,
                z: 0,
                ease: 'power2.inOut'
            });
            
            // Show 3D panel controls
            const controlsPanel = document.getElementById('panel-3d-controls');
            if (controlsPanel) {
                controlsPanel.style.display = 'block';
            }
            
            // Setup 3D panel controls
            setup3DPanelControls();
        }
        
        function setup3DPanelControls() {
            const controlsPanel = document.getElementById('panel-3d-controls');
            const closeBtn = document.getElementById('close-3d-controls');
            const header = document.getElementById('panel-3d-header');
            
            // Position controls
            const posX = document.getElementById('panel-3d-pos-x');
            const posY = document.getElementById('panel-3d-pos-y');
            const posZ = document.getElementById('panel-3d-pos-z');
            
            // Rotation controls
            const rotX = document.getElementById('panel-3d-rot-x');
            const rotY = document.getElementById('panel-3d-rot-y');
            const rotZ = document.getElementById('panel-3d-rot-z');
            
            // Scale controls
            const scaX = document.getElementById('panel-3d-sca-x');
            const scaY = document.getElementById('panel-3d-sca-y');
            const scaZ = document.getElementById('panel-3d-sca-z');
            
            // Color and opacity
            const colorPicker = document.getElementById('panel-3d-color');
            const colorValue = document.getElementById('panel-3d-color-value');
            const opacitySlider = document.getElementById('panel-3d-opacity');
            const opacityValue = document.getElementById('panel-3d-opacity-value');
            
            // Buttons
            const pocketBtn = document.getElementById('save-to-pocket-3d');
            const resetBtn = document.getElementById('reset-3d-panel');
            const removeBtn = document.getElementById('remove-3d-panel');
            
            // Close button
            if (closeBtn) {
                closeBtn.addEventListener('click', () => {
                    controlsPanel.style.display = 'none';
                    playSound('passive');
                });
            }
            
            // Position updates
            if (posX && scene3DDataPanel) {
                posX.addEventListener('input', (e) => {
                    scene3DDataPanel.position.x = parseFloat(e.target.value);
                    playSound('passive');
                });
            }
            if (posY && scene3DDataPanel) {
                posY.addEventListener('input', (e) => {
                    scene3DDataPanel.position.y = parseFloat(e.target.value);
                    playSound('passive');
                });
            }
            if (posZ && scene3DDataPanel) {
                posZ.addEventListener('input', (e) => {
                    scene3DDataPanel.position.z = parseFloat(e.target.value);
                    playSound('passive');
                });
            }
            
            // Rotation updates
            if (rotX && scene3DDataPanel) {
                rotX.addEventListener('input', (e) => {
                    scene3DDataPanel.rotation.x = parseFloat(e.target.value);
                    playSound('passive');
                });
            }
            if (rotY && scene3DDataPanel) {
                rotY.addEventListener('input', (e) => {
                    scene3DDataPanel.rotation.y = parseFloat(e.target.value);
                    playSound('passive');
                });
            }
            if (rotZ && scene3DDataPanel) {
                rotZ.addEventListener('input', (e) => {
                    scene3DDataPanel.rotation.z = parseFloat(e.target.value);
                    playSound('passive');
                });
            }
            
            // Scale updates
            if (scaX && scene3DDataPanel) {
                scaX.addEventListener('input', (e) => {
                    scene3DDataPanel.scale.x = parseFloat(e.target.value);
                    playSound('passive');
                });
            }
            if (scaY && scene3DDataPanel) {
                scaY.addEventListener('input', (e) => {
                    scene3DDataPanel.scale.y = parseFloat(e.target.value);
                    playSound('passive');
                });
            }
            if (scaZ && scene3DDataPanel) {
                scaZ.addEventListener('input', (e) => {
                    scene3DDataPanel.scale.z = parseFloat(e.target.value);
                    playSound('passive');
                });
            }
            
            // Color update
            if (colorPicker && colorValue && scene3DDataPanel) {
                colorPicker.addEventListener('input', (e) => {
                    const color = e.target.value;
                    colorValue.textContent = color.toUpperCase();
                    updatePanelColor(color);
                    playSound('passive');
                });
            }
            
            // Opacity update
            if (opacitySlider && opacityValue && scene3DDataPanel) {
                opacitySlider.addEventListener('input', (e) => {
                    const value = parseFloat(e.target.value);
                    opacityValue.textContent = `${Math.round(value * 100)}%`;
                    scene3DDataPanel.material.opacity = value;
                    playSound('passive');
                });
            }
            
            // Reset button
            if (resetBtn && scene3DDataPanel) {
                resetBtn.addEventListener('click', () => {
                    // Reset to default position
                    scene3DDataPanel.position.set(0, 0, 0);
                    scene3DDataPanel.rotation.set(0, 0, 0);
                    scene3DDataPanel.scale.set(1, 1, 1);
                    
                    // Reset sliders
                    if (posX) posX.value = 0;
                    if (posY) posY.value = 0;
                    if (posZ) posZ.value = 0;
                    if (rotX) rotX.value = 0;
                    if (rotY) rotY.value = 0;
                    if (rotZ) rotZ.value = 0;
                    if (scaX) scaX.value = 1;
                    if (scaY) scaY.value = 1;
                    if (scaZ) scaZ.value = 1;
                    
                    // Reset camera
                    gsap.to(camera.position, {
                        duration: 1,
                        x: 0,
                        y: 0,
                        z: 15,
                        ease: 'power2.inOut'
                    });
                    
                    playSound('active');
                });
            }
            
            // Remove button
            if (removeBtn && scene3DDataPanel) {
                removeBtn.addEventListener('click', () => {
                    if (confirm('Remove 3D panel from scene?')) {
                        scene.remove(scene3DDataPanel);
                        scene3DDataPanel = null;
                        controlsPanel.style.display = 'none';
                        playSound('active');
                    }
                });
            }
            
            // Put in pocket
            if (pocketBtn) {
                pocketBtn.addEventListener('click', () => {
                    // Store panel data in pocket
                    const panelData = {
                        type: '3d-panel',
                        jsonContent: scene3DDataPanel.userData.jsonContent,
                        position: {
                            x: scene3DDataPanel.position.x,
                            y: scene3DDataPanel.position.y,
                            z: scene3DDataPanel.position.z
                        },
                        rotation: {
                            x: scene3DDataPanel.rotation.x,
                            y: scene3DDataPanel.rotation.y,
                            z: scene3DDataPanel.rotation.z
                        },
                        scale: {
                            x: scene3DDataPanel.scale.x,
                            y: scene3DDataPanel.scale.y,
                            z: scene3DDataPanel.scale.z
                        }
                    };
                    
                    // Find next available pocket slot
                    let slotIndex = 0;
                    while (slotIndex < maxPocketSlots && pocketItems[slotIndex]) {
                        slotIndex++;
                    }
                    
                    if (slotIndex < maxPocketSlots) {
                        pocketItems[slotIndex] = panelData;
                        localStorage.setItem(`pocket_item_${slotIndex}`, JSON.stringify(panelData));
                        
                        // Remove from scene
                        scene.remove(scene3DDataPanel);
                        scene3DDataPanel = null;
                        controlsPanel.style.display = 'none';
                        
                        // Visual feedback
                        pocketBtn.textContent = ' STORED!';
                        setTimeout(() => {
                            pocketBtn.textContent = ' SAVE TO POCKET';
                        }, 2000);
                        
                        playSound('active');
                    } else {
                        alert('Pocket is full!');
                    }
                });
            }
            
            // Make controls panel draggable
            if (header && controlsPanel) {
                let isDragging = false;
                let currentX;
                let currentY;
                let initialX;
                let initialY;
                
                header.addEventListener('mousedown', (e) => {
                    if (e.target === header || header.contains(e.target.querySelector('span'))) {
                        isDragging = true;
                        const rect = controlsPanel.getBoundingClientRect();
                        initialX = e.clientX - rect.left;
                        initialY = e.clientY - rect.top;
                        controlsPanel.style.transform = 'none';
                    }
                });
                
                document.addEventListener('mousemove', (e) => {
                    if (isDragging) {
                        e.preventDefault();
                        currentX = e.clientX - initialX;
                        currentY = e.clientY - initialY;
                        controlsPanel.style.right = 'auto';
                        controlsPanel.style.left = currentX + 'px';
                        controlsPanel.style.top = currentY + 'px';
                    }
                });
                
                document.addEventListener('mouseup', () => {
                    isDragging = false;
                });
            }
        }
        
        function updatePanelColor(color) {
            if (!scene3DDataPanel) return;
            
            const jsonContent = scene3DDataPanel.userData.jsonContent;
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            canvas.width = 1024;
            canvas.height = 2048;
            
            // Convert hex to RGB
            const r = parseInt(color.substr(1,2), 16);
            const g = parseInt(color.substr(3,2), 16);
            const b = parseInt(color.substr(5,2), 16);
            
            // Background with new color
            context.fillStyle = `rgba(${r}, ${g}, ${b}, 0.95)`;
            context.fillRect(0, 0, canvas.width, canvas.height);
            
            // Border
            context.strokeStyle = 'rgba(255, 255, 255, 0.5)';
            context.lineWidth = 4;
            context.strokeRect(2, 2, canvas.width - 4, canvas.height - 4);
            
            // Header
            context.fillStyle = 'rgba(128, 128, 128, 0.3)';
            context.fillRect(0, 0, canvas.width, 80);
            context.font = 'bold 36px Orbitron';
            context.fillStyle = '#ffffff';
            context.textAlign = 'center';
            context.fillText(' DATA VIEWER', canvas.width / 2, 50);
            
            // JSON Content
            context.font = '20px Courier New';
            context.fillStyle = '#ffffff';
            context.textAlign = 'left';
            
            const lines = jsonContent.split('\n');
            let y = 120;
            const lineHeight = 28;
            const maxWidth = canvas.width - 40;
            
            lines.forEach(line => {
                if (y < canvas.height - 40) {
                    const words = line.split(' ');
                    let currentLine = '';
                    
                    words.forEach(word => {
                        const testLine = currentLine + word + ' ';
                        const metrics = context.measureText(testLine);
                        
                        if (metrics.width > maxWidth && currentLine !== '') {
                            context.fillText(currentLine, 20, y);
                            y += lineHeight;
                            currentLine = word + ' ';
                        } else {
                            currentLine = testLine;
                        }
                    });
                    
                    context.fillText(currentLine, 20, y);
                    y += lineHeight;
                }
            });
            
            // Scroll hints
            context.font = 'bold 24px Orbitron';
            context.fillStyle = 'rgba(255, 255, 255, 0.7)';
            context.textAlign = 'center';
            context.fillText(' W Key - Scroll Up ', canvas.width / 2, canvas.height - 50);
            context.fillText(' S Key - Scroll Down ', canvas.width / 2, canvas.height - 20);
            
            // Update texture
            const newTexture = new THREE.CanvasTexture(canvas);
            scene3DDataPanel.material.map = newTexture;
            scene3DDataPanel.material.needsUpdate = true;
            
            // Dispose old texture
            if (scene3DDataTexture) scene3DDataTexture.dispose();
            scene3DDataTexture = newTexture;
        }
        
        // Add scroll functionality for 3D panel in animate loop
        window.scroll3DPanel = function(direction) {
            if (scene3DDataPanel && scene3DDataPanel.userData.is3DPanel) {
                const scrollAmount = 0.5;
                scene3DDataPanel.userData.scrollOffset += direction * scrollAmount;
                
                // Update texture offset for scrolling effect
                if (scene3DDataPanel.material.map) {
                    scene3DDataPanel.material.map.offset.y = scene3DDataPanel.userData.scrollOffset * 0.001;
                    scene3DDataPanel.material.map.needsUpdate = true;
                }
            }
        };


        function setupPanelControls() {
            const panel = document.getElementById('inspector-panel');
            const header = document.getElementById('panel-header');
            const minimizeBtn = document.getElementById('minimize-btn');
            const closeBtn = document.getElementById('close-btn');

            if (!panel || !header || !minimizeBtn || !closeBtn) {
                console.warn('Inspector panel elements not found');
                return;
            }

            // Minimize
            minimizeBtn.addEventListener('click', () => {
                panel.classList.toggle('minimized');
                const content = document.getElementById('panel-content');
                if (content) {
                    content.classList.toggle('hidden');
                }
                minimizeBtn.textContent = panel.classList.contains('minimized') ? '' : '_';
            });

            // Close (hide via toggle class)
            closeBtn.addEventListener('click', () => {
                panel.classList.remove('visible');
                playSound('passive');
            });

            // Drag
            header.addEventListener('mousedown', (e) => {
                isDragging = true;
                dragStartX = e.clientX - panel.offsetLeft;
                dragStartY = e.clientY - panel.offsetTop;
            });

            document.addEventListener('mousemove', (e) => {
                if (isDragging) {
                    panel.style.left = (e.clientX - dragStartX) + 'px';
                    panel.style.top = (e.clientY - dragStartY) + 'px';
                }
            });

            document.addEventListener('mouseup', () => {
                isDragging = false;
                isResizing = false;
            });
            
            // Inspector resize
            const resizeHandle = document.getElementById('inspector-resize-handle');
            let isResizing = false;
            let resizeStartX, resizeStartY, resizeStartWidth, resizeStartHeight;
            
            if (resizeHandle) {
                resizeHandle.addEventListener('mousedown', (e) => {
                    e.stopPropagation();
                    isResizing = true;
                    resizeStartX = e.clientX;
                    resizeStartY = e.clientY;
                    resizeStartWidth = panel.offsetWidth;
                    resizeStartHeight = panel.offsetHeight;
                });
                
                document.addEventListener('mousemove', (e) => {
                    if (isResizing) {
                        const newWidth = resizeStartWidth + (e.clientX - resizeStartX);
                        const newHeight = resizeStartHeight + (e.clientY - resizeStartY);
                        panel.style.width = Math.max(320, newWidth) + 'px';
                        panel.style.maxHeight = Math.max(200, newHeight) + 'px';
                    }
                });
            }
            
            // Info Section Toggle
            const infoToggle = document.getElementById('info-toggle');
            const infoContent = document.getElementById('info-content');
            const infoArrow = document.getElementById('info-arrow');
            
            if (infoToggle && infoContent && infoArrow) {
                infoToggle.addEventListener('click', () => {
                    const isExpanded = infoContent.style.display !== 'none';
                    
                    if (isExpanded) {
                        // Collapse
                        infoContent.style.display = 'none';
                        infoArrow.style.transform = 'rotate(0deg)';
                        infoArrow.textContent = '';
                        infoToggle.querySelector('span:last-child').textContent = 'Click to expand';
                    } else {
                        // Expand
                        infoContent.style.display = 'block';
                        infoArrow.style.transform = 'rotate(90deg)';
                        infoArrow.textContent = '';
                        infoToggle.querySelector('span:last-child').textContent = 'Click to collapse';
                    }
                    playSound('passive');
                });
            }
            
            // MySpace Panel Setup
            const myspacePanel = document.getElementById('myspace-panel');
            const myspaceHeader = document.getElementById('myspace-panel-header');
            const myspaceMinimizeBtn = document.getElementById('myspace-minimize-btn');
            const myspaceCloseBtn = document.getElementById('myspace-close-btn');
            
            if (myspacePanel && myspaceHeader && myspaceMinimizeBtn && myspaceCloseBtn) {
                // Minimize
                myspaceMinimizeBtn.addEventListener('click', () => {
                    myspacePanel.classList.toggle('minimized');
                    const content = document.getElementById('myspace-panel-content');
                    if (content) {
                        content.classList.toggle('hidden');
                    }
                    myspaceMinimizeBtn.textContent = myspacePanel.classList.contains('minimized') ? '' : '_';
                });
                
                // Close
                myspaceCloseBtn.addEventListener('click', () => {
                    myspacePanel.style.display = 'none';
                    playSound('passive');
                });
                
                // Drag
                let myspaceDragging = false;
                let myspaceDragStartX, myspaceDragStartY;
                
                myspaceHeader.addEventListener('mousedown', (e) => {
                    myspaceDragging = true;
                    myspaceDragStartX = e.clientX - myspacePanel.offsetLeft;
                    myspaceDragStartY = e.clientY - myspacePanel.offsetTop;
                });
                
                document.addEventListener('mousemove', (e) => {
                    if (myspaceDragging) {
                        myspacePanel.style.left = (e.clientX - myspaceDragStartX) + 'px';
                        myspacePanel.style.top = (e.clientY - myspaceDragStartY) + 'px';
                    }
                });
                
                document.addEventListener('mouseup', () => {
                    myspaceDragging = false;
                    myspaceResizing = false;
                });
                
                // Resize
                const myspaceResizeHandle = document.getElementById('myspace-resize-handle');
                let myspaceResizing = false;
                let myspaceResizeStartX, myspaceResizeStartY, myspaceResizeStartWidth, myspaceResizeStartHeight;
                
                if (myspaceResizeHandle) {
                    myspaceResizeHandle.addEventListener('mousedown', (e) => {
                        e.stopPropagation();
                        myspaceResizing = true;
                        myspaceResizeStartX = e.clientX;
                        myspaceResizeStartY = e.clientY;
                        myspaceResizeStartWidth = myspacePanel.offsetWidth;
                        myspaceResizeStartHeight = myspacePanel.offsetHeight;
                    });
                    
                    document.addEventListener('mousemove', (e) => {
                        if (myspaceResizing) {
                            const newWidth = myspaceResizeStartWidth + (e.clientX - myspaceResizeStartX);
                            const newHeight = myspaceResizeStartHeight + (e.clientY - myspaceResizeStartY);
                            myspacePanel.style.width = Math.max(320, newWidth) + 'px';
                            myspacePanel.style.maxHeight = Math.max(200, newHeight) + 'px';
                        }
                    });
                }
                
                // Summon/DeSummon Toggle
                const summonBtn = document.getElementById('summon-toggle-btn');
                let myspaceSummoned = true;
                
                if (summonBtn) {
                    summonBtn.addEventListener('click', () => {
                        myspaceSummoned = !myspaceSummoned;
                        summonBtn.classList.toggle('active');
                        summonBtn.textContent = myspaceSummoned ? ' SUMMONED' : ' DESUMMONED';
                        
                        // Toggle MySpace grid visibility
                        if (mySpaceGroup) {
                            mySpaceGroup.visible = myspaceSummoned;
                        }
                        playSound('active');
                    });
                }
                
                // MyZone Toggle
                const myzoneBtn = document.getElementById('myzone-toggle-btn');
                let myzoneActive = false;
                
                if (myzoneBtn) {
                    myzoneBtn.addEventListener('click', () => {
                        myzoneActive = !myzoneActive;
                        myzoneBtn.classList.toggle('active');
                        myzoneBtn.textContent = myzoneActive ? ' LOCKED' : 'LOCK TO VIEW';
                        
                        window.myzoneLocked = myzoneActive;
                        playSound('active');
                    });
                }
                
                // Rotation Controls
                const rotateUpBtn = document.getElementById('rotate-up-btn');
                const rotateDownBtn = document.getElementById('rotate-down-btn');
                const rotateLeftBtn = document.getElementById('rotate-left-btn');
                const rotateRightBtn = document.getElementById('rotate-right-btn');
                
                if (rotateUpBtn) {
                    rotateUpBtn.addEventListener('click', () => {
                        if (mySpaceGroup) {
                            gsap.to(mySpaceGroup.rotation, {
                                duration: 0.6,
                                x: mySpaceGroup.rotation.x + Math.PI / 4,
                                ease: 'power2.inOut'
                            });
                        }
                        playSound('passive');
                    });
                }
                
                if (rotateDownBtn) {
                    rotateDownBtn.addEventListener('click', () => {
                        if (mySpaceGroup) {
                            gsap.to(mySpaceGroup.rotation, {
                                duration: 0.6,
                                x: mySpaceGroup.rotation.x - Math.PI / 4,
                                ease: 'power2.inOut'
                            });
                        }
                        playSound('passive');
                    });
                }
                
                if (rotateLeftBtn) {
                    rotateLeftBtn.addEventListener('click', () => {
                        if (mySpaceGroup) {
                            gsap.to(mySpaceGroup.rotation, {
                                duration: 0.6,
                                y: mySpaceGroup.rotation.y - Math.PI / 4,
                                ease: 'power2.inOut'
                            });
                        }
                        playSound('passive');
                    });
                }
                
                if (rotateRightBtn) {
                    rotateRightBtn.addEventListener('click', () => {
                        if (mySpaceGroup) {
                            gsap.to(mySpaceGroup.rotation, {
                                duration: 0.6,
                                y: mySpaceGroup.rotation.y + Math.PI / 4,
                                ease: 'power2.inOut'
                            });
                        }
                        playSound('passive');
                    });
                }
                
                // Center Sphere Button
                const centerSphereBtn = document.getElementById('center-sphere-btn');
                
                if (centerSphereBtn) {
                    centerSphereBtn.addEventListener('click', () => {
                        if (mySpaceGroup) {
                            // Animate rotation back to zero (centered)
                            gsap.to(mySpaceGroup.rotation, {
                                duration: 0.8,
                                x: 0,
                                y: 0,
                                z: 0,
                                ease: 'power2.inOut'
                            });
                        }
                        playSound('active');
                    });
                }
                
                // Reset MySpace Button
                const resetMyspaceBtn = document.getElementById('reset-myspace-btn');
                
                if (resetMyspaceBtn) {
                    resetMyspaceBtn.addEventListener('click', () => {
                        if (mySpaceGroup) {
                            // Reset position and rotation
                            mySpaceGroup.position.set(0, 0, 0);
                            mySpaceGroup.rotation.set(0, 0, 0);
                            
                            // Turn off MyZone lock if active
                            if (window.myzoneLocked) {
                                window.myzoneLocked = false;
                                const myzoneBtn = document.getElementById('myzone-toggle-btn');
                                if (myzoneBtn) {
                                    myzoneBtn.classList.remove('active');
                                    myzoneBtn.textContent = 'LOCK TO VIEW';
                                }
                            }
                        }
                        playSound('active');
                    });
                }
                
                // Sphere Auto-Rotation Checkboxes
                const sphereRotateXCheckbox = document.getElementById('sphere-rotate-x');
                const sphereRotateYCheckbox = document.getElementById('sphere-rotate-y');
                const sphereRotateZCheckbox = document.getElementById('sphere-rotate-z');
                
                if (sphereRotateXCheckbox) {
                    sphereRotateXCheckbox.addEventListener('change', (e) => {
                        sphereRotateX = e.target.checked;
                        playSound('passive');
                    });
                }
                
                if (sphereRotateYCheckbox) {
                    sphereRotateYCheckbox.addEventListener('change', (e) => {
                        sphereRotateY = e.target.checked;
                        playSound('passive');
                    });
                }
                
                if (sphereRotateZCheckbox) {
                    sphereRotateZCheckbox.addEventListener('change', (e) => {
                        sphereRotateZ = e.target.checked;
                        playSound('passive');
                    });
                }
                
                // Wallpaper Controls
                const wallpaperImageBtn = document.getElementById('wallpaper-image-btn');
                const wallpaperVideoBtn = document.getElementById('wallpaper-video-btn');
                const wallpaperDefaultBtn = document.getElementById('wallpaper-default-btn');
                const wallpaperUpload = document.getElementById('wallpaper-upload');
                const wallpaperUploadTrigger = document.getElementById('wallpaper-upload-trigger');
                const wallpaperPreview = document.getElementById('wallpaper-preview');
                
                let currentWallpaperMode = 'default';
                
                if (wallpaperImageBtn && wallpaperVideoBtn && wallpaperDefaultBtn) {
                    wallpaperImageBtn.addEventListener('click', () => {
                        currentWallpaperMode = 'image';
                        wallpaperImageBtn.classList.add('active');
                        wallpaperVideoBtn.classList.remove('active');
                        wallpaperDefaultBtn.classList.remove('active');
                        playSound('passive');
                    });
                    
                    wallpaperVideoBtn.addEventListener('click', () => {
                        currentWallpaperMode = 'video';
                        wallpaperVideoBtn.classList.add('active');
                        wallpaperImageBtn.classList.remove('active');
                        wallpaperDefaultBtn.classList.remove('active');
                        playSound('passive');
                    });
                    
                    wallpaperDefaultBtn.addEventListener('click', () => {
                        currentWallpaperMode = 'default';
                        wallpaperDefaultBtn.classList.add('active');
                        wallpaperImageBtn.classList.remove('active');
                        wallpaperVideoBtn.classList.remove('active');
                        
                        // Restore default gradient for panels
                        if (mySpaceGroup) {
                            mySpaceGroup.children.forEach(panel => {
                                if (panel.userData.type === 'myspace-sphere') {
                                    // Restore sphere's original gradient shader
                                    if (panel.material && panel.material.type !== 'ShaderMaterial') {
                                        const sphereMaterial = new THREE.ShaderMaterial({
                                            side: THREE.BackSide,
                                            uniforms: {
                                                color1: { value: new THREE.Color(0x333333) },
                                                color2: { value: new THREE.Color(0xffffff) }
                                            },
                                            vertexShader: `
                                                varying vec3 vPosition;
                                                void main() {
                                                    vPosition = position;
                                                    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
                                                }
                                            `,
                                            fragmentShader: `
                                                uniform vec3 color1;
                                                uniform vec3 color2;
                                                varying vec3 vPosition;
                                                void main() {
                                                    float mixValue = (vPosition.y + 30.0) / 60.0;
                                                    gl_FragColor = vec4(mix(color1, color2, mixValue), 1.0);
                                                }
                                            `
                                        });
                                        panel.material = sphereMaterial;
                                    }
                                } else if (panel.material && panel.material.map) {
                                    panel.material.map = null;
                                    panel.material.needsUpdate = true;
                                }
                            });
                        }
                        wallpaperPreview.textContent = 'Current: Default Gradient';
                        playSound('passive');
                    });
                }
                
                if (wallpaperUploadTrigger && wallpaperUpload) {
                    wallpaperUploadTrigger.addEventListener('click', () => {
                        wallpaperUpload.click();
                    });
                    
                    wallpaperUpload.addEventListener('change', (e) => {
                        const file = e.target.files[0];
                        if (!file) return;
                        
                        const reader = new FileReader();
                        reader.onload = (event) => {
                            if (currentWallpaperMode === 'image') {
                                const texture = new THREE.TextureLoader().load(event.target.result);
                                texture.wrapS = THREE.RepeatWrapping;
                                texture.wrapT = THREE.RepeatWrapping;
                                
                                if (mySpaceGroup) {
                                    mySpaceGroup.children.forEach(panel => {
                                        if (panel.userData.type === 'myspace-sphere') {
                                            // Replace sphere shader with textured material
                                            panel.material = new THREE.MeshBasicMaterial({
                                                map: texture,
                                                side: THREE.BackSide
                                            });
                                        } else if (panel.material) {
                                            panel.material.map = texture;
                                            panel.material.needsUpdate = true;
                                        }
                                    });
                                }
                                wallpaperPreview.textContent = `Current: ${file.name}`;
                            } else if (currentWallpaperMode === 'video') {
                                const video = document.createElement('video');
                                video.src = event.target.result;
                                video.loop = true;
                                video.muted = true;
                                video.play();
                                
                                const videoTexture = new THREE.VideoTexture(video);
                                videoTexture.wrapS = THREE.RepeatWrapping;
                                videoTexture.wrapT = THREE.RepeatWrapping;
                                
                                if (mySpaceGroup) {
                                    mySpaceGroup.children.forEach(panel => {
                                        if (panel.userData.type === 'myspace-sphere') {
                                            // Replace sphere shader with video texture material
                                            panel.material = new THREE.MeshBasicMaterial({
                                                map: videoTexture,
                                                side: THREE.BackSide
                                            });
                                        } else if (panel.material) {
                                            panel.material.map = videoTexture;
                                            panel.material.needsUpdate = true;
                                        }
                                    });
                                }
                                wallpaperPreview.textContent = `Current: ${file.name} (Video)`;
                            }
                            playSound('active');
                        };
                        reader.readAsDataURL(file);
                    });
                }
            }
            
            // Help Panel Setup
            const helpPanel = document.getElementById('help-panel');
            const helpHeader = document.getElementById('help-panel-header');
            const helpMinimizeBtn = document.getElementById('help-minimize-btn');
            const helpCloseBtn = document.getElementById('help-close-btn');
            
            if (helpPanel && helpHeader && helpMinimizeBtn && helpCloseBtn) {
                // Minimize/Expand
                helpMinimizeBtn.addEventListener('click', () => {
                    helpPanel.classList.toggle('minimized');
                    const content = document.getElementById('help-panel-content');
                    if (content) {
                        content.classList.toggle('hidden');
                    }
                    helpMinimizeBtn.textContent = helpPanel.classList.contains('minimized') ? '' : '_';
                    playSound('passive');
                });
                
                // Close
                helpCloseBtn.addEventListener('click', () => {
                    helpPanel.style.display = 'none';
                    playSound('passive');
                });
                
                // Drag
                let helpDragging = false;
                let helpDragStartX, helpDragStartY;
                
                helpHeader.addEventListener('mousedown', (e) => {
                    helpDragging = true;
                    helpDragStartX = e.clientX - helpPanel.offsetLeft;
                    helpDragStartY = e.clientY - helpPanel.offsetTop;
                });
                
                document.addEventListener('mousemove', (e) => {
                    if (helpDragging) {
                        helpPanel.style.left = (e.clientX - helpDragStartX) + 'px';
                        helpPanel.style.top = (e.clientY - helpDragStartY) + 'px';
                    }
                });
                
                document.addEventListener('mouseup', () => {
                    helpDragging = false;
                });
            }
            
            // Chat Button
            const chatButton = document.getElementById('chat-button');
            const chatPanel = document.getElementById('chat-panel');
            const chatClose = document.getElementById('chat-close');
            
            if (chatButton && chatPanel) {
                chatButton.addEventListener('click', () => {
                    const isHidden = chatPanel.style.display === 'none';
                    chatPanel.style.display = isHidden ? 'block' : 'none';
                    chatButton.style.background = isHidden ? 'rgba(128, 128, 128, 0.5)' : 'rgba(25, 25, 30, 0.85)';
                    playSound('passive');
                });
            }
            
            if (chatClose) {
                chatClose.addEventListener('click', () => {
                    chatPanel.style.display = 'none';
                    chatButton.style.background = 'rgba(25, 25, 30, 0.85)';
                    playSound('passive');
                });
            }
            
            // Chat Panel Drag
            const chatPanelHeader = document.getElementById('chat-panel-header');
            if (chatPanelHeader && chatPanel) {
                let chatDragging = false;
                let chatDragStartX, chatDragStartY;
                
                chatPanelHeader.addEventListener('mousedown', (e) => {
                    chatDragging = true;
                    chatDragStartX = e.clientX - chatPanel.offsetLeft;
                    chatDragStartY = e.clientY - chatPanel.offsetTop;
                });
                
                document.addEventListener('mousemove', (e) => {
                    if (chatDragging) {
                        chatPanel.style.left = (e.clientX - chatDragStartX) + 'px';
                        chatPanel.style.top = (e.clientY - chatDragStartY) + 'px';
                        chatPanel.style.bottom = 'auto';
                        chatPanel.style.right = 'auto';
                    }
                });
                
                document.addEventListener('mouseup', () => {
                    chatDragging = false;
                });
            }
            
            // View Panel
            const openViewPanelBtn = document.getElementById('open-view-panel-btn');
            const viewPanel = document.getElementById('view-panel');
            const viewPanelClose = document.getElementById('view-panel-close');
            
            if (openViewPanelBtn && viewPanel) {
                openViewPanelBtn.addEventListener('click', () => {
                    if (selectedObject) {
                        // Load data into view panel
                        const objectId = selectedObject.uuid;
                        const savedData = localStorage.getItem(`object_data_${objectId}`);
                        
                        if (savedData) {
                            const data = JSON.parse(savedData);
                            document.getElementById('view-header').textContent = data.header || '';
                            document.getElementById('view-body').textContent = data.body || '';
                            document.getElementById('view-footer').textContent = data.footer || '';
                        } else {
                            document.getElementById('view-header').textContent = '';
                            document.getElementById('view-body').textContent = '';
                            document.getElementById('view-footer').textContent = '';
                        }
                        
                        viewPanel.style.display = 'block';
                        playSound('active');
                    } else {
                        alert('No object selected. Please select an object first.');
                    }
                });
            }
            
            if (viewPanelClose) {
                viewPanelClose.addEventListener('click', () => {
                    viewPanel.style.display = 'none';
                    playSound('passive');
                });
            }
            
            // View Panel Drag
            const viewPanelHeader = document.getElementById('view-panel-header');
            let isViewDragging = false;
            let viewDragStartX, viewDragStartY;
            
            if (viewPanelHeader && viewPanel) {
                viewPanelHeader.addEventListener('mousedown', (e) => {
                    // Don't drag if clicking close button
                    if (e.target.closest('#view-panel-close')) return;
                    
                    isViewDragging = true;
                    viewDragStartX = e.clientX - viewPanel.offsetLeft;
                    viewDragStartY = e.clientY - viewPanel.offsetTop;
                });
                
                document.addEventListener('mousemove', (e) => {
                    if (isViewDragging) {
                        viewPanel.style.left = (e.clientX - viewDragStartX) + 'px';
                        viewPanel.style.top = (e.clientY - viewDragStartY) + 'px';
                    }
                });
                
                document.addEventListener('mouseup', () => {
                    isViewDragging = false;
                    isViewResizing = false;
                });
            }
            
            // View Panel Resize
            const viewResizeHandle = document.getElementById('view-panel-resize-handle');
            let isViewResizing = false;
            let viewResizeStartX, viewResizeStartY, viewResizeStartWidth, viewResizeStartHeight;
            
            if (viewResizeHandle && viewPanel) {
                viewResizeHandle.addEventListener('mousedown', (e) => {
                    e.stopPropagation();
                    isViewResizing = true;
                    viewResizeStartX = e.clientX;
                    viewResizeStartY = e.clientY;
                    viewResizeStartWidth = viewPanel.offsetWidth;
                    viewResizeStartHeight = viewPanel.offsetHeight;
                });
                
                document.addEventListener('mousemove', (e) => {
                    if (isViewResizing) {
                        const newWidth = viewResizeStartWidth + (e.clientX - viewResizeStartX);
                        const newHeight = viewResizeStartHeight + (e.clientY - viewResizeStartY);
                        viewPanel.style.width = Math.max(300, newWidth) + 'px';
                        viewPanel.style.maxHeight = Math.max(200, newHeight) + 'px';
                    }
                });
            }
            
            // Copy to clipboard functionality
            document.querySelectorAll('.copy-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const field = btn.getAttribute('data-copy');
                    let textToCopy = '';
                    
                    if (field === 'header') {
                        textToCopy = document.getElementById('view-header').textContent;
                    } else if (field === 'body') {
                        textToCopy = document.getElementById('view-body').textContent;
                    } else if (field === 'footer') {
                        textToCopy = document.getElementById('view-footer').textContent;
                    }
                    
                    if (textToCopy && textToCopy !== '') {
                        navigator.clipboard.writeText(textToCopy).then(() => {
                            const originalText = btn.textContent;
                            btn.textContent = ' COPIED';
                            btn.style.background = 'rgba(74, 226, 144, 0.3)';
                            btn.style.borderColor = 'rgba(74, 226, 144, 0.5)';
                            
                            setTimeout(() => {
                                btn.textContent = originalText;
                                btn.style.background = 'rgba(128, 128, 128, 0.3)';
                                btn.style.borderColor = 'rgba(128, 128, 128, 0.5)';
                            }, 2000);
                            
                            playSound('active');
                        });
                    }
                });
            });

            // FAQ panel close
            const faqClose = document.getElementById('faq-close');
            if (faqClose) {
                faqClose.addEventListener('click', () => {
                    document.getElementById('faq-panel').classList.remove('visible');
                });
            }
        }

        function setupMobileControls() {
            const joystickStick = document.getElementById('joystick-stick');
            const joystickBase = joystickStick.parentElement;
            
            // Performance optimization for mobile
            let lastJoystickUpdate = 0;
            const joystickThrottle = 16; // ~60fps max

            // Joystick touch/mouse controls
            joystickStick.addEventListener('mousedown', startJoystick);
            joystickStick.addEventListener('touchstart', startJoystick, { passive: false });

            function startJoystick(e) {
                e.preventDefault();
                joystickActive = true;
                const rect = joystickBase.getBoundingClientRect();
                joystickStartPos = {
                    x: rect.left + rect.width / 2,
                    y: rect.top + rect.height / 2
                };

                document.addEventListener('mousemove', moveJoystick);
                document.addEventListener('touchmove', moveJoystick, { passive: false });
                document.addEventListener('mouseup', stopJoystick);
                document.addEventListener('touchend', stopJoystick);
            }

            function moveJoystick(e) {
                if (!joystickActive) return;
                
                // Throttle updates for performance on mobile
                const now = performance.now();
                if (now - lastJoystickUpdate < joystickThrottle) {
                    return;
                }
                lastJoystickUpdate = now;
                
                e.preventDefault(); // Prevent scrolling on mobile
                
                const clientX = e.touches ? e.touches[0].clientX : e.clientX;
                const clientY = e.touches ? e.touches[0].clientY : e.clientY;

                const deltaX = clientX - joystickStartPos.x;
                const deltaY = clientY - joystickStartPos.y;

                const distance = Math.min(45, Math.sqrt(deltaX * deltaX + deltaY * deltaY));
                const angle = Math.atan2(deltaY, deltaX);

                const maxOffset = 45;
                const offsetX = Math.cos(angle) * distance;
                const offsetY = Math.sin(angle) * distance;

                joystickStick.style.transform = `translate(calc(-50% + ${offsetX}px), calc(-50% + ${offsetY}px))`;

                // Move camera based on joystick
                const moveX = (offsetX / maxOffset) * moveSpeed;
                const moveZ = (offsetY / maxOffset) * moveSpeed;

                camera.position.x += moveX;
                camera.position.z += moveZ;
                cameraTarget.x += moveX;
                cameraTarget.z += moveZ;
            }

            function stopJoystick() {
                joystickActive = false;
                joystickStick.style.transform = 'translate(-50%, -50%)';
                document.removeEventListener('mousemove', moveJoystick);
                document.removeEventListener('touchmove', moveJoystick);
                document.removeEventListener('mouseup', stopJoystick);
                document.removeEventListener('touchend', stopJoystick);
            }

            // Mobile touch for FPS camera look (single finger on canvas)
            const canvas = renderer.domElement;
            let touchStartX = 0;
            let touchStartY = 0;
            let isTouchLooking = false;
            let lastTouchUpdate = 0;
            const touchThrottle = 16; // ~60fps max

            canvas.addEventListener('touchstart', (e) => {
                // Only handle single finger touch for camera look
                if (e.touches.length === 1) {
                    const touch = e.touches[0];
                    touchStartX = touch.clientX;
                    touchStartY = touch.clientY;
                    isTouchLooking = true;
                }
            }, { passive: true });

            canvas.addEventListener('touchmove', (e) => {
                if (isTouchLooking && e.touches.length === 1) {
                    // Throttle for performance
                    const now = performance.now();
                    if (now - lastTouchUpdate < touchThrottle) {
                        return;
                    }
                    lastTouchUpdate = now;
                    
                    e.preventDefault();
                    const touch = e.touches[0];
                    
                    const deltaX = touch.clientX - touchStartX;
                    const deltaY = touch.clientY - touchStartY;
                    
                    touchStartX = touch.clientX;
                    touchStartY = touch.clientY;

                    // Apply FPS-style rotation (same as C key mouse look)
                    if (Math.abs(deltaX) > 0.1 || Math.abs(deltaY) > 0.1) {
                        // Horizontal rotation (yaw)
                        camera.rotateOnWorldAxis(new THREE.Vector3(0, 1, 0), -deltaX * lookSensitivity * 2);
                        
                        // Vertical rotation (pitch)
                        const pitchAxis = new THREE.Vector3(1, 0, 0);
                        const pitchQuaternion = new THREE.Quaternion().setFromAxisAngle(pitchAxis, -deltaY * lookSensitivity * 2);
                        camera.quaternion.multiply(pitchQuaternion);
                        
                        // Clamp pitch
                        const forward = new THREE.Vector3(0, 0, -1);
                        forward.applyQuaternion(camera.quaternion);
                        
                        if (forward.y < -0.99) {
                            const correctionAxis = new THREE.Vector3(1, 0, 0);
                            const correctionQuaternion = new THREE.Quaternion().setFromAxisAngle(correctionAxis, -0.01);
                            camera.quaternion.multiply(correctionQuaternion);
                        } else if (forward.y > 0.99) {
                            const correctionAxis = new THREE.Vector3(1, 0, 0);
                            const correctionQuaternion = new THREE.Quaternion().setFromAxisAngle(correctionAxis, 0.01);
                            camera.quaternion.multiply(correctionQuaternion);
                        }
                    }
                }
            });

            canvas.addEventListener('touchend', () => {
                isTouchLooking = false;
            });

            // Setup RH Joystick
            const rhJoystickStick = document.getElementById('rh-joystick-stick');
            const rhJoystickBase = rhJoystickStick.parentElement;
            let rhJoystickActive = false;
            let rhJoystickStartPos = { x: 0, y: 0 };

            rhJoystickStick.addEventListener('mousedown', startRHJoystick);
            rhJoystickStick.addEventListener('touchstart', startRHJoystick, { passive: false });

            function startRHJoystick(e) {
                e.preventDefault();
                rhJoystickActive = true;
                const rect = rhJoystickBase.getBoundingClientRect();
                rhJoystickStartPos = {
                    x: rect.left + rect.width / 2,
                    y: rect.top + rect.height / 2
                };

                document.addEventListener('mousemove', moveRHJoystick);
                document.addEventListener('touchmove', moveRHJoystick, { passive: false });
                document.addEventListener('mouseup', stopRHJoystick);
                document.addEventListener('touchend', stopRHJoystick);
            }

            function moveRHJoystick(e) {
                if (!rhJoystickActive) return;
                
                const now = performance.now();
                if (now - lastJoystickUpdate < joystickThrottle) {
                    return;
                }
                lastJoystickUpdate = now;
                
                e.preventDefault();
                
                const clientX = e.touches ? e.touches[0].clientX : e.clientX;
                const clientY = e.touches ? e.touches[0].clientY : e.clientY;

                const deltaX = clientX - rhJoystickStartPos.x;
                const deltaY = clientY - rhJoystickStartPos.y;

                const distance = Math.min(45, Math.sqrt(deltaX * deltaX + deltaY * deltaY));
                const angle = Math.atan2(deltaY, deltaX);

                const maxOffset = 45;
                const offsetX = Math.cos(angle) * distance;
                const offsetY = Math.sin(angle) * distance;

                rhJoystickStick.style.transform = `translate(calc(-50% + ${offsetX}px), calc(-50% + ${offsetY}px))`;

                // Move camera based on joystick
                const moveX = (offsetX / maxOffset) * moveSpeed;
                const moveZ = (offsetY / maxOffset) * moveSpeed;

                camera.position.x += moveX;
                camera.position.z += moveZ;
                cameraTarget.x += moveX;
                cameraTarget.z += moveZ;
            }

            function stopRHJoystick() {
                rhJoystickActive = false;
                rhJoystickStick.style.transform = 'translate(-50%, -50%)';
                document.removeEventListener('mousemove', moveRHJoystick);
                document.removeEventListener('touchmove', moveRHJoystick);
                document.removeEventListener('mouseup', stopRHJoystick);
                document.removeEventListener('touchend', stopRHJoystick);
            }

            // Setup CH Joystick
            const chJoystickStick = document.getElementById('ch-joystick-stick');
            const chJoystickBase = chJoystickStick.parentElement;
            let chJoystickActive = false;
            let chJoystickStartPos = { x: 0, y: 0 };

            chJoystickStick.addEventListener('mousedown', startCHJoystick);
            chJoystickStick.addEventListener('touchstart', startCHJoystick, { passive: false });

            function startCHJoystick(e) {
                e.preventDefault();
                chJoystickActive = true;
                const rect = chJoystickBase.getBoundingClientRect();
                chJoystickStartPos = {
                    x: rect.left + rect.width / 2,
                    y: rect.top + rect.height / 2
                };

                document.addEventListener('mousemove', moveCHJoystick);
                document.addEventListener('touchmove', moveCHJoystick, { passive: false });
                document.addEventListener('mouseup', stopCHJoystick);
                document.addEventListener('touchend', stopCHJoystick);
            }

            function moveCHJoystick(e) {
                if (!chJoystickActive) return;
                
                const now = performance.now();
                if (now - lastJoystickUpdate < joystickThrottle) {
                    return;
                }
                lastJoystickUpdate = now;
                
                e.preventDefault();
                
                const clientX = e.touches ? e.touches[0].clientX : e.clientX;
                const clientY = e.touches ? e.touches[0].clientY : e.clientY;

                const deltaX = clientX - chJoystickStartPos.x;
                const deltaY = clientY - chJoystickStartPos.y;

                const distance = Math.min(45, Math.sqrt(deltaX * deltaX + deltaY * deltaY));
                const angle = Math.atan2(deltaY, deltaX);

                const maxOffset = 45;
                const offsetX = Math.cos(angle) * distance;
                const offsetY = Math.sin(angle) * distance;

                chJoystickStick.style.transform = `translate(calc(-50% + ${offsetX}px), calc(-50% + ${offsetY}px))`;

                // Move camera based on joystick
                const moveX = (offsetX / maxOffset) * moveSpeed;
                const moveZ = (offsetY / maxOffset) * moveSpeed;

                camera.position.x += moveX;
                camera.position.z += moveZ;
                cameraTarget.x += moveX;
                cameraTarget.z += moveZ;
            }

            function stopCHJoystick() {
                chJoystickActive = false;
                chJoystickStick.style.transform = 'translate(-50%, -50%)';
                document.removeEventListener('mousemove', moveCHJoystick);
                document.removeEventListener('touchmove', moveCHJoystick);
                document.removeEventListener('mouseup', stopCHJoystick);
                document.removeEventListener('touchend', stopCHJoystick);
            }
        }

        function setupTransformPanel() {
            const transformPanel = document.getElementById('transform-panel');
            const transformClose = document.getElementById('transform-close');
            const transformTitle = document.getElementById('transform-title');
            
            const btnPos = document.getElementById('btn-pos');
            const btnRot = document.getElementById('btn-rot');
            const btnScale = document.getElementById('btn-scale');

            const transformX = document.getElementById('transform-x');
            const transformY = document.getElementById('transform-y');
            const transformZ = document.getElementById('transform-z');
            const stepSize = document.getElementById('step-size');

            transformClose.addEventListener('click', () => {
                transformPanel.style.display = 'none';
                currentTransformMode = null;
                btnPos.classList.remove('active');
                btnRot.classList.remove('active');
                btnScale.classList.remove('active');
            });

            btnPos.addEventListener('click', () => {
                showTransformPanel('POSITION', 'position', btnPos);
            });

            btnRot.addEventListener('click', () => {
                showTransformPanel('ROTATION', 'rotation', btnRot);
            });

            btnScale.addEventListener('click', () => {
                showTransformPanel('SCALE', 'scale', btnScale);
            });

            function showTransformPanel(title, mode, button) {
                transformTitle.textContent = title;
                currentTransformMode = mode;
                transformPanel.style.display = 'block';

                // Update active states
                btnPos.classList.remove('active');
                btnRot.classList.remove('active');
                btnScale.classList.remove('active');
                button.classList.add('active');

                // Update values based on selected object OR camera
                if (selectedObject) {
                    // Object is selected - show object transforms
                    if (mode === 'position') {
                        transformX.value = selectedObject.position.x.toFixed(2);
                        transformY.value = selectedObject.position.y.toFixed(2);
                        transformZ.value = selectedObject.position.z.toFixed(2);
                    } else if (mode === 'rotation') {
                        transformX.value = (selectedObject.rotation.x * 180 / Math.PI).toFixed(2);
                        transformY.value = (selectedObject.rotation.y * 180 / Math.PI).toFixed(2);
                        transformZ.value = (selectedObject.rotation.z * 180 / Math.PI).toFixed(2);
                    } else if (mode === 'scale') {
                        transformX.value = selectedObject.scale.x.toFixed(2);
                        transformY.value = selectedObject.scale.y.toFixed(2);
                        transformZ.value = selectedObject.scale.z.toFixed(2);
                    }
                } else {
                    // Nothing selected - show camera transforms
                    if (mode === 'position') {
                        transformX.value = camera.position.x.toFixed(2);
                        transformY.value = camera.position.y.toFixed(2);
                        transformZ.value = camera.position.z.toFixed(2);
                    } else if (mode === 'rotation') {
                        transformX.value = (camera.rotation.x * 180 / Math.PI).toFixed(2);
                        transformY.value = (camera.rotation.y * 180 / Math.PI).toFixed(2);
                        transformZ.value = (camera.rotation.z * 180 / Math.PI).toFixed(2);
                    } else if (mode === 'scale') {
                        // Camera doesn't have scale, show 1.0
                        transformX.value = '1.00';
                        transformY.value = '1.00';
                        transformZ.value = '1.00';
                    }
                }
            }

            // Apply transform changes
            function applyTransform() {
                if (!currentTransformMode) return;

                const x = parseFloat(transformX.value) || 0;
                const y = parseFloat(transformY.value) || 0;
                const z = parseFloat(transformZ.value) || 0;

                if (selectedObject) {
                    // Apply to selected object
                    if (currentTransformMode === 'position') {
                        selectedObject.position.set(x, y, z);
                    } else if (currentTransformMode === 'rotation') {
                        selectedObject.rotation.set(
                            x * Math.PI / 180,
                            y * Math.PI / 180,
                            z * Math.PI / 180
                        );
                    } else if (currentTransformMode === 'scale') {
                        selectedObject.scale.set(x, y, z);
                    }
                    updateInspectorPanel();
                } else {
                    // Apply to camera (user)
                    if (currentTransformMode === 'position') {
                        camera.position.set(x, y, z);
                    } else if (currentTransformMode === 'rotation') {
                        camera.rotation.set(
                            x * Math.PI / 180,
                            y * Math.PI / 180,
                            z * Math.PI / 180
                        );
                    }
                    // Scale doesn't apply to camera
                }

                playSound('active');
            }

            // Submit button applies changes
            const transformSubmit = document.getElementById('transform-submit');
            transformSubmit.addEventListener('click', () => {
                applyTransform();
            });

            // Arrow keys for fine control (but don't apply immediately)
            [transformX, transformY, transformZ].forEach(input => {
                input.addEventListener('keydown', (e) => {
                    const step = parseFloat(stepSize.value) || 1;
                    const currentValue = parseFloat(input.value) || 0;

                    if (e.key === 'ArrowUp') {
                        e.preventDefault();
                        input.value = (currentValue + step).toFixed(2);
                    } else if (e.key === 'ArrowDown') {
                        e.preventDefault();
                        input.value = (currentValue - step).toFixed(2);
                    } else if (e.key === 'Enter') {
                        e.preventDefault();
                        applyTransform();
                    }
                });
            });
        }

        function setupActionGrid() {
            const actionButtons = document.querySelectorAll('.action-btn');
            
            actionButtons.forEach((btn, index) => {
                btn.addEventListener('click', () => {
                    // Toggle active state
                    btn.classList.toggle('active');
                    
                    // Custom action for each button
                    console.log(`Action button ${index + 1} clicked`);
                    playSound('passive');
                    
                    // You can add specific functionality for each button here
                    // For example, save states, trigger animations, etc.
                });
            });
        }

        function setupHamburgerMenus() {
            const leftHamburger = document.getElementById('left-hamburger');
            const rightHamburger = document.getElementById('right-hamburger');
            const leftMenu = document.getElementById('left-menu');
            const rightMenu = document.getElementById('right-menu');
            const leftBreadcrumb = document.getElementById('left-breadcrumb');
            const rightBreadcrumb = document.getElementById('right-breadcrumb');

            // Toggle left menu
            leftHamburger.addEventListener('click', () => {
                leftMenu.classList.toggle('open');
                leftHamburger.classList.toggle('menu-open');
                playSound('passive');
            });

            // Toggle right menu
            rightHamburger.addEventListener('click', () => {
                rightMenu.classList.toggle('open');
                rightHamburger.classList.toggle('menu-open');
                playSound('passive');
            });

            // Handle menu item clicks for both menus
            const allMenuItems = document.querySelectorAll('.menu-item');
            allMenuItems.forEach(item => {
                const header = item.querySelector('.menu-item-header');
                
                header.addEventListener('click', (e) => {
                    e.stopPropagation();
                    
                    // Toggle submenu expansion
                    item.classList.toggle('expanded');
                    
                    const page = item.getAttribute('data-page');
                    const isLeftMenu = item.closest('#left-menu');
                    const breadcrumb = isLeftMenu ? leftBreadcrumb : rightBreadcrumb;
                    const menuTitle = isLeftMenu ? 'Admin & System' : 'Navigation';
                    
                    // Update breadcrumb
                    const pageName = header.querySelector('span').textContent;
                    breadcrumb.innerHTML = `
                        <span class="breadcrumb-item" data-level="root">${menuTitle}</span>
                        <span class="breadcrumb-separator"></span>
                        <span class="breadcrumb-item breadcrumb-current">${pageName}</span>
                    `;
                    
                    playSound('passive');
                });
            });

            // Handle submenu item clicks
            const allSubmenuItems = document.querySelectorAll('.submenu-item');
            allSubmenuItems.forEach(subitem => {
                subitem.addEventListener('click', (e) => {
                    e.stopPropagation();
                    
                    const submenuId = subitem.getAttribute('data-submenu');
                    
                    // Handle special admin items
                    if (submenuId === 'admin-restart') {
                        document.getElementById('restart-prompt').classList.add('visible');
                        playSound('active');
                        return;
                    }
                    
                    if (submenuId === 'admin-theme') {
                        initThemeSelector();
                        document.getElementById('theme-prompt').classList.add('visible');
                        playSound('active');
                        return;
                    }
                    
                    if (submenuId === 'admin-08') {
                        document.getElementById('particle-behavior-panel').style.display = 'block';
                        playSound('active');
                        return;
                    }
                    
                    if (submenuId === 'myspace') {
                        // Open MySpace Control Panel
                        const myspacePanel = document.getElementById('myspace-panel');
                        if (myspacePanel) {
                            myspacePanel.style.display = 'block';
                            myspacePanel.classList.remove('minimized');
                            const content = document.getElementById('myspace-panel-content');
                            if (content) {
                                content.classList.remove('hidden');
                            }
                            document.getElementById('myspace-minimize-btn').textContent = '_';
                        }
                        playSound('active');
                        return;
                    }
                    
                    if (submenuId === 'system-01') {
                        // Open MySpace Grid Panel
                        document.getElementById('myspace-grid-panel').style.display = 'block';
                        playSound('active');
                        return;
                    }
                    
                    if (submenuId === 'system-11') {
                        // Toggle header bar visibility
                        const headerBar = document.getElementById('header-bar');
                        if (headerBar.style.display === 'none') {
                            headerBar.style.display = 'flex';
                        } else {
                            headerBar.style.display = 'none';
                        }
                        playSound('active');
                        return;
                    }
                    
                    const parentItem = subitem.closest('.menu-item');
                    const page = parentItem.getAttribute('data-page');
                    const isLeftMenu = subitem.closest('#left-menu');
                    const breadcrumb = isLeftMenu ? leftBreadcrumb : rightBreadcrumb;
                    const menuTitle = isLeftMenu ? 'Admin & System' : 'Navigation';
                    const pageName = parentItem.querySelector('.menu-item-header span').textContent;
                    
                    // Update breadcrumb with submenu
                    breadcrumb.innerHTML = `
                        <span class="breadcrumb-item" data-level="root">${menuTitle}</span>
                        <span class="breadcrumb-separator"></span>
                        <span class="breadcrumb-item" data-level="page">${pageName}</span>
                        <span class="breadcrumb-separator"></span>
                        <span class="breadcrumb-item breadcrumb-current">${subitem.textContent}</span>
                    `;
                    
                    playSound('active');
                    
                    console.log('Submenu clicked:', submenuId, 'Parent:', page);
                    // You can add navigation logic here
                });
            });

            // Breadcrumb navigation
            document.addEventListener('click', (e) => {
                if (e.target.classList.contains('breadcrumb-item') && e.target.getAttribute('data-level')) {
                    const level = e.target.getAttribute('data-level');
                    const isLeftMenu = e.target.closest('#left-menu');
                    const breadcrumb = isLeftMenu ? leftBreadcrumb : rightBreadcrumb;
                    const menuTitle = isLeftMenu ? 'Admin & System' : 'Navigation';
                    
                    if (level === 'root') {
                        breadcrumb.innerHTML = `
                            <span class="breadcrumb-item breadcrumb-current">${menuTitle}</span>
                        `;
                        // Collapse all submenus
                        const menu = isLeftMenu ? leftMenu : rightMenu;
                        menu.querySelectorAll('.menu-item').forEach(item => {
                            item.classList.remove('expanded');
                        });
                    } else if (level === 'page') {
                        const pageName = e.target.textContent;
                        breadcrumb.innerHTML = `
                            <span class="breadcrumb-item" data-level="root">${menuTitle}</span>
                            <span class="breadcrumb-separator"></span>
                            <span class="breadcrumb-item breadcrumb-current">${pageName}</span>
                        `;
                    }
                    playSound('passive');
                }
            });

            // Close menus when clicking outside
            document.addEventListener('click', (e) => {
                if (!leftMenu.contains(e.target) && !leftHamburger.contains(e.target)) {
                    leftMenu.classList.remove('open');
                    leftHamburger.classList.remove('menu-open');
                }
                if (!rightMenu.contains(e.target) && !rightHamburger.contains(e.target)) {
                    rightMenu.classList.remove('open');
                    rightHamburger.classList.remove('menu-open');
                }
            });
        }

        function setupDockDragDrop() {
            const dockItems = document.querySelectorAll('.dock-item');
            const docks = document.querySelectorAll('.dock');
            let draggedItem = null;

            dockItems.forEach(item => {
                item.addEventListener('dragstart', (e) => {
                    draggedItem = item;
                    item.classList.add('dragging');
                    e.dataTransfer.effectAllowed = 'move';
                    playSound('hover');
                });

                item.addEventListener('dragend', () => {
                    item.classList.remove('dragging');
                    draggedItem = null;
                });
            });

            docks.forEach(dock => {
                dock.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    e.dataTransfer.dropEffect = 'move';
                    dock.classList.add('drag-over');
                });

                dock.addEventListener('dragleave', () => {
                    dock.classList.remove('drag-over');
                });

                dock.addEventListener('drop', (e) => {
                    e.preventDefault();
                    dock.classList.remove('drag-over');
                    
                    if (draggedItem && draggedItem.parentElement !== dock) {
                        // Remove from old dock
                        draggedItem.parentElement.removeChild(draggedItem);
                        
                        // Add to new dock
                        dock.appendChild(draggedItem);
                        
                        playSound('active');
                    }
                });
            });
        }

        function setupTimer() {
            const timerElement = document.getElementById('session-timer');
            
            function updateTimer() {
                const elapsed = Date.now() - sessionStartTime;
                const hours = Math.floor(elapsed / 3600000);
                const minutes = Math.floor((elapsed % 3600000) / 60000);
                const seconds = Math.floor((elapsed % 60000) / 1000);
                const milliseconds = elapsed % 1000;
                
                timerElement.textContent = 
                    `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}.${milliseconds.toString().padStart(3, '0')}`;
            }
            
            // Update timer every 10ms for smooth milliseconds
            timerInterval = setInterval(updateTimer, 10);
            updateTimer(); // Initial call
        }

        function setupTimezone() {
            const timezoneDisplay = document.getElementById('timezone-display');
            const timezoneSelector = document.getElementById('timezone-selector');
            const currentTimeEl = document.getElementById('current-time');
            const timezoneAbbr = document.getElementById('timezone-abbr');
            const autoDetectBtn = document.getElementById('auto-detect-tz');
            
            let selectedTimezone = localStorage.getItem('userTimezone') || 'America/New_York';
            let timezoneInterval;
            
            const timezoneAbbreviations = {
                'America/New_York': 'EST',
                'America/Chicago': 'CST',
                'America/Denver': 'MST',
                'America/Los_Angeles': 'PST',
                'Europe/London': 'GMT',
                'Europe/Paris': 'CET',
                'Asia/Tokyo': 'JST',
                'Australia/Sydney': 'AEDT'
            };
            
            function updateClock() {
                const now = new Date();
                const options = { 
                    timeZone: selectedTimezone,
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit',
                    hour12: true
                };
                const timeString = now.toLocaleTimeString('en-US', options);
                currentTimeEl.textContent = timeString;
                timezoneAbbr.textContent = timezoneAbbreviations[selectedTimezone] || 'UTC';
            }
            
            // Toggle timezone selector
            timezoneDisplay.addEventListener('click', (e) => {
                e.stopPropagation();
                const isVisible = timezoneSelector.style.display === 'block';
                timezoneSelector.style.display = isVisible ? 'none' : 'block';
                playSound('passive');
            });
            
            // Close selector when clicking outside
            document.addEventListener('click', (e) => {
                if (!timezoneDisplay.contains(e.target)) {
                    timezoneSelector.style.display = 'none';
                }
            });
            
            // Timezone option selection
            document.querySelectorAll('.timezone-option').forEach(option => {
                option.addEventListener('click', () => {
                    selectedTimezone = option.getAttribute('data-tz');
                    localStorage.setItem('userTimezone', selectedTimezone);
                    updateClock();
                    timezoneSelector.style.display = 'none';
                    playSound('active');
                });
                
                // Hover effect
                option.addEventListener('mouseenter', () => {
                    option.style.background = 'rgba(128, 128, 128, 0.3)';
                });
                option.addEventListener('mouseleave', () => {
                    option.style.background = 'transparent';
                });
            });
            
            // Auto-detect timezone
            if (autoDetectBtn) {
                autoDetectBtn.addEventListener('click', () => {
                    try {
                        const detectedTZ = Intl.DateTimeFormat().resolvedOptions().timeZone;
                        selectedTimezone = detectedTZ;
                        localStorage.setItem('userTimezone', detectedTZ);
                        updateClock();
                        timezoneSelector.style.display = 'none';
                        playSound('active');
                        
                        // Show feedback
                        autoDetectBtn.textContent = ` Detected: ${detectedTZ}`;
                        setTimeout(() => {
                            autoDetectBtn.textContent = ' Auto-Detect Location';
                        }, 2000);
                    } catch (error) {
                        console.error('Could not detect timezone', error);
                    }
                });
            }
            
            // Start clock
            updateClock();
            timezoneInterval = setInterval(updateClock, 1000);
        }

        function setupSearchPanel() {
            const searchPanel = document.getElementById('search-panel');
            const searchInput = document.getElementById('search-input');
            
            searchPanel.addEventListener('click', (e) => {
                if (searchPanel.classList.contains('collapsed')) {
                    searchPanel.classList.remove('collapsed');
                    searchPanel.classList.add('expanded');
                    playSound('passive');
                    // Focus input after animation
                    setTimeout(() => searchInput.focus(), 300);
                }
            });
            
            // Click outside to collapse
            document.addEventListener('click', (e) => {
                if (!searchPanel.contains(e.target) && searchPanel.classList.contains('expanded')) {
                    searchPanel.classList.remove('expanded');
                    searchPanel.classList.add('collapsed');
                    searchInput.value = ''; // Clear on collapse
                }
            });
            
            // Search functionality
            searchInput.addEventListener('input', (e) => {
                const query = e.target.value.toLowerCase();
                console.log('Search query:', query);
                // You can add actual search functionality here
            });
            
            // Prevent Enter from closing
            searchInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    console.log('Search submitted:', searchInput.value);
                    // Add search action here
                }
            });
        }

        function animate() {
            requestAnimationFrame(animate);
            
            // FPS tracking
            const currentTime = performance.now();
            const delta = currentTime - lastFrameTime;
            lastFrameTime = currentTime;
            fpsFrames++;
            fpsTime += delta;
            
            if (fpsTime >= 1000) {
                fps = Math.round((fpsFrames * 1000) / fpsTime);
                document.getElementById('fps-counter').textContent = `${fps}`;
                fpsFrames = 0;
                fpsTime = 0;
            }
            
            // Update entrance sequence
            if (isEntranceActive) {
                updateEntranceSequence(delta / 1000);
                renderer.render(scene, camera);
                return; // Skip other updates during entrance
            }
            
            // Performance optimization for mobile/iPad
            const isMobile = window.innerWidth < 1024;
            if (isMobile) {
                // Reduce particle system updates on mobile
                if (Math.random() > 0.5) {
                    // Skip half the particle updates for better performance
                    renderer.render(scene, camera);
                    return;
                }
            }
            
            // Animate particle energy state
            if (particleSystem) {
                // When C key is held (focus mode), make particle tunnel follow mouse
                if (keys.c) {
                    // Convert mouse coordinates to camera-local offset
                    // mouse.x and mouse.y are in range -1 to 1
                    const offsetScale = 5; // How much particles offset from center
                    particleSystem.position.x = mouse.x * offsetScale;
                    particleSystem.position.y = mouse.y * offsetScale;
                } else {
                    // Reset to center when not focusing
                    particleSystem.position.x = 0;
                    particleSystem.position.y = 0;
                }
                
                const positions = particleSystem.geometry.attributes.position.array;
                
                if (particleBehaviorMode === 'calm') {
                    // CALM MODE: Original gentle floating behavior
                    for (let i = 0; i < particleCount; i++) {
                        const i3 = i * 3;
                        
                        // Update positions with gentle movement
                        positions[i3] += particleVelocities[i3];
                        positions[i3 + 1] += particleVelocities[i3 + 1];
                        positions[i3 + 2] += particleVelocities[i3 + 2];
                        
                        // Calculate distance from center
                        const x = positions[i3];
                        const y = positions[i3 + 1];
                        const z = positions[i3 + 2];
                        const distance = Math.sqrt(x * x + y * y + z * z);
                        
                        // Keep particles within sphere bounds (8-12 radius)
                        if (distance > 12 || distance < 8) {
                            // Reverse velocity if hitting boundaries
                            const normalX = x / distance;
                            const normalY = y / distance;
                            const normalZ = z / distance;
                            
                            // Reflect velocity
                            const dot = particleVelocities[i3] * normalX + 
                                       particleVelocities[i3 + 1] * normalY + 
                                       particleVelocities[i3 + 2] * normalZ;
                            
                            particleVelocities[i3] -= 2 * dot * normalX;
                            particleVelocities[i3 + 1] -= 2 * dot * normalY;
                            particleVelocities[i3 + 2] -= 2 * dot * normalZ;
                            
                            // Clamp to boundary
                            const targetRadius = distance > 12 ? 12 : 8;
                            positions[i3] = normalX * targetRadius;
                            positions[i3 + 1] = normalY * targetRadius;
                            positions[i3 + 2] = normalZ * targetRadius;
                        }
                        
                        // Add gentle pulsing effect
                        const pulseSpeed = 0.001;
                        const pulseAmount = Math.sin(Date.now() * pulseSpeed + i * 0.1) * 0.01;
                        positions[i3] *= (1 + pulseAmount);
                        positions[i3 + 1] *= (1 + pulseAmount);
                        positions[i3 + 2] *= (1 + pulseAmount);
                    }
                    
                    // Gentle rotation for calm mode
                    particleSystem.rotation.y += 0.0005;
                    
                } else if (particleBehaviorMode === 'forward') {
                    // FORWARD MODE: Particles flow straight toward user (lightspeed tunnel)
                    const flowSpeed = forwardFlowSpeed * 2;
                    
                    for (let i = 0; i < particleCount; i++) {
                        const i3 = i * 3;
                        
                        // Move particles straight toward camera (negative Z in camera space)
                        positions[i3 + 2] -= flowSpeed;
                        
                        // Reset particles that pass through camera
                        if (positions[i3 + 2] < -5) {
                            // Respawn at far edge in CIRCULAR pattern (tunnel effect)
                            const angle = Math.random() * Math.PI * 2;
                            const radius = Math.sqrt(Math.random()) * 10; // Circular distribution
                            
                            positions[i3] = Math.cos(angle) * radius; // X position
                            positions[i3 + 1] = Math.sin(angle) * radius; // Y position
                            positions[i3 + 2] = 15; // Far Z edge
                        }
                    }
                    
                } else if (particleBehaviorMode === 'backward') {
                    // BACKWARD MODE: Particles flow away from user (reverse tunnel)
                    const flowSpeed = backwardFlowSpeed * 2;
                    
                    for (let i = 0; i < particleCount; i++) {
                        const i3 = i * 3;
                        
                        // Move particles away from camera (positive Z)
                        positions[i3 + 2] += flowSpeed;
                        
                        // Reset particles that go too far
                        if (positions[i3 + 2] > 15) {
                            // Respawn at near edge in CIRCULAR pattern (tunnel effect)
                            const angle = Math.random() * Math.PI * 2;
                            const radius = Math.sqrt(Math.random()) * 10; // Circular distribution
                            
                            positions[i3] = Math.cos(angle) * radius; // X position
                            positions[i3 + 1] = Math.sin(angle) * radius; // Y position
                            positions[i3 + 2] = -5; // Near Z edge
                        }
                    }
                    
                } else if (particleBehaviorMode === 'upward') {
                    // UPWARD MODE: Particles rise upward
                    const flowSpeed = upwardFlowSpeed * 2;
                    
                    for (let i = 0; i < particleCount; i++) {
                        const i3 = i * 3;
                        
                        // Move particles upward (positive Y)
                        positions[i3 + 1] += flowSpeed;
                        
                        // Reset particles that go too far
                        if (positions[i3 + 1] > 30) {
                            // Respawn at bottom in XZ plane
                            positions[i3] = (Math.random() - 0.5) * 50; // X position
                            positions[i3 + 1] = -30; // Bottom Y edge
                            positions[i3 + 2] = (Math.random() - 0.5) * 50; // Z position
                        }
                    }
                    
                } else if (particleBehaviorMode === 'downward') {
                    // DOWNWARD MODE: Particles fall downward
                    const flowSpeed = downwardFlowSpeed * 2;
                    
                    for (let i = 0; i < particleCount; i++) {
                        const i3 = i * 3;
                        
                        // Move particles downward (negative Y)
                        positions[i3 + 1] -= flowSpeed;
                        
                        // Reset particles that go too far
                        if (positions[i3 + 1] < -30) {
                            // Respawn at top in XZ plane
                            positions[i3] = (Math.random() - 0.5) * 50; // X position
                            positions[i3 + 1] = 30; // Top Y edge
                            positions[i3 + 2] = (Math.random() - 0.5) * 50; // Z position
                        }
                    }
                    
                } else if (particleBehaviorMode === 'connected') {
                    // CONNECTED MODE: Draw lines between nearby particles (particles.js style)
                    // First do gentle float like CALM
                    for (let i = 0; i < particleCount; i++) {
                        const i3 = i * 3;
                        
                        positions[i3] += particleVelocities[i3];
                        positions[i3 + 1] += particleVelocities[i3 + 1];
                        positions[i3 + 2] += particleVelocities[i3 + 2];
                        
                        const x = positions[i3];
                        const y = positions[i3 + 1];
                        const z = positions[i3 + 2];
                        const distance = Math.sqrt(x * x + y * y + z * z);
                        
                        if (distance > 12 || distance < 8) {
                            const normalX = x / distance;
                            const normalY = y / distance;
                            const normalZ = z / distance;
                            
                            const dot = particleVelocities[i3] * normalX + 
                                       particleVelocities[i3 + 1] * normalY + 
                                       particleVelocities[i3 + 2] * normalZ;
                            
                            particleVelocities[i3] -= 2 * dot * normalX;
                            particleVelocities[i3 + 1] -= 2 * dot * normalY;
                            particleVelocities[i3 + 2] -= 2 * dot * normalZ;
                            
                            const targetRadius = distance > 12 ? 12 : 8;
                            positions[i3] = normalX * targetRadius;
                            positions[i3 + 1] = normalY * targetRadius;
                            positions[i3 + 2] = normalZ * targetRadius;
                        }
                    }
                    
                    // Draw connection lines
                    // Remove old lines if they exist
                    if (window.particleLines) {
                        scene.remove(window.particleLines);
                        window.particleLines.geometry.dispose();
                        window.particleLines.material.dispose();
                    }
                    
                    const lineGeometry = new THREE.BufferGeometry();
                    const linePositions = [];
                    const maxDistance = 5 * connectionFrequency; // Frequency affects connection distance
                    
                    // Check connections between particles
                    for (let i = 0; i < particleCount; i++) {
                        const i3 = i * 3;
                        const x1 = positions[i3];
                        const y1 = positions[i3 + 1];
                        const z1 = positions[i3 + 2];
                        
                        // Only check a subset of particles for performance
                        const checkCount = Math.floor(10 * connectionFrequency) + 1;
                        for (let j = 0; j < checkCount; j++) {
                            const randomIdx = Math.floor(Math.random() * particleCount);
                            if (randomIdx === i) continue;
                            
                            const j3 = randomIdx * 3;
                            const x2 = positions[j3];
                            const y2 = positions[j3 + 1];
                            const z2 = positions[j3 + 2];
                            
                            const dx = x2 - x1;
                            const dy = y2 - y1;
                            const dz = z2 - z1;
                            const dist = Math.sqrt(dx * dx + dy * dy + dz * dz);
                            
                            if (dist < maxDistance) {
                                linePositions.push(x1, y1, z1);
                                linePositions.push(x2, y2, z2);
                            }
                        }
                    }
                    
                    if (linePositions.length > 0) {
                        lineGeometry.setAttribute('position', new THREE.Float32BufferAttribute(linePositions, 3));
                        const lineMaterial = new THREE.LineBasicMaterial({
                            color: 0xffffff,
                            opacity: 0.3 * connectionFrequency,
                            transparent: true,
                            blending: THREE.AdditiveBlending
                        });
                        window.particleLines = new THREE.LineSegments(lineGeometry, lineMaterial);
                        camera.add(window.particleLines); // Attach to camera like particles
                    }
                    
                    particleSystem.rotation.y += 0.0003;
                    
                } else if (particleBehaviorMode === 'glitch') {
                    // GLITCH MODE: Random teleportation/glitch effect
                    const glitchChance = glitchIntensity * 0.1; // Higher intensity = more glitches
                    const glitchDistance = glitchIntensity * 5; // How far particles can teleport
                    
                    for (let i = 0; i < particleCount; i++) {
                        const i3 = i * 3;
                        
                        // Random chance to glitch
                        if (Math.random() < glitchChance) {
                            // Teleport to random nearby position
                            const angle = Math.random() * Math.PI * 2;
                            const radius = Math.sqrt(Math.random()) * glitchDistance;
                            const zOffset = (Math.random() - 0.5) * glitchDistance;
                            
                            positions[i3] += Math.cos(angle) * radius;
                            positions[i3 + 1] += Math.sin(angle) * radius;
                            positions[i3 + 2] += zOffset;
                        } else {
                            // Normal gentle movement
                            positions[i3] += particleVelocities[i3] * 0.5;
                            positions[i3 + 1] += particleVelocities[i3 + 1] * 0.5;
                            positions[i3 + 2] += particleVelocities[i3 + 2] * 0.5;
                        }
                        
                        // Keep in bounds
                        const x = positions[i3];
                        const y = positions[i3 + 1];
                        const z = positions[i3 + 2];
                        const distance = Math.sqrt(x * x + y * y + z * z);
                        
                        if (distance > 12) {
                            const normalX = x / distance;
                            const normalY = y / distance;
                            const normalZ = z / distance;
                            positions[i3] = normalX * 12;
                            positions[i3 + 1] = normalY * 12;
                            positions[i3 + 2] = normalZ * 12;
                        }
                    }
                    
                    // Jittery rotation
                    particleSystem.rotation.y += (Math.random() - 0.5) * 0.01 * glitchIntensity;
                    
                } else if (particleBehaviorMode === 'constellation') {
                    // CONSTELLATION MODE: Random connections between all particles
                    // Gentle float like CALM
                    for (let i = 0; i < particleCount; i++) {
                        const i3 = i * 3;
                        
                        positions[i3] += particleVelocities[i3];
                        positions[i3 + 1] += particleVelocities[i3 + 1];
                        positions[i3 + 2] += particleVelocities[i3 + 2];
                        
                        const x = positions[i3];
                        const y = positions[i3 + 1];
                        const z = positions[i3 + 2];
                        const distance = Math.sqrt(x * x + y * y + z * z);
                        
                        if (distance > 12 || distance < 8) {
                            const normalX = x / distance;
                            const normalY = y / distance;
                            const normalZ = z / distance;
                            
                            const dot = particleVelocities[i3] * normalX + 
                                       particleVelocities[i3 + 1] * normalY + 
                                       particleVelocities[i3 + 2] * normalZ;
                            
                            particleVelocities[i3] -= 2 * dot * normalX;
                            particleVelocities[i3 + 1] -= 2 * dot * normalY;
                            particleVelocities[i3 + 2] -= 2 * dot * normalZ;
                            
                            const targetRadius = distance > 12 ? 12 : 8;
                            positions[i3] = normalX * targetRadius;
                            positions[i3 + 1] = normalY * targetRadius;
                            positions[i3 + 2] = normalZ * targetRadius;
                        }
                    }
                    
                    // Draw random constellation lines
                    if (window.particleLines) {
                        scene.remove(window.particleLines);
                        window.particleLines.geometry.dispose();
                        window.particleLines.material.dispose();
                    }
                    
                    const lineGeometry = new THREE.BufferGeometry();
                    const linePositions = [];
                    
                    // Each particle randomly connects to a few nearby particles
                    for (let i = 0; i < particleCount; i++) {
                        const i3 = i * 3;
                        const x1 = positions[i3];
                        const y1 = positions[i3 + 1];
                        const z1 = positions[i3 + 2];
                        
                        // Random number of connections per particle (1-3)
                        const connectionCount = Math.floor(Math.random() * 3) + 1;
                        
                        for (let c = 0; c < connectionCount; c++) {
                            const randomIdx = Math.floor(Math.random() * particleCount);
                            if (randomIdx === i) continue;
                            
                            const j3 = randomIdx * 3;
                            const x2 = positions[j3];
                            const y2 = positions[j3 + 1];
                            const z2 = positions[j3 + 2];
                            
                            const dx = x2 - x1;
                            const dy = y2 - y1;
                            const dz = z2 - z1;
                            const dist = Math.sqrt(dx * dx + dy * dy + dz * dz);
                            
                            if (dist < constellationDistance) {
                                linePositions.push(x1, y1, z1);
                                linePositions.push(x2, y2, z2);
                            }
                        }
                    }
                    
                    if (linePositions.length > 0) {
                        lineGeometry.setAttribute('position', new THREE.Float32BufferAttribute(linePositions, 3));
                        const lineMaterial = new THREE.LineBasicMaterial({
                            color: 0xffffff,
                            opacity: 0.2,
                            transparent: true,
                            blending: THREE.AdditiveBlending
                        });
                        window.particleLines = new THREE.LineSegments(lineGeometry, lineMaterial);
                        camera.add(window.particleLines); // Attach to camera like particles
                    }
                }
                
                particleSystem.geometry.attributes.position.needsUpdate = true;
            }
            
            // Camera breathing effect - enhanced for more pronounced feel
            breathTime += 0.016 * breathSpeed; // Assuming ~60fps
            const breathOffset = Math.sin(breathTime) * breathIntensity;
            const breathRotation = Math.sin(breathTime * 1.3) * 0.003; // Slight tilt
            
            // Apply breathing to camera position (up/down)
            if (!keys.r && !keys.f) { // Only when not manually moving up/down
                const breathDelta = breathOffset - (camera.userData.lastBreathOffset || 0);
                camera.position.y += breathDelta;
                camera.userData.lastBreathOffset = breathOffset;
            } else {
                camera.userData.lastBreathOffset = 0;
            }
            
            // Apply subtle rotation breathing (slight tilt)
            if (!keys.c) { // Only when not using mouse look
                camera.rotation.z = breathRotation;
            }
            
            // Check if 3D data panel is active
            const has3DPanel = scene3DDataPanel && scene3DDataPanel.userData.is3DPanel;
            
            // WASD camera movement (or 3D panel scrolling if active)
            if (keys.w) {
                if (has3DPanel) {
                    // Scroll 3D panel up
                    if (window.scroll3DPanel) window.scroll3DPanel(-1);
                } else {
                    const forward = new THREE.Vector3(0, 0, -1);
                    forward.applyQuaternion(camera.quaternion);
                    camera.position.add(forward.multiplyScalar(moveSpeed));
                }
            }
            if (keys.s) {
                if (has3DPanel) {
                    // Scroll 3D panel down
                    if (window.scroll3DPanel) window.scroll3DPanel(1);
                } else {
                    const backward = new THREE.Vector3(0, 0, 1);
                    backward.applyQuaternion(camera.quaternion);
                    camera.position.add(backward.multiplyScalar(moveSpeed));
                }
            }
            if (keys.a) {
                const left = new THREE.Vector3(-1, 0, 0);
                left.applyQuaternion(camera.quaternion);
                camera.position.add(left.multiplyScalar(moveSpeed));
            }
            if (keys.d) {
                const right = new THREE.Vector3(1, 0, 0);
                right.applyQuaternion(camera.quaternion);
                camera.position.add(right.multiplyScalar(moveSpeed));
            }
            if (keys.r) {
                camera.position.y += moveSpeed;
            }
            if (keys.f) {
                camera.position.y -= moveSpeed;
            }
            
            // Update inspector panel in real-time if object is selected
            if (selectedObject && document.getElementById('inspector-panel').classList.contains('visible')) {
                document.getElementById('object-position').textContent = 
                    `X: ${selectedObject.position.x.toFixed(2)} | Y: ${selectedObject.position.y.toFixed(2)} | Z: ${selectedObject.position.z.toFixed(2)}`;
                document.getElementById('object-rotation').textContent = 
                    `X: ${(selectedObject.rotation.x * 180 / Math.PI).toFixed(2)} | Y: ${(selectedObject.rotation.y * 180 / Math.PI).toFixed(2)} | Z: ${(selectedObject.rotation.z * 180 / Math.PI).toFixed(2)}`;
                document.getElementById('object-scale').textContent = 
                    `X: ${selectedObject.scale.x.toFixed(2)} | Y: ${selectedObject.scale.y.toFixed(2)} | Z: ${selectedObject.scale.z.toFixed(2)}`;
            }
            
            // Update coordinate guide in navbar
            document.getElementById('coord-pos-x').textContent = `X: ${camera.position.x.toFixed(2)}`;
            document.getElementById('coord-pos-y').textContent = `Y: ${camera.position.y.toFixed(2)}`;
            document.getElementById('coord-pos-z').textContent = `Z: ${camera.position.z.toFixed(2)}`;
            
            const rotX = (camera.rotation.x * 180 / Math.PI).toFixed(2);
            const rotY = (camera.rotation.y * 180 / Math.PI).toFixed(2);
            const rotZ = (camera.rotation.z * 180 / Math.PI).toFixed(2);
            document.getElementById('coord-rot-x').textContent = `X: ${rotX}`;
            document.getElementById('coord-rot-y').textContent = `Y: ${rotY}`;
            document.getElementById('coord-rot-z').textContent = `Z: ${rotZ}`;
            
            document.getElementById('coord-sca-x').textContent = `X: ${camera.scale.x.toFixed(2)}`;
            document.getElementById('coord-sca-y').textContent = `Y: ${camera.scale.y.toFixed(2)}`;
            document.getElementById('coord-sca-z').textContent = `Z: ${camera.scale.z.toFixed(2)}`;
            
            // Update ruler markers
            const xMarker = document.getElementById('x-marker');
            const yMarker = document.getElementById('y-marker');
            const zMarker = document.getElementById('z-marker');
            if (xMarker && yMarker && zMarker) {
                // Map camera position (-50 to +50) to ruler position (0% to 100%)
                const xPercent = ((camera.position.x + 50) / 100) * 100;
                const yPercent = ((camera.position.y + 50) / 100) * 100;
                const zPercent = ((camera.position.z + 50) / 100) * 100;
                xMarker.style.left = Math.max(0, Math.min(100, xPercent)) + '%';
                yMarker.style.top = Math.max(0, Math.min(100, 100 - yPercent)) + '%'; // Inverted for visual consistency
                zMarker.style.top = Math.max(0, Math.min(100, 100 - zPercent)) + '%'; // Inverted for visual consistency
            }
            
            // MyZone: Lock grid to camera view
            if (window.myzoneLocked && mySpaceGroup) {
                mySpaceGroup.position.copy(camera.position);
                mySpaceGroup.position.z -= 30; // 30 units in front of camera
                mySpaceGroup.quaternion.copy(camera.quaternion);
            }
            
            // Sphere Auto-Rotation
            if (window.mySpaceSphere) {
                const rotationSpeed = 0.005; // Slow continuous rotation
                
                if (sphereRotateX) {
                    window.mySpaceSphere.rotation.x += rotationSpeed;
                }
                if (sphereRotateY) {
                    window.mySpaceSphere.rotation.y += rotationSpeed;
                }
                if (sphereRotateZ) {
                    window.mySpaceSphere.rotation.z += rotationSpeed;
                }
            }
            
            renderer.render(scene, camera);
        }

        // Start
        init();

        // Make functions globally accessible for inline handlers
        window.showWisdomPrompt = showWisdomPrompt;
    </script>
    <!-- Chat Button -->
    <div id="chat-button" style="position: fixed; bottom: 20px; right: 120px; width: 60px; height: 60px; background: rgba(25, 25, 30, 0.85); border: 2px solid rgba(128, 128, 128, 0.5); border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; backdrop-filter: blur(20px); z-index: 1000; transition: all 0.3s; font-size: 24px;">
        
    </div>

    <!-- Chat Panel -->
    <div id="chat-panel" style="display: none; position: fixed; bottom: 90px; right: 120px; width: 350px; height: 450px; background: rgba(25, 25, 30, 0.95); backdrop-filter: blur(20px); border: 1px solid rgba(128, 128, 128, 0.5); border-radius: 16px; z-index: 1001; padding: 0; overflow: hidden;">
        <div id="chat-panel-header" style="padding: 16px; background: rgba(128, 128, 128, 0.2); border-bottom: 1px solid rgba(128, 128, 128, 0.3); display: flex; justify-content: space-between; align-items: center; cursor: move; user-select: none;">
            <span style="font-family: 'Orbitron', sans-serif; font-weight: 600; font-size: 14px;"> CHAT</span>
            <button id="chat-close" style="background: none; border: none; color: #fff; font-size: 20px; cursor: pointer; padding: 0; line-height: 1;"></button>
        </div>
        <div id="chat-messages" style="height: calc(100% - 120px); overflow-y: auto; padding: 16px;">
            <div style="text-align: center; color: rgba(255, 255, 255, 0.5); font-size: 12px; margin-top: 40px;">
                Chat functionality coming soon...
            </div>
        </div>
        <div style="padding: 16px; border-top: 1px solid rgba(128, 128, 128, 0.3);">
            <input type="text" id="chat-input" placeholder="Type a message..." style="width: 100%; padding: 10px; background: rgba(128, 128, 128, 0.2); border: 1px solid rgba(128, 128, 128, 0.3); border-radius: 8px; color: #fff; font-family: 'Orbitron', sans-serif; font-size: 12px;">
        </div>
    </div>

    <!-- Side Tray for Minimized Windows -->
    <div id="side-tray" style="display: none; position: fixed; left: 20px; top: 140px; bottom: 100px; width: 60px; background: rgba(25, 25, 30, 0.3); backdrop-filter: blur(10px); border: 1px solid rgba(128, 128, 128, 0.2); border-radius: 12px; z-index: 900; padding: 8px; overflow-y: auto;">
        <div style="font-size: 9px; color: rgba(255, 255, 255, 0.5); text-align: center; margin-bottom: 8px; font-family: 'Orbitron', sans-serif; writing-mode: vertical-rl; text-orientation: mixed;">TRAY</div>
        <div id="side-tray-content" style="display: flex; flex-direction: column; gap: 6px;"></div>
    </div>

    <!-- Top Tray Holder -->
    <div id="top-tray" style="display: none; position: fixed; top: 75px; left: 50%; transform: translateX(-50%); width: 300px; height: 60px; background: rgba(25, 25, 30, 0.3); backdrop-filter: blur(10px); border: 1px solid rgba(128, 128, 128, 0.2); border-radius: 12px; z-index: 900; padding: 10px; gap: 8px; justify-content: center; align-items: center;">
        <div id="top-tray-content" style="display: flex; gap: 8px;"></div>
    </div>

</body>
</html>

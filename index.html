<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Journal Viewer</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
</head>
<body>
<div id="canvas-container"></div>

<!-- Compact Header Bar -->
<div id="header-bar" style="position: fixed; top: 10px; left: 20px; right: 20px; height: 60px; background: rgba(25, 25, 30, 0.85); backdrop-filter: blur(20px); border: 1px solid rgba(128, 128, 128, 0.3); border-radius: 12px; padding: 8px 16px; z-index: 1000; display: flex; align-items: center; gap: 8px;">
    
    <!-- Profile Picture -->
    <div id="profile-image-container" style="width: 44px; height: 44px; border-radius: 50%; border: 2px solid rgba(128, 128, 128, 0.5); overflow: hidden; cursor: pointer; background: rgba(128, 128, 128, 0.2); display: flex; align-items: center; justify-content: center; font-size: 24px; color: rgba(128, 128, 128, 0.8); flex-shrink: 0;">
        üë§
    </div>
    <input type="file" id="profile-image-input" accept="image/*" style="display: none;">
    
    <!-- User Info Column -->
    <div style="display: flex; flex-direction: column; gap: 2px; min-width: 150px;">
        <div style="display: flex; align-items: center; gap: 6px;">
            <span style="font-size: 11px; color: rgba(255, 255, 255, 0.6); font-weight: 600;">USER:</span>
            <div id="header-username" contenteditable="true" style="font-size: 12px; font-weight: 700; color: #fff; border: 1px solid transparent; padding: 2px 4px; border-radius: 3px; outline: none; cursor: text;">undefined</div>
        </div>
        <div id="header-description" contenteditable="true" style="font-size: 10px; color: rgba(255, 255, 255, 0.5); border: 1px solid transparent; padding: 2px 4px; border-radius: 3px; outline: none; cursor: text; min-width: 100px;">Add description...</div>
    </div>
    
    <!-- Divider -->
    <div style="width: 1px; height: 40px; background: rgba(128, 128, 128, 0.2); flex-shrink: 0;"></div>
    
    <!-- Primary Space Info Column -->
    <div style="display: flex; flex-direction: column; gap: 4px; min-width: 140px;">
        <div style="font-size: 9px; font-weight: 700; color: #fff; letter-spacing: 0.5px; margin-bottom: 2px; text-shadow: 0 0 10px rgba(255, 255, 255, 0.8), 0 0 20px rgba(255, 255, 255, 0.5);">PRIMARY SPACE</div>
        <div style="display: flex; flex-direction: column; gap: 2px;">
            <div id="session-timer" style="font-size: 11px; font-weight: 700; color: #fff; font-family: 'Courier New', monospace;">00:00:00.000</div>
            <div id="timezone-display" style="font-size: 10px; font-weight: 700; color: #fff; cursor: pointer; position: relative; font-family: 'Courier New', monospace; text-shadow: 0 0 10px rgba(255, 255, 255, 0.8), 0 0 20px rgba(255, 255, 255, 0.5);">
                <span id="current-time">--:--:-- --</span>
                <span id="timezone-abbr" style="margin-left: 4px;">EST</span>
            </div>
            <!-- Timezone Selector Dropdown -->
            <div id="timezone-selector" style="display: none; position: absolute; top: 100%; left: 0; background: rgba(25, 25, 30, 0.95); border: 1px solid rgba(128, 128, 128, 0.3); border-radius: 8px; padding: 8px; min-width: 200px; max-height: 300px; overflow-y: auto; z-index: 10000; backdrop-filter: blur(20px); box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);">
                <div style="font-size: 10px; font-weight: 700; color: #fff; margin-bottom: 8px; padding-bottom: 4px; border-bottom: 1px solid rgba(128, 128, 128, 0.2);">SELECT TIMEZONE</div>
                <div class="timezone-option" data-tz="America/New_York" style="padding: 6px; cursor: pointer; font-size: 10px; color: rgba(255, 255, 255, 0.8); border-radius: 4px;">EST - Eastern</div>
                <div class="timezone-option" data-tz="America/Chicago" style="padding: 6px; cursor: pointer; font-size: 10px; color: rgba(255, 255, 255, 0.8); border-radius: 4px;">CST - Central</div>
                <div class="timezone-option" data-tz="America/Denver" style="padding: 6px; cursor: pointer; font-size: 10px; color: rgba(255, 255, 255, 0.8); border-radius: 4px;">MST - Mountain</div>
                <div class="timezone-option" data-tz="America/Los_Angeles" style="padding: 6px; cursor: pointer; font-size: 10px; color: rgba(255, 255, 255, 0.8); border-radius: 4px;">PST - Pacific</div>
                <div class="timezone-option" data-tz="Europe/London" style="padding: 6px; cursor: pointer; font-size: 10px; color: rgba(255, 255, 255, 0.8); border-radius: 4px;">GMT - London</div>
                <div class="timezone-option" data-tz="Europe/Paris" style="padding: 6px; cursor: pointer; font-size: 10px; color: rgba(255, 255, 255, 0.8); border-radius: 4px;">CET - Paris</div>
                <div class="timezone-option" data-tz="Asia/Tokyo" style="padding: 6px; cursor: pointer; font-size: 10px; color: rgba(255, 255, 255, 0.8); border-radius: 4px;">JST - Tokyo</div>
                <div class="timezone-option" data-tz="Australia/Sydney" style="padding: 6px; cursor: pointer; font-size: 10px; color: rgba(255, 255, 255, 0.8); border-radius: 4px;">AEDT - Sydney</div>
                <div style="margin-top: 8px; padding-top: 8px; border-top: 1px solid rgba(128, 128, 128, 0.2);">
                    <div id="auto-detect-tz" style="padding: 6px; cursor: pointer; font-size: 10px; color: rgba(74, 144, 226, 0.9); border-radius: 4px; text-align: center;">üåê Auto-Detect Location</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Divider -->
    <div style="width: 1px; height: 40px; background: rgba(128, 128, 128, 0.2); flex-shrink: 0;"></div>
    
    <!-- Coordinate Guide: Position -->
    <div style="display: flex; flex-direction: column; gap: 2px; min-width: 90px;">
        <div style="font-size: 8px; font-weight: 700; color: #fff; letter-spacing: 0.5px; text-shadow: 0 0 10px rgba(255, 255, 255, 0.8), 0 0 20px rgba(255, 255, 255, 0.5);">POS</div>
        <div style="font-family: 'Courier New', monospace; font-size: 9px; color: rgba(255, 255, 255, 0.8);">
            <div id="coord-pos-x">X: 0.00</div>
            <div id="coord-pos-y">Y: 0.00</div>
            <div id="coord-pos-z">Z: 0.00</div>
        </div>
    </div>
    
    <!-- Coordinate Guide: Rotation -->
    <div style="display: flex; flex-direction: column; gap: 2px; min-width: 90px;">
        <div style="font-size: 8px; font-weight: 700; color: #fff; letter-spacing: 0.5px; text-shadow: 0 0 10px rgba(255, 255, 255, 0.8), 0 0 20px rgba(255, 255, 255, 0.5);">ROT</div>
        <div style="font-family: 'Courier New', monospace; font-size: 9px; color: rgba(255, 255, 255, 0.8);">
            <div id="coord-rot-x">X: 0.00¬∞</div>
            <div id="coord-rot-y">Y: 0.00¬∞</div>
            <div id="coord-rot-z">Z: 0.00¬∞</div>
        </div>
    </div>
    
    <!-- Coordinate Guide: Scale -->
    <div style="display: flex; flex-direction: column; gap: 2px; min-width: 90px;">
        <div style="font-size: 8px; font-weight: 700; color: #fff; letter-spacing: 0.5px; text-shadow: 0 0 10px rgba(255, 255, 255, 0.8), 0 0 20px rgba(255, 255, 255, 0.5);">SCA</div>
        <div style="font-family: 'Courier New', monospace; font-size: 9px; color: rgba(255, 255, 255, 0.8);">
            <div id="coord-sca-x">X: 1.00</div>
            <div id="coord-sca-y">Y: 1.00</div>
            <div id="coord-sca-z">Z: 1.00</div>
        </div>
    </div>
    
    <!-- Divider -->
    <div style="width: 1px; height: 40px; background: rgba(128, 128, 128, 0.2); flex-shrink: 0;"></div>
    
    <!-- FPS Column -->
    <div style="display: flex; flex-direction: column; gap: 2px; min-width: 60px;">
        <div style="font-size: 8px; font-weight: 700; color: #fff; letter-spacing: 0.5px; text-shadow: 0 0 10px rgba(255, 255, 255, 0.8), 0 0 20px rgba(255, 255, 255, 0.5);">FPS</div>
        <div style="font-family: 'Courier New', monospace; font-size: 11px; color: rgba(255, 255, 255, 0.9);">
            <div id="fps-counter">60</div>
        </div>
    </div>
    
    <!-- Divider -->
    <div style="width: 1px; height: 40px; background: rgba(128, 128, 128, 0.2); flex-shrink: 0;"></div>
    
    <!-- System Column -->
    <div style="display: flex; flex-direction: column; gap: 2px; min-width: 110px;">
        <div style="font-size: 8px; font-weight: 700; color: #fff; letter-spacing: 0.5px; text-shadow: 0 0 10px rgba(255, 255, 255, 0.8), 0 0 20px rgba(255, 255, 255, 0.5);">SYSTEM</div>
        <div style="font-family: 'Courier New', monospace; font-size: 9px; color: rgba(255, 255, 255, 0.8);">
            <div style="display: flex; justify-content: space-between;">
                <span>Root:</span>
                <span id="root-system" style="color: #fff; text-shadow: 0 0 10px rgba(255, 255, 255, 0.8), 0 0 20px rgba(255, 255, 255, 0.5);">default</span>
            </div>
            <div style="display: flex; justify-content: space-between;">
                <span>Parent:</span>
                <span id="parent-system" style="color: #fff; text-shadow: 0 0 10px rgba(255, 255, 255, 0.8), 0 0 20px rgba(255, 255, 255, 0.5);">default</span>
            </div>
            <div style="display: flex; justify-content: space-between;">
                <span>Child:</span>
                <span id="child-system" style="color: #fff; text-shadow: 0 0 10px rgba(255, 255, 255, 0.8), 0 0 20px rgba(255, 255, 255, 0.5);">default</span>
            </div>
        </div>
    </div>
    
    <!-- Divider -->
    <div style="width: 1px; height: 40px; background: rgba(128, 128, 128, 0.2); flex-shrink: 0;"></div>
    
    <!-- Dimensional Column -->
    <div style="display: flex; flex-direction: column; gap: 2px; min-width: 110px;">
        <div style="font-size: 8px; font-weight: 700; color: #fff; letter-spacing: 0.5px; text-shadow: 0 0 10px rgba(255, 255, 255, 0.8), 0 0 20px rgba(255, 255, 255, 0.5);">DIMENSIONAL</div>
        <div style="font-family: 'Courier New', monospace; font-size: 9px; color: rgba(255, 255, 255, 0.8);">
            <div style="display: flex; justify-content: space-between;">
                <span>Exp:</span>
                <span id="dimensional-experience" style="color: #fff; text-shadow: 0 0 10px rgba(255, 255, 255, 0.8), 0 0 20px rgba(255, 255, 255, 0.5);">undefined</span>
            </div>
            <div style="display: flex; justify-content: space-between;">
                <span>Per:</span>
                <span id="dimensional-perspective" style="color: #fff; text-shadow: 0 0 10px rgba(255, 255, 255, 0.8), 0 0 20px rgba(255, 255, 255, 0.5);">undefined</span>
            </div>
            <div style="display: flex; justify-content: space-between;">
                <span>Time:</span>
                <span id="dimensional-time" style="color: #fff; text-shadow: 0 0 10px rgba(255, 255, 255, 0.8), 0 0 20px rgba(255, 255, 255, 0.5);">undefined</span>
            </div>
            <div style="display: flex; justify-content: space-between;">
                <span>Space:</span>
                <span id="dimensional-space" style="color: #fff; text-shadow: 0 0 10px rgba(255, 255, 255, 0.8), 0 0 20px rgba(255, 255, 255, 0.5);">undefined</span>
            </div>
        </div>
    </div>
</div>

<!-- Top Right Search Panel -->
<div id="search-panel" class="collapsed">
    <div class="search-icon">üîç</div>
    <div class="search-content">
        <input type="text" class="search-input" placeholder="Search..." id="search-input">
    </div>
</div>

<!-- Camera Rotation Circle -->
<div id="camera-circle"></div>

<!-- Hamburger Menu Buttons -->
<div class="hamburger-btn" id="left-hamburger">
    <span></span>
    <span></span>
    <span></span>
</div>

<div class="hamburger-btn" id="right-hamburger">
    <span></span>
    <span></span>
    <span></span>
</div>

<!-- Left Side Menu (Admin/System) -->
<div class="side-menu" id="left-menu">
    <div class="menu-header">
        <div class="menu-title">ADMIN & SYSTEM</div>
    </div>
    <div class="breadcrumb" id="left-breadcrumb">
        <span class="breadcrumb-item breadcrumb-current">Admin & System</span>
    </div>
    <div class="menu-items">
        <div class="menu-item" data-page="admin">
            <div class="menu-item-header">
                <span>Admin</span>
                <span class="expand-icon">‚ñ∂</span>
            </div>
            <div class="submenu">
                <div class="submenu-item" data-submenu="admin-00">subMenuItem00</div>
                <div class="submenu-item" data-submenu="admin-01">subMenuItem01</div>
                <div class="submenu-item" data-submenu="admin-02">subMenuItem02</div>
                <div class="submenu-item" data-submenu="admin-03">subMenuItem03</div>
                <div class="submenu-item" data-submenu="admin-04">subMenuItem04</div>
                <div class="submenu-item" data-submenu="admin-05">subMenuItem05</div>
                <div class="submenu-item" data-submenu="admin-06">subMenuItem06</div>
                <div class="submenu-item" data-submenu="admin-07">UI Transparency</div>
                <div class="submenu-item" data-submenu="admin-08">Particle Behavior</div>
                <div class="submenu-item has-children" data-submenu="admin-theme">
                    Theme
                    <span class="expand-icon">‚ñ∂</span>
                </div>
                <div class="submenu-item has-children" data-submenu="admin-restart">
                    Restart App
                    <span class="expand-icon">‚ñ∂</span>
                </div>
            </div>
        </div>
        <div class="menu-item" data-page="system">
            <div class="menu-item-header">
                <span>Systems</span>
                <span class="expand-icon">‚ñ∂</span>
            </div>
            <div class="submenu">
                <div class="submenu-item" data-submenu="system-00" style="flex-direction: column; align-items: flex-start; padding: 12px;">
                    <div style="margin-bottom: 8px; font-weight: 600;">UI Transparency</div>
                    <input type="range" id="ui-transparency-slider" min="0" max="100" value="100" 
                           style="width: 100%; cursor: pointer;">
                    <div style="display: flex; justify-content: space-between; width: 100%; font-size: 10px; margin-top: 4px;">
                        <span>Hidden</span>
                        <span id="transparency-value">100%</span>
                        <span>Opaque</span>
                    </div>
                </div>
                <div class="submenu-item" data-submenu="system-01">MySpace</div>
                <div class="submenu-item" data-submenu="system-02">subMenuItem02</div>
                <div class="submenu-item" data-submenu="system-03">subMenuItem03</div>
                <div class="submenu-item" data-submenu="system-04">subMenuItem04</div>
                <div class="submenu-item" data-submenu="system-05">subMenuItem05</div>
                <div class="submenu-item" data-submenu="system-06">subMenuItem06</div>
                <div class="submenu-item" data-submenu="system-07">subMenuItem07</div>
                <div class="submenu-item" data-submenu="system-08">subMenuItem08</div>
                <div class="submenu-item" data-submenu="system-09">subMenuItem09</div>
                <div class="submenu-item" data-submenu="system-10">subMenuItem10</div>
                <div class="submenu-item" data-submenu="system-11">NAV</div>
            </div>
        </div>
        <div class="menu-item" data-page="experiences">
            <div class="menu-item-header">
                <span>Experiences</span>
                <span class="expand-icon">‚ñ∂</span>
            </div>
            <div class="submenu">
                <div class="submenu-item" data-submenu="experiences-00">subMenuItem00</div>
                <div class="submenu-item" data-submenu="experiences-01">subMenuItem01</div>
                <div class="submenu-item" data-submenu="experiences-02">subMenuItem02</div>
                <div class="submenu-item" data-submenu="experiences-03">subMenuItem03</div>
                <div class="submenu-item" data-submenu="experiences-04">subMenuItem04</div>
                <div class="submenu-item" data-submenu="experiences-05">subMenuItem05</div>
                <div class="submenu-item" data-submenu="experiences-06">subMenuItem06</div>
                <div class="submenu-item" data-submenu="experiences-07">subMenuItem07</div>
                <div class="submenu-item" data-submenu="experiences-08">subMenuItem08</div>
                <div class="submenu-item" data-submenu="experiences-09">subMenuItem09</div>
                <div class="submenu-item" data-submenu="experiences-10">subMenuItem10</div>
            </div>
        </div>
        <div class="menu-item" data-page="perspectives">
            <div class="menu-item-header">
                <span>Perspectives</span>
                <span class="expand-icon">‚ñ∂</span>
            </div>
            <div class="submenu">
                <div class="submenu-item" data-submenu="perspectives-00">subMenuItem00</div>
                <div class="submenu-item" data-submenu="perspectives-01">subMenuItem01</div>
                <div class="submenu-item" data-submenu="perspectives-02">subMenuItem02</div>
                <div class="submenu-item" data-submenu="perspectives-03">subMenuItem03</div>
                <div class="submenu-item" data-submenu="perspectives-04">subMenuItem04</div>
                <div class="submenu-item" data-submenu="perspectives-05">subMenuItem05</div>
                <div class="submenu-item" data-submenu="perspectives-06">subMenuItem06</div>
                <div class="submenu-item" data-submenu="perspectives-07">subMenuItem07</div>
                <div class="submenu-item" data-submenu="perspectives-08">subMenuItem08</div>
                <div class="submenu-item" data-submenu="perspectives-09">subMenuItem09</div>
                <div class="submenu-item" data-submenu="perspectives-10">subMenuItem10</div>
            </div>
        </div>
        <div class="menu-item" data-page="times">
            <div class="menu-item-header">
                <span>Times</span>
                <span class="expand-icon">‚ñ∂</span>
            </div>
            <div class="submenu">
                <div class="submenu-item" data-submenu="times-00">subMenuItem00</div>
                <div class="submenu-item" data-submenu="times-01">subMenuItem01</div>
                <div class="submenu-item" data-submenu="times-02">subMenuItem02</div>
                <div class="submenu-item" data-submenu="times-03">subMenuItem03</div>
                <div class="submenu-item" data-submenu="times-04">subMenuItem04</div>
                <div class="submenu-item" data-submenu="times-05">subMenuItem05</div>
                <div class="submenu-item" data-submenu="times-06">subMenuItem06</div>
                <div class="submenu-item" data-submenu="times-07">subMenuItem07</div>
                <div class="submenu-item" data-submenu="times-08">subMenuItem08</div>
                <div class="submenu-item" data-submenu="times-09">subMenuItem09</div>
                <div class="submenu-item" data-submenu="times-10">subMenuItem10</div>
            </div>
        </div>
        <div class="menu-item" data-page="space">
            <div class="menu-item-header">
                <span>Spaces</span>
                <span class="expand-icon">‚ñ∂</span>
            </div>
            <div class="submenu">
                <div class="submenu-item" data-submenu="space-00">subMenuItem00</div>
                <div class="submenu-item" data-submenu="space-01">subMenuItem01</div>
                <div class="submenu-item" data-submenu="space-02">subMenuItem02</div>
                <div class="submenu-item" data-submenu="space-03">subMenuItem03</div>
                <div class="submenu-item" data-submenu="space-04">subMenuItem04</div>
                <div class="submenu-item" data-submenu="space-05">subMenuItem05</div>
                <div class="submenu-item" data-submenu="space-06">subMenuItem06</div>
                <div class="submenu-item" data-submenu="space-07">subMenuItem07</div>
                <div class="submenu-item" data-submenu="space-08">subMenuItem08</div>
                <div class="submenu-item" data-submenu="space-09">subMenuItem09</div>
                <div class="submenu-item" data-submenu="space-10">subMenuItem10</div>
            </div>
        </div>
        <div class="menu-item" data-page="objects">
            <div class="menu-item-header">
                <span>Objects</span>
                <span class="expand-icon">‚ñ∂</span>
            </div>
            <div class="submenu">
                <div class="submenu-item" data-submenu="objects-00">subMenuItem00</div>
                <div class="submenu-item" data-submenu="objects-01">subMenuItem01</div>
                <div class="submenu-item" data-submenu="objects-02">subMenuItem02</div>
                <div class="submenu-item" data-submenu="objects-03">subMenuItem03</div>
                <div class="submenu-item" data-submenu="objects-04">subMenuItem04</div>
                <div class="submenu-item" data-submenu="objects-05">subMenuItem05</div>
                <div class="submenu-item" data-submenu="objects-06">subMenuItem06</div>
                <div class="submenu-item" data-submenu="objects-07">subMenuItem07</div>
                <div class="submenu-item" data-submenu="objects-08">subMenuItem08</div>
                <div class="submenu-item" data-submenu="objects-09">subMenuItem09</div>
                <div class="submenu-item" data-submenu="objects-10">subMenuItem10</div>
            </div>
        </div>
    </div>
</div>

<!-- Right Side Menu (Site Pages) -->
<div class="side-menu" id="right-menu">
    <div class="menu-header">
        <div class="menu-title">NAVIGATION</div>
    </div>
    <div class="breadcrumb" id="right-breadcrumb">
        <span class="breadcrumb-item breadcrumb-current">Navigation</span>
    </div>
    <div class="menu-items">
        <div class="menu-item active" data-page="home">
            <div class="menu-item-header">
                <span>Home</span>
                <span class="expand-icon">‚ñ∂</span>
            </div>
            <div class="submenu">
                <div class="submenu-item" data-submenu="home-00">subMenuItem00</div>
                <div class="submenu-item" data-submenu="home-01">subMenuItem01</div>
                <div class="submenu-item" data-submenu="home-02">subMenuItem02</div>
                <div class="submenu-item" data-submenu="home-03">subMenuItem03</div>
                <div class="submenu-item" data-submenu="home-04">subMenuItem04</div>
                <div class="submenu-item" data-submenu="home-05">subMenuItem05</div>
                <div class="submenu-item" data-submenu="home-06">subMenuItem06</div>
                <div class="submenu-item" data-submenu="home-07">subMenuItem07</div>
                <div class="submenu-item" data-submenu="home-08">subMenuItem08</div>
                <div class="submenu-item" data-submenu="home-09">subMenuItem09</div>
                <div class="submenu-item" data-submenu="home-10">subMenuItem10</div>
            </div>
        </div>
        <div class="menu-item" data-page="about">
            <div class="menu-item-header">
                <span>About Me</span>
                <span class="expand-icon">‚ñ∂</span>
            </div>
            <div class="submenu">
                <div class="submenu-item" data-submenu="about-00">subMenuItem00</div>
                <div class="submenu-item" data-submenu="about-01">subMenuItem01</div>
                <div class="submenu-item" data-submenu="about-02">subMenuItem02</div>
                <div class="submenu-item" data-submenu="about-03">subMenuItem03</div>
                <div class="submenu-item" data-submenu="about-04">subMenuItem04</div>
                <div class="submenu-item" data-submenu="about-05">subMenuItem05</div>
                <div class="submenu-item" data-submenu="about-06">subMenuItem06</div>
                <div class="submenu-item" data-submenu="about-07">subMenuItem07</div>
                <div class="submenu-item" data-submenu="about-08">subMenuItem08</div>
                <div class="submenu-item" data-submenu="about-09">subMenuItem09</div>
                <div class="submenu-item" data-submenu="about-10">subMenuItem10</div>
            </div>
        </div>
        <div class="menu-item" data-page="portfolio">
            <div class="menu-item-header">
                <span>Portfolio</span>
                <span class="expand-icon">‚ñ∂</span>
            </div>
            <div class="submenu">
                <div class="submenu-item" data-submenu="portfolio-00">subMenuItem00</div>
                <div class="submenu-item" data-submenu="portfolio-01">subMenuItem01</div>
                <div class="submenu-item" data-submenu="portfolio-02">subMenuItem02</div>
                <div class="submenu-item" data-submenu="portfolio-03">subMenuItem03</div>
                <div class="submenu-item" data-submenu="portfolio-04">subMenuItem04</div>
                <div class="submenu-item" data-submenu="portfolio-05">subMenuItem05</div>
                <div class="submenu-item" data-submenu="portfolio-06">subMenuItem06</div>
                <div class="submenu-item" data-submenu="portfolio-07">subMenuItem07</div>
                <div class="submenu-item" data-submenu="portfolio-08">subMenuItem08</div>
                <div class="submenu-item" data-submenu="portfolio-09">subMenuItem09</div>
                <div class="submenu-item" data-submenu="portfolio-10">subMenuItem10</div>
            </div>
        </div>
        <div class="menu-item" data-page="products">
            <div class="menu-item-header">
                <span>Products</span>
                <span class="expand-icon">‚ñ∂</span>
            </div>
            <div class="submenu">
                <div class="submenu-item" data-submenu="products-00">subMenuItem00</div>
                <div class="submenu-item" data-submenu="products-01">subMenuItem01</div>
                <div class="submenu-item" data-submenu="products-02">subMenuItem02</div>
                <div class="submenu-item" data-submenu="products-03">subMenuItem03</div>
                <div class="submenu-item" data-submenu="products-04">subMenuItem04</div>
                <div class="submenu-item" data-submenu="products-05">subMenuItem05</div>
                <div class="submenu-item" data-submenu="products-06">subMenuItem06</div>
                <div class="submenu-item" data-submenu="products-07">subMenuItem07</div>
                <div class="submenu-item" data-submenu="products-08">subMenuItem08</div>
                <div class="submenu-item" data-submenu="products-09">subMenuItem09</div>
                <div class="submenu-item" data-submenu="products-10">subMenuItem10</div>
            </div>
        </div>
        <div class="menu-item" data-page="services">
            <div class="menu-item-header">
                <span>Services</span>
                <span class="expand-icon">‚ñ∂</span>
            </div>
            <div class="submenu">
                <div class="submenu-item" data-submenu="services-00">subMenuItem00</div>
                <div class="submenu-item" data-submenu="services-01">subMenuItem01</div>
                <div class="submenu-item" data-submenu="services-02">subMenuItem02</div>
                <div class="submenu-item" data-submenu="services-03">subMenuItem03</div>
                <div class="submenu-item" data-submenu="services-04">subMenuItem04</div>
                <div class="submenu-item" data-submenu="services-05">subMenuItem05</div>
                <div class="submenu-item" data-submenu="services-06">subMenuItem06</div>
                <div class="submenu-item" data-submenu="services-07">subMenuItem07</div>
                <div class="submenu-item" data-submenu="services-08">subMenuItem08</div>
                <div class="submenu-item" data-submenu="services-09">subMenuItem09</div>
                <div class="submenu-item" data-submenu="services-10">subMenuItem10</div>
            </div>
        </div>
        <div class="menu-item" data-page="resources">
            <div class="menu-item-header">
                <span>Resources</span>
                <span class="expand-icon">‚ñ∂</span>
            </div>
            <div class="submenu">
                <div class="submenu-item" data-submenu="resources-00">subMenuItem00</div>
                <div class="submenu-item" data-submenu="resources-01">subMenuItem01</div>
                <div class="submenu-item" data-submenu="resources-02">subMenuItem02</div>
                <div class="submenu-item" data-submenu="resources-03">subMenuItem03</div>
                <div class="submenu-item" data-submenu="resources-04">subMenuItem04</div>
                <div class="submenu-item" data-submenu="resources-05">subMenuItem05</div>
                <div class="submenu-item" data-submenu="resources-06">subMenuItem06</div>
                <div class="submenu-item" data-submenu="resources-07">subMenuItem07</div>
                <div class="submenu-item" data-submenu="resources-08">subMenuItem08</div>
                <div class="submenu-item" data-submenu="resources-09">subMenuItem09</div>
                <div class="submenu-item" data-submenu="resources-10">subMenuItem10</div>
            </div>
        </div>
        <div class="menu-item" data-page="supporters">
            <div class="menu-item-header">
                <span>Supporters</span>
                <span class="expand-icon">‚ñ∂</span>
            </div>
            <div class="submenu">
                <div class="submenu-item" data-submenu="supporters-00">subMenuItem00</div>
                <div class="submenu-item" data-submenu="supporters-01">subMenuItem01</div>
                <div class="submenu-item" data-submenu="supporters-02">subMenuItem02</div>
                <div class="submenu-item" data-submenu="supporters-03">subMenuItem03</div>
                <div class="submenu-item" data-submenu="supporters-04">subMenuItem04</div>
                <div class="submenu-item" data-submenu="supporters-05">subMenuItem05</div>
                <div class="submenu-item" data-submenu="supporters-06">subMenuItem06</div>
                <div class="submenu-item" data-submenu="supporters-07">subMenuItem07</div>
                <div class="submenu-item" data-submenu="supporters-08">subMenuItem08</div>
                <div class="submenu-item" data-submenu="supporters-09">subMenuItem09</div>
                <div class="submenu-item" data-submenu="supporters-10">subMenuItem10</div>
            </div>
        </div>
        <div class="menu-item" data-page="contact">
            <div class="menu-item-header">
                <span>Contact</span>
                <span class="expand-icon">‚ñ∂</span>
            </div>
            <div class="submenu">
                <div class="submenu-item" data-submenu="contact-00">subMenuItem00</div>
                <div class="submenu-item" data-submenu="contact-01">subMenuItem01</div>
                <div class="submenu-item" data-submenu="contact-02">subMenuItem02</div>
                <div class="submenu-item" data-submenu="contact-03">subMenuItem03</div>
                <div class="submenu-item" data-submenu="contact-04">subMenuItem04</div>
                <div class="submenu-item" data-submenu="contact-05">subMenuItem05</div>
                <div class="submenu-item" data-submenu="contact-06">subMenuItem06</div>
                <div class="submenu-item" data-submenu="contact-07">subMenuItem07</div>
                <div class="submenu-item" data-submenu="contact-08">subMenuItem08</div>
                <div class="submenu-item" data-submenu="contact-09">subMenuItem09</div>
                <div class="submenu-item" data-submenu="contact-10">subMenuItem10</div>
            </div>
        </div>
    </div>
</div>

<!-- Docks -->
<div class="dock hidden" id="dock-bottom">
    <div class="dock-item" draggable="true" data-item="1">D1</div>
    <div class="dock-item" draggable="true" data-item="2">D2</div>
    <div class="dock-item" draggable="true" data-item="3">D3</div>
    <div class="dock-item" draggable="true" data-item="4">D4</div>
    <div class="dock-item" draggable="true" data-item="5">D5</div>
</div>

<div class="dock hidden" id="dock-top">
    <div class="dock-item" draggable="true" data-item="6">D6</div>
    <div class="dock-item" draggable="true" data-item="7">D7</div>
    <div class="dock-item" draggable="true" data-item="8">D8</div>
</div>

<div class="dock hidden" id="dock-left">
    <div class="dock-item" draggable="true" data-item="9">D9</div>
    <div class="dock-item" draggable="true" data-item="10">D10</div>
    <div class="dock-item" draggable="true" data-item="11">D11</div>
</div>

<div class="dock hidden" id="dock-right">
    <div class="dock-item" draggable="true" data-item="12">D12</div>
    <div class="dock-item" draggable="true" data-item="13">D13</div>
    <div class="dock-item" draggable="true" data-item="14">D14</div>
</div>

<!-- Restart Prompt Modal -->
<div class="prompt-modal" id="restart-prompt">
    <button class="prompt-close" onclick="document.getElementById('restart-prompt').classList.remove('visible')">√ó</button>
    <div class="prompt-title">Restart Application?</div>
    <div class="prompt-message">Are you sure you want to restart the application? All unsaved progress will be lost.</div>
    <div class="prompt-buttons">
        <button class="prompt-btn" onclick="location.reload()">Yes</button>
        <button class="prompt-btn" onclick="document.getElementById('restart-prompt').classList.remove('visible')">No</button>
        <button class="prompt-btn" onclick="showWisdomPrompt()">Not Sure</button>
    </div>
</div>

<!-- Wisdom Prompt Modal -->
<div class="prompt-modal" id="wisdom-prompt">
    <button class="prompt-close" onclick="document.getElementById('wisdom-prompt').classList.remove('visible')">√ó</button>
    <div class="prompt-title">Maybe This Will Help...</div>
    <div class="prompt-message" id="wisdom-text"></div>
    <div class="prompt-buttons">
        <button class="prompt-btn" onclick="document.getElementById('wisdom-prompt').classList.remove('visible')">Close</button>
    </div>
</div>

<!-- Theme Selector Modal -->
<div class="prompt-modal" id="theme-prompt">
    <button class="prompt-close" onclick="document.getElementById('theme-prompt').classList.remove('visible')">√ó</button>
    <div class="prompt-title">Select Theme</div>
    <div class="theme-grid" id="theme-grid"></div>
</div>

<!-- Left Hand Menu -->
<div class="hand-menu" id="left-hand">
    <div class="hand-circle">LH</div>
    <div class="radial-menu" id="lh-radial"></div>
</div>

<!-- Right Hand Menu -->
<div class="hand-menu" id="right-hand">
    <div class="hand-circle">RH</div>
    <div class="radial-menu" id="rh-radial"></div>
</div>

<!-- Conscious Hand Menu -->
<div class="hand-menu" id="conscious-hand">
    <div class="hand-circle">CH</div>
    <div class="radial-menu" id="ch-radial"></div>
</div>

<!-- Pause Overlay -->
<div class="pause-overlay" id="pause-overlay">
    <div class="pause-menu">
        <div class="pause-title">PAUSED</div>
        <button class="pause-btn" id="resume-btn">Resume</button>
    </div>
</div>

<!-- Pocket Panel -->
<div class="pocket-panel" id="pocket-panel">
    <div class="pocket-header">USER POCKET</div>
    <div class="pocket-grid" id="pocket-grid"></div>
    <div class="pocket-pagination" style="display: flex; justify-content: center; align-items: center; gap: 10px; margin-top: 15px; padding: 10px;">
        <button id="pocket-prev-page" style="padding: 6px 12px; background: rgba(128, 128, 128, 0.3); border: 1px solid rgba(128, 128, 128, 0.5); border-radius: 6px; color: #fff; cursor: pointer; font-family: 'Orbitron', sans-serif; font-size: 11px;">‚óÄ PREV</button>
        <span id="pocket-page-info" style="font-size: 12px; color: #fff; min-width: 80px; text-align: center;">Page 1 / 10</span>
        <button id="pocket-next-page" style="padding: 6px 12px; background: rgba(128, 128, 128, 0.3); border: 1px solid rgba(128, 128, 128, 0.5); border-radius: 6px; color: #fff; cursor: pointer; font-family: 'Orbitron', sans-serif; font-size: 11px;">NEXT ‚ñ∂</button>
    </div>
</div>

<!-- Particle Behavior Panel -->
<div id="particle-behavior-panel" class="side-menu" style="display: none; right: 120px; top: 80px; width: 350px; max-height: 600px; overflow-y: auto;">
    <div class="panel-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <span class="panel-title" style="font-size: 18px; font-weight: 700;">PARTICLE BEHAVIOR</span>
        <button class="panel-btn close-btn" id="particle-behavior-close" style="background: none; border: none; color: #fff; font-size: 24px; cursor: pointer;">√ó</button>
    </div>
    
    <div class="behavior-section" style="margin-bottom: 25px;">
        <div style="font-weight: 600; margin-bottom: 10px; font-size: 14px;">Behavior Mode</div>
        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 15px;">
            <button class="behavior-mode-btn active" data-mode="calm" style="padding: 10px; border-radius: 6px; color: #fff; cursor: pointer; font-family: 'Orbitron', sans-serif; font-size: 10px; font-weight: 600;">CALM</button>
            <button class="behavior-mode-btn" data-mode="forward" style="padding: 10px; border-radius: 6px; color: #fff; cursor: pointer; font-family: 'Orbitron', sans-serif; font-size: 10px; font-weight: 600;">FORWARD</button>
            <button class="behavior-mode-btn" data-mode="backward" style="padding: 10px; border-radius: 6px; color: #fff; cursor: pointer; font-family: 'Orbitron', sans-serif; font-size: 10px; font-weight: 600;">BACKWARD</button>
            <button class="behavior-mode-btn" data-mode="connected" style="padding: 10px; border-radius: 6px; color: #fff; cursor: pointer; font-family: 'Orbitron', sans-serif; font-size: 10px; font-weight: 600;">CONNECTED</button>
            <button class="behavior-mode-btn" data-mode="glitch" style="padding: 10px; border-radius: 6px; color: #fff; cursor: pointer; font-family: 'Orbitron', sans-serif; font-size: 10px; font-weight: 600;">GLITCH</button>
            <button class="behavior-mode-btn" data-mode="constellation" style="padding: 10px; border-radius: 6px; color: #fff; cursor: pointer; font-family: 'Orbitron', sans-serif; font-size: 9px; font-weight: 600;">CONSTELLATION</button>
        </div>
    </div>
    
    <div class="behavior-controls" id="forward-controls" style="display: none; margin-bottom: 20px;">
        <div style="font-weight: 600; margin-bottom: 10px; font-size: 14px;">Forward Flow Speed</div>
        <input type="range" id="forward-speed-slider" min="1" max="100" value="50" style="width: 100%; cursor: pointer; margin-bottom: 8px;">
        <div style="display: flex; justify-content: space-between; font-size: 11px;">
            <span>Slow</span>
            <span id="forward-speed-value">50</span>
            <span>Fast</span>
        </div>
    </div>
    
    <div class="behavior-controls" id="backward-controls" style="display: none; margin-bottom: 20px;">
        <div style="font-weight: 600; margin-bottom: 10px; font-size: 14px;">Backward Flow Speed</div>
        <input type="range" id="backward-speed-slider" min="1" max="100" value="50" style="width: 100%; cursor: pointer; margin-bottom: 8px;">
        <div style="display: flex; justify-content: space-between; font-size: 11px;">
            <span>Slow</span>
            <span id="backward-speed-value">50</span>
            <span>Fast</span>
        </div>
    </div>
    
    <div class="behavior-controls" id="connected-controls" style="display: none; margin-bottom: 20px;">
        <div style="font-weight: 600; margin-bottom: 10px; font-size: 14px;">Connection Frequency</div>
        <input type="range" id="connected-frequency-slider" min="1" max="100" value="50" style="width: 100%; cursor: pointer; margin-bottom: 8px;">
        <div style="display: flex; justify-content: space-between; font-size: 11px;">
            <span>Sparse</span>
            <span id="connected-frequency-value">50</span>
            <span>Dense</span>
        </div>
    </div>
    
    <div class="behavior-controls" id="glitch-controls" style="display: none; margin-bottom: 20px;">
        <div style="font-weight: 600; margin-bottom: 10px; font-size: 14px;">Glitch Intensity</div>
        <input type="range" id="glitch-intensity-slider" min="1" max="100" value="50" style="width: 100%; cursor: pointer; margin-bottom: 8px;">
        <div style="display: flex; justify-content: space-between; font-size: 11px;">
            <span>Subtle</span>
            <span id="glitch-intensity-value">50</span>
            <span>Extreme</span>
        </div>
    </div>
    
    <div class="behavior-controls" id="constellation-controls" style="display: none; margin-bottom: 20px;">
        <div style="font-weight: 600; margin-bottom: 10px; font-size: 14px;">Connection Distance</div>
        <input type="range" id="constellation-distance-slider" min="1" max="100" value="30" style="width: 100%; cursor: pointer; margin-bottom: 8px;">
        <div style="display: flex; justify-content: space-between; font-size: 11px;">
            <span>Close</span>
            <span id="constellation-distance-value">30</span>
            <span>Far</span>
        </div>
    </div>
    
    <!-- Divider -->
    <div style="height: 1px; background: rgba(128, 128, 128, 0.2); margin: 25px 0;"></div>
    
    <!-- Particle Count -->
    <div style="margin-bottom: 20px;">
        <div style="font-weight: 600; margin-bottom: 10px; font-size: 14px;">Particle Count</div>
        <input type="range" id="particle-count-slider" min="3000" max="6000" value="3000" step="100" style="width: 100%; cursor: pointer; margin-bottom: 8px;">
        <div style="display: flex; justify-content: space-between; font-size: 11px;">
            <span>3,000</span>
            <span id="particle-count-value">3,000</span>
            <span>6,000</span>
        </div>
    </div>
    
    <!-- Divider -->
    <div style="height: 1px; background: rgba(128, 128, 128, 0.2); margin: 25px 0;"></div>
    
    <!-- Particle System Rotation -->
    <div style="margin-bottom: 20px;">
        <div style="font-weight: 600; margin-bottom: 15px; font-size: 14px;">Particle System Rotation</div>
        
        <!-- X Rotation -->
        <div style="margin-bottom: 15px;">
            <div style="display: flex; justify-content: space-between; margin-bottom: 6px;">
                <span style="font-size: 12px; color: rgba(255, 255, 255, 0.8);">X-Axis</span>
                <span id="particle-rot-x-value" style="font-size: 12px; color: rgba(255, 255, 255, 0.8);">0¬∞</span>
            </div>
            <input type="range" id="particle-rot-x-slider" min="0" max="360" value="0" style="width: 100%; cursor: pointer;">
        </div>
        
        <!-- Y Rotation -->
        <div style="margin-bottom: 15px;">
            <div style="display: flex; justify-content: space-between; margin-bottom: 6px;">
                <span style="font-size: 12px; color: rgba(255, 255, 255, 0.8);">Y-Axis</span>
                <span id="particle-rot-y-value" style="font-size: 12px; color: rgba(255, 255, 255, 0.8);">0¬∞</span>
            </div>
            <input type="range" id="particle-rot-y-slider" min="0" max="360" value="0" style="width: 100%; cursor: pointer;">
        </div>
        
        <!-- Z Rotation -->
        <div style="margin-bottom: 15px;">
            <div style="display: flex; justify-content: space-between; margin-bottom: 6px;">
                <span style="font-size: 12px; color: rgba(255, 255, 255, 0.8);">Z-Axis</span>
                <span id="particle-rot-z-value" style="font-size: 12px; color: rgba(255, 255, 255, 0.8);">71¬∞</span>
            </div>
            <input type="range" id="particle-rot-z-slider" min="0" max="360" value="71" style="width: 100%; cursor: pointer;">
        </div>
        
        <button id="particle-rot-reset" style="width: 100%; padding: 8px; background: rgba(128, 128, 128, 0.3); border: 1px solid rgba(128, 128, 128, 0.5); border-radius: 6px; color: #fff; cursor: pointer; font-family: 'Orbitron', sans-serif; font-size: 11px; font-weight: 600;">
            RESET ROTATION
        </button>
    </div>
</div>

<!-- FAQ Panel -->
<div id="faq-panel">
    <div class="panel-header">
        <span class="panel-title">CONTROLS & FAQ</span>
        <button class="panel-btn close-btn" id="faq-close">√ó</button>
    </div>
    <div class="faq-content">
        <div class="faq-item">
            <div class="faq-question">‚å®Ô∏è Keyboard Controls</div>
            <div class="faq-answer" style="line-height: 2;">
                <strong>W</strong> - Move forward<br>
                <strong>A</strong> - Move left<br>
                <strong>S</strong> - Move backward<br>
                <strong>D</strong> - Move right<br>
                <strong>R</strong> - Move up<br>
                <strong>F</strong> - Move down<br>
                <strong>C</strong> - Hold to enable mouse look (FPS mode)<br>
                <strong>O</strong> - Reset camera to origin (0, 0, 10)<br>
                <strong>0</strong> - Toggle MySpace (collapse/expand grid)<br>
                <strong>9</strong> - Toggle User Pocket<br>
                <strong>Q</strong> - Toggle Controls & FAQ panel<br>
                <strong>X</strong> - Toggle Inspector panel<br>
                <strong>Z</strong> - Toggle docks visibility<br>
                <strong>Left Shift</strong> - Toggle Left Hand menu<br>
                <strong>Right Shift</strong> - Toggle Right Hand menu<br>
                <strong>Enter</strong> - Toggle Conscious Hand menu
            </div>
        </div>
        <div class="faq-item">
            <div class="faq-question">üñ±Ô∏è Mouse Controls</div>
            <div class="faq-answer">
                <strong>Hold C + Move mouse</strong> - Look around (FPS style)<br>
                <strong>Click objects</strong> - Select journal pages or grid panels<br>
                <strong>Click + Drag</strong> - Orbit camera around scene
            </div>
        </div>
        <div class="faq-item">
            <div class="faq-question">üì± Mobile Controls</div>
            <div class="faq-answer">
                <strong>Joystick (bottom left)</strong> - Move camera position<br>
                <strong>Single finger touch on screen</strong> - Look around (FPS camera rotation)<br>
                <strong>POS/ROT/SCL buttons</strong> - Adjust position, rotation, scale<br>
                <strong>Action buttons (A1-A30)</strong> - Custom quick actions
            </div>
        </div>
        <div class="faq-item">
            <div class="faq-question">üîç UI Panels</div>
            <div class="faq-answer">
                <strong>Top Left</strong> - Session info (space title, username, timer)<br>
                <strong>Top Right</strong> - Search panel (click icon to expand)<br>
                <strong>Inspector (X key)</strong> - Object properties and transparency<br>
                <strong>Side Menus</strong> - Click hamburger icons for navigation
            </div>
        </div>
        <div class="faq-item">
            <div class="faq-question">‚úã Hand Menus</div>
            <div class="faq-answer">
                <strong>Left Hand (LH)</strong> - Left Shift key or LH button - Radial menu with 10 options<br>
                <strong>Right Hand (RH)</strong> - Right Shift key or RH button - Radial menu with 10 options<br>
                <strong>Conscious Hand (CH)</strong> - Enter key or CH button - Main menu controls including Pause Menu<br>
                Click on radial menu items to select options. Only one hand menu visible at a time.
            </div>
        </div>
        <div class="faq-item">
            <div class="faq-question">üåê MySpace (Grid Sphere)</div>
            <div class="faq-answer">
                The spherical grid is your personal space. Press <strong>0 key</strong> or the <strong>MS button</strong> to collapse/expand it. When collapsed, panels animate one-by-one into a smaller sphere. Access also via Conscious Hand menu ‚Üí MySpace option.
            </div>
        </div>
        <div class="faq-item">
            <div class="faq-question">üì¶ User Pocket</div>
            <div class="faq-answer">
                Your pocket stores up to <strong>20 items</strong>. Press <strong>9 key</strong> or select from Conscious Hand menu. The pocket panel slides in from the right with a 4x5 grid.<br><br>
                <strong>Cell States:</strong><br>
                ‚Ä¢ Empty slots: Dashed border, ready for items<br>
                ‚Ä¢ Items in pocket: 35% opacity (stored)<br>
                ‚Ä¢ Items deployed in scene: 20% opacity (active)<br><br>
                Click slots to deploy/recall items. Items can have password protection for security.
            </div>
        </div>
        <div class="faq-item">
            <div class="faq-question">How do I navigate the site?</div>
            <div class="faq-answer">Click the hamburger menus (‚ò∞) at the top left (Admin/System) and top right (Site Pages) to access different sections. Click outside the menu to close it.</div>
        </div>
        <div class="faq-item">
            <div class="faq-question">What are the docks?</div>
            <div class="faq-answer">Docks are located on all four edges (top, bottom, left, right). They contain draggable items (D1-D14) you can move between docks by clicking and dragging. Press <strong>Z</strong> to show/hide all docks.</div>
        </div>
        <div class="faq-item">
            <div class="faq-question">How do I select and manipulate objects?</div>
            <div class="faq-answer">Click on any journal page or grid panel to select it. Selected objects turn blue and the camera animates to focus on them. Press <strong>X</strong> to open the Inspector panel where you can adjust transparency (10-100%) and view object details.</div>
        </div>
        <div class="faq-item">
            <div class="faq-question">What do the transform buttons do?</div>
            <div class="faq-answer">The <strong>POS</strong>, <strong>ROT</strong>, and <strong>SCL</strong> buttons open transform panels to adjust position, rotation, and scale of selected objects with precise control. Use the step size control to determine how much each adjustment changes the values (range: -1000 to 1000).</div>
        </div>
    </div>
</div>

<!-- Inspector Panel -->
<div id="inspector-panel">
    <div class="panel-header" id="panel-header">
        <span class="panel-title">INSPECTOR</span>
        <div class="panel-controls">
            <button class="panel-btn" id="minimize-btn">_</button>
            <button class="panel-btn close-btn" id="close-btn">√ó</button>
        </div>
    </div>
    <div class="panel-content" id="panel-content" style="padding: 16px;">
        <!-- Selected Object Name -->
        <div style="margin-bottom: 20px;">
            <div class="info-label" style="font-size: 11px; color: rgba(255, 255, 255, 0.6); margin-bottom: 6px;">SELECTED OBJECT</div>
            <div class="info-value" id="selected-name" style="font-size: 14px; font-weight: 700; color: #808080;">None</div>
        </div>
        
        <!-- Object Transform Properties -->
        <div id="object-details" style="display: none;">
            <!-- Position -->
            <div style="margin-bottom: 15px;">
                <div class="info-label" style="font-size: 11px; color: rgba(255, 255, 255, 0.6); margin-bottom: 6px;">POSITION</div>
                <div id="object-position" style="font-family: 'Courier New', monospace; font-size: 12px; color: #fff; background: rgba(0, 0, 0, 0.3); padding: 8px; border-radius: 6px; border: 1px solid rgba(128, 128, 128, 0.3);">
                    X: 0.00 | Y: 0.00 | Z: 0.00
                </div>
            </div>
            
            <!-- Rotation -->
            <div style="margin-bottom: 15px;">
                <div class="info-label" style="font-size: 11px; color: rgba(255, 255, 255, 0.6); margin-bottom: 6px;">ROTATION</div>
                <div id="object-rotation" style="font-family: 'Courier New', monospace; font-size: 12px; color: #fff; background: rgba(0, 0, 0, 0.3); padding: 8px; border-radius: 6px; border: 1px solid rgba(128, 128, 128, 0.3);">
                    X: 0.00 | Y: 0.00 | Z: 0.00
                </div>
            </div>
            
            <!-- Scale -->
            <div style="margin-bottom: 20px;">
                <div class="info-label" style="font-size: 11px; color: rgba(255, 255, 255, 0.6); margin-bottom: 6px;">SCALE</div>
                <div id="object-scale" style="font-family: 'Courier New', monospace; font-size: 12px; color: #fff; background: rgba(0, 0, 0, 0.3); padding: 8px; border-radius: 6px; border: 1px solid rgba(128, 128, 128, 0.3);">
                    X: 1.00 | Y: 1.00 | Z: 1.00
                </div>
            </div>
            
            <!-- Divider -->
            <div style="height: 1px; background: rgba(128, 128, 128, 0.2); margin: 20px 0;"></div>
            
            <!-- Object Data Section -->
            <div style="margin-bottom: 20px;">
                <div class="info-label" style="font-size: 11px; color: rgba(255, 255, 255, 0.6); margin-bottom: 10px;">OBJECT DATA</div>
                
                <!-- Header Field -->
                <div style="margin-bottom: 12px;">
                    <label style="display: block; font-size: 10px; color: rgba(255, 255, 255, 0.5); margin-bottom: 4px;">Header</label>
                    <input type="text" id="object-data-header" placeholder="Enter header..." style="width: 100%; padding: 8px; background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(128, 128, 128, 0.3); border-radius: 6px; color: #fff; font-family: 'Orbitron', sans-serif; font-size: 12px; outline: none;">
                </div>
                
                <!-- Body Field -->
                <div style="margin-bottom: 12px;">
                    <label style="display: block; font-size: 10px; color: rgba(255, 255, 255, 0.5); margin-bottom: 4px;">Body</label>
                    <textarea id="object-data-body" placeholder="Enter body content..." style="width: 100%; min-height: 120px; padding: 8px; background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(128, 128, 128, 0.3); border-radius: 6px; color: #fff; font-family: 'Orbitron', sans-serif; font-size: 11px; outline: none; resize: vertical;"></textarea>
                </div>
                
                <!-- Footer Field -->
                <div style="margin-bottom: 15px;">
                    <label style="display: block; font-size: 10px; color: rgba(255, 255, 255, 0.5); margin-bottom: 4px;">Footer</label>
                    <input type="text" id="object-data-footer" placeholder="Enter footer..." style="width: 100%; padding: 8px; background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(128, 128, 128, 0.3); border-radius: 6px; color: #fff; font-family: 'Orbitron', sans-serif; font-size: 12px; outline: none;">
                </div>
                
                <!-- Icon Selector Section -->
                <div style="margin-bottom: 15px;">
                    <label style="display: block; font-size: 10px; color: rgba(255, 255, 255, 0.5); margin-bottom: 8px;">Icon/Image</label>
                    
                    <!-- Icon Type Selector -->
                    <div style="display: flex; gap: 6px; margin-bottom: 10px;">
                        <button class="icon-type-btn active" data-type="emoji" style="flex: 1; padding: 6px; background: rgba(128, 128, 128, 0.3); border: 1px solid rgba(128, 128, 128, 0.5); border-radius: 4px; color: #fff; cursor: pointer; font-size: 10px; font-weight: 600;">üì± EMOJI</button>
                        <button class="icon-type-btn" data-type="image" style="flex: 1; padding: 6px; background: rgba(128, 128, 128, 0.3); border: 1px solid rgba(128, 128, 128, 0.5); border-radius: 4px; color: #fff; cursor: pointer; font-size: 10px; font-weight: 600;">üñºÔ∏è IMAGE</button>
                        <button class="icon-type-btn" data-type="fontawesome" style="flex: 1; padding: 6px; background: rgba(128, 128, 128, 0.3); border: 1px solid rgba(128, 128, 128, 0.5); border-radius: 4px; color: #fff; cursor: pointer; font-size: 10px; font-weight: 600;">‚≠ê ICON</button>
                    </div>
                    
                    <!-- Emoji Picker -->
                    <div id="emoji-picker" class="icon-picker-content" style="display: grid; grid-template-columns: repeat(6, 1fr); gap: 4px; max-height: 150px; overflow-y: auto; padding: 8px; background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(128, 128, 128, 0.3); border-radius: 6px;">
                        <button class="emoji-option" data-emoji="üòÄ" style="padding: 8px; background: rgba(128, 128, 128, 0.2); border: 1px solid rgba(128, 128, 128, 0.3); border-radius: 4px; cursor: pointer; font-size: 20px;">üòÄ</button>
                        <button class="emoji-option" data-emoji="üìÑ" style="padding: 8px; background: rgba(128, 128, 128, 0.2); border: 1px solid rgba(128, 128, 128, 0.3); border-radius: 4px; cursor: pointer; font-size: 20px;">üìÑ</button>
                        <button class="emoji-option" data-emoji="üìú" style="padding: 8px; background: rgba(128, 128, 128, 0.2); border: 1px solid rgba(128, 128, 128, 0.3); border-radius: 4px; cursor: pointer; font-size: 20px;">üìú</button>
                        <button class="emoji-option" data-emoji="‚≠ê" style="padding: 8px; background: rgba(128, 128, 128, 0.2); border: 1px solid rgba(128, 128, 128, 0.3); border-radius: 4px; cursor: pointer; font-size: 20px;">‚≠ê</button>
                        <button class="emoji-option" data-emoji="‚ù§Ô∏è" style="padding: 8px; background: rgba(128, 128, 128, 0.2); border: 1px solid rgba(128, 128, 128, 0.3); border-radius: 4px; cursor: pointer; font-size: 20px;">‚ù§Ô∏è</button>
                        <button class="emoji-option" data-emoji="üî•" style="padding: 8px; background: rgba(128, 128, 128, 0.2); border: 1px solid rgba(128, 128, 128, 0.3); border-radius: 4px; cursor: pointer; font-size: 20px;">üî•</button>
                        <button class="emoji-option" data-emoji="üí°" style="padding: 8px; background: rgba(128, 128, 128, 0.2); border: 1px solid rgba(128, 128, 128, 0.3); border-radius: 4px; cursor: pointer; font-size: 20px;">üí°</button>
                        <button class="emoji-option" data-emoji="üéØ" style="padding: 8px; background: rgba(128, 128, 128, 0.2); border: 1px solid rgba(128, 128, 128, 0.3); border-radius: 4px; cursor: pointer; font-size: 20px;">üéØ</button>
                        <button class="emoji-option" data-emoji="üé®" style="padding: 8px; background: rgba(128, 128, 128, 0.2); border: 1px solid rgba(128, 128, 128, 0.3); border-radius: 4px; cursor: pointer; font-size: 20px;">üé®</button>
                        <button class="emoji-option" data-emoji="üöÄ" style="padding: 8px; background: rgba(128, 128, 128, 0.2); border: 1px solid rgba(128, 128, 128, 0.3); border-radius: 4px; cursor: pointer; font-size: 20px;">üöÄ</button>
                        <button class="emoji-option" data-emoji="üíª" style="padding: 8px; background: rgba(128, 128, 128, 0.2); border: 1px solid rgba(128, 128, 128, 0.3); border-radius: 4px; cursor: pointer; font-size: 20px;">üíª</button>
                        <button class="emoji-option" data-emoji="üìä" style="padding: 8px; background: rgba(128, 128, 128, 0.2); border: 1px solid rgba(128, 128, 128, 0.3); border-radius: 4px; cursor: pointer; font-size: 20px;">üìä</button>
                    </div>
                    
                    <!-- Image Upload -->
                    <div id="image-picker" class="icon-picker-content" style="display: none;">
                        <input type="file" id="icon-image-upload" accept="image/*" style="width: 100%; padding: 8px; background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(128, 128, 128, 0.3); border-radius: 6px; color: #fff; font-size: 10px; cursor: pointer;">
                        <div id="image-preview" style="margin-top: 8px; min-height: 60px; display: flex; align-items: center; justify-content: center; background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(128, 128, 128, 0.3); border-radius: 6px; color: rgba(255, 255, 255, 0.4); font-size: 10px;">No image selected</div>
                    </div>
                    
                    <!-- Font Awesome Icons -->
                    <div id="fontawesome-picker" class="icon-picker-content" style="display: none; grid-template-columns: repeat(6, 1fr); gap: 4px; max-height: 150px; overflow-y: auto; padding: 8px; background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(128, 128, 128, 0.3); border-radius: 6px;">
                        <button class="fa-option" data-icon="fa-home" style="padding: 8px; background: rgba(128, 128, 128, 0.2); border: 1px solid rgba(128, 128, 128, 0.3); border-radius: 4px; cursor: pointer; font-size: 16px;">üè†</button>
                        <button class="fa-option" data-icon="fa-user" style="padding: 8px; background: rgba(128, 128, 128, 0.2); border: 1px solid rgba(128, 128, 128, 0.3); border-radius: 4px; cursor: pointer; font-size: 16px;">üë§</button>
                        <button class="fa-option" data-icon="fa-heart" style="padding: 8px; background: rgba(128, 128, 128, 0.2); border: 1px solid rgba(128, 128, 128, 0.3); border-radius: 4px; cursor: pointer; font-size: 16px;">‚ù§Ô∏è</button>
                        <button class="fa-option" data-icon="fa-star" style="padding: 8px; background: rgba(128, 128, 128, 0.2); border: 1px solid rgba(128, 128, 128, 0.3); border-radius: 4px; cursor: pointer; font-size: 16px;">‚≠ê</button>
                        <button class="fa-option" data-icon="fa-cog" style="padding: 8px; background: rgba(128, 128, 128, 0.2); border: 1px solid rgba(128, 128, 128, 0.3); border-radius: 4px; cursor: pointer; font-size: 16px;">‚öôÔ∏è</button>
                        <button class="fa-option" data-icon="fa-check" style="padding: 8px; background: rgba(128, 128, 128, 0.2); border: 1px solid rgba(128, 128, 128, 0.3); border-radius: 4px; cursor: pointer; font-size: 16px;">‚úì</button>
                    </div>
                    
                    <!-- Selected Icon Display -->
                    <div id="selected-icon-display" style="margin-top: 8px; padding: 8px; background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(128, 128, 128, 0.3); border-radius: 6px; color: rgba(255, 255, 255, 0.6); font-size: 10px; text-align: center;">
                        <span id="selected-icon-text">No icon selected</span>
                    </div>
                </div>
                
                <!-- Submit Button -->
                <button id="object-data-submit" style="width: 100%; padding: 10px; background: rgba(128, 128, 128, 0.3); border: 1px solid rgba(128, 128, 128, 0.5); border-radius: 6px; color: #fff; cursor: pointer; font-family: 'Orbitron', sans-serif; font-size: 12px; font-weight: 600; transition: all 0.3s; margin-bottom: 10px;">
                    SAVE DATA
                </button>
                
                <!-- View Panel Button -->
                <button id="open-view-panel-btn" style="width: 100%; padding: 10px; background: rgba(128, 128, 128, 0.3); border: 1px solid rgba(128, 128, 128, 0.5); border-radius: 6px; color: #fff; cursor: pointer; font-family: 'Orbitron', sans-serif; font-size: 12px; font-weight: 600; transition: all 0.3s;">
                    üìÑ VIEW PANEL
                </button>
            </div>
        </div>
    </div>
    <!-- Resize Handle -->
    <div id="inspector-resize-handle" style="position: absolute; bottom: 0; right: 0; width: 20px; height: 20px; cursor: nwse-resize; background: linear-gradient(135deg, transparent 50%, rgba(128, 128, 128, 0.5) 50%); border-bottom-right-radius: 16px;"></div>
</div>

<!-- Object Data View Panel -->
<div id="view-panel" style="display: none; position: fixed; left: 360px; top: 135px; width: 400px; max-height: calc(100vh - 400px); overflow-y: auto; background: rgba(25, 25, 30, 0.95); backdrop-filter: blur(20px); border: 1px solid rgba(128, 128, 128, 0.3); border-radius: 16px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4); color: #fff; z-index: 1000;">
    <div id="view-panel-header" style="display: flex; justify-content: space-between; align-items: center; padding: 12px 16px; background: rgba(128, 128, 128, 0.15); border-bottom: 1px solid rgba(128, 128, 128, 0.3); cursor: move; user-select: none; border-top-left-radius: 16px; border-top-right-radius: 16px;">
        <span style="font-size: 14px; font-weight: 600; letter-spacing: 0.5px;">OBJECT DATA VIEW</span>
        <button id="view-panel-close" style="width: 24px; height: 24px; border-radius: 50%; background: rgba(255, 0, 0, 0.2); border: 1px solid rgba(255, 0, 0, 0.5); color: #fff; cursor: pointer; font-size: 18px; line-height: 1;">√ó</button>
    </div>
    
    <div style="padding: 16px;">
    <!-- Header -->
    <div style="margin-bottom: 20px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
            <div style="font-size: 11px; color: rgba(255, 255, 255, 0.6); font-weight: 600;">HEADER</div>
            <button class="copy-btn" data-copy="header" style="padding: 4px 8px; background: rgba(128, 128, 128, 0.3); border: 1px solid rgba(128, 128, 128, 0.5); border-radius: 4px; color: #fff; cursor: pointer; font-family: 'Orbitron', sans-serif; font-size: 9px; font-weight: 600;">üìã COPY</button>
        </div>
        <div id="view-header" style="padding: 12px; background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(128, 128, 128, 0.3); border-radius: 8px; font-family: 'Orbitron', sans-serif; font-size: 13px; word-wrap: break-word; min-height: 40px;">
            ‚Äî
        </div>
    </div>
    
    <!-- Body -->
    <div style="margin-bottom: 20px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
            <div style="font-size: 11px; color: rgba(255, 255, 255, 0.6); font-weight: 600;">BODY</div>
            <button class="copy-btn" data-copy="body" style="padding: 4px 8px; background: rgba(128, 128, 128, 0.3); border: 1px solid rgba(128, 128, 128, 0.5); border-radius: 4px; color: #fff; cursor: pointer; font-family: 'Orbitron', sans-serif; font-size: 9px; font-weight: 600;">üìã COPY</button>
        </div>
        <div id="view-body" style="padding: 12px; background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(128, 128, 128, 0.3); border-radius: 8px; font-family: 'Orbitron', sans-serif; font-size: 12px; white-space: pre-wrap; word-wrap: break-word; min-height: 120px; max-height: 300px; overflow-y: auto;">
            ‚Äî
        </div>
    </div>
    
    <!-- Footer -->
    <div style="margin-bottom: 0;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
            <div style="font-size: 11px; color: rgba(255, 255, 255, 0.6); font-weight: 600;">FOOTER</div>
            <button class="copy-btn" data-copy="footer" style="padding: 4px 8px; background: rgba(128, 128, 128, 0.3); border: 1px solid rgba(128, 128, 128, 0.5); border-radius: 4px; color: #fff; cursor: pointer; font-family: 'Orbitron', sans-serif; font-size: 9px; font-weight: 600;">üìã COPY</button>
        </div>
        <div id="view-footer" style="padding: 12px; background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(128, 128, 128, 0.3); border-radius: 8px; font-family: 'Orbitron', sans-serif; font-size: 13px; word-wrap: break-word; min-height: 40px;">
            ‚Äî
        </div>
    </div>
    </div>
    
    <!-- Resize Handle -->
    <div id="view-panel-resize-handle" style="position: absolute; bottom: 0; right: 0; width: 20px; height: 20px; cursor: nwse-resize; background: linear-gradient(135deg, transparent 50%, rgba(128, 128, 128, 0.5) 50%); border-bottom-right-radius: 16px;"></div>
</div>

<!-- MySpace Grid Panel -->
<div id="myspace-grid-panel" class="side-menu" style="display: none; right: 120px; top: 80px; width: 350px; max-height: 600px; overflow-y: auto;">
    <div class="panel-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <span class="panel-title" style="font-size: 18px; font-weight: 700;">MYSPACE GRID</span>
        <button class="panel-btn close-btn" id="myspace-grid-close" style="background: none; border: none; color: #fff; font-size: 24px; cursor: pointer;">√ó</button>
    </div>
    
    <div style="margin-bottom: 25px;">
        <div style="font-weight: 600; margin-bottom: 15px; font-size: 14px; color: rgba(255, 255, 255, 0.9);">Grid Type</div>
        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
            <button class="myspace-grid-btn active" data-grid-type="spherical" style="padding: 12px; background: rgba(128, 128, 128, 0.3); border: 1px solid rgba(128, 128, 128, 0.5); border-radius: 8px; color: #fff; cursor: pointer; font-family: 'Orbitron', sans-serif; font-size: 11px; font-weight: 600; transition: all 0.3s;">
                üåê SPHERICAL
            </button>
            <button class="myspace-grid-btn" data-grid-type="planar" style="padding: 12px; background: rgba(128, 128, 128, 0.3); border: 1px solid rgba(128, 128, 128, 0.5); border-radius: 8px; color: #fff; cursor: pointer; font-family: 'Orbitron', sans-serif; font-size: 11px; font-weight: 600; transition: all 0.3s;">
                üìê PLANAR WALLS
            </button>
            <button class="myspace-grid-btn" data-grid-type="helix" style="padding: 12px; background: rgba(128, 128, 128, 0.3); border: 1px solid rgba(128, 128, 128, 0.5); border-radius: 8px; color: #fff; cursor: pointer; font-family: 'Orbitron', sans-serif; font-size: 11px; font-weight: 600; transition: all 0.3s;">
                üåÄ HELIX
            </button>
            <button class="myspace-grid-btn" data-grid-type="cube" style="padding: 12px; background: rgba(128, 128, 128, 0.3); border: 1px solid rgba(128, 128, 128, 0.5); border-radius: 8px; color: #fff; cursor: pointer; font-family: 'Orbitron', sans-serif; font-size: 11px; font-weight: 600; transition: all 0.3s;">
                ‚¨õ CUBE
            </button>
        </div>
    </div>
    
    <!-- Grid Settings -->
    <div style="margin-bottom: 20px;">
        <div style="font-weight: 600; margin-bottom: 10px; font-size: 14px; color: rgba(255, 255, 255, 0.9);">Grid Size</div>
        <input type="range" id="grid-size-slider" min="5" max="25" value="15" style="width: 100%; cursor: pointer; margin-bottom: 8px;">
        <div style="display: flex; justify-content: space-between; font-size: 11px; color: rgba(255, 255, 255, 0.7);">
            <span>Small (5)</span>
            <span id="grid-size-value">15</span>
            <span>Large (25)</span>
        </div>
    </div>
    
    <div style="margin-bottom: 20px;">
        <div style="font-weight: 600; margin-bottom: 10px; font-size: 14px; color: rgba(255, 255, 255, 0.9);">Grid Spacing</div>
        <input type="range" id="grid-spacing-slider" min="1" max="5" value="2" step="0.5" style="width: 100%; cursor: pointer; margin-bottom: 8px;">
        <div style="display: flex; justify-content: space-between; font-size: 11px; color: rgba(255, 255, 255, 0.7);">
            <span>Tight (1)</span>
            <span id="grid-spacing-value">2</span>
            <span>Wide (5)</span>
        </div>
    </div>
    
    <button id="apply-grid-btn" style="width: 100%; padding: 12px; background: rgba(128, 128, 128, 0.4); border: 1px solid rgba(128, 128, 128, 0.6); border-radius: 8px; color: #fff; cursor: pointer; font-family: 'Orbitron', sans-serif; font-size: 12px; font-weight: 600; transition: all 0.3s;">
        ‚úì APPLY CHANGES
    </button>
</div>

<!-- Mobile Movement Control -->
<div id="movement-control">
    <div class="joystick-base">
        <div class="joystick-stick" id="joystick-stick"></div>
    </div>
    <div class="control-buttons">
        <!-- Column 1: Vertical Movement -->
        <button class="control-btn vertical-btn" id="btn-up" title="Move Up (R)">‚Üë</button>
        <button class="control-btn vertical-btn" id="btn-down" title="Move Down (F)">‚Üì</button>
        <button class="control-btn vertical-btn" id="btn-center" title="Reset Camera (O)">‚¶ø</button>
        
        <!-- Column 2: Transform Controls -->
        <button class="control-btn" id="btn-pos" title="Position">POS</button>
        <button class="control-btn" id="btn-rot" title="Rotation">ROT</button>
        <button class="control-btn" id="btn-scale" title="Scale">SCL</button>
        
        <!-- Column 3: Hand Menus -->
        <button class="control-btn" id="btn-lh" title="Left Hand">LH</button>
        <button class="control-btn" id="btn-rh" title="Right Hand">RH</button>
        <button class="control-btn" id="btn-ch" title="Conscious Hand">CH</button>
        
        <!-- Column 4: UI Toggles -->
        <button class="control-btn" id="btn-docks" title="Docks">DO</button>
        <button class="control-btn" id="btn-keyboard" title="Keyboard">KB</button>
        <button class="control-btn" id="btn-action-grid" title="Action Grid">GKB</button>
        
        <!-- Column 5: Future Buttons -->
        <button class="control-btn" id="btn-nav" title="Toggle Navigation Bar">NAV</button>
        <button class="control-btn" id="btn-rulers" title="Toggle Rulers">RUL</button>
        <button class="control-btn" id="btn-13">MAX</button>
    </div>
</div>

<!-- Position Rulers -->
<div id="x-axis-ruler" style="display: none; position: fixed; bottom: 20px; right: 20px; width: 300px; height: 30px; background: rgba(255, 255, 255, 0.15); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.4); border-radius: 8px; align-items: center; justify-content: space-between; padding: 0 10px; font-family: 'Courier New', monospace; font-size: 10px; color: #fff; z-index: 900;">
    <span style="color: rgba(255, 255, 255, 0.8);">-50</span>
    <div style="flex: 1; height: 2px; background: linear-gradient(90deg, rgba(255, 255, 255, 0.3), rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.3)); margin: 0 10px; position: relative; box-shadow: 0 0 5px rgba(255, 255, 255, 0.5);">
        <div id="x-marker" style="position: absolute; width: 3px; height: 10px; background: #fff; box-shadow: 0 0 15px rgba(255, 255, 255, 0.9), 0 0 25px rgba(255, 255, 255, 0.5); left: 50%; transform: translateX(-50%); top: -4px; border-radius: 2px;"></div>
    </div>
    <span style="color: rgba(255, 255, 255, 0.8);">+50</span>
    <span style="margin-left: 10px; color: #fff; font-weight: 700; text-shadow: 0 0 10px rgba(255, 255, 255, 0.8), 0 0 20px rgba(255, 255, 255, 0.5);">X</span>
</div>

<div id="z-axis-ruler" style="display: none; position: fixed; right: 20px; top: 160px; width: 30px; height: 300px; background: rgba(255, 255, 255, 0.15); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.4); border-radius: 8px; flex-direction: column; align-items: center; justify-content: space-between; padding: 10px 0; font-family: 'Courier New', monospace; font-size: 10px; color: #fff; z-index: 900;">
    <span style="color: rgba(255, 255, 255, 0.8);">+50</span>
    <div style="flex: 1; width: 2px; background: linear-gradient(180deg, rgba(255, 255, 255, 0.3), rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.3)); margin: 10px 0; position: relative; box-shadow: 0 0 5px rgba(255, 255, 255, 0.5);">
        <div id="z-marker" style="position: absolute; height: 3px; width: 10px; background: #fff; box-shadow: 0 0 15px rgba(255, 255, 255, 0.9), 0 0 25px rgba(255, 255, 255, 0.5); top: 50%; left: 50%; transform: translate(-50%, -50%); border-radius: 2px;"></div>
    </div>
    <span style="color: rgba(255, 255, 255, 0.8);">-50</span>
    <div style="margin-top: 10px; color: #fff; font-weight: 700; writing-mode: vertical-rl; transform: rotate(180deg); text-shadow: 0 0 10px rgba(255, 255, 255, 0.8), 0 0 20px rgba(255, 255, 255, 0.5);">Z</div>
</div>

<div id="y-axis-ruler" style="display: none; position: fixed; left: 20px; top: 160px; width: 30px; height: 300px; background: rgba(255, 255, 255, 0.15); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.4); border-radius: 8px; flex-direction: column; align-items: center; justify-content: space-between; padding: 10px 0; font-family: 'Courier New', monospace; font-size: 10px; color: #fff; z-index: 900;">
    <span style="color: rgba(255, 255, 255, 0.8);">+50</span>
    <div style="flex: 1; width: 2px; background: linear-gradient(180deg, rgba(255, 255, 255, 0.3), rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.3)); margin: 10px 0; position: relative; box-shadow: 0 0 5px rgba(255, 255, 255, 0.5);">
        <div id="y-marker" style="position: absolute; height: 3px; width: 10px; background: #fff; box-shadow: 0 0 15px rgba(255, 255, 255, 0.9), 0 0 25px rgba(255, 255, 255, 0.5); top: 50%; left: 50%; transform: translate(-50%, -50%); border-radius: 2px;"></div>
    </div>
    <span style="color: rgba(255, 255, 255, 0.8);">-50</span>
    <div style="margin-top: 10px; color: #fff; font-weight: 700; writing-mode: vertical-rl; transform: rotate(180deg); text-shadow: 0 0 10px rgba(255, 255, 255, 0.8), 0 0 20px rgba(255, 255, 255, 0.5);">Y</div>
</div>

<!-- JSON Viewer Panel -->
<div id="json-viewer-panel" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 80vw; max-width: 800px; height: 70vh; background: rgba(25, 25, 30, 0.98); border: 2px solid rgba(255, 255, 255, 0.3); border-radius: 12px; z-index: 5000; backdrop-filter: blur(20px); box-shadow: 0 0 40px rgba(0, 0, 0, 0.8), 0 0 80px rgba(255, 255, 255, 0.2); resize: both; overflow: hidden; min-width: 400px; min-height: 300px;">
    <!-- Header -->
    <div id="json-viewer-header" style="padding: 16px; border-bottom: 1px solid rgba(128, 128, 128, 0.3); display: flex; justify-content: space-between; align-items: center; gap: 12px; cursor: move; user-select: none;">
        <div style="font-family: 'Orbitron', sans-serif; font-size: 14px; font-weight: 700; color: #fff; text-shadow: 0 0 10px rgba(255, 255, 255, 0.8);">üìú DATA VIEWER</div>
        
        <!-- Transparency Control -->
        <div style="display: flex; align-items: center; gap: 8px; flex: 1; max-width: 300px;">
            <span style="font-size: 10px; color: rgba(255, 255, 255, 0.6); white-space: nowrap;">Opacity:</span>
            <input type="range" id="json-viewer-opacity" min="0.3" max="1" step="0.1" value="0.98" style="flex: 1; height: 4px; background: rgba(128, 128, 128, 0.3); border-radius: 2px; outline: none;">
            <span id="json-viewer-opacity-value" style="font-size: 10px; color: rgba(255, 255, 255, 0.6); min-width: 30px;">98%</span>
        </div>
        
        <div style="display: flex; gap: 8px;">
            <button id="toggle-3d-viewer" style="padding: 6px 12px; background: rgba(128, 128, 128, 0.3); border: 1px solid rgba(128, 128, 128, 0.5); border-radius: 6px; color: #fff; cursor: pointer; font-size: 10px; font-weight: 600;">3D VIEW</button>
            <button id="minimize-json-viewer" style="width: 32px; height: 32px; background: rgba(128, 128, 128, 0.3); border: 1px solid rgba(128, 128, 128, 0.5); border-radius: 6px; color: #fff; cursor: pointer; font-size: 18px; display: flex; align-items: center; justify-content: center;">‚àí</button>
            <button id="close-json-viewer" style="width: 32px; height: 32px; background: rgba(128, 128, 128, 0.3); border: 1px solid rgba(128, 128, 128, 0.5); border-radius: 6px; color: #fff; cursor: pointer; font-size: 18px; display: flex; align-items: center; justify-content: center;">√ó</button>
        </div>
    </div>
    
    <!-- Scroll Controls -->
    <div style="position: absolute; right: 16px; top: 50%; transform: translateY(-50%); display: flex; flex-direction: column; gap: 8px; z-index: 1;">
        <button id="json-scroll-up" style="width: 40px; height: 40px; background: rgba(128, 128, 128, 0.3); border: 1px solid rgba(128, 128, 128, 0.5); border-radius: 6px; color: #fff; cursor: pointer; font-size: 20px; display: flex; align-items: center; justify-content: center;">‚ñ≤</button>
        <button id="json-scroll-down" style="width: 40px; height: 40px; background: rgba(128, 128, 128, 0.3); border: 1px solid rgba(128, 128, 128, 0.5); border-radius: 6px; color: #fff; cursor: pointer; font-size: 20px; display: flex; align-items: center; justify-content: center;">‚ñº</button>
    </div>
    
    <!-- Content Area -->
    <div id="json-viewer-content" style="padding: 20px; height: calc(100% - 64px); overflow-y: auto; font-family: 'Courier New', monospace; font-size: 12px; color: #fff; line-height: 1.6;">
        <pre id="json-viewer-pre" style="margin: 0; white-space: pre-wrap; word-wrap: break-word;"></pre>
    </div>
</div>

<!-- Minimized JSON Viewer Tab -->
<div id="json-viewer-minimized" style="display: none; position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); padding: 12px 24px; background: rgba(25, 25, 30, 0.95); border: 1px solid rgba(255, 255, 255, 0.3); border-radius: 8px; cursor: pointer; backdrop-filter: blur(20px); z-index: 5000;">
    <span style="font-family: 'Orbitron', sans-serif; font-size: 12px; font-weight: 600; color: #fff;">üìú DATA VIEWER (minimized)</span>
</div>

<!-- 3D Panel Control Panel -->
<div id="panel-3d-controls" style="display: none; position: fixed; right: 20px; top: 50%; transform: translateY(-50%); width: 280px; background: rgba(25, 25, 30, 0.95); border: 2px solid rgba(255, 255, 255, 0.3); border-radius: 12px; backdrop-filter: blur(20px); z-index: 4500; box-shadow: 0 0 40px rgba(0, 0, 0, 0.8), 0 0 80px rgba(255, 255, 255, 0.2);">
    <!-- Header -->
    <div id="panel-3d-header" style="padding: 12px; border-bottom: 1px solid rgba(128, 128, 128, 0.3); display: flex; justify-content: space-between; align-items: center; cursor: move; user-select: none;">
        <span style="font-family: 'Orbitron', sans-serif; font-size: 12px; font-weight: 700; color: #fff; text-shadow: 0 0 10px rgba(255, 255, 255, 0.8);">‚öôÔ∏è 3D PANEL CONTROLS</span>
        <button id="close-3d-controls" style="width: 28px; height: 28px; background: rgba(128, 128, 128, 0.3); border: 1px solid rgba(128, 128, 128, 0.5); border-radius: 6px; color: #fff; cursor: pointer; font-size: 16px; display: flex; align-items: center; justify-content: center;">√ó</button>
    </div>
    
    <!-- Content -->
    <div style="padding: 16px; max-height: 70vh; overflow-y: auto;">
        <!-- Position Controls -->
        <div style="margin-bottom: 16px;">
            <div style="font-size: 10px; font-weight: 700; color: #fff; margin-bottom: 8px; text-shadow: 0 0 10px rgba(255, 255, 255, 0.8);">POSITION</div>
            <div style="display: grid; grid-template-columns: 20px 1fr; gap: 8px; align-items: center;">
                <span style="font-size: 9px; color: rgba(255, 255, 255, 0.7);">X</span>
                <input type="range" id="panel-3d-pos-x" min="-15" max="15" step="0.5" value="0" style="width: 100%;">
                <span style="font-size: 9px; color: rgba(255, 255, 255, 0.7);">Y</span>
                <input type="range" id="panel-3d-pos-y" min="-15" max="15" step="0.5" value="0" style="width: 100%;">
                <span style="font-size: 9px; color: rgba(255, 255, 255, 0.7);">Z</span>
                <input type="range" id="panel-3d-pos-z" min="-15" max="15" step="0.5" value="0" style="width: 100%;">
            </div>
        </div>
        
        <!-- Rotation Controls -->
        <div style="margin-bottom: 16px;">
            <div style="font-size: 10px; font-weight: 700; color: #fff; margin-bottom: 8px; text-shadow: 0 0 10px rgba(255, 255, 255, 0.8);">ROTATION</div>
            <div style="display: grid; grid-template-columns: 20px 1fr; gap: 8px; align-items: center;">
                <span style="font-size: 9px; color: rgba(255, 255, 255, 0.7);">X</span>
                <input type="range" id="panel-3d-rot-x" min="0" max="360" step="1" value="0" style="width: 100%;">
                <span style="font-size: 9px; color: rgba(255, 255, 255, 0.7);">Y</span>
                <input type="range" id="panel-3d-rot-y" min="0" max="360" step="1" value="0" style="width: 100%;">
                <span style="font-size: 9px; color: rgba(255, 255, 255, 0.7);">Z</span>
                <input type="range" id="panel-3d-rot-z" min="0" max="360" step="1" value="0" style="width: 100%;">
            </div>
        </div>
        
        <!-- Scale Controls -->
        <div style="margin-bottom: 16px;">
            <div style="font-size: 10px; font-weight: 700; color: #fff; margin-bottom: 8px; text-shadow: 0 0 10px rgba(255, 255, 255, 0.8);">SCALE</div>
            <div style="display: grid; grid-template-columns: 20px 1fr; gap: 8px; align-items: center;">
                <span style="font-size: 9px; color: rgba(255, 255, 255, 0.7);">X</span>
                <input type="range" id="panel-3d-sca-x" min="0.5" max="3" step="0.1" value="1" style="width: 100%;">
                <span style="font-size: 9px; color: rgba(255, 255, 255, 0.7);">Y</span>
                <input type="range" id="panel-3d-sca-y" min="0.5" max="3" step="0.1" value="2" style="width: 100%;">
                <span style="font-size: 9px; color: rgba(255, 255, 255, 0.7);">Z</span>
                <input type="range" id="panel-3d-sca-z" min="0.5" max="3" step="0.1" value="1" style="width: 100%;">
            </div>
        </div>
        
        <!-- Color Control -->
        <div style="margin-bottom: 16px;">
            <div style="font-size: 10px; font-weight: 700; color: #fff; margin-bottom: 8px; text-shadow: 0 0 10px rgba(255, 255, 255, 0.8);">PANEL COLOR</div>
            <input type="color" id="panel-3d-color" value="#191920" style="width: 100%; height: 40px; border: 1px solid rgba(128, 128, 128, 0.5); border-radius: 6px; background: rgba(0, 0, 0, 0.3); cursor: pointer;">
        </div>
        
        <!-- Opacity Control -->
        <div style="margin-bottom: 16px;">
            <div style="font-size: 10px; font-weight: 700; color: #fff; margin-bottom: 8px; text-shadow: 0 0 10px rgba(255, 255, 255, 0.8);">OPACITY</div>
            <input type="range" id="panel-3d-opacity" min="0.1" max="1" step="0.1" value="0.95" style="width: 100%;">
            <span id="panel-3d-opacity-value" style="font-size: 9px; color: rgba(255, 255, 255, 0.6);">95%</span>
        </div>
        
        <!-- Put in Pocket Button -->
        <button id="put-panel-in-pocket" style="width: 100%; padding: 10px; background: rgba(128, 128, 128, 0.3); border: 1px solid rgba(128, 128, 128, 0.5); border-radius: 6px; color: #fff; cursor: pointer; font-family: 'Orbitron', sans-serif; font-size: 11px; font-weight: 600;">
            üì¶ PUT IN POCKET
        </button>
    </div>
</div>

<!-- 3D Panel Control Panel -->
<div id="panel-3d-controls" style="display: none; position: fixed; right: 20px; top: 50%; transform: translateY(-50%); width: 280px; background: rgba(25, 25, 30, 0.95); border: 2px solid rgba(255, 255, 255, 0.3); border-radius: 12px; z-index: 5000; backdrop-filter: blur(20px); box-shadow: 0 0 40px rgba(0, 0, 0, 0.8);">
    <!-- Header (draggable) -->
    <div id="panel-3d-header" style="padding: 12px 16px; border-bottom: 1px solid rgba(128, 128, 128, 0.3); display: flex; justify-content: space-between; align-items: center; cursor: move; user-select: none; background: rgba(128, 128, 128, 0.2);">
        <div style="font-family: 'Orbitron', sans-serif; font-size: 12px; font-weight: 700; color: #fff; text-shadow: 0 0 10px rgba(255, 255, 255, 0.8);">üéõÔ∏è 3D PANEL CONTROLS</div>
        <button id="close-3d-controls" style="width: 24px; height: 24px; background: rgba(128, 128, 128, 0.3); border: 1px solid rgba(128, 128, 128, 0.5); border-radius: 4px; color: #fff; cursor: pointer; font-size: 16px; display: flex; align-items: center; justify-content: center;">√ó</button>
    </div>
    
    <!-- Content -->
    <div style="padding: 16px; max-height: 600px; overflow-y: auto;">
        <!-- Position Controls -->
        <div style="margin-bottom: 16px;">
            <div style="font-size: 10px; font-weight: 700; color: #fff; margin-bottom: 8px; text-shadow: 0 0 8px rgba(255, 255, 255, 0.6);">POSITION</div>
            <div style="display: grid; grid-template-columns: 30px 1fr; gap: 8px; align-items: center;">
                <span style="font-size: 10px; color: rgba(255, 255, 255, 0.8);">X:</span>
                <input type="range" id="panel-3d-pos-x" min="-20" max="20" step="0.5" value="0" style="width: 100%;">
                
                <span style="font-size: 10px; color: rgba(255, 255, 255, 0.8);">Y:</span>
                <input type="range" id="panel-3d-pos-y" min="-20" max="20" step="0.5" value="0" style="width: 100%;">
                
                <span style="font-size: 10px; color: rgba(255, 255, 255, 0.8);">Z:</span>
                <input type="range" id="panel-3d-pos-z" min="-20" max="20" step="0.5" value="0" style="width: 100%;">
            </div>
        </div>
        
        <!-- Rotation Controls -->
        <div style="margin-bottom: 16px;">
            <div style="font-size: 10px; font-weight: 700; color: #fff; margin-bottom: 8px; text-shadow: 0 0 8px rgba(255, 255, 255, 0.6);">ROTATION</div>
            <div style="display: grid; grid-template-columns: 30px 1fr; gap: 8px; align-items: center;">
                <span style="font-size: 10px; color: rgba(255, 255, 255, 0.8);">X:</span>
                <input type="range" id="panel-3d-rot-x" min="-3.14" max="3.14" step="0.1" value="0" style="width: 100%;">
                
                <span style="font-size: 10px; color: rgba(255, 255, 255, 0.8);">Y:</span>
                <input type="range" id="panel-3d-rot-y" min="-3.14" max="3.14" step="0.1" value="0" style="width: 100%;">
                
                <span style="font-size: 10px; color: rgba(255, 255, 255, 0.8);">Z:</span>
                <input type="range" id="panel-3d-rot-z" min="-3.14" max="3.14" step="0.1" value="0" style="width: 100%;">
            </div>
        </div>
        
        <!-- Scale Controls -->
        <div style="margin-bottom: 16px;">
            <div style="font-size: 10px; font-weight: 700; color: #fff; margin-bottom: 8px; text-shadow: 0 0 8px rgba(255, 255, 255, 0.6);">SCALE</div>
            <div style="display: grid; grid-template-columns: 30px 1fr; gap: 8px; align-items: center;">
                <span style="font-size: 10px; color: rgba(255, 255, 255, 0.8);">X:</span>
                <input type="range" id="panel-3d-sca-x" min="0.1" max="3" step="0.1" value="1" style="width: 100%;">
                
                <span style="font-size: 10px; color: rgba(255, 255, 255, 0.8);">Y:</span>
                <input type="range" id="panel-3d-sca-y" min="0.1" max="3" step="0.1" value="1" style="width: 100%;">
                
                <span style="font-size: 10px; color: rgba(255, 255, 255, 0.8);">Z:</span>
                <input type="range" id="panel-3d-sca-z" min="0.1" max="3" step="0.1" value="1" style="width: 100%;">
            </div>
        </div>
        
        <!-- Color Control -->
        <div style="margin-bottom: 16px;">
            <div style="font-size: 10px; font-weight: 700; color: #fff; margin-bottom: 8px; text-shadow: 0 0 8px rgba(255, 255, 255, 0.6);">PANEL COLOR</div>
            <div style="display: flex; gap: 8px; align-items: center;">
                <input type="color" id="panel-3d-color" value="#191919" style="width: 60px; height: 32px; border: 1px solid rgba(128, 128, 128, 0.5); border-radius: 4px; cursor: pointer;">
                <span id="panel-3d-color-value" style="font-size: 10px; color: rgba(255, 255, 255, 0.8); font-family: 'Courier New', monospace;">#191919</span>
            </div>
        </div>
        
        <!-- Opacity Control -->
        <div style="margin-bottom: 16px;">
            <div style="font-size: 10px; font-weight: 700; color: #fff; margin-bottom: 8px; text-shadow: 0 0 8px rgba(255, 255, 255, 0.6);">OPACITY</div>
            <div style="display: flex; gap: 8px; align-items: center;">
                <input type="range" id="panel-3d-opacity" min="0.3" max="1" step="0.05" value="0.95" style="flex: 1;">
                <span id="panel-3d-opacity-value" style="font-size: 10px; color: rgba(255, 255, 255, 0.8); min-width: 35px;">95%</span>
            </div>
        </div>
        
        <!-- Action Buttons -->
        <div style="display: flex; flex-direction: column; gap: 8px;">
            <button id="reset-3d-panel" style="width: 100%; padding: 10px; background: rgba(128, 128, 128, 0.3); border: 1px solid rgba(128, 128, 128, 0.5); border-radius: 6px; color: #fff; cursor: pointer; font-family: 'Orbitron', sans-serif; font-size: 11px; font-weight: 600;">üîÑ RESET POSITION</button>
            
            <button id="save-to-pocket-3d" style="width: 100%; padding: 10px; background: rgba(128, 128, 128, 0.3); border: 1px solid rgba(128, 128, 128, 0.5); border-radius: 6px; color: #fff; cursor: pointer; font-family: 'Orbitron', sans-serif; font-size: 11px; font-weight: 600;">üíº SAVE TO POCKET</button>
            
            <button id="remove-3d-panel" style="width: 100%; padding: 10px; background: rgba(180, 80, 80, 0.3); border: 1px solid rgba(180, 80, 80, 0.5); border-radius: 6px; color: #fff; cursor: pointer; font-family: 'Orbitron', sans-serif; font-size: 11px; font-weight: 600;">üóëÔ∏è REMOVE PANEL</button>
        </div>
    </div>
</div>

<!-- Virtual Keyboard -->
<div id="virtual-keyboard"></div>

<!-- Transform Panel -->
<div id="transform-panel">
    <div class="transform-header">
        <span class="panel-title" id="transform-title">POSITION</span>
        <button class="panel-btn close-btn" id="transform-close">√ó</button>
    </div>
    <div class="transform-content">
        <div class="transform-row">
            <div class="transform-label">X</div>
            <div class="transform-inputs">
                <input type="number" class="transform-input" id="transform-x" value="0" step="0.1">
            </div>
        </div>
        <div class="transform-row">
            <div class="transform-label">Y</div>
            <div class="transform-inputs">
                <input type="number" class="transform-input" id="transform-y" value="0" step="0.1">
            </div>
        </div>
        <div class="transform-row">
            <div class="transform-label">Z</div>
            <div class="transform-inputs">
                <input type="number" class="transform-input" id="transform-z" value="0" step="0.1">
            </div>
        </div>
        <div class="transform-row">
            <div class="transform-label">Step Size</div>
            <div class="step-control">
                <span class="step-label">Range:</span>
                <input type="number" class="step-input" id="step-size" value="1" min="-1000" max="1000">
            </div>
        </div>
        <div class="transform-submit-container">
            <button class="transform-submit-btn" id="transform-submit">Apply Changes</button>
        </div>
    </div>
</div>

<!-- Action Button Grid (30 buttons) -->
<div id="action-grid" class="hidden">
    <button class="action-btn" data-action="1">A1</button>
    <button class="action-btn" data-action="2">A2</button>
    <button class="action-btn" data-action="3">A3</button>
    <button class="action-btn" data-action="4">A4</button>
    <button class="action-btn" data-action="5">A5</button>
    <button class="action-btn" data-action="6">A6</button>
    <button class="action-btn" data-action="7">A7</button>
    <button class="action-btn" data-action="8">A8</button>
    <button class="action-btn" data-action="9">A9</button>
    <button class="action-btn" data-action="10">A10</button>
    <button class="action-btn" data-action="11">A11</button>
    <button class="action-btn" data-action="12">A12</button>
    <button class="action-btn" data-action="13">A13</button>
    <button class="action-btn" data-action="14">A14</button>
    <button class="action-btn" data-action="15">A15</button>
    <button class="action-btn" data-action="16">A16</button>
    <button class="action-btn" data-action="17">A17</button>
    <button class="action-btn" data-action="18">A18</button>
    <button class="action-btn" data-action="19">A19</button>
    <button class="action-btn" data-action="20">A20</button>
    <button class="action-btn" data-action="21">A21</button>
    <button class="action-btn" data-action="22">A22</button>
    <button class="action-btn" data-action="23">A23</button>
    <button class="action-btn" data-action="24">A24</button>
    <button class="action-btn" data-action="25">A25</button>
    <button class="action-btn" data-action="26">A26</button>
    <button class="action-btn" data-action="27">A27</button>
    <button class="action-btn" data-action="28">A28</button>
    <button class="action-btn" data-action="29">A29</button>
    <button class="action-btn" data-action="30">A30</button>
</div>

<!-- THREE.js and GSAP -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

<script>
            </style>
        `;
        
        document.body.appendChild(welcomePanel);
        
        // Button click starts entrance
        document.getElementById('start-entrance').addEventListener('click', () => {
            playSound('active');
            welcomePanel.style.transition = 'opacity 0.5s';
            welcomePanel.style.opacity = '0';
            setTimeout(() => {
                welcomePanel.remove();
                startEntranceSequence();
            }, 500);
        });
    }
    
    function startEntranceSequence() {
        isEntranceActive = true;
        entranceProgress = 0;
        
        // Move camera way above
        camera.position.set(0, 100000, 0);
        camera.lookAt(0, 0, 0);
        
        // Create primary tunnel cylinder (50% transparent white)
        const tunnelGeometry = new THREE.CylinderGeometry(15, 15, 200000, 32, 1, true);
        const tunnelMaterial = new THREE.MeshBasicMaterial({
            color: 0xffffff,
            transparent: true,
            opacity: 0.5,
            side: THREE.DoubleSide
        });
        entranceTunnel = new THREE.Mesh(tunnelGeometry, tunnelMaterial);
        entranceTunnel.position.y = 50000;
        scene.add(entranceTunnel);
        
        // Create wireframe cylinder inside
        const wireframeGeometry = new THREE.CylinderGeometry(14, 14, 200000, 16, 1, true);
        const wireframeMaterial = new THREE.MeshBasicMaterial({
            color: 0xffffff,
            wireframe: true,
            transparent: true,
            opacity: 0.8
        });
        entranceWireframe = new THREE.Mesh(wireframeGeometry, wireframeMaterial);
        entranceWireframe.position.y = 50000;
        scene.add(entranceWireframe);
        
        // Create ring geometries that come towards user
        for (let i = 0; i < 20; i++) {
            const ringGeometry = new THREE.TorusGeometry(12, 0.5, 16, 32);
            const ringMaterial = new THREE.MeshBasicMaterial({
                color: 0xffffff,
                transparent: true,
                opacity: 0.8
            });
            const ring = new THREE.Mesh(ringGeometry, ringMaterial);
            ring.rotation.x = Math.PI / 2;
            ring.position.y = i * 10000;
            ring.userData.initialY = ring.position.y;
            entranceRings.push(ring);
            scene.add(ring);
        }
        
        // Disable controls during entrance
        controlsEnabled = false;
    }
    
    function updateEntranceSequence(delta) {
        if (!isEntranceActive) return;
        
        // 5 second descent
        entranceProgress += delta / 5;
        
        if (entranceProgress < 1) {
            // Descend
            const startY = 100000;
            const endY = 15;
            camera.position.y = startY - (startY - endY) * entranceProgress;
            
            // Rotate tunnel
            if (entranceTunnel) entranceTunnel.rotation.y += delta * 2;
            if (entranceWireframe) entranceWireframe.rotation.y -= delta * 3;
            
            // Move rings towards user
            entranceRings.forEach((ring, i) => {
                ring.position.y -= delta * 20000;
                if (ring.position.y < camera.position.y - 1000) {
                    ring.position.y = camera.position.y + 20000;
                }
                ring.rotation.z += delta * 2;
            });
        } else {
            // Landing sequence
            endEntranceSequence();
        }
    }
    
    function endEntranceSequence() {
        isEntranceActive = false;
        
        // Remove tunnel and rings
        if (entranceTunnel) {
            scene.remove(entranceTunnel);
            entranceTunnel = null;
        }
        if (entranceWireframe) {
            scene.remove(entranceWireframe);
            entranceWireframe = null;
        }
        entranceRings.forEach(ring => scene.remove(ring));
        entranceRings = [];
        
        // Create landing cylinder effect
        const landingGeometry = new THREE.CylinderGeometry(8, 8, 30, 32, 1, true);
        const landingMaterial = new THREE.MeshBasicMaterial({
            color: 0xffffff,
            transparent: true,
            opacity: 0.9,
            side: THREE.DoubleSide
        });
        landingCylinder = new THREE.Mesh(landingGeometry, landingMaterial);
        landingCylinder.position.copy(camera.position);
        scene.add(landingCylinder);
        
        // Animate cylinder rising and fading
        let landingProgress = 0;
        const landingAnimation = setInterval(() => {
            landingProgress += 0.02;
            if (landingProgress >= 1) {
                scene.remove(landingCylinder);
                landingCylinder = null;
                clearInterval(landingAnimation);
                controlsEnabled = true;
            } else {
                landingCylinder.position.y += 2;
                landingCylinder.material.opacity = 0.9 * (1 - landingProgress);
                landingCylinder.scale.set(1 + landingProgress * 2, 1, 1 + landingProgress * 2);
            }
        }, 16);
        
        // Smooth camera transition to final position
        gsap.to(camera.position, {
            duration: 1,
            x: 0,
            y: 0,
            z: 15,
            ease: 'power2.out',
            onUpdate: () => {
                // During transition, gradually face forward
                camera.lookAt(0, 0, 0);
            },
            onComplete: () => {
                // Once at final position, face forward towards horizon
                camera.lookAt(0, 0, -100);
            }
        });
        
        playSound('active');
    }

    function onMouseMove(event) {
        const rect = renderer.domElement.getBoundingClientRect();
        mouse.x = ((event.clientX - rect.left) / rect.width) * 2 - 1;
        mouse.y = -((event.clientY - rect.top) / rect.height) * 2 + 1;

        // Mouse look - only when holding C key (Metroid Prime style)
        if (keys.c && !isRotating) {
            const deltaX = event.clientX - lastMouseX;
            const deltaY = event.clientY - lastMouseY;
            
            lastMouseX = event.clientX;
            lastMouseY = event.clientY;

            // Apply FPS-style rotation
            if (Math.abs(deltaX) > 0.1 || Math.abs(deltaY) > 0.1) {
                // Horizontal rotation (yaw) - rotate around world Y axis
                camera.rotateOnWorldAxis(new THREE.Vector3(0, 1, 0), -deltaX * lookSensitivity);
                
                // Vertical rotation (pitch) - rotate around camera's local X axis
                const pitchAxis = new THREE.Vector3(1, 0, 0);
                const pitchQuaternion = new THREE.Quaternion().setFromAxisAngle(pitchAxis, -deltaY * lookSensitivity);
                camera.quaternion.multiply(pitchQuaternion);
                
                // Clamp pitch to prevent looking too far up or down
                const forward = new THREE.Vector3(0, 0, -1);
                forward.applyQuaternion(camera.quaternion);
                
                // If looking too far down, clamp it
                if (forward.y < -0.99) {
                    const correctionAxis = new THREE.Vector3(1, 0, 0);
                    const correctionAngle = -0.01;
                    const correctionQuaternion = new THREE.Quaternion().setFromAxisAngle(correctionAxis, correctionAngle);
                    camera.quaternion.multiply(correctionQuaternion);
                }
                // If looking too far up, clamp it
                else if (forward.y > 0.99) {
                    const correctionAxis = new THREE.Vector3(1, 0, 0);
                    const correctionAngle = 0.01;
                    const correctionQuaternion = new THREE.Quaternion().setFromAxisAngle(correctionAxis, correctionAngle);
                    camera.quaternion.multiply(correctionQuaternion);
                }
            }
        } else {
            // Update last mouse position even when not looking
            lastMouseX = event.clientX;
            lastMouseY = event.clientY;
        }

        // Orbit rotation (when dragging without C key)
        if (isRotating && !keys.c) {
            const deltaX = event.clientX - previousMousePosition.x;
            const deltaY = event.clientY - previousMousePosition.y;
            
            const rotationSpeed = 0.005;
            const euler = new THREE.Euler(
                deltaY * rotationSpeed,
                deltaX * rotationSpeed,
                0,
                'XYZ'
            );
            
            const quaternion = new THREE.Quaternion().setFromEuler(euler);
            camera.position.applyQuaternion(quaternion);
            camera.lookAt(cameraTarget);
            
            previousMousePosition = { x: event.clientX, y: event.clientY };
        }

        // Raycasting for hover
        raycaster.setFromCamera(mouse, camera);
        const intersects = raycaster.intersectObjects(interactiveObjects);

        if (intersects.length > 0) {
            const hoveredObj = intersects[0].object;
            if (hoveredObj !== hoveredObject) {
                if (hoveredObject && hoveredObject !== selectedObject) {
                    hoveredObject.material.color.setHex(hoveredObject.userData.originalColor);
                    hoveredObject.material.opacity = hoveredObject.userData.type === 'grid' ? 0.2 : 0.8;
                }
                hoveredObject = hoveredObj;
                if (hoveredObj !== selectedObject) {
                    hoveredObj.material.color.setHex(0x888888);
                    hoveredObj.material.opacity = 0.6;
                }
                playSound('hover');
            }
        } else {
            if (hoveredObject && hoveredObject !== selectedObject) {
                hoveredObject.material.color.setHex(hoveredObject.userData.originalColor);
                hoveredObject.material.opacity = hoveredObject.userData.type === 'grid' ? 0.2 : 0.8;
            }
            hoveredObject = null;
        }
    }

    function onMouseDown(event) {
        if (event.button === 0) {
            const rect = renderer.domElement.getBoundingClientRect();
            const x = ((event.clientX - rect.left) / rect.width) * 2 - 1;
            const y = -((event.clientY - rect.top) / rect.height) * 2 + 1;
            
            raycaster.setFromCamera({ x, y }, camera);
            const intersects = raycaster.intersectObjects(interactiveObjects);

            if (intersects.length > 0) {
                const clickedObj = intersects[0].object;
                
                // Check if clicked on scroll icon
                if (clickedObj.userData.isScrollIcon) {
                    const parentObj = clickedObj.userData.parentObject;
                    if (parentObj) {
                        // Load JSON data and show viewer
                        const objectId = parentObj.uuid;
                        const savedData = localStorage.getItem(`object_data_${objectId}`);
                        if (savedData) {
                            const data = JSON.parse(savedData);
                            if (data.isJSON) {
                                showJSONViewer(data.body);
                                
                                // Move camera to center for viewing
                                gsap.to(camera.position, {
                                    duration: 1.5,
                                    x: 0,
                                    y: 0,
                                    z: 15,
                                    ease: 'power2.inOut'
                                });
                                gsap.to(cameraTarget, {
                                    duration: 1.5,
                                    x: 0,
                                    y: 0,
                                    z: 0,
                                    ease: 'power2.inOut'
                                });
                            }
                        }
                    }
                    playSound('active');
                    return; // Don't continue with normal selection
                }
                
                // Reset previous selection
                if (selectedObject) {
                    selectedObject.material.color.setHex(selectedObject.userData.originalColor);
                    selectedObject.material.opacity = selectedObject.userData.type === 'grid' ? 0.2 : 0.8;
                    // Only set emissive if material supports it
                    if (selectedObject.material.emissive) {
                        selectedObject.material.emissive.setHex(0x000000);
                        selectedObject.material.emissiveIntensity = 0;
                    }
                }
                
                selectedObject = clickedObj;
                clickedObj.material.color.setHex(0xffffff);
                clickedObj.material.opacity = 1.0;
                // Only set emissive if material supports it
                if (clickedObj.material.emissive !== undefined) {
                    clickedObj.material.emissive.setHex(0xffffff);
                    clickedObj.material.emissiveIntensity = 0.5;
                }
                playSound('active');
                
                // Update UI
                updateInspectorPanel();
                
                // Animate camera
                gsap.to(camera.position, {
                    duration: 1.5,
                    x: clickedObj.position.x * 1.5,
                    y: clickedObj.position.y * 1.5,
                    z: clickedObj.position.z + 10,
                    ease: 'power2.inOut',
                    onUpdate: () => {
                        camera.lookAt(clickedObj.position);
                    }
                });
                
                gsap.to(cameraTarget, {
                    duration: 1.5,
                    x: clickedObj.position.x,
                    y: clickedObj.position.y,
                    z: clickedObj.position.z,
                    ease: 'power2.inOut'
                });
            } else {
                isRotating = true;
                previousMousePosition = { x: event.clientX, y: event.clientY };
            }
        }
    }

    function onMouseUp() {
        isRotating = false;
    }

    function onResize() {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    }

    function updateInspectorPanel() {
        if (selectedObject) {
            const objName = selectedObject.userData.title || selectedObject.userData.label || 'Unknown';
            document.getElementById('selected-name').textContent = objName;
            
            // Update position
            document.getElementById('object-position').textContent = 
                `X: ${selectedObject.position.x.toFixed(2)} | Y: ${selectedObject.position.y.toFixed(2)} | Z: ${selectedObject.position.z.toFixed(2)}`;
            
            // Update rotation (convert from radians to degrees)
            document.getElementById('object-rotation').textContent = 
                `X: ${(selectedObject.rotation.x * 180 / Math.PI).toFixed(2)}¬∞ | Y: ${(selectedObject.rotation.y * 180 / Math.PI).toFixed(2)}¬∞ | Z: ${(selectedObject.rotation.z * 180 / Math.PI).toFixed(2)}¬∞`;
            
            // Update scale
            document.getElementById('object-scale').textContent = 
                `X: ${selectedObject.scale.x.toFixed(2)} | Y: ${selectedObject.scale.y.toFixed(2)} | Z: ${selectedObject.scale.z.toFixed(2)}`;
            
            // Load saved object data from localStorage
            const objectId = selectedObject.uuid; // Use THREE.js UUID
            const savedData = localStorage.getItem(`object_data_${objectId}`);
            
            if (savedData) {
                const data = JSON.parse(savedData);
                document.getElementById('object-data-header').value = data.header || '';
                document.getElementById('object-data-body').value = data.body || '';
                document.getElementById('object-data-footer').value = data.footer || '';
                
                // Update labels with header, footer, and icon
                updateObjectLabel(selectedObject, data.header, data.footer, data.icon);
                
                // Add scroll icon if JSON detected
                if (data.isJSON) {
                    addScrollIconToObject(selectedObject);
                }
                
                // Show selected icon in UI
                if (data.icon) {
                    if (data.icon.type === 'image' && data.icon.imageData) {
                        document.getElementById('selected-icon-text').textContent = `Image selected`;
                    } else if (data.icon.value) {
                        document.getElementById('selected-icon-text').textContent = `Selected: ${data.icon.value}`;
                    }
                }
            } else {
                // Clear fields if no saved data
                document.getElementById('object-data-header').value = '';
                document.getElementById('object-data-body').value = '';
                document.getElementById('object-data-footer').value = '';
                document.getElementById('selected-icon-text').textContent = 'No icon selected';
            }
            
            document.getElementById('object-details').style.display = 'block';
        } else {
            document.getElementById('selected-name').textContent = 'None';
            document.getElementById('object-details').style.display = 'none';
        }
    }
    
    function setupInspectorDataSave() {
        const submitBtn = document.getElementById('object-data-submit');
        
        // Icon selector state
        let selectedIconType = 'emoji';
        let selectedIconValue = null;
        let selectedImageData = null;
        
        if (!submitBtn) {
            console.warn('Inspector submit button not found');
            return;
        }
        
        // Icon type button handlers
        document.querySelectorAll('.icon-type-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                // Remove active from all
                document.querySelectorAll('.icon-type-btn').forEach(b => {
                    b.classList.remove('active');
                    b.style.background = 'rgba(128, 128, 128, 0.3)';
                });
                
                // Add active to clicked
                btn.classList.add('active');
                btn.style.background = 'rgba(128, 128, 128, 0.5)';
                
                selectedIconType = btn.getAttribute('data-type');
                
                // Show appropriate picker
                document.getElementById('emoji-picker').style.display = selectedIconType === 'emoji' ? 'grid' : 'none';
                document.getElementById('image-picker').style.display = selectedIconType === 'image' ? 'block' : 'none';
                document.getElementById('fontawesome-picker').style.display = selectedIconType === 'fontawesome' ? 'grid' : 'none';
                
                playSound('passive');
            });
        });
        
        // Emoji selection
        document.querySelectorAll('.emoji-option').forEach(btn => {
            btn.addEventListener('click', () => {
                selectedIconValue = btn.getAttribute('data-emoji');
                document.getElementById('selected-icon-text').textContent = `Selected: ${selectedIconValue}`;
                playSound('passive');
            });
        });
        
        // FontAwesome selection
        document.querySelectorAll('.fa-option').forEach(btn => {
            btn.addEventListener('click', () => {
                selectedIconValue = btn.textContent; // Using emoji representation
                document.getElementById('selected-icon-text').textContent = `Selected: ${selectedIconValue}`;
                playSound('passive');
            });
        });
        
        // Image upload
        const imageUpload = document.getElementById('icon-image-upload');
        if (imageUpload) {
            imageUpload.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        selectedImageData = event.target.result;
                        const preview = document.getElementById('image-preview');
                        preview.innerHTML = `<img src="${selectedImageData}" style="max-width: 100%; max-height: 100%; object-fit: contain;">`;
                        document.getElementById('selected-icon-text').textContent = `Image: ${file.name}`;
                        playSound('passive');
                    };
                    reader.readAsDataURL(file);
                }
            });
        }
        
        // Save button handler
        submitBtn.addEventListener('click', () => {
            if (selectedObject) {
                const objectId = selectedObject.uuid;
                const header = document.getElementById('object-data-header').value;
                const body = document.getElementById('object-data-body').value;
                const footer = document.getElementById('object-data-footer').value;
                
                // Prepare icon data
                let iconData = null;
                if (selectedIconValue || selectedImageData) {
                    iconData = {
                        type: selectedIconType,
                        value: selectedIconValue,
                        imageData: selectedImageData
                    };
                }
                
                // Check if body contains JSON
                let isJSON = false;
                try {
                    if (body && body.trim().startsWith('{') || body.trim().startsWith('[')) {
                        JSON.parse(body);
                        isJSON = true;
                    }
                } catch (e) {
                    isJSON = false;
                }
                
                const data = {
                    header: header,
                    body: body,
                    footer: footer,
                    icon: iconData,
                    isJSON: isJSON,
                    savedAt: new Date().toISOString()
                };
                
                localStorage.setItem(`object_data_${objectId}`, JSON.stringify(data));
                
                // Update labels and icons
                updateObjectLabel(selectedObject, header, footer, iconData);
                
                // Add scroll icon if JSON detected
                if (isJSON) {
                    addScrollIconToObject(selectedObject);
                } else if (selectedObject.userData.scrollIcon) {
                    // Remove scroll icon if body is no longer JSON
                    selectedObject.remove(selectedObject.userData.scrollIcon);
                    selectedObject.userData.scrollIcon = null;
                }
                
                // Visual feedback
                submitBtn.textContent = 'SAVED!';
                submitBtn.style.background = 'rgba(74, 226, 144, 0.3)';
                submitBtn.style.borderColor = 'rgba(74, 226, 144, 0.5)';
                
                setTimeout(() => {
                    submitBtn.textContent = 'SAVE DATA';
                    submitBtn.style.background = 'rgba(128, 128, 128, 0.3)';
                    submitBtn.style.borderColor = 'rgba(128, 128, 128, 0.5)';
                }, 2000);
                
                playSound('active');
            }
        });
    }
    
    function updateObjectLabel(object, headerText, footerText, iconData) {
        // Remove existing labels
        if (object.userData.headerLabel) {
            object.remove(object.userData.headerLabel);
            if (object.userData.headerLabel.geometry) object.userData.headerLabel.geometry.dispose();
            if (object.userData.headerLabel.material) object.userData.headerLabel.material.dispose();
            object.userData.headerLabel = null;
        }
        if (object.userData.footerLabel) {
            object.remove(object.userData.footerLabel);
            if (object.userData.footerLabel.geometry) object.userData.footerLabel.geometry.dispose();
            if (object.userData.footerLabel.material) object.userData.footerLabel.material.dispose();
            object.userData.footerLabel = null;
        }
        if (object.userData.iconSprite) {
            object.remove(object.userData.iconSprite);
            if (object.userData.iconSprite.geometry) object.userData.iconSprite.geometry.dispose();
            if (object.userData.iconSprite.material) object.userData.iconSprite.material.dispose();
            object.userData.iconSprite = null;
        }
        if (object.userData.scrollIcon) {
            object.remove(object.userData.scrollIcon);
            if (object.userData.scrollIcon.geometry) object.userData.scrollIcon.geometry.dispose();
            if (object.userData.scrollIcon.material) object.userData.scrollIcon.material.dispose();
            object.userData.scrollIcon = null;
        }
        
        // Create header label if text provided
        if (headerText && headerText.trim()) {
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            canvas.width = 512;
            canvas.height = 128;
            
            // Draw background
            context.fillStyle = 'rgba(80, 80, 90, 0.9)';
            context.fillRect(0, 0, canvas.width, canvas.height);
            
            // Border
            context.strokeStyle = 'rgba(128, 128, 128, 0.5)';
            context.lineWidth = 2;
            context.strokeRect(1, 1, canvas.width - 2, canvas.height - 2);
            
            // Text with glow
            context.font = 'bold 48px Orbitron, sans-serif';
            context.textAlign = 'center';
            context.textBaseline = 'middle';
            context.shadowColor = 'rgba(255, 255, 255, 0.8)';
            context.shadowBlur = 15;
            context.fillStyle = '#ffffff';
            context.fillText(headerText, canvas.width / 2, canvas.height / 2);
            context.fillText(headerText, canvas.width / 2, canvas.height / 2);
            
            const texture = new THREE.CanvasTexture(canvas);
            const spriteMaterial = new THREE.SpriteMaterial({ 
                map: texture,
                transparent: true,
                depthTest: false,
                depthWrite: false
            });
            const sprite = new THREE.Sprite(spriteMaterial);
            sprite.scale.set(4, 1, 1);
            sprite.position.set(0, 3.5, 0); // Higher to not cover object
            object.add(sprite);
            object.userData.headerLabel = sprite;
        }
        
        // Create footer label if text provided
        if (footerText && footerText.trim()) {
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            canvas.width = 512;
            canvas.height = 128;
            
            // Draw background
            context.fillStyle = 'rgba(80, 80, 90, 0.9)';
            context.fillRect(0, 0, canvas.width, canvas.height);
            
            // Border
            context.strokeStyle = 'rgba(128, 128, 128, 0.5)';
            context.lineWidth = 2;
            context.strokeRect(1, 1, canvas.width - 2, canvas.height - 2);
            
            // Text with glow
            context.font = 'bold 38px Orbitron, sans-serif';
            context.textAlign = 'center';
            context.textBaseline = 'middle';
            context.shadowColor = 'rgba(255, 255, 255, 0.8)';
            context.shadowBlur = 15;
            context.fillStyle = '#ffffff';
            context.fillText(footerText, canvas.width / 2, canvas.height / 2);
            context.fillText(footerText, canvas.width / 2, canvas.height / 2);
            
            const texture = new THREE.CanvasTexture(canvas);
            const spriteMaterial = new THREE.SpriteMaterial({ 
                map: texture,
                transparent: true,
                depthTest: false,
                depthWrite: false
            });
            const sprite = new THREE.Sprite(spriteMaterial);
            sprite.scale.set(4, 1, 1);
            sprite.position.set(0, -2.5, 0); // Bottom of object
            object.add(sprite);
            object.userData.footerLabel = sprite;
        }
        
        // Create icon sprite if icon data provided
        if (iconData && iconData.type && iconData.value) {
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            canvas.width = 256;
            canvas.height = 256;
            
            // Semi-transparent background
            context.fillStyle = 'rgba(255, 255, 255, 0.2)';
            context.fillRect(0, 0, canvas.width, canvas.height);
            
            // Border
            context.strokeStyle = 'rgba(255, 255, 255, 0.5)';
            context.lineWidth = 4;
            context.strokeRect(2, 2, canvas.width - 4, canvas.height - 4);
            
            if (iconData.type === 'emoji' || iconData.type === 'fontawesome') {
                // Draw emoji/icon
                context.font = '120px Arial';
                context.textAlign = 'center';
                context.textBaseline = 'middle';
                context.fillStyle = '#ffffff';
                context.fillText(iconData.value, canvas.width / 2, canvas.height / 2);
            } else if (iconData.type === 'image' && iconData.imageData) {
                // Draw image
                const img = new Image();
                img.src = iconData.imageData;
                img.onload = () => {
                    context.drawImage(img, 20, 20, canvas.width - 40, canvas.height - 40);
                    const texture = new THREE.CanvasTexture(canvas);
                    if (object.userData.iconSprite && object.userData.iconSprite.material) {
                        object.userData.iconSprite.material.map = texture;
                        object.userData.iconSprite.material.needsUpdate = true;
                    }
                };
            }
            
            const texture = new THREE.CanvasTexture(canvas);
            const spriteMaterial = new THREE.SpriteMaterial({ 
                map: texture,
                transparent: true,
                depthTest: false,
                depthWrite: false
            });
            const sprite = new THREE.Sprite(spriteMaterial);
            sprite.scale.set(1.5, 1.5, 1);
            sprite.position.set(0, 0, 0.1); // Slightly in front of object
            object.add(sprite);
            object.userData.iconSprite = sprite;
        }
    }
    
    function addScrollIconToObject(object) {
        // Remove existing scroll icon
        if (object.userData.scrollIcon) {
            object.remove(object.userData.scrollIcon);
            if (object.userData.scrollIcon.geometry) object.userData.scrollIcon.geometry.dispose();
            if (object.userData.scrollIcon.material) object.userData.scrollIcon.material.dispose();
        }
        
        // Create scroll icon
        const canvas = document.createElement('canvas');
        const context = canvas.getContext('2d');
        canvas.width = 128;
        canvas.height = 128;
        
        // Background
        context.fillStyle = 'rgba(100, 100, 255, 0.8)';
        context.beginPath();
        context.arc(64, 64, 60, 0, Math.PI * 2);
        context.fill();
        
        // Border
        context.strokeStyle = 'rgba(255, 255, 255, 0.8)';
        context.lineWidth = 4;
        context.stroke();
        
        // Scroll emoji
        context.font = 'bold 60px Arial';
        context.textAlign = 'center';
        context.textBaseline = 'middle';
        context.fillStyle = '#ffffff';
        context.fillText('üìú', 64, 64);
        
        const texture = new THREE.CanvasTexture(canvas);
        const spriteMaterial = new THREE.SpriteMaterial({ 
            map: texture,
            transparent: true,
            depthTest: false,
            depthWrite: false
        });
        const sprite = new THREE.Sprite(spriteMaterial);
        sprite.scale.set(1, 1, 1);
        sprite.position.set(1.5, 1.5, 0); // Top right corner
        sprite.userData.isScrollIcon = true;
        sprite.userData.parentObject = object;
        
        object.add(sprite);
        object.userData.scrollIcon = sprite;
        
        // Add to interactive objects for clicking
        interactiveObjects.push(sprite);
    }
    
    function showJSONViewer(jsonString) {
        const panel = document.getElementById('json-viewer-panel');
        const content = document.getElementById('json-viewer-pre');
        
        if (!panel || !content) return;
        
        // Format JSON
        try {
            const parsed = JSON.parse(jsonString);
            content.textContent = JSON.stringify(parsed, null, 2);
        } catch (e) {
            content.textContent = jsonString;
        }
        
        // Show panel
        panel.style.display = 'block';
        playSound('passive');
    }
    
    function setupJSONViewer() {
        const panel = document.getElementById('json-viewer-panel');
        const minimizedTab = document.getElementById('json-viewer-minimized');
        const closeBtn = document.getElementById('close-json-viewer');
        const minimizeBtn = document.getElementById('minimize-json-viewer');
        const toggle3DBtn = document.getElementById('toggle-3d-viewer');
        const scrollUpBtn = document.getElementById('json-scroll-up');
        const scrollDownBtn = document.getElementById('json-scroll-down');
        const contentArea = document.getElementById('json-viewer-content');
        const opacitySlider = document.getElementById('json-viewer-opacity');
        const opacityValue = document.getElementById('json-viewer-opacity-value');
        
        // Opacity slider
        if (opacitySlider && opacityValue && panel) {
            opacitySlider.addEventListener('input', (e) => {
                const value = parseFloat(e.target.value);
                opacityValue.textContent = `${Math.round(value * 100)}%`;
                panel.style.background = `rgba(25, 25, 30, ${value})`;
                playSound('passive');
            });
        }
        
        // Make panel draggable
        const header = document.getElementById('json-viewer-header');
        if (header && panel) {
            let isDragging = false;
            let currentX;
            let currentY;
            let initialX;
            let initialY;
            
            header.addEventListener('mousedown', (e) => {
                if (e.target === header || header.contains(e.target)) {
                    isDragging = true;
                    const rect = panel.getBoundingClientRect();
                    initialX = e.clientX - rect.left;
                    initialY = e.clientY - rect.top;
                    panel.style.transform = 'none';
                }
            });
            
            document.addEventListener('mousemove', (e) => {
                if (isDragging) {
                    e.preventDefault();
                    currentX = e.clientX - initialX;
                    currentY = e.clientY - initialY;
                    panel.style.left = currentX + 'px';
                    panel.style.top = currentY + 'px';
                }
            });
            
            document.addEventListener('mouseup', () => {
                isDragging = false;
            });
        }
        
        // Close button
        if (closeBtn) {
            closeBtn.addEventListener('click', () => {
                panel.style.display = 'none';
                playSound('passive');
            });
        }
        
        // Minimize button
        if (minimizeBtn && panel && minimizedTab) {
            minimizeBtn.addEventListener('click', () => {
                panel.style.display = 'none';
                minimizedTab.style.display = 'block';
                playSound('passive');
            });
        }
        
        // Restore from minimized
        if (minimizedTab && panel) {
            minimizedTab.addEventListener('click', () => {
                minimizedTab.style.display = 'none';
                panel.style.display = 'block';
                playSound('passive');
            });
        }
        
        // Toggle 3D View
        if (toggle3DBtn) {
            toggle3DBtn.addEventListener('click', () => {
                // Close 2D panel
                panel.style.display = 'none';
                
                // Create or show 3D panel
                show3DDataPanel();
                playSound('active');
            });
        }
        
        // Scroll buttons
        if (scrollUpBtn && contentArea) {
            scrollUpBtn.addEventListener('click', () => {
                contentArea.scrollBy({ top: -100, behavior: 'smooth' });
                playSound('passive');
            });
        }
        
        if (scrollDownBtn && contentArea) {
            scrollDownBtn.addEventListener('click', () => {
                contentArea.scrollBy({ top: 100, behavior: 'smooth' });
                playSound('passive');
            });
        }
        
        // Close on Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                if (panel && panel.style.display === 'block') {
                    panel.style.display = 'none';
                    playSound('passive');
                }
            }
        });
    }
    
    let scene3DDataPanel = null;
    let scene3DDataTexture = null;
    
    function show3DDataPanel() {
        const jsonContent = document.getElementById('json-viewer-pre').textContent;
        
        // Remove existing 3D panel if exists
        if (scene3DDataPanel) {
            scene.remove(scene3DDataPanel);
            if (scene3DDataTexture) scene3DDataTexture.dispose();
        }
        
        // Create canvas for text
        const canvas = document.createElement('canvas');
        const context = canvas.getContext('2d');
        canvas.width = 1024;
        canvas.height = 2048;
        
        // Background
        context.fillStyle = 'rgba(25, 25, 30, 0.95)';
        context.fillRect(0, 0, canvas.width, canvas.height);
        
        // Border
        context.strokeStyle = 'rgba(255, 255, 255, 0.5)';
        context.lineWidth = 4;
        context.strokeRect(2, 2, canvas.width - 4, canvas.height - 4);
        
        // Header
        context.fillStyle = 'rgba(128, 128, 128, 0.3)';
        context.fillRect(0, 0, canvas.width, 80);
        context.font = 'bold 36px Orbitron';
        context.fillStyle = '#ffffff';
        context.textAlign = 'center';
        context.fillText('üìú DATA VIEWER', canvas.width / 2, 50);
        
        // JSON Content
        context.font = '20px Courier New';
        context.fillStyle = '#ffffff';
        context.textAlign = 'left';
        
        const lines = jsonContent.split('\n');
        let y = 120;
        const lineHeight = 28;
        const maxWidth = canvas.width - 40;
        
        lines.forEach(line => {
            if (y < canvas.height - 40) {
                // Wrap long lines
                const words = line.split(' ');
                let currentLine = '';
                
                words.forEach(word => {
                    const testLine = currentLine + word + ' ';
                    const metrics = context.measureText(testLine);
                    
                    if (metrics.width > maxWidth && currentLine !== '') {
                        context.fillText(currentLine, 20, y);
                        y += lineHeight;
                        currentLine = word + ' ';
                    } else {
                        currentLine = testLine;
                    }
                });
                
                context.fillText(currentLine, 20, y);
                y += lineHeight;
            }
        });
        
        // Scroll controls hint
        context.font = 'bold 24px Orbitron';
        context.fillStyle = 'rgba(255, 255, 255, 0.7)';
        context.textAlign = 'center';
        context.fillText('‚ñ≤ W Key - Scroll Up ‚ñ≤', canvas.width / 2, canvas.height - 50);
        context.fillText('‚ñº S Key - Scroll Down ‚ñº', canvas.width / 2, canvas.height - 20);
        
        // Create texture and material
        scene3DDataTexture = new THREE.CanvasTexture(canvas);
        const material = new THREE.MeshBasicMaterial({
            map: scene3DDataTexture,
            transparent: true,
            opacity: 0.95,
            side: THREE.DoubleSide
        });
        
        // Create plane geometry
        const geometry = new THREE.PlaneGeometry(10, 20);
        scene3DDataPanel = new THREE.Mesh(geometry, material);
        
        // Position at center
        scene3DDataPanel.position.set(0, 0, 0);
        scene3DDataPanel.userData.is3DPanel = true;
        scene3DDataPanel.userData.scrollOffset = 0;
        scene3DDataPanel.userData.jsonContent = jsonContent;
        scene3DDataPanel.userData.canvasHeight = canvas.height;
        
        scene.add(scene3DDataPanel);
        
        // Move camera to viewing position
        gsap.to(camera.position, {
            duration: 1.5,
            x: 0,
            y: 0,
            z: 15,
            ease: 'power2.inOut'
        });
        
        gsap.to(cameraTarget, {
            duration: 1.5,
            x: 0,
            y: 0,
            z: 0,
            ease: 'power2.inOut'
        });
        
        // Show 3D panel controls
        const controlsPanel = document.getElementById('panel-3d-controls');
        if (controlsPanel) {
            controlsPanel.style.display = 'block';
        }
        
        // Setup 3D panel controls
        setup3DPanelControls();
    }
    
    function setup3DPanelControls() {
        const controlsPanel = document.getElementById('panel-3d-controls');
        const closeBtn = document.getElementById('close-3d-controls');
        const header = document.getElementById('panel-3d-header');
        
        // Position controls
        const posX = document.getElementById('panel-3d-pos-x');
        const posY = document.getElementById('panel-3d-pos-y');
        const posZ = document.getElementById('panel-3d-pos-z');
        
        // Rotation controls
        const rotX = document.getElementById('panel-3d-rot-x');
        const rotY = document.getElementById('panel-3d-rot-y');
        const rotZ = document.getElementById('panel-3d-rot-z');
        
        // Scale controls
        const scaX = document.getElementById('panel-3d-sca-x');
        const scaY = document.getElementById('panel-3d-sca-y');
        const scaZ = document.getElementById('panel-3d-sca-z');
        
        // Color and opacity
        const colorPicker = document.getElementById('panel-3d-color');
        const colorValue = document.getElementById('panel-3d-color-value');
        const opacitySlider = document.getElementById('panel-3d-opacity');
        const opacityValue = document.getElementById('panel-3d-opacity-value');
        
        // Buttons
        const pocketBtn = document.getElementById('save-to-pocket-3d');
        const resetBtn = document.getElementById('reset-3d-panel');
        const removeBtn = document.getElementById('remove-3d-panel');
        
        // Close button
        if (closeBtn) {
            closeBtn.addEventListener('click', () => {
                controlsPanel.style.display = 'none';
                playSound('passive');
            });
        }
        
        // Position updates
        if (posX && scene3DDataPanel) {
            posX.addEventListener('input', (e) => {
                scene3DDataPanel.position.x = parseFloat(e.target.value);
                playSound('passive');
            });
        }
        if (posY && scene3DDataPanel) {
            posY.addEventListener('input', (e) => {
                scene3DDataPanel.position.y = parseFloat(e.target.value);
                playSound('passive');
            });
        }
        if (posZ && scene3DDataPanel) {
            posZ.addEventListener('input', (e) => {
                scene3DDataPanel.position.z = parseFloat(e.target.value);
                playSound('passive');
            });
        }
        
        // Rotation updates
        if (rotX && scene3DDataPanel) {
            rotX.addEventListener('input', (e) => {
                scene3DDataPanel.rotation.x = parseFloat(e.target.value);
                playSound('passive');
            });
        }
        if (rotY && scene3DDataPanel) {
            rotY.addEventListener('input', (e) => {
                scene3DDataPanel.rotation.y = parseFloat(e.target.value);
                playSound('passive');
            });
        }
        if (rotZ && scene3DDataPanel) {
            rotZ.addEventListener('input', (e) => {
                scene3DDataPanel.rotation.z = parseFloat(e.target.value);
                playSound('passive');
            });
        }
        
        // Scale updates
        if (scaX && scene3DDataPanel) {
            scaX.addEventListener('input', (e) => {
                scene3DDataPanel.scale.x = parseFloat(e.target.value);
                playSound('passive');
            });
        }
        if (scaY && scene3DDataPanel) {
            scaY.addEventListener('input', (e) => {
                scene3DDataPanel.scale.y = parseFloat(e.target.value);
                playSound('passive');
            });
        }
        if (scaZ && scene3DDataPanel) {
            scaZ.addEventListener('input', (e) => {
                scene3DDataPanel.scale.z = parseFloat(e.target.value);
                playSound('passive');
            });
        }
        
        // Color update
        if (colorPicker && colorValue && scene3DDataPanel) {
            colorPicker.addEventListener('input', (e) => {
                const color = e.target.value;
                colorValue.textContent = color.toUpperCase();
                updatePanelColor(color);
                playSound('passive');
            });
        }
        
        // Opacity update
        if (opacitySlider && opacityValue && scene3DDataPanel) {
            opacitySlider.addEventListener('input', (e) => {
                const value = parseFloat(e.target.value);
                opacityValue.textContent = `${Math.round(value * 100)}%`;
                scene3DDataPanel.material.opacity = value;
                playSound('passive');
            });
        }
        
        // Reset button
        if (resetBtn && scene3DDataPanel) {
            resetBtn.addEventListener('click', () => {
                // Reset to default position
                scene3DDataPanel.position.set(0, 0, 0);
                scene3DDataPanel.rotation.set(0, 0, 0);
                scene3DDataPanel.scale.set(1, 1, 1);
                
                // Reset sliders
                if (posX) posX.value = 0;
                if (posY) posY.value = 0;
                if (posZ) posZ.value = 0;
                if (rotX) rotX.value = 0;
                if (rotY) rotY.value = 0;
                if (rotZ) rotZ.value = 0;
                if (scaX) scaX.value = 1;
                if (scaY) scaY.value = 1;
                if (scaZ) scaZ.value = 1;
                
                // Reset camera
                gsap.to(camera.position, {
                    duration: 1,
                    x: 0,
                    y: 0,
                    z: 15,
                    ease: 'power2.inOut'
                });
                
                playSound('active');
            });
        }
        
        // Remove button
        if (removeBtn && scene3DDataPanel) {
            removeBtn.addEventListener('click', () => {
                if (confirm('Remove 3D panel from scene?')) {
                    scene.remove(scene3DDataPanel);
                    scene3DDataPanel = null;
                    controlsPanel.style.display = 'none';
                    playSound('active');
                }
            });
        }
        
        // Put in pocket
        if (pocketBtn) {
            pocketBtn.addEventListener('click', () => {
                // Store panel data in pocket
                const panelData = {
                    type: '3d-panel',
                    jsonContent: scene3DDataPanel.userData.jsonContent,
                    position: {
                        x: scene3DDataPanel.position.x,
                        y: scene3DDataPanel.position.y,
                        z: scene3DDataPanel.position.z
                    },
                    rotation: {
                        x: scene3DDataPanel.rotation.x,
                        y: scene3DDataPanel.rotation.y,
                        z: scene3DDataPanel.rotation.z
                    },
                    scale: {
                        x: scene3DDataPanel.scale.x,
                        y: scene3DDataPanel.scale.y,
                        z: scene3DDataPanel.scale.z
                    }
                };
                
                // Find next available pocket slot
                let slotIndex = 0;
                while (slotIndex < maxPocketSlots && pocketItems[slotIndex]) {
                    slotIndex++;
                }
                
                if (slotIndex < maxPocketSlots) {
                    pocketItems[slotIndex] = panelData;
                    localStorage.setItem(`pocket_item_${slotIndex}`, JSON.stringify(panelData));
                    
                    // Remove from scene
                    scene.remove(scene3DDataPanel);
                    scene3DDataPanel = null;
                    controlsPanel.style.display = 'none';
                    
                    // Visual feedback
                    pocketBtn.textContent = '‚úì STORED!';
                    setTimeout(() => {
                        pocketBtn.textContent = 'üíº SAVE TO POCKET';
                    }, 2000);
                    
                    playSound('active');
                } else {
                    alert('Pocket is full!');
                }
            });
        }
        
        // Make controls panel draggable
        if (header && controlsPanel) {
            let isDragging = false;
            let currentX;
            let currentY;
            let initialX;
            let initialY;
            
            header.addEventListener('mousedown', (e) => {
                if (e.target === header || header.contains(e.target.querySelector('span'))) {
                    isDragging = true;
                    const rect = controlsPanel.getBoundingClientRect();
                    initialX = e.clientX - rect.left;
                    initialY = e.clientY - rect.top;
                    controlsPanel.style.transform = 'none';
                }
            });
            
            document.addEventListener('mousemove', (e) => {
                if (isDragging) {
                    e.preventDefault();
                    currentX = e.clientX - initialX;
                    currentY = e.clientY - initialY;
                    controlsPanel.style.right = 'auto';
                    controlsPanel.style.left = currentX + 'px';
                    controlsPanel.style.top = currentY + 'px';
                }
            });
            
            document.addEventListener('mouseup', () => {
                isDragging = false;
            });
        }
    }
    
    function updatePanelColor(color) {
        if (!scene3DDataPanel) return;
        
        const jsonContent = scene3DDataPanel.userData.jsonContent;
        const canvas = document.createElement('canvas');
        const context = canvas.getContext('2d');
        canvas.width = 1024;
        canvas.height = 2048;
        
        // Convert hex to RGB
        const r = parseInt(color.substr(1,2), 16);
        const g = parseInt(color.substr(3,2), 16);
        const b = parseInt(color.substr(5,2), 16);
        
        // Background with new color
        context.fillStyle = `rgba(${r}, ${g}, ${b}, 0.95)`;
        context.fillRect(0, 0, canvas.width, canvas.height);
        
        // Border
        context.strokeStyle = 'rgba(255, 255, 255, 0.5)';
        context.lineWidth = 4;
        context.strokeRect(2, 2, canvas.width - 4, canvas.height - 4);
        
        // Header
        context.fillStyle = 'rgba(128, 128, 128, 0.3)';
        context.fillRect(0, 0, canvas.width, 80);
        context.font = 'bold 36px Orbitron';
        context.fillStyle = '#ffffff';
        context.textAlign = 'center';
        context.fillText('üìú DATA VIEWER', canvas.width / 2, 50);
        
        // JSON Content
        context.font = '20px Courier New';
        context.fillStyle = '#ffffff';
        context.textAlign = 'left';
        
        const lines = jsonContent.split('\n');
        let y = 120;
        const lineHeight = 28;
        const maxWidth = canvas.width - 40;
        
        lines.forEach(line => {
            if (y < canvas.height - 40) {
                const words = line.split(' ');
                let currentLine = '';
                
                words.forEach(word => {
                    const testLine = currentLine + word + ' ';
                    const metrics = context.measureText(testLine);
                    
                    if (metrics.width > maxWidth && currentLine !== '') {
                        context.fillText(currentLine, 20, y);
                        y += lineHeight;
                        currentLine = word + ' ';
                    } else {
                        currentLine = testLine;
                    }
                });
                
                context.fillText(currentLine, 20, y);
                y += lineHeight;
            }
        });
        
        // Scroll hints
        context.font = 'bold 24px Orbitron';
        context.fillStyle = 'rgba(255, 255, 255, 0.7)';
        context.textAlign = 'center';
        context.fillText('‚ñ≤ W Key - Scroll Up ‚ñ≤', canvas.width / 2, canvas.height - 50);
        context.fillText('‚ñº S Key - Scroll Down ‚ñº', canvas.width / 2, canvas.height - 20);
        
        // Update texture
        const newTexture = new THREE.CanvasTexture(canvas);
        scene3DDataPanel.material.map = newTexture;
        scene3DDataPanel.material.needsUpdate = true;
        
        // Dispose old texture
        if (scene3DDataTexture) scene3DDataTexture.dispose();
        scene3DDataTexture = newTexture;
    }
    
    // Add scroll functionality for 3D panel in animate loop
    window.scroll3DPanel = function(direction) {
        if (scene3DDataPanel && scene3DDataPanel.userData.is3DPanel) {
            const scrollAmount = 0.5;
            scene3DDataPanel.userData.scrollOffset += direction * scrollAmount;
            
            // Update texture offset for scrolling effect
            if (scene3DDataPanel.material.map) {
                scene3DDataPanel.material.map.offset.y = scene3DDataPanel.userData.scrollOffset * 0.001;
                scene3DDataPanel.material.map.needsUpdate = true;
            }
        }
    };


    function setupPanelControls() {
        const panel = document.getElementById('inspector-panel');
        const header = document.getElementById('panel-header');
        const minimizeBtn = document.getElementById('minimize-btn');
        const closeBtn = document.getElementById('close-btn');

        if (!panel || !header || !minimizeBtn || !closeBtn) {
            console.warn('Inspector panel elements not found');
            return;
        }

        // Minimize
        minimizeBtn.addEventListener('click', () => {
            panel.classList.toggle('minimized');
            const content = document.getElementById('panel-content');
            if (content) {
                content.classList.toggle('hidden');
            }
            minimizeBtn.textContent = panel.classList.contains('minimized') ? '‚ñ°' : '_';
        });

        // Close (hide via toggle class)
        closeBtn.addEventListener('click', () => {
            panel.classList.remove('visible');
            playSound('passive');
        });

        // Drag
        header.addEventListener('mousedown', (e) => {
            isDragging = true;
            dragStartX = e.clientX - panel.offsetLeft;
            dragStartY = e.clientY - panel.offsetTop;
        });

        document.addEventListener('mousemove', (e) => {
            if (isDragging) {
                panel.style.left = (e.clientX - dragStartX) + 'px';
                panel.style.top = (e.clientY - dragStartY) + 'px';
            }
        });

        document.addEventListener('mouseup', () => {
            isDragging = false;
            isResizing = false;
        });
        
        // Inspector resize
        const resizeHandle = document.getElementById('inspector-resize-handle');
        let isResizing = false;
        let resizeStartX, resizeStartY, resizeStartWidth, resizeStartHeight;
        
        if (resizeHandle) {
            resizeHandle.addEventListener('mousedown', (e) => {
                e.stopPropagation();
                isResizing = true;
                resizeStartX = e.clientX;
                resizeStartY = e.clientY;
                resizeStartWidth = panel.offsetWidth;
                resizeStartHeight = panel.offsetHeight;
            });
            
            document.addEventListener('mousemove', (e) => {
                if (isResizing) {
                    const newWidth = resizeStartWidth + (e.clientX - resizeStartX);
                    const newHeight = resizeStartHeight + (e.clientY - resizeStartY);
                    panel.style.width = Math.max(320, newWidth) + 'px';
                    panel.style.maxHeight = Math.max(200, newHeight) + 'px';
                }
            });
        }
        
        // View Panel
        const openViewPanelBtn = document.getElementById('open-view-panel-btn');
        const viewPanel = document.getElementById('view-panel');
        const viewPanelClose = document.getElementById('view-panel-close');
        
        if (openViewPanelBtn && viewPanel) {
            openViewPanelBtn.addEventListener('click', () => {
                if (selectedObject) {
                    // Load data into view panel
                    const objectId = selectedObject.uuid;
                    const savedData = localStorage.getItem(`object_data_${objectId}`);
                    
                    if (savedData) {
                        const data = JSON.parse(savedData);
                        document.getElementById('view-header').textContent = data.header || '‚Äî';
                        document.getElementById('view-body').textContent = data.body || '‚Äî';
                        document.getElementById('view-footer').textContent = data.footer || '‚Äî';
                    } else {
                        document.getElementById('view-header').textContent = '‚Äî';
                        document.getElementById('view-body').textContent = '‚Äî';
                        document.getElementById('view-footer').textContent = '‚Äî';
                    }
                    
                    viewPanel.style.display = 'block';
                    playSound('active');
                } else {
                    alert('No object selected. Please select an object first.');
                }
            });
        }
        
        if (viewPanelClose) {
            viewPanelClose.addEventListener('click', () => {
                viewPanel.style.display = 'none';
                playSound('passive');
            });
        }
        
        // View Panel Drag
        const viewPanelHeader = document.getElementById('view-panel-header');
        let isViewDragging = false;
        let viewDragStartX, viewDragStartY;
        
        if (viewPanelHeader && viewPanel) {
            viewPanelHeader.addEventListener('mousedown', (e) => {
                // Don't drag if clicking close button
                if (e.target.closest('#view-panel-close')) return;
                
                isViewDragging = true;
                viewDragStartX = e.clientX - viewPanel.offsetLeft;
                viewDragStartY = e.clientY - viewPanel.offsetTop;
            });
            
            document.addEventListener('mousemove', (e) => {
                if (isViewDragging) {
                    viewPanel.style.left = (e.clientX - viewDragStartX) + 'px';
                    viewPanel.style.top = (e.clientY - viewDragStartY) + 'px';
                }
            });
            
            document.addEventListener('mouseup', () => {
                isViewDragging = false;
                isViewResizing = false;
            });
        }
        
        // View Panel Resize
        const viewResizeHandle = document.getElementById('view-panel-resize-handle');
        let isViewResizing = false;
        let viewResizeStartX, viewResizeStartY, viewResizeStartWidth, viewResizeStartHeight;
        
        if (viewResizeHandle && viewPanel) {
            viewResizeHandle.addEventListener('mousedown', (e) => {
                e.stopPropagation();
                isViewResizing = true;
                viewResizeStartX = e.clientX;
                viewResizeStartY = e.clientY;
                viewResizeStartWidth = viewPanel.offsetWidth;
                viewResizeStartHeight = viewPanel.offsetHeight;
            });
            
            document.addEventListener('mousemove', (e) => {
                if (isViewResizing) {
                    const newWidth = viewResizeStartWidth + (e.clientX - viewResizeStartX);
                    const newHeight = viewResizeStartHeight + (e.clientY - viewResizeStartY);
                    viewPanel.style.width = Math.max(300, newWidth) + 'px';
                    viewPanel.style.maxHeight = Math.max(200, newHeight) + 'px';
                }
            });
        }
        
        // Copy to clipboard functionality
        document.querySelectorAll('.copy-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const field = btn.getAttribute('data-copy');
                let textToCopy = '';
                
                if (field === 'header') {
                    textToCopy = document.getElementById('view-header').textContent;
                } else if (field === 'body') {
                    textToCopy = document.getElementById('view-body').textContent;
                } else if (field === 'footer') {
                    textToCopy = document.getElementById('view-footer').textContent;
                }
                
                if (textToCopy && textToCopy !== '‚Äî') {
                    navigator.clipboard.writeText(textToCopy).then(() => {
                        const originalText = btn.textContent;
                        btn.textContent = '‚úì COPIED';
                        btn.style.background = 'rgba(74, 226, 144, 0.3)';
                        btn.style.borderColor = 'rgba(74, 226, 144, 0.5)';
                        
                        setTimeout(() => {
                            btn.textContent = originalText;
                            btn.style.background = 'rgba(128, 128, 128, 0.3)';
                            btn.style.borderColor = 'rgba(128, 128, 128, 0.5)';
                        }, 2000);
                        
                        playSound('active');
                    });
                }
            });
        });

        // FAQ panel close
        const faqClose = document.getElementById('faq-close');
        if (faqClose) {
            faqClose.addEventListener('click', () => {
                document.getElementById('faq-panel').classList.remove('visible');
            });
        }
    }

    function setupMobileControls() {
        const joystickStick = document.getElementById('joystick-stick');
        const joystickBase = joystickStick.parentElement;
        
        // Performance optimization for mobile
        let lastJoystickUpdate = 0;
        const joystickThrottle = 16; // ~60fps max

        // Joystick touch/mouse controls
        joystickStick.addEventListener('mousedown', startJoystick);
        joystickStick.addEventListener('touchstart', startJoystick, { passive: false });

        function startJoystick(e) {
            e.preventDefault();
            joystickActive = true;
            const rect = joystickBase.getBoundingClientRect();
            joystickStartPos = {
                x: rect.left + rect.width / 2,
                y: rect.top + rect.height / 2
            };

            document.addEventListener('mousemove', moveJoystick);
            document.addEventListener('touchmove', moveJoystick, { passive: false });
            document.addEventListener('mouseup', stopJoystick);
            document.addEventListener('touchend', stopJoystick);
        }

        function moveJoystick(e) {
            if (!joystickActive) return;
            
            // Throttle updates for performance on mobile
            const now = performance.now();
            if (now - lastJoystickUpdate < joystickThrottle) {
                return;
            }
            lastJoystickUpdate = now;
            
            e.preventDefault(); // Prevent scrolling on mobile
            
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;

            const deltaX = clientX - joystickStartPos.x;
            const deltaY = clientY - joystickStartPos.y;

            const distance = Math.min(45, Math.sqrt(deltaX * deltaX + deltaY * deltaY));
            const angle = Math.atan2(deltaY, deltaX);

            const maxOffset = 45;
            const offsetX = Math.cos(angle) * distance;
            const offsetY = Math.sin(angle) * distance;

            joystickStick.style.transform = `translate(calc(-50% + ${offsetX}px), calc(-50% + ${offsetY}px))`;

            // Move camera based on joystick
            const moveX = (offsetX / maxOffset) * moveSpeed;
            const moveZ = (offsetY / maxOffset) * moveSpeed;

            camera.position.x += moveX;
            camera.position.z += moveZ;
            cameraTarget.x += moveX;
            cameraTarget.z += moveZ;
        }

        function stopJoystick() {
            joystickActive = false;
            joystickStick.style.transform = 'translate(-50%, -50%)';
            document.removeEventListener('mousemove', moveJoystick);
            document.removeEventListener('touchmove', moveJoystick);
            document.removeEventListener('mouseup', stopJoystick);
            document.removeEventListener('touchend', stopJoystick);
        }

        // Mobile touch for FPS camera look (single finger on canvas)
        const canvas = renderer.domElement;
        let touchStartX = 0;
        let touchStartY = 0;
        let isTouchLooking = false;
        let lastTouchUpdate = 0;
        const touchThrottle = 16; // ~60fps max

        canvas.addEventListener('touchstart', (e) => {
            // Only handle single finger touch for camera look
            if (e.touches.length === 1) {
                const touch = e.touches[0];
                touchStartX = touch.clientX;
                touchStartY = touch.clientY;
                isTouchLooking = true;
            }
        }, { passive: true });

        canvas.addEventListener('touchmove', (e) => {
            if (isTouchLooking && e.touches.length === 1) {
                // Throttle for performance
                const now = performance.now();
                if (now - lastTouchUpdate < touchThrottle) {
                    return;
                }
                lastTouchUpdate = now;
                
                e.preventDefault();
                const touch = e.touches[0];
                
                const deltaX = touch.clientX - touchStartX;
                const deltaY = touch.clientY - touchStartY;
                
                touchStartX = touch.clientX;
                touchStartY = touch.clientY;

                // Apply FPS-style rotation (same as C key mouse look)
                if (Math.abs(deltaX) > 0.1 || Math.abs(deltaY) > 0.1) {
                    // Horizontal rotation (yaw)
                    camera.rotateOnWorldAxis(new THREE.Vector3(0, 1, 0), -deltaX * lookSensitivity * 2);
                    
                    // Vertical rotation (pitch)
                    const pitchAxis = new THREE.Vector3(1, 0, 0);
                    const pitchQuaternion = new THREE.Quaternion().setFromAxisAngle(pitchAxis, -deltaY * lookSensitivity * 2);
                    camera.quaternion.multiply(pitchQuaternion);
                    
                    // Clamp pitch
                    const forward = new THREE.Vector3(0, 0, -1);
                    forward.applyQuaternion(camera.quaternion);
                    
                    if (forward.y < -0.99) {
                        const correctionAxis = new THREE.Vector3(1, 0, 0);
                        const correctionQuaternion = new THREE.Quaternion().setFromAxisAngle(correctionAxis, -0.01);
                        camera.quaternion.multiply(correctionQuaternion);
                    } else if (forward.y > 0.99) {
                        const correctionAxis = new THREE.Vector3(1, 0, 0);
                        const correctionQuaternion = new THREE.Quaternion().setFromAxisAngle(correctionAxis, 0.01);
                        camera.quaternion.multiply(correctionQuaternion);
                    }
                }
            }
        });

        canvas.addEventListener('touchend', () => {
            isTouchLooking = false;
        });
    }

    function setupTransformPanel() {
        const transformPanel = document.getElementById('transform-panel');
        const transformClose = document.getElementById('transform-close');
        const transformTitle = document.getElementById('transform-title');
        
        const btnPos = document.getElementById('btn-pos');
        const btnRot = document.getElementById('btn-rot');
        const btnScale = document.getElementById('btn-scale');

        const transformX = document.getElementById('transform-x');
        const transformY = document.getElementById('transform-y');
        const transformZ = document.getElementById('transform-z');
        const stepSize = document.getElementById('step-size');

        transformClose.addEventListener('click', () => {
            transformPanel.style.display = 'none';
            currentTransformMode = null;
            btnPos.classList.remove('active');
            btnRot.classList.remove('active');
            btnScale.classList.remove('active');
        });

        btnPos.addEventListener('click', () => {
            showTransformPanel('POSITION', 'position', btnPos);
        });

        btnRot.addEventListener('click', () => {
            showTransformPanel('ROTATION', 'rotation', btnRot);
        });

        btnScale.addEventListener('click', () => {
            showTransformPanel('SCALE', 'scale', btnScale);
        });

        function showTransformPanel(title, mode, button) {
            transformTitle.textContent = title;
            currentTransformMode = mode;
            transformPanel.style.display = 'block';

            // Update active states
            btnPos.classList.remove('active');
            btnRot.classList.remove('active');
            btnScale.classList.remove('active');
            button.classList.add('active');

            // Update values based on selected object
            if (selectedObject) {
                if (mode === 'position') {
                    transformX.value = selectedObject.position.x.toFixed(2);
                    transformY.value = selectedObject.position.y.toFixed(2);
                    transformZ.value = selectedObject.position.z.toFixed(2);
                } else if (mode === 'rotation') {
                    transformX.value = (selectedObject.rotation.x * 180 / Math.PI).toFixed(2);
                    transformY.value = (selectedObject.rotation.y * 180 / Math.PI).toFixed(2);
                    transformZ.value = (selectedObject.rotation.z * 180 / Math.PI).toFixed(2);
                } else if (mode === 'scale') {
                    transformX.value = selectedObject.scale.x.toFixed(2);
                    transformY.value = selectedObject.scale.y.toFixed(2);
                    transformZ.value = selectedObject.scale.z.toFixed(2);
                }
            }
        }

        // Apply transform changes
        function applyTransform() {
            if (!selectedObject || !currentTransformMode) return;

            const x = parseFloat(transformX.value) || 0;
            const y = parseFloat(transformY.value) || 0;
            const z = parseFloat(transformZ.value) || 0;

            if (currentTransformMode === 'position') {
                selectedObject.position.set(x, y, z);
            } else if (currentTransformMode === 'rotation') {
                selectedObject.rotation.set(
                    x * Math.PI / 180,
                    y * Math.PI / 180,
                    z * Math.PI / 180
                );
            } else if (currentTransformMode === 'scale') {
                selectedObject.scale.set(x, y, z);
            }

            updateInspectorPanel();
            playSound('active');
        }

        // Submit button applies changes
        const transformSubmit = document.getElementById('transform-submit');
        transformSubmit.addEventListener('click', () => {
            applyTransform();
        });

        // Arrow keys for fine control (but don't apply immediately)
        [transformX, transformY, transformZ].forEach(input => {
            input.addEventListener('keydown', (e) => {
                const step = parseFloat(stepSize.value) || 1;
                const currentValue = parseFloat(input.value) || 0;

                if (e.key === 'ArrowUp') {
                    e.preventDefault();
                    input.value = (currentValue + step).toFixed(2);
                } else if (e.key === 'ArrowDown') {
                    e.preventDefault();
                    input.value = (currentValue - step).toFixed(2);
                } else if (e.key === 'Enter') {
                    e.preventDefault();
                    applyTransform();
                }
            });
        });
    }

    function setupActionGrid() {
        const actionButtons = document.querySelectorAll('.action-btn');
        
        actionButtons.forEach((btn, index) => {
            btn.addEventListener('click', () => {
                // Toggle active state
                btn.classList.toggle('active');
                
                // Custom action for each button
                console.log(`Action button ${index + 1} clicked`);
                playSound('passive');
                
                // You can add specific functionality for each button here
                // For example, save states, trigger animations, etc.
            });
        });
    }

    function setupHamburgerMenus() {
        const leftHamburger = document.getElementById('left-hamburger');
        const rightHamburger = document.getElementById('right-hamburger');
        const leftMenu = document.getElementById('left-menu');
        const rightMenu = document.getElementById('right-menu');
        const leftBreadcrumb = document.getElementById('left-breadcrumb');
        const rightBreadcrumb = document.getElementById('right-breadcrumb');

        // Toggle left menu
        leftHamburger.addEventListener('click', () => {
            leftMenu.classList.toggle('open');
            leftHamburger.classList.toggle('menu-open');
            playSound('passive');
        });

        // Toggle right menu
        rightHamburger.addEventListener('click', () => {
            rightMenu.classList.toggle('open');
            rightHamburger.classList.toggle('menu-open');
            playSound('passive');
        });

        // Handle menu item clicks for both menus
        const allMenuItems = document.querySelectorAll('.menu-item');
        allMenuItems.forEach(item => {
            const header = item.querySelector('.menu-item-header');
            
            header.addEventListener('click', (e) => {
                e.stopPropagation();
                
                // Toggle submenu expansion
                item.classList.toggle('expanded');
                
                const page = item.getAttribute('data-page');
                const isLeftMenu = item.closest('#left-menu');
                const breadcrumb = isLeftMenu ? leftBreadcrumb : rightBreadcrumb;
                const menuTitle = isLeftMenu ? 'Admin & System' : 'Navigation';
                
                // Update breadcrumb
                const pageName = header.querySelector('span').textContent;
                breadcrumb.innerHTML = `
                    <span class="breadcrumb-item" data-level="root">${menuTitle}</span>
                    <span class="breadcrumb-separator">‚Ä∫</span>
                    <span class="breadcrumb-item breadcrumb-current">${pageName}</span>
                `;
                
                playSound('passive');
            });
        });

        // Handle submenu item clicks
        const allSubmenuItems = document.querySelectorAll('.submenu-item');
        allSubmenuItems.forEach(subitem => {
            subitem.addEventListener('click', (e) => {
                e.stopPropagation();
                
                const submenuId = subitem.getAttribute('data-submenu');
                
                // Handle special admin items
                if (submenuId === 'admin-restart') {
                    document.getElementById('restart-prompt').classList.add('visible');
                    playSound('active');
                    return;
                }
                
                if (submenuId === 'admin-theme') {
                    initThemeSelector();
                    document.getElementById('theme-prompt').classList.add('visible');
                    playSound('active');
                    return;
                }
                
                if (submenuId === 'admin-08') {
                    document.getElementById('particle-behavior-panel').style.display = 'block';
                    playSound('active');
                    return;
                }
                
                if (submenuId === 'system-01') {
                    // Open MySpace Grid Panel
                    document.getElementById('myspace-grid-panel').style.display = 'block';
                    playSound('active');
                    return;
                }
                
                if (submenuId === 'system-11') {
                    // Toggle header bar visibility
                    const headerBar = document.getElementById('header-bar');
                    if (headerBar.style.display === 'none') {
                        headerBar.style.display = 'flex';
                    } else {
                        headerBar.style.display = 'none';
                    }
                    playSound('active');
                    return;
                }
                
                const parentItem = subitem.closest('.menu-item');
                const page = parentItem.getAttribute('data-page');
                const isLeftMenu = subitem.closest('#left-menu');
                const breadcrumb = isLeftMenu ? leftBreadcrumb : rightBreadcrumb;
                const menuTitle = isLeftMenu ? 'Admin & System' : 'Navigation';
                const pageName = parentItem.querySelector('.menu-item-header span').textContent;
                
                // Update breadcrumb with submenu
                breadcrumb.innerHTML = `
                    <span class="breadcrumb-item" data-level="root">${menuTitle}</span>
                    <span class="breadcrumb-separator">‚Ä∫</span>
                    <span class="breadcrumb-item" data-level="page">${pageName}</span>
                    <span class="breadcrumb-separator">‚Ä∫</span>
                    <span class="breadcrumb-item breadcrumb-current">${subitem.textContent}</span>
                `;
                
                playSound('active');
                
                console.log('Submenu clicked:', submenuId, 'Parent:', page);
                // You can add navigation logic here
            });
        });

        // Breadcrumb navigation
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('breadcrumb-item') && e.target.getAttribute('data-level')) {
                const level = e.target.getAttribute('data-level');
                const isLeftMenu = e.target.closest('#left-menu');
                const breadcrumb = isLeftMenu ? leftBreadcrumb : rightBreadcrumb;
                const menuTitle = isLeftMenu ? 'Admin & System' : 'Navigation';
                
                if (level === 'root') {
                    breadcrumb.innerHTML = `
                        <span class="breadcrumb-item breadcrumb-current">${menuTitle}</span>
                    `;
                    // Collapse all submenus
                    const menu = isLeftMenu ? leftMenu : rightMenu;
                    menu.querySelectorAll('.menu-item').forEach(item => {
                        item.classList.remove('expanded');
                    });
                } else if (level === 'page') {
                    const pageName = e.target.textContent;
                    breadcrumb.innerHTML = `
                        <span class="breadcrumb-item" data-level="root">${menuTitle}</span>
                        <span class="breadcrumb-separator">‚Ä∫</span>
                        <span class="breadcrumb-item breadcrumb-current">${pageName}</span>
                    `;
                }
                playSound('passive');
            }
        });

        // Close menus when clicking outside
        document.addEventListener('click', (e) => {
            if (!leftMenu.contains(e.target) && !leftHamburger.contains(e.target)) {
                leftMenu.classList.remove('open');
                leftHamburger.classList.remove('menu-open');
            }
            if (!rightMenu.contains(e.target) && !rightHamburger.contains(e.target)) {
                rightMenu.classList.remove('open');
                rightHamburger.classList.remove('menu-open');
            }
        });
    }

    function setupDockDragDrop() {
        const dockItems = document.querySelectorAll('.dock-item');
        const docks = document.querySelectorAll('.dock');
        let draggedItem = null;

        dockItems.forEach(item => {
            item.addEventListener('dragstart', (e) => {
                draggedItem = item;
                item.classList.add('dragging');
                e.dataTransfer.effectAllowed = 'move';
                playSound('hover');
            });

            item.addEventListener('dragend', () => {
                item.classList.remove('dragging');
                draggedItem = null;
            });
        });

        docks.forEach(dock => {
            dock.addEventListener('dragover', (e) => {
                e.preventDefault();
                e.dataTransfer.dropEffect = 'move';
                dock.classList.add('drag-over');
            });

            dock.addEventListener('dragleave', () => {
                dock.classList.remove('drag-over');
            });

            dock.addEventListener('drop', (e) => {
                e.preventDefault();
                dock.classList.remove('drag-over');
                
                if (draggedItem && draggedItem.parentElement !== dock) {
                    // Remove from old dock
                    draggedItem.parentElement.removeChild(draggedItem);
                    
                    // Add to new dock
                    dock.appendChild(draggedItem);
                    
                    playSound('active');
                }
            });
        });
    }

    function setupTimer() {
        const timerElement = document.getElementById('session-timer');
        
        function updateTimer() {
            const elapsed = Date.now() - sessionStartTime;
            const hours = Math.floor(elapsed / 3600000);
            const minutes = Math.floor((elapsed % 3600000) / 60000);
            const seconds = Math.floor((elapsed % 60000) / 1000);
            const milliseconds = elapsed % 1000;
            
            timerElement.textContent = 
                `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}.${milliseconds.toString().padStart(3, '0')}`;
        }
        
        // Update timer every 10ms for smooth milliseconds
        timerInterval = setInterval(updateTimer, 10);
        updateTimer(); // Initial call
    }

    function setupTimezone() {
        const timezoneDisplay = document.getElementById('timezone-display');
        const timezoneSelector = document.getElementById('timezone-selector');
        const currentTimeEl = document.getElementById('current-time');
        const timezoneAbbr = document.getElementById('timezone-abbr');
        const autoDetectBtn = document.getElementById('auto-detect-tz');
        
        let selectedTimezone = localStorage.getItem('userTimezone') || 'America/New_York';
        let timezoneInterval;
        
        const timezoneAbbreviations = {
            'America/New_York': 'EST',
            'America/Chicago': 'CST',
            'America/Denver': 'MST',
            'America/Los_Angeles': 'PST',
            'Europe/London': 'GMT',
            'Europe/Paris': 'CET',
            'Asia/Tokyo': 'JST',
            'Australia/Sydney': 'AEDT'
        };
        
        function updateClock() {
            const now = new Date();
            const options = { 
                timeZone: selectedTimezone,
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: true
            };
            const timeString = now.toLocaleTimeString('en-US', options);
            currentTimeEl.textContent = timeString;
            timezoneAbbr.textContent = timezoneAbbreviations[selectedTimezone] || 'UTC';
        }
        
        // Toggle timezone selector
        timezoneDisplay.addEventListener('click', (e) => {
            e.stopPropagation();
            const isVisible = timezoneSelector.style.display === 'block';
            timezoneSelector.style.display = isVisible ? 'none' : 'block';
            playSound('passive');
        });
        
        // Close selector when clicking outside
        document.addEventListener('click', (e) => {
            if (!timezoneDisplay.contains(e.target)) {
                timezoneSelector.style.display = 'none';
            }
        });
        
        // Timezone option selection
        document.querySelectorAll('.timezone-option').forEach(option => {
            option.addEventListener('click', () => {
                selectedTimezone = option.getAttribute('data-tz');
                localStorage.setItem('userTimezone', selectedTimezone);
                updateClock();
                timezoneSelector.style.display = 'none';
                playSound('active');
            });
            
            // Hover effect
            option.addEventListener('mouseenter', () => {
                option.style.background = 'rgba(128, 128, 128, 0.3)';
            });
            option.addEventListener('mouseleave', () => {
                option.style.background = 'transparent';
            });
        });
        
        // Auto-detect timezone
        if (autoDetectBtn) {
            autoDetectBtn.addEventListener('click', () => {
                try {
                    const detectedTZ = Intl.DateTimeFormat().resolvedOptions().timeZone;
                    selectedTimezone = detectedTZ;
                    localStorage.setItem('userTimezone', detectedTZ);
                    updateClock();
                    timezoneSelector.style.display = 'none';
                    playSound('active');
                    
                    // Show feedback
                    autoDetectBtn.textContent = `‚úì Detected: ${detectedTZ}`;
                    setTimeout(() => {
                        autoDetectBtn.textContent = 'üåê Auto-Detect Location';
                    }, 2000);
                } catch (error) {
                    console.error('Could not detect timezone', error);
                }
            });
        }
        
        // Start clock
        updateClock();
        timezoneInterval = setInterval(updateClock, 1000);
    }

    function setupSearchPanel() {
        const searchPanel = document.getElementById('search-panel');
        const searchInput = document.getElementById('search-input');
        
        searchPanel.addEventListener('click', (e) => {
            if (searchPanel.classList.contains('collapsed')) {
                searchPanel.classList.remove('collapsed');
                searchPanel.classList.add('expanded');
                playSound('passive');
                // Focus input after animation
                setTimeout(() => searchInput.focus(), 300);
            }
        });
        
        // Click outside to collapse
        document.addEventListener('click', (e) => {
            if (!searchPanel.contains(e.target) && searchPanel.classList.contains('expanded')) {
                searchPanel.classList.remove('expanded');
                searchPanel.classList.add('collapsed');
                searchInput.value = ''; // Clear on collapse
            }
        });
        
        // Search functionality
        searchInput.addEventListener('input', (e) => {
            const query = e.target.value.toLowerCase();
            console.log('Search query:', query);
            // You can add actual search functionality here
        });
        
        // Prevent Enter from closing
        searchInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                console.log('Search submitted:', searchInput.value);
                // Add search action here
            }
        });
    }

    function animate() {
        requestAnimationFrame(animate);
        
        // FPS tracking
        const currentTime = performance.now();
        const delta = currentTime - lastFrameTime;
        lastFrameTime = currentTime;
        fpsFrames++;
        fpsTime += delta;
        
        if (fpsTime >= 1000) {
            fps = Math.round((fpsFrames * 1000) / fpsTime);
            document.getElementById('fps-counter').textContent = `${fps}`;
            fpsFrames = 0;
            fpsTime = 0;
        }
        
        // Update entrance sequence
        if (isEntranceActive) {
            updateEntranceSequence(delta / 1000);
            renderer.render(scene, camera);
            return; // Skip other updates during entrance
        }
        
        // Performance optimization for mobile/iPad
        const isMobile = window.innerWidth < 1024;
        if (isMobile) {
            // Reduce particle system updates on mobile
            if (Math.random() > 0.5) {
                // Skip half the particle updates for better performance
                renderer.render(scene, camera);
                return;
            }
        }
        
        // Animate particle energy state
        if (particleSystem) {
            // When C key is held (focus mode), make particle tunnel follow mouse
            if (keys.c) {
                // Convert mouse coordinates to camera-local offset
                // mouse.x and mouse.y are in range -1 to 1
                const offsetScale = 5; // How much particles offset from center
                particleSystem.position.x = mouse.x * offsetScale;
                particleSystem.position.y = mouse.y * offsetScale;
            } else {
                // Reset to center when not focusing
                particleSystem.position.x = 0;
                particleSystem.position.y = 0;
            }
            
            const positions = particleSystem.geometry.attributes.position.array;
            
            if (particleBehaviorMode === 'calm') {
                // CALM MODE: Original gentle floating behavior
                for (let i = 0; i < particleCount; i++) {
                    const i3 = i * 3;
                    
                    // Update positions with gentle movement
                    positions[i3] += particleVelocities[i3];
                    positions[i3 + 1] += particleVelocities[i3 + 1];
                    positions[i3 + 2] += particleVelocities[i3 + 2];
                    
                    // Calculate distance from center
                    const x = positions[i3];
                    const y = positions[i3 + 1];
                    const z = positions[i3 + 2];
                    const distance = Math.sqrt(x * x + y * y + z * z);
                    
                    // Keep particles within sphere bounds (8-12 radius)
                    if (distance > 12 || distance < 8) {
                        // Reverse velocity if hitting boundaries
                        const normalX = x / distance;
                        const normalY = y / distance;
                        const normalZ = z / distance;
                        
                        // Reflect velocity
                        const dot = particleVelocities[i3] * normalX + 
                                   particleVelocities[i3 + 1] * normalY + 
                                   particleVelocities[i3 + 2] * normalZ;
                        
                        particleVelocities[i3] -= 2 * dot * normalX;
                        particleVelocities[i3 + 1] -= 2 * dot * normalY;
                        particleVelocities[i3 + 2] -= 2 * dot * normalZ;
                        
                        // Clamp to boundary
                        const targetRadius = distance > 12 ? 12 : 8;
                        positions[i3] = normalX * targetRadius;
                        positions[i3 + 1] = normalY * targetRadius;
                        positions[i3 + 2] = normalZ * targetRadius;
                    }
                    
                    // Add gentle pulsing effect
                    const pulseSpeed = 0.001;
                    const pulseAmount = Math.sin(Date.now() * pulseSpeed + i * 0.1) * 0.01;
                    positions[i3] *= (1 + pulseAmount);
                    positions[i3 + 1] *= (1 + pulseAmount);
                    positions[i3 + 2] *= (1 + pulseAmount);
                }
                
                // Gentle rotation for calm mode
                particleSystem.rotation.y += 0.0005;
                
            } else if (particleBehaviorMode === 'forward') {
                // FORWARD MODE: Particles flow straight toward user (lightspeed tunnel)
                const flowSpeed = forwardFlowSpeed * 2;
                
                for (let i = 0; i < particleCount; i++) {
                    const i3 = i * 3;
                    
                    // Move particles straight toward camera (negative Z in camera space)
                    positions[i3 + 2] -= flowSpeed;
                    
                    // Reset particles that pass through camera
                    if (positions[i3 + 2] < -5) {
                        // Respawn at far edge in CIRCULAR pattern (tunnel effect)
                        const angle = Math.random() * Math.PI * 2;
                        const radius = Math.sqrt(Math.random()) * 10; // Circular distribution
                        
                        positions[i3] = Math.cos(angle) * radius; // X position
                        positions[i3 + 1] = Math.sin(angle) * radius; // Y position
                        positions[i3 + 2] = 15; // Far Z edge
                    }
                }
                
            } else if (particleBehaviorMode === 'backward') {
                // BACKWARD MODE: Particles flow away from user (reverse tunnel)
                const flowSpeed = backwardFlowSpeed * 2;
                
                for (let i = 0; i < particleCount; i++) {
                    const i3 = i * 3;
                    
                    // Move particles away from camera (positive Z)
                    positions[i3 + 2] += flowSpeed;
                    
                    // Reset particles that go too far
                    if (positions[i3 + 2] > 15) {
                        // Respawn at near edge in CIRCULAR pattern (tunnel effect)
                        const angle = Math.random() * Math.PI * 2;
                        const radius = Math.sqrt(Math.random()) * 10; // Circular distribution
                        
                        positions[i3] = Math.cos(angle) * radius; // X position
                        positions[i3 + 1] = Math.sin(angle) * radius; // Y position
                        positions[i3 + 2] = -5; // Near Z edge
                    }
                }
                
            } else if (particleBehaviorMode === 'connected') {
                // CONNECTED MODE: Draw lines between nearby particles (particles.js style)
                // First do gentle float like CALM
                for (let i = 0; i < particleCount; i++) {
                    const i3 = i * 3;
                    
                    positions[i3] += particleVelocities[i3];
                    positions[i3 + 1] += particleVelocities[i3 + 1];
                    positions[i3 + 2] += particleVelocities[i3 + 2];
                    
                    const x = positions[i3];
                    const y = positions[i3 + 1];
                    const z = positions[i3 + 2];
                    const distance = Math.sqrt(x * x + y * y + z * z);
                    
                    if (distance > 12 || distance < 8) {
                        const normalX = x / distance;
                        const normalY = y / distance;
                        const normalZ = z / distance;
                        
                        const dot = particleVelocities[i3] * normalX + 
                                   particleVelocities[i3 + 1] * normalY + 
                                   particleVelocities[i3 + 2] * normalZ;
                        
                        particleVelocities[i3] -= 2 * dot * normalX;
                        particleVelocities[i3 + 1] -= 2 * dot * normalY;
                        particleVelocities[i3 + 2] -= 2 * dot * normalZ;
                        
                        const targetRadius = distance > 12 ? 12 : 8;
                        positions[i3] = normalX * targetRadius;
                        positions[i3 + 1] = normalY * targetRadius;
                        positions[i3 + 2] = normalZ * targetRadius;
                    }
                }
                
                // Draw connection lines
                // Remove old lines if they exist
                if (window.particleLines) {
                    scene.remove(window.particleLines);
                    window.particleLines.geometry.dispose();
                    window.particleLines.material.dispose();
                }
                
                const lineGeometry = new THREE.BufferGeometry();
                const linePositions = [];
                const maxDistance = 5 * connectionFrequency; // Frequency affects connection distance
                
                // Check connections between particles
                for (let i = 0; i < particleCount; i++) {
                    const i3 = i * 3;
                    const x1 = positions[i3];
                    const y1 = positions[i3 + 1];
                    const z1 = positions[i3 + 2];
                    
                    // Only check a subset of particles for performance
                    const checkCount = Math.floor(10 * connectionFrequency) + 1;
                    for (let j = 0; j < checkCount; j++) {
                        const randomIdx = Math.floor(Math.random() * particleCount);
                        if (randomIdx === i) continue;
                        
                        const j3 = randomIdx * 3;
                        const x2 = positions[j3];
                        const y2 = positions[j3 + 1];
                        const z2 = positions[j3 + 2];
                        
                        const dx = x2 - x1;
                        const dy = y2 - y1;
                        const dz = z2 - z1;
                        const dist = Math.sqrt(dx * dx + dy * dy + dz * dz);
                        
                        if (dist < maxDistance) {
                            linePositions.push(x1, y1, z1);
                            linePositions.push(x2, y2, z2);
                        }
                    }
                }
                
                if (linePositions.length > 0) {
                    lineGeometry.setAttribute('position', new THREE.Float32BufferAttribute(linePositions, 3));
                    const lineMaterial = new THREE.LineBasicMaterial({
                        color: 0xffffff,
                        opacity: 0.3 * connectionFrequency,
                        transparent: true,
                        blending: THREE.AdditiveBlending
                    });
                    window.particleLines = new THREE.LineSegments(lineGeometry, lineMaterial);
                    camera.add(window.particleLines); // Attach to camera like particles
                }
                
                particleSystem.rotation.y += 0.0003;
                
            } else if (particleBehaviorMode === 'glitch') {
                // GLITCH MODE: Random teleportation/glitch effect
                const glitchChance = glitchIntensity * 0.1; // Higher intensity = more glitches
                const glitchDistance = glitchIntensity * 5; // How far particles can teleport
                
                for (let i = 0; i < particleCount; i++) {
                    const i3 = i * 3;
                    
                    // Random chance to glitch
                    if (Math.random() < glitchChance) {
                        // Teleport to random nearby position
                        const angle = Math.random() * Math.PI * 2;
                        const radius = Math.sqrt(Math.random()) * glitchDistance;
                        const zOffset = (Math.random() - 0.5) * glitchDistance;
                        
                        positions[i3] += Math.cos(angle) * radius;
                        positions[i3 + 1] += Math.sin(angle) * radius;
                        positions[i3 + 2] += zOffset;
                    } else {
                        // Normal gentle movement
                        positions[i3] += particleVelocities[i3] * 0.5;
                        positions[i3 + 1] += particleVelocities[i3 + 1] * 0.5;
                        positions[i3 + 2] += particleVelocities[i3 + 2] * 0.5;
                    }
                    
                    // Keep in bounds
                    const x = positions[i3];
                    const y = positions[i3 + 1];
                    const z = positions[i3 + 2];
                    const distance = Math.sqrt(x * x + y * y + z * z);
                    
                    if (distance > 12) {
                        const normalX = x / distance;
                        const normalY = y / distance;
                        const normalZ = z / distance;
                        positions[i3] = normalX * 12;
                        positions[i3 + 1] = normalY * 12;
                        positions[i3 + 2] = normalZ * 12;
                    }
                }
                
                // Jittery rotation
                particleSystem.rotation.y += (Math.random() - 0.5) * 0.01 * glitchIntensity;
                
            } else if (particleBehaviorMode === 'constellation') {
                // CONSTELLATION MODE: Random connections between all particles
                // Gentle float like CALM
                for (let i = 0; i < particleCount; i++) {
                    const i3 = i * 3;
                    
                    positions[i3] += particleVelocities[i3];
                    positions[i3 + 1] += particleVelocities[i3 + 1];
                    positions[i3 + 2] += particleVelocities[i3 + 2];
                    
                    const x = positions[i3];
                    const y = positions[i3 + 1];
                    const z = positions[i3 + 2];
                    const distance = Math.sqrt(x * x + y * y + z * z);
                    
                    if (distance > 12 || distance < 8) {
                        const normalX = x / distance;
                        const normalY = y / distance;
                        const normalZ = z / distance;
                        
                        const dot = particleVelocities[i3] * normalX + 
                                   particleVelocities[i3 + 1] * normalY + 
                                   particleVelocities[i3 + 2] * normalZ;
                        
                        particleVelocities[i3] -= 2 * dot * normalX;
                        particleVelocities[i3 + 1] -= 2 * dot * normalY;
                        particleVelocities[i3 + 2] -= 2 * dot * normalZ;
                        
                        const targetRadius = distance > 12 ? 12 : 8;
                        positions[i3] = normalX * targetRadius;
                        positions[i3 + 1] = normalY * targetRadius;
                        positions[i3 + 2] = normalZ * targetRadius;
                    }
                }
                
                // Draw random constellation lines
                if (window.particleLines) {
                    scene.remove(window.particleLines);
                    window.particleLines.geometry.dispose();
                    window.particleLines.material.dispose();
                }
                
                const lineGeometry = new THREE.BufferGeometry();
                const linePositions = [];
                
                // Each particle randomly connects to a few nearby particles
                for (let i = 0; i < particleCount; i++) {
                    const i3 = i * 3;
                    const x1 = positions[i3];
                    const y1 = positions[i3 + 1];
                    const z1 = positions[i3 + 2];
                    
                    // Random number of connections per particle (1-3)
                    const connectionCount = Math.floor(Math.random() * 3) + 1;
                    
                    for (let c = 0; c < connectionCount; c++) {
                        const randomIdx = Math.floor(Math.random() * particleCount);
                        if (randomIdx === i) continue;
                        
                        const j3 = randomIdx * 3;
                        const x2 = positions[j3];
                        const y2 = positions[j3 + 1];
                        const z2 = positions[j3 + 2];
                        
                        const dx = x2 - x1;
                        const dy = y2 - y1;
                        const dz = z2 - z1;
                        const dist = Math.sqrt(dx * dx + dy * dy + dz * dz);
                        
                        if (dist < constellationDistance) {
                            linePositions.push(x1, y1, z1);
                            linePositions.push(x2, y2, z2);
                        }
                    }
                }
                
                if (linePositions.length > 0) {
                    lineGeometry.setAttribute('position', new THREE.Float32BufferAttribute(linePositions, 3));
                    const lineMaterial = new THREE.LineBasicMaterial({
                        color: 0xffffff,
                        opacity: 0.2,
                        transparent: true,
                        blending: THREE.AdditiveBlending
                    });
                    window.particleLines = new THREE.LineSegments(lineGeometry, lineMaterial);
                    camera.add(window.particleLines); // Attach to camera like particles
                }
            }
            
            particleSystem.geometry.attributes.position.needsUpdate = true;
        }
        
        // Camera breathing effect
        breathTime += 0.016 * breathSpeed; // Assuming ~60fps
        const breathOffset = Math.sin(breathTime) * breathIntensity;
        
        // Apply subtle breathing to camera position (up/down)
        if (!keys.r && !keys.f) { // Only when not manually moving up/down
            const breathDelta = breathOffset - (camera.userData.lastBreathOffset || 0);
            camera.position.y += breathDelta;
            camera.userData.lastBreathOffset = breathOffset;
        } else {
            camera.userData.lastBreathOffset = 0;
        }
        
        // Check if 3D data panel is active
        const has3DPanel = scene3DDataPanel && scene3DDataPanel.userData.is3DPanel;
        
        // WASD camera movement (or 3D panel scrolling if active)
        if (keys.w) {
            if (has3DPanel) {
                // Scroll 3D panel up
                if (window.scroll3DPanel) window.scroll3DPanel(-1);
            } else {
                const forward = new THREE.Vector3(0, 0, -1);
                forward.applyQuaternion(camera.quaternion);
                camera.position.add(forward.multiplyScalar(moveSpeed));
            }
        }
        if (keys.s) {
            if (has3DPanel) {
                // Scroll 3D panel down
                if (window.scroll3DPanel) window.scroll3DPanel(1);
            } else {
                const backward = new THREE.Vector3(0, 0, 1);
                backward.applyQuaternion(camera.quaternion);
                camera.position.add(backward.multiplyScalar(moveSpeed));
            }
        }
        if (keys.a) {
            const left = new THREE.Vector3(-1, 0, 0);
            left.applyQuaternion(camera.quaternion);
            camera.position.add(left.multiplyScalar(moveSpeed));
        }
        if (keys.d) {
            const right = new THREE.Vector3(1, 0, 0);
            right.applyQuaternion(camera.quaternion);
            camera.position.add(right.multiplyScalar(moveSpeed));
        }
        if (keys.r) {
            camera.position.y += moveSpeed;
        }
        if (keys.f) {
            camera.position.y -= moveSpeed;
        }
        
        // Update inspector panel in real-time if object is selected
        if (selectedObject && document.getElementById('inspector-panel').classList.contains('visible')) {
            document.getElementById('object-position').textContent = 
                `X: ${selectedObject.position.x.toFixed(2)} | Y: ${selectedObject.position.y.toFixed(2)} | Z: ${selectedObject.position.z.toFixed(2)}`;
            document.getElementById('object-rotation').textContent = 
                `X: ${(selectedObject.rotation.x * 180 / Math.PI).toFixed(2)}¬∞ | Y: ${(selectedObject.rotation.y * 180 / Math.PI).toFixed(2)}¬∞ | Z: ${(selectedObject.rotation.z * 180 / Math.PI).toFixed(2)}¬∞`;
            document.getElementById('object-scale').textContent = 
                `X: ${selectedObject.scale.x.toFixed(2)} | Y: ${selectedObject.scale.y.toFixed(2)} | Z: ${selectedObject.scale.z.toFixed(2)}`;
        }
        
        // Update coordinate guide in navbar
        document.getElementById('coord-pos-x').textContent = `X: ${camera.position.x.toFixed(2)}`;
        document.getElementById('coord-pos-y').textContent = `Y: ${camera.position.y.toFixed(2)}`;
        document.getElementById('coord-pos-z').textContent = `Z: ${camera.position.z.toFixed(2)}`;
        
        const rotX = (camera.rotation.x * 180 / Math.PI).toFixed(2);
        const rotY = (camera.rotation.y * 180 / Math.PI).toFixed(2);
        const rotZ = (camera.rotation.z * 180 / Math.PI).toFixed(2);
        document.getElementById('coord-rot-x').textContent = `X: ${rotX}¬∞`;
        document.getElementById('coord-rot-y').textContent = `Y: ${rotY}¬∞`;
        document.getElementById('coord-rot-z').textContent = `Z: ${rotZ}¬∞`;
        
        document.getElementById('coord-sca-x').textContent = `X: ${camera.scale.x.toFixed(2)}`;
        document.getElementById('coord-sca-y').textContent = `Y: ${camera.scale.y.toFixed(2)}`;
        document.getElementById('coord-sca-z').textContent = `Z: ${camera.scale.z.toFixed(2)}`;
        
        // Update ruler markers
        const xMarker = document.getElementById('x-marker');
        const yMarker = document.getElementById('y-marker');
        const zMarker = document.getElementById('z-marker');
        if (xMarker && yMarker && zMarker) {
            // Map camera position (-50 to +50) to ruler position (0% to 100%)
            const xPercent = ((camera.position.x + 50) / 100) * 100;
            const yPercent = ((camera.position.y + 50) / 100) * 100;
            const zPercent = ((camera.position.z + 50) / 100) * 100;
            xMarker.style.left = Math.max(0, Math.min(100, xPercent)) + '%';
            yMarker.style.top = Math.max(0, Math.min(100, 100 - yPercent)) + '%'; // Inverted for visual consistency
            zMarker.style.top = Math.max(0, Math.min(100, 100 - zPercent)) + '%'; // Inverted for visual consistency
        }
        
        renderer.render(scene, camera);
    }

    // Start
    init();

    // Make functions globally accessible for inline handlers
    window.showWisdomPrompt = showWisdomPrompt;
</script>
</body>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/gsap.min.js"></script>
    <script src="app.js"></script>
</body>
</html>
